function abstract(){return function(){throw new Error("Unimplemented abstract method.")}()}var uidCounter_=0;function getUid(obj){return obj.ol_uid||(obj.ol_uid=String(++uidCounter_))}var VERSION="5.3.3",AssertionError=function(Error){function AssertionError(code){var message="Assertion failed. See https://openlayers.org/en/"+("v"+VERSION.split("-")[0])+"/doc/errors/#"+code+" for details.";Error.call(this,message),this.code=code,this.name="AssertionError",this.message=message}return Error&&(AssertionError.__proto__=Error),AssertionError.prototype=Object.create(Error&&Error.prototype),AssertionError.prototype.constructor=AssertionError,AssertionError}(Error),CollectionEventType={ADD:"add",REMOVE:"remove"},ObjectEventType={PROPERTYCHANGE:"propertychange"},assign="function"==typeof Object.assign?Object.assign:function(target,var_sources){var arguments$1=arguments;if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),i=1,ii=arguments.length;i<ii;++i){var source=arguments$1[i];if(null!=source)for(var key in source)source.hasOwnProperty(key)&&(output[key]=source[key])}return output};function clear(object){for(var property in object)delete object[property]}function getValues(object){var values=[];for(var property in object)values.push(object[property]);return values}function isEmpty(object){var property;for(property in object)return!1;return!property}function bindListener(listenerObj){var boundListener=function(evt){var listener=listenerObj.listener,bindTo=listenerObj.bindTo||listenerObj.target;return listenerObj.callOnce&&unlistenByKey(listenerObj),listener.call(bindTo,evt)};return listenerObj.boundListener=boundListener,boundListener}function findListener(listeners,listener,opt_this,opt_setDeleteIndex){for(var listenerObj,i=0,ii=listeners.length;i<ii;++i)if((listenerObj=listeners[i]).listener===listener&&listenerObj.bindTo===opt_this)return opt_setDeleteIndex&&(listenerObj.deleteIndex=i),listenerObj}function getListeners(target,type){var listenerMap=getListenerMap(target);return listenerMap?listenerMap[type]:void 0}function getListenerMap(target,opt_create){var listenerMap=target.ol_lm;return!listenerMap&&opt_create&&(listenerMap=target.ol_lm={}),listenerMap}function removeListenerMap(target){delete target.ol_lm}function removeListeners(target,type){var listeners=getListeners(target,type);if(listeners){for(var i=0,ii=listeners.length;i<ii;++i)target.removeEventListener(type,listeners[i].boundListener),clear(listeners[i]);listeners.length=0;var listenerMap=getListenerMap(target);listenerMap&&(delete listenerMap[type],0===Object.keys(listenerMap).length&&removeListenerMap(target))}}function listen(target,type,listener,opt_this,opt_once){var listenerMap=getListenerMap(target,!0),listeners=listenerMap[type];listeners||(listeners=listenerMap[type]=[]);var listenerObj=findListener(listeners,listener,opt_this,!1);return listenerObj?opt_once||(listenerObj.callOnce=!1):(listenerObj={bindTo:opt_this,callOnce:!!opt_once,listener:listener,target:target,type:type},target.addEventListener(type,bindListener(listenerObj)),listeners.push(listenerObj)),listenerObj}function listenOnce(target,type,listener,opt_this){return listen(target,type,listener,opt_this,!0)}function unlisten(target,type,listener,opt_this){var listeners=getListeners(target,type);if(listeners){var listenerObj=findListener(listeners,listener,opt_this,!0);listenerObj&&unlistenByKey(listenerObj)}}function unlistenByKey(key){if(key&&key.target){key.target.removeEventListener(key.type,key.boundListener);var listeners=getListeners(key.target,key.type);if(listeners){var i="deleteIndex"in key?key.deleteIndex:listeners.indexOf(key);-1!==i&&listeners.splice(i,1),0===listeners.length&&removeListeners(key.target,key.type)}clear(key)}}function unlistenAll(target){var listenerMap=getListenerMap(target);if(listenerMap)for(var type in listenerMap)removeListeners(target,type)}var Disposable=function(){this.disposed_=!1};function TRUE(){return!0}function FALSE(){return!1}function VOID(){}Disposable.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},Disposable.prototype.disposeInternal=function(){};var Event=function(type){this.propagationStopped,this.type=type,this.target=null};function stopPropagation(evt){evt.stopPropagation()}Event.prototype.preventDefault=function(){this.propagationStopped=!0},Event.prototype.stopPropagation=function(){this.propagationStopped=!0};var Target=function(Disposable$$1){function Target(){Disposable$$1.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return Disposable$$1&&(Target.__proto__=Disposable$$1),Target.prototype=Object.create(Disposable$$1&&Disposable$$1.prototype),Target.prototype.constructor=Target,Target.prototype.addEventListener=function(type,listener){var listeners=this.listeners_[type];listeners||(listeners=this.listeners_[type]=[]),-1===listeners.indexOf(listener)&&listeners.push(listener)},Target.prototype.dispatchEvent=function(event){var evt="string"==typeof event?new Event(event):event,type=evt.type;evt.target=this;var propagate,listeners=this.listeners_[type];if(listeners){type in this.dispatching_||(this.dispatching_[type]=0,this.pendingRemovals_[type]=0),++this.dispatching_[type];for(var i=0,ii=listeners.length;i<ii;++i)if(!1===listeners[i].call(this,evt)||evt.propagationStopped){propagate=!1;break}if(--this.dispatching_[type],0===this.dispatching_[type]){var pendingRemovals=this.pendingRemovals_[type];for(delete this.pendingRemovals_[type];pendingRemovals--;)this.removeEventListener(type,VOID);delete this.dispatching_[type]}return propagate}},Target.prototype.disposeInternal=function(){unlistenAll(this)},Target.prototype.getListeners=function(type){return this.listeners_[type]},Target.prototype.hasListener=function(opt_type){return opt_type?opt_type in this.listeners_:Object.keys(this.listeners_).length>0},Target.prototype.removeEventListener=function(type,listener){var listeners=this.listeners_[type];if(listeners){var index=listeners.indexOf(listener);type in this.pendingRemovals_?(listeners[index]=VOID,++this.pendingRemovals_[type]):(listeners.splice(index,1),0===listeners.length&&delete this.listeners_[type])}},Target}(Disposable),EventType={CHANGE:"change",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"},Observable=function(EventTarget){function Observable(){EventTarget.call(this),this.revision_=0}return EventTarget&&(Observable.__proto__=EventTarget),Observable.prototype=Object.create(EventTarget&&EventTarget.prototype),Observable.prototype.constructor=Observable,Observable.prototype.changed=function(){++this.revision_,this.dispatchEvent(EventType.CHANGE)},Observable.prototype.getRevision=function(){return this.revision_},Observable.prototype.on=function(type,listener){if(Array.isArray(type)){for(var len=type.length,keys=new Array(len),i=0;i<len;++i)keys[i]=listen(this,type[i],listener);return keys}return listen(this,type,listener)},Observable.prototype.once=function(type,listener){if(Array.isArray(type)){for(var len=type.length,keys=new Array(len),i=0;i<len;++i)keys[i]=listenOnce(this,type[i],listener);return keys}return listenOnce(this,type,listener)},Observable.prototype.un=function(type,listener){if(Array.isArray(type))for(var i=0,ii=type.length;i<ii;++i)unlisten(this,type[i],listener);else unlisten(this,type,listener)},Observable}(Target),ObjectEvent=function(Event$$1){function ObjectEvent(type,key,oldValue){Event$$1.call(this,type),this.key=key,this.oldValue=oldValue}return Event$$1&&(ObjectEvent.__proto__=Event$$1),ObjectEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),ObjectEvent.prototype.constructor=ObjectEvent,ObjectEvent}(Event),BaseObject=function(Observable$$1){function BaseObject(opt_values){Observable$$1.call(this),getUid(this),this.values_={},void 0!==opt_values&&this.setProperties(opt_values)}return Observable$$1&&(BaseObject.__proto__=Observable$$1),BaseObject.prototype=Object.create(Observable$$1&&Observable$$1.prototype),BaseObject.prototype.constructor=BaseObject,BaseObject.prototype.get=function(key){var value;return this.values_.hasOwnProperty(key)&&(value=this.values_[key]),value},BaseObject.prototype.getKeys=function(){return Object.keys(this.values_)},BaseObject.prototype.getProperties=function(){return assign({},this.values_)},BaseObject.prototype.notify=function(key,oldValue){var eventType;eventType=getChangeEventType(key),this.dispatchEvent(new ObjectEvent(eventType,key,oldValue)),eventType=ObjectEventType.PROPERTYCHANGE,this.dispatchEvent(new ObjectEvent(eventType,key,oldValue))},BaseObject.prototype.set=function(key,value,opt_silent){if(opt_silent)this.values_[key]=value;else{var oldValue=this.values_[key];this.values_[key]=value,oldValue!==value&&this.notify(key,oldValue)}},BaseObject.prototype.setProperties=function(values,opt_silent){for(var key in values)this.set(key,values[key],opt_silent)},BaseObject.prototype.unset=function(key,opt_silent){if(key in this.values_){var oldValue=this.values_[key];delete this.values_[key],opt_silent||this.notify(key,oldValue)}},BaseObject}(Observable),changeEventTypeCache={};function getChangeEventType(key){return changeEventTypeCache.hasOwnProperty(key)?changeEventTypeCache[key]:changeEventTypeCache[key]="change:"+key}var MAX_TEXTURE_SIZE,EXTENSIONS,Property={LENGTH:"length"},CollectionEvent=function(Event$$1){function CollectionEvent(type,opt_element){Event$$1.call(this,type),this.element=opt_element}return Event$$1&&(CollectionEvent.__proto__=Event$$1),CollectionEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),CollectionEvent.prototype.constructor=CollectionEvent,CollectionEvent}(Event),Collection=function(BaseObject$$1){function Collection(opt_array,opt_options){BaseObject$$1.call(this);var options=opt_options||{};if(this.unique_=!!options.unique,this.array_=opt_array||[],this.unique_)for(var i=0,ii=this.array_.length;i<ii;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}return BaseObject$$1&&(Collection.__proto__=BaseObject$$1),Collection.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),Collection.prototype.constructor=Collection,Collection.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},Collection.prototype.extend=function(arr){for(var i=0,ii=arr.length;i<ii;++i)this.push(arr[i]);return this},Collection.prototype.forEach=function(f){for(var array=this.array_,i=0,ii=array.length;i<ii;++i)f(array[i],i,array)},Collection.prototype.getArray=function(){return this.array_},Collection.prototype.item=function(index){return this.array_[index]},Collection.prototype.getLength=function(){return this.get(Property.LENGTH)},Collection.prototype.insertAt=function(index,elem){this.unique_&&this.assertUnique_(elem),this.array_.splice(index,0,elem),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,elem))},Collection.prototype.pop=function(){return this.removeAt(this.getLength()-1)},Collection.prototype.push=function(elem){this.unique_&&this.assertUnique_(elem);var n=this.getLength();return this.insertAt(n,elem),this.getLength()},Collection.prototype.remove=function(elem){for(var arr=this.array_,i=0,ii=arr.length;i<ii;++i)if(arr[i]===elem)return this.removeAt(i)},Collection.prototype.removeAt=function(index){var prev=this.array_[index];return this.array_.splice(index,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,prev)),prev},Collection.prototype.setAt=function(index,elem){var n=this.getLength();if(index<n){this.unique_&&this.assertUnique_(elem,index);var prev=this.array_[index];this.array_[index]=elem,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,prev)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,elem))}else{for(var j=n;j<index;++j)this.insertAt(j,void 0);this.insertAt(index,elem)}},Collection.prototype.updateLength_=function(){this.set(Property.LENGTH,this.array_.length)},Collection.prototype.assertUnique_=function(elem,opt_except){for(var i=0,ii=this.array_.length;i<ii;++i)if(this.array_[i]===elem&&i!==opt_except)throw new AssertionError(58)},Collection}(BaseObject),MapEvent=function(Event$$1){function MapEvent(type,map,opt_frameState){Event$$1.call(this,type),this.map=map,this.frameState=void 0!==opt_frameState?opt_frameState:null}return Event$$1&&(MapEvent.__proto__=Event$$1),MapEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),MapEvent.prototype.constructor=MapEvent,MapEvent}(Event),MapBrowserEvent=function(MapEvent$$1){function MapBrowserEvent(type,map,browserEvent,opt_dragging,opt_frameState){MapEvent$$1.call(this,type,map,opt_frameState),this.originalEvent=browserEvent,this.pixel=map.getEventPixel(browserEvent),this.coordinate=map.getCoordinateFromPixel(this.pixel),this.dragging=void 0!==opt_dragging&&opt_dragging}return MapEvent$$1&&(MapBrowserEvent.__proto__=MapEvent$$1),MapBrowserEvent.prototype=Object.create(MapEvent$$1&&MapEvent$$1.prototype),MapBrowserEvent.prototype.constructor=MapBrowserEvent,MapBrowserEvent.prototype.preventDefault=function(){MapEvent$$1.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},MapBrowserEvent.prototype.stopPropagation=function(){MapEvent$$1.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},MapBrowserEvent}(MapEvent),CONTEXT_IDS=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function getContext(canvas,opt_attributes){for(var ii=CONTEXT_IDS.length,i=0;i<ii;++i)try{var context=canvas.getContext(CONTEXT_IDS[i],opt_attributes);if(context)return context}catch(e){}return null}if("undefined"!=typeof window&&"WebGLRenderingContext"in window)try{var canvas=document.createElement("canvas"),gl=getContext(canvas,{failIfMajorPerformanceCaveat:!0});gl&&(MAX_TEXTURE_SIZE=gl.getParameter(gl.MAX_TEXTURE_SIZE),EXTENSIONS=gl.getSupportedExtensions())}catch(e){}var ua="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",FIREFOX=-1!==ua.indexOf("firefox"),SAFARI=-1!==ua.indexOf("safari")&&-1==ua.indexOf("chrom"),WEBKIT=-1!==ua.indexOf("webkit")&&-1==ua.indexOf("edge"),MAC=-1!==ua.indexOf("macintosh"),DEVICE_PIXEL_RATIO=window.devicePixelRatio||1,CANVAS_LINE_DASH=function(){var has=!1;try{has=!!document.createElement("canvas").getContext("2d").setLineDash}catch(e){}return has}(),TOUCH="ontouchstart"in window,POINTER="PointerEvent"in window,MSPOINTER=!!navigator.msPointerEnabled,MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},MapBrowserPointerEvent=function(MapBrowserEvent$$1){function MapBrowserPointerEvent(type,map,pointerEvent,opt_dragging,opt_frameState){MapBrowserEvent$$1.call(this,type,map,pointerEvent.originalEvent,opt_dragging,opt_frameState),this.pointerEvent=pointerEvent}return MapBrowserEvent$$1&&(MapBrowserPointerEvent.__proto__=MapBrowserEvent$$1),MapBrowserPointerEvent.prototype=Object.create(MapBrowserEvent$$1&&MapBrowserEvent$$1.prototype),MapBrowserPointerEvent.prototype.constructor=MapBrowserPointerEvent,MapBrowserPointerEvent}(MapBrowserEvent),PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},EventSource=function(dispatcher,mapping){this.dispatcher=dispatcher,this.mapping_=mapping};EventSource.prototype.getEvents=function(){return Object.keys(this.mapping_)},EventSource.prototype.getHandlerForEvent=function(eventType){return this.mapping_[eventType]};var POINTER_ID=1,POINTER_TYPE="mouse",DEDUP_DIST=25;function mousedown(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){POINTER_ID.toString()in this.pointerMap&&this.cancel(inEvent);var e=prepareEvent(inEvent,this.dispatcher);this.pointerMap[POINTER_ID.toString()]=inEvent,this.dispatcher.down(e,inEvent)}}function mousemove(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.move(e,inEvent)}}function mouseup(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var p=this.pointerMap[POINTER_ID.toString()];if(p&&p.button===inEvent.button){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.up(e,inEvent),this.cleanupMouse()}}}function mouseover(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.enterOver(e,inEvent)}}function mouseout(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.leaveOut(e,inEvent)}}var MouseSource=function(EventSource$$1){function MouseSource(dispatcher){var mapping={mousedown:mousedown,mousemove:mousemove,mouseup:mouseup,mouseover:mouseover,mouseout:mouseout};EventSource$$1.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap,this.lastTouches=[]}return EventSource$$1&&(MouseSource.__proto__=EventSource$$1),MouseSource.prototype=Object.create(EventSource$$1&&EventSource$$1.prototype),MouseSource.prototype.constructor=MouseSource,MouseSource.prototype.isEventSimulatedFromTouch_=function(inEvent){for(var lts=this.lastTouches,x=inEvent.clientX,y=inEvent.clientY,i=0,l=lts.length,t=void 0;i<l&&(t=lts[i]);i++){var dx=Math.abs(x-t[0]),dy=Math.abs(y-t[1]);if(dx<=DEDUP_DIST&&dy<=DEDUP_DIST)return!0}return!1},MouseSource.prototype.cancel=function(inEvent){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.cancel(e,inEvent),this.cleanupMouse()},MouseSource.prototype.cleanupMouse=function(){delete this.pointerMap[POINTER_ID.toString()]},MouseSource}(EventSource);function prepareEvent(inEvent,dispatcher){var e=dispatcher.cloneEvent(inEvent,inEvent),pd=e.preventDefault;return e.preventDefault=function(){inEvent.preventDefault(),pd()},e.pointerId=POINTER_ID,e.isPrimary=!0,e.pointerType=POINTER_TYPE,e}var POINTER_TYPES=["","unavailable","touch","pen","mouse"];function msPointerDown(inEvent){this.pointerMap[inEvent.pointerId.toString()]=inEvent;var e=this.prepareEvent_(inEvent);this.dispatcher.down(e,inEvent)}function msPointerMove(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.move(e,inEvent)}function msPointerUp(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.up(e,inEvent),this.cleanup(inEvent.pointerId)}function msPointerOut(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.leaveOut(e,inEvent)}function msPointerOver(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.enterOver(e,inEvent)}function msPointerCancel(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.cancel(e,inEvent),this.cleanup(inEvent.pointerId)}function msLostPointerCapture(inEvent){var e=this.dispatcher.makeEvent("lostpointercapture",inEvent,inEvent);this.dispatcher.dispatchEvent(e)}function msGotPointerCapture(inEvent){var e=this.dispatcher.makeEvent("gotpointercapture",inEvent,inEvent);this.dispatcher.dispatchEvent(e)}var MsSource=function(EventSource$$1){function MsSource(dispatcher){var mapping={MSPointerDown:msPointerDown,MSPointerMove:msPointerMove,MSPointerUp:msPointerUp,MSPointerOut:msPointerOut,MSPointerOver:msPointerOver,MSPointerCancel:msPointerCancel,MSGotPointerCapture:msGotPointerCapture,MSLostPointerCapture:msLostPointerCapture};EventSource$$1.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap}return EventSource$$1&&(MsSource.__proto__=EventSource$$1),MsSource.prototype=Object.create(EventSource$$1&&EventSource$$1.prototype),MsSource.prototype.constructor=MsSource,MsSource.prototype.prepareEvent_=function(inEvent){var e=inEvent;return"number"==typeof inEvent.pointerType&&((e=this.dispatcher.cloneEvent(inEvent,inEvent)).pointerType=POINTER_TYPES[inEvent.pointerType]),e},MsSource.prototype.cleanup=function(pointerId){delete this.pointerMap[pointerId.toString()]},MsSource}(EventSource);function pointerDown(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerMove(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerUp(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerOut(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerOver(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerCancel(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function lostPointerCapture(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function gotPointerCapture(inEvent){this.dispatcher.fireNativeEvent(inEvent)}var NativeSource=function(EventSource$$1){function NativeSource(dispatcher){var mapping={pointerdown:pointerDown,pointermove:pointerMove,pointerup:pointerUp,pointerout:pointerOut,pointerover:pointerOver,pointercancel:pointerCancel,gotpointercapture:gotPointerCapture,lostpointercapture:lostPointerCapture};EventSource$$1.call(this,dispatcher,mapping)}return EventSource$$1&&(NativeSource.__proto__=EventSource$$1),NativeSource.prototype=Object.create(EventSource$$1&&EventSource$$1.prototype),NativeSource.prototype.constructor=NativeSource,NativeSource}(EventSource),HAS_BUTTONS=!1,PointerEvent=function(_Event){function PointerEvent(type,originalEvent,opt_eventDict){_Event.call(this,type),this.originalEvent=originalEvent;var eventDict=opt_eventDict||{};this.buttons=getButtons(eventDict),this.pressure=getPressure(eventDict,this.buttons),this.bubbles="bubbles"in eventDict&&eventDict.bubbles,this.cancelable="cancelable"in eventDict&&eventDict.cancelable,this.view="view"in eventDict?eventDict.view:null,this.detail="detail"in eventDict?eventDict.detail:null,this.screenX="screenX"in eventDict?eventDict.screenX:0,this.screenY="screenY"in eventDict?eventDict.screenY:0,this.clientX="clientX"in eventDict?eventDict.clientX:0,this.clientY="clientY"in eventDict?eventDict.clientY:0,this.ctrlKey="ctrlKey"in eventDict&&eventDict.ctrlKey,this.altKey="altKey"in eventDict&&eventDict.altKey,this.shiftKey="shiftKey"in eventDict&&eventDict.shiftKey,this.metaKey="metaKey"in eventDict&&eventDict.metaKey,this.button="button"in eventDict?eventDict.button:0,this.relatedTarget="relatedTarget"in eventDict?eventDict.relatedTarget:null,this.pointerId="pointerId"in eventDict?eventDict.pointerId:0,this.width="width"in eventDict?eventDict.width:0,this.height="height"in eventDict?eventDict.height:0,this.tiltX="tiltX"in eventDict?eventDict.tiltX:0,this.tiltY="tiltY"in eventDict?eventDict.tiltY:0,this.pointerType="pointerType"in eventDict?eventDict.pointerType:"",this.hwTimestamp="hwTimestamp"in eventDict?eventDict.hwTimestamp:0,this.isPrimary="isPrimary"in eventDict&&eventDict.isPrimary,originalEvent.preventDefault&&(this.preventDefault=function(){originalEvent.preventDefault()})}return _Event&&(PointerEvent.__proto__=_Event),PointerEvent.prototype=Object.create(_Event&&_Event.prototype),PointerEvent.prototype.constructor=PointerEvent,PointerEvent}(Event);function getButtons(eventDict){var buttons;if(eventDict.buttons||HAS_BUTTONS)buttons=eventDict.buttons;else switch(eventDict.which){case 1:buttons=1;break;case 2:buttons=4;break;case 3:buttons=2;break;default:buttons=0}return buttons}function getPressure(eventDict,buttons){return eventDict.pressure?eventDict.pressure:buttons?.5:0}function binarySearch(haystack,needle,opt_comparator){for(var mid,cmp,comparator=opt_comparator||numberSafeCompareFunction,low=0,high=haystack.length,found=!1;low<high;)(cmp=+comparator(haystack[mid=low+(high-low>>1)],needle))<0?low=mid+1:(high=mid,found=!cmp);return found?low:~low}function numberSafeCompareFunction(a,b){return a>b?1:a<b?-1:0}function includes(arr,obj){return arr.indexOf(obj)>=0}function linearFindNearest(arr,target,direction){var i,n=arr.length;if(arr[0]<=target)return 0;if(target<=arr[n-1])return n-1;if(direction>0){for(i=1;i<n;++i)if(arr[i]<target)return i-1}else if(direction<0){for(i=1;i<n;++i)if(arr[i]<=target)return i}else for(i=1;i<n;++i){if(arr[i]==target)return i;if(arr[i]<target)return arr[i-1]-target<target-arr[i]?i-1:i}return n-1}function reverseSubArray(arr,begin,end){for(;begin<end;){var tmp=arr[begin];arr[begin]=arr[end],arr[end]=tmp,++begin,--end}}function extend(arr,data){for(var extension=Array.isArray(data)?data:[data],length=extension.length,i=0;i<length;i++)arr[arr.length]=extension[i]}function remove(arr,obj){var i=arr.indexOf(obj),found=i>-1;return found&&arr.splice(i,1),found}function equals(arr1,arr2){var len1=arr1.length;if(len1!==arr2.length)return!1;for(var i=0;i<len1;i++)if(arr1[i]!==arr2[i])return!1;return!0}function stableSort(arr,compareFnc){var i,length=arr.length,tmp=Array(arr.length);for(i=0;i<length;i++)tmp[i]={index:i,value:arr[i]};for(tmp.sort(function(a,b){return compareFnc(a.value,b.value)||a.index-b.index}),i=0;i<arr.length;i++)arr[i]=tmp[i].value}!function(){try{var ev=new MouseEvent("click",{buttons:1});HAS_BUTTONS=1===ev.buttons}catch(e){}}();var CLICK_COUNT_TIMEOUT=200,POINTER_TYPE$1="touch";function touchstart(inEvent){this.vacuumTouches_(inEvent),this.setPrimaryTouch_(inEvent.changedTouches[0]),this.dedupSynthMouse_(inEvent),this.clickCount_++,this.processTouches_(inEvent,this.overDown_)}function touchmove(inEvent){this.processTouches_(inEvent,this.moveOverOut_)}function touchend(inEvent){this.dedupSynthMouse_(inEvent),this.processTouches_(inEvent,this.upOut_)}function touchcancel(inEvent){this.processTouches_(inEvent,this.cancelOut_)}var TouchSource=function(EventSource$$1){function TouchSource(dispatcher,mouseSource){var mapping={touchstart:touchstart,touchmove:touchmove,touchend:touchend,touchcancel:touchcancel};EventSource$$1.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap,this.mouseSource=mouseSource,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_,this.dedupTimeout_=2500}return EventSource$$1&&(TouchSource.__proto__=EventSource$$1),TouchSource.prototype=Object.create(EventSource$$1&&EventSource$$1.prototype),TouchSource.prototype.constructor=TouchSource,TouchSource.prototype.isPrimaryTouch_=function(inTouch){return this.firstTouchId_===inTouch.identifier},TouchSource.prototype.setPrimaryTouch_=function(inTouch){var count=Object.keys(this.pointerMap).length;(0===count||1===count&&POINTER_ID.toString()in this.pointerMap)&&(this.firstTouchId_=inTouch.identifier,this.cancelResetClickCount_())},TouchSource.prototype.removePrimaryPointer_=function(inPointer){inPointer.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},TouchSource.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),CLICK_COUNT_TIMEOUT)},TouchSource.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},TouchSource.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)},TouchSource.prototype.touchToPointer_=function(browserEvent,inTouch){var e=this.dispatcher.cloneEvent(browserEvent,inTouch);return e.pointerId=inTouch.identifier+2,e.bubbles=!0,e.cancelable=!0,e.detail=this.clickCount_,e.button=0,e.buttons=1,e.width=inTouch.radiusX||0,e.height=inTouch.radiusY||0,e.pressure=inTouch.force||.5,e.isPrimary=this.isPrimaryTouch_(inTouch),e.pointerType=POINTER_TYPE$1,e.clientX=inTouch.clientX,e.clientY=inTouch.clientY,e.screenX=inTouch.screenX,e.screenY=inTouch.screenY,e},TouchSource.prototype.processTouches_=function(inEvent,inFunction){var touches=Array.prototype.slice.call(inEvent.changedTouches),count=touches.length;function preventDefault(){inEvent.preventDefault()}for(var i=0;i<count;++i){var pointer=this.touchToPointer_(inEvent,touches[i]);pointer.preventDefault=preventDefault,inFunction.call(this,inEvent,pointer)}},TouchSource.prototype.findTouch_=function(touchList,searchId){for(var l=touchList.length,i=0;i<l;i++){if(touchList[i].identifier===searchId)return!0}return!1},TouchSource.prototype.vacuumTouches_=function(inEvent){var touchList=inEvent.touches,keys=Object.keys(this.pointerMap),count=keys.length;if(count>=touchList.length){for(var d=[],i=0;i<count;++i){var key=Number(keys[i]),value=this.pointerMap[key];key==POINTER_ID||this.findTouch_(touchList,key-2)||d.push(value.out)}for(var i$1=0;i$1<d.length;++i$1)this.cancelOut_(inEvent,d[i$1])}},TouchSource.prototype.overDown_=function(browserEvent,inPointer){this.pointerMap[inPointer.pointerId]={target:inPointer.target,out:inPointer,outTarget:inPointer.target},this.dispatcher.over(inPointer,browserEvent),this.dispatcher.enter(inPointer,browserEvent),this.dispatcher.down(inPointer,browserEvent)},TouchSource.prototype.moveOverOut_=function(browserEvent,inPointer){var event=inPointer,pointer=this.pointerMap[event.pointerId];if(pointer){var outEvent=pointer.out,outTarget=pointer.outTarget;this.dispatcher.move(event,browserEvent),outEvent&&outTarget!==event.target&&(outEvent.relatedTarget=event.target,event.relatedTarget=outTarget,outEvent.target=outTarget,event.target?(this.dispatcher.leaveOut(outEvent,browserEvent),this.dispatcher.enterOver(event,browserEvent)):(event.target=outTarget,event.relatedTarget=null,this.cancelOut_(browserEvent,event))),pointer.out=event,pointer.outTarget=event.target}},TouchSource.prototype.upOut_=function(browserEvent,inPointer){this.dispatcher.up(inPointer,browserEvent),this.dispatcher.out(inPointer,browserEvent),this.dispatcher.leave(inPointer,browserEvent),this.cleanUpPointer_(inPointer)},TouchSource.prototype.cancelOut_=function(browserEvent,inPointer){this.dispatcher.cancel(inPointer,browserEvent),this.dispatcher.out(inPointer,browserEvent),this.dispatcher.leave(inPointer,browserEvent),this.cleanUpPointer_(inPointer)},TouchSource.prototype.cleanUpPointer_=function(inPointer){delete this.pointerMap[inPointer.pointerId],this.removePrimaryPointer_(inPointer)},TouchSource.prototype.dedupSynthMouse_=function(inEvent){var lts=this.mouseSource.lastTouches,t=inEvent.changedTouches[0];if(this.isPrimaryTouch_(t)){var lt=[t.clientX,t.clientY];lts.push(lt),setTimeout(function(){remove(lts,lt)},this.dedupTimeout_)}},TouchSource}(EventSource),CLONE_PROPS=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]],PointerEventHandler=function(EventTarget){function PointerEventHandler(element){EventTarget.call(this),this.element_=element,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()}return EventTarget&&(PointerEventHandler.__proto__=EventTarget),PointerEventHandler.prototype=Object.create(EventTarget&&EventTarget.prototype),PointerEventHandler.prototype.constructor=PointerEventHandler,PointerEventHandler.prototype.registerSources=function(){if(POINTER)this.registerSource("native",new NativeSource(this));else if(MSPOINTER)this.registerSource("ms",new MsSource(this));else{var mouseSource=new MouseSource(this);this.registerSource("mouse",mouseSource),TOUCH&&this.registerSource("touch",new TouchSource(this,mouseSource))}this.register_()},PointerEventHandler.prototype.registerSource=function(name,source){var s=source,newEvents=s.getEvents();newEvents&&(newEvents.forEach(function(e){var handler=s.getHandlerForEvent(e);handler&&(this.eventMap_[e]=handler.bind(s))}.bind(this)),this.eventSourceList_.push(s))},PointerEventHandler.prototype.register_=function(){for(var l=this.eventSourceList_.length,i=0;i<l;i++){var eventSource=this.eventSourceList_[i];this.addEvents_(eventSource.getEvents())}},PointerEventHandler.prototype.unregister_=function(){for(var l=this.eventSourceList_.length,i=0;i<l;i++){var eventSource=this.eventSourceList_[i];this.removeEvents_(eventSource.getEvents())}},PointerEventHandler.prototype.eventHandler_=function(inEvent){var type=inEvent.type,handler=this.eventMap_[type];handler&&handler(inEvent)},PointerEventHandler.prototype.addEvents_=function(events){events.forEach(function(eventName){listen(this.element_,eventName,this.eventHandler_,this)}.bind(this))},PointerEventHandler.prototype.removeEvents_=function(events){events.forEach(function(e){unlisten(this.element_,e,this.eventHandler_,this)}.bind(this))},PointerEventHandler.prototype.cloneEvent=function(event,inEvent){for(var eventCopy={},i=0,ii=CLONE_PROPS.length;i<ii;i++){var p=CLONE_PROPS[i][0];eventCopy[p]=event[p]||inEvent[p]||CLONE_PROPS[i][1]}return eventCopy},PointerEventHandler.prototype.down=function(data,event){this.fireEvent(PointerEventType.POINTERDOWN,data,event)},PointerEventHandler.prototype.move=function(data,event){this.fireEvent(PointerEventType.POINTERMOVE,data,event)},PointerEventHandler.prototype.up=function(data,event){this.fireEvent(PointerEventType.POINTERUP,data,event)},PointerEventHandler.prototype.enter=function(data,event){data.bubbles=!1,this.fireEvent(PointerEventType.POINTERENTER,data,event)},PointerEventHandler.prototype.leave=function(data,event){data.bubbles=!1,this.fireEvent(PointerEventType.POINTERLEAVE,data,event)},PointerEventHandler.prototype.over=function(data,event){data.bubbles=!0,this.fireEvent(PointerEventType.POINTEROVER,data,event)},PointerEventHandler.prototype.out=function(data,event){data.bubbles=!0,this.fireEvent(PointerEventType.POINTEROUT,data,event)},PointerEventHandler.prototype.cancel=function(data,event){this.fireEvent(PointerEventType.POINTERCANCEL,data,event)},PointerEventHandler.prototype.leaveOut=function(data,event){this.out(data,event),this.contains_(data.target,data.relatedTarget)||this.leave(data,event)},PointerEventHandler.prototype.enterOver=function(data,event){this.over(data,event),this.contains_(data.target,data.relatedTarget)||this.enter(data,event)},PointerEventHandler.prototype.contains_=function(container,contained){return!(!container||!contained)&&container.contains(contained)},PointerEventHandler.prototype.makeEvent=function(inType,data,event){return new PointerEvent(inType,event,data)},PointerEventHandler.prototype.fireEvent=function(inType,data,event){var e=this.makeEvent(inType,data,event);this.dispatchEvent(e)},PointerEventHandler.prototype.fireNativeEvent=function(event){var e=this.makeEvent(event.type,event,event);this.dispatchEvent(e)},PointerEventHandler.prototype.wrapMouseEvent=function(eventType,event){return this.makeEvent(eventType,prepareEvent(event,this),event)},PointerEventHandler.prototype.disposeInternal=function(){this.unregister_(),EventTarget.prototype.disposeInternal.call(this)},PointerEventHandler}(Target),MapBrowserEventHandler=function(EventTarget){function MapBrowserEventHandler(map,moveTolerance){EventTarget.call(this),this.map_=map,this.clickTimeoutId_,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=moveTolerance?moveTolerance*DEVICE_PIXEL_RATIO:DEVICE_PIXEL_RATIO,this.down_=null;var element=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new PointerEventHandler(element),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=listen(this.pointerEventHandler_,PointerEventType.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=listen(this.pointerEventHandler_,PointerEventType.POINTERMOVE,this.relayEvent_,this)}return EventTarget&&(MapBrowserEventHandler.__proto__=EventTarget),MapBrowserEventHandler.prototype=Object.create(EventTarget&&EventTarget.prototype),MapBrowserEventHandler.prototype.constructor=MapBrowserEventHandler,MapBrowserEventHandler.prototype.emulateClick_=function(pointerEvent){var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.CLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,newEvent=new MapBrowserPointerEvent(MapBrowserEventType.DBLCLICK,this.map_,pointerEvent),this.dispatchEvent(newEvent)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.SINGLECLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent)}.bind(this),250)},MapBrowserEventHandler.prototype.updateActivePointers_=function(pointerEvent){var event=pointerEvent;event.type==MapBrowserEventType.POINTERUP||event.type==MapBrowserEventType.POINTERCANCEL?delete this.trackedTouches_[event.pointerId]:event.type==MapBrowserEventType.POINTERDOWN&&(this.trackedTouches_[event.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},MapBrowserEventHandler.prototype.handlePointerUp_=function(pointerEvent){this.updateActivePointers_(pointerEvent);var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.POINTERUP,this.map_,pointerEvent);this.dispatchEvent(newEvent),newEvent.propagationStopped||this.dragging_||!this.isMouseActionButton_(pointerEvent)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},MapBrowserEventHandler.prototype.isMouseActionButton_=function(pointerEvent){return 0===pointerEvent.button},MapBrowserEventHandler.prototype.handlePointerDown_=function(pointerEvent){this.updateActivePointers_(pointerEvent);var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.POINTERDOWN,this.map_,pointerEvent);this.dispatchEvent(newEvent),this.down_=pointerEvent,0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new PointerEventHandler(document),this.dragListenerKeys_.push(listen(this.documentPointerEventHandler_,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(this.documentPointerEventHandler_,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.pointerEventHandler_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)))},MapBrowserEventHandler.prototype.handlePointerMove_=function(pointerEvent){if(this.isMoving_(pointerEvent)){this.dragging_=!0;var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.POINTERDRAG,this.map_,pointerEvent,this.dragging_);this.dispatchEvent(newEvent)}pointerEvent.preventDefault()},MapBrowserEventHandler.prototype.relayEvent_=function(pointerEvent){var dragging=!(!this.down_||!this.isMoving_(pointerEvent));this.dispatchEvent(new MapBrowserPointerEvent(pointerEvent.type,this.map_,pointerEvent,dragging))},MapBrowserEventHandler.prototype.isMoving_=function(pointerEvent){return this.dragging_||Math.abs(pointerEvent.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(pointerEvent.clientY-this.down_.clientY)>this.moveTolerance_},MapBrowserEventHandler.prototype.disposeInternal=function(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),EventTarget.prototype.disposeInternal.call(this)},MapBrowserEventHandler}(Target),MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},RenderEventType={POSTCOMPOSE:"postcompose",PRECOMPOSE:"precompose",RENDER:"render",RENDERCOMPLETE:"rendercomplete"},TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};function assert(assertion,errorCode){if(!assertion)throw new AssertionError(errorCode)}var DROP=1/0,PriorityQueue=function(priorityFunction,keyFunction){this.priorityFunction_=priorityFunction,this.keyFunction_=keyFunction,this.elements_=[],this.priorities_=[],this.queuedElements_={}};PriorityQueue.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,clear(this.queuedElements_)},PriorityQueue.prototype.dequeue=function(){var elements=this.elements_,priorities=this.priorities_,element=elements[0];1==elements.length?(elements.length=0,priorities.length=0):(elements[0]=elements.pop(),priorities[0]=priorities.pop(),this.siftUp_(0));var elementKey=this.keyFunction_(element);return delete this.queuedElements_[elementKey],element},PriorityQueue.prototype.enqueue=function(element){assert(!(this.keyFunction_(element)in this.queuedElements_),31);var priority=this.priorityFunction_(element);return priority!=DROP&&(this.elements_.push(element),this.priorities_.push(priority),this.queuedElements_[this.keyFunction_(element)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},PriorityQueue.prototype.getCount=function(){return this.elements_.length},PriorityQueue.prototype.getLeftChildIndex_=function(index){return 2*index+1},PriorityQueue.prototype.getRightChildIndex_=function(index){return 2*index+2},PriorityQueue.prototype.getParentIndex_=function(index){return index-1>>1},PriorityQueue.prototype.heapify_=function(){var i;for(i=(this.elements_.length>>1)-1;i>=0;i--)this.siftUp_(i)},PriorityQueue.prototype.isEmpty=function(){return 0===this.elements_.length},PriorityQueue.prototype.isKeyQueued=function(key){return key in this.queuedElements_},PriorityQueue.prototype.isQueued=function(element){return this.isKeyQueued(this.keyFunction_(element))},PriorityQueue.prototype.siftUp_=function(index){for(var elements=this.elements_,priorities=this.priorities_,count=elements.length,element=elements[index],priority=priorities[index],startIndex=index;index<count>>1;){var lIndex=this.getLeftChildIndex_(index),rIndex=this.getRightChildIndex_(index),smallerChildIndex=rIndex<count&&priorities[rIndex]<priorities[lIndex]?rIndex:lIndex;elements[index]=elements[smallerChildIndex],priorities[index]=priorities[smallerChildIndex],index=smallerChildIndex}elements[index]=element,priorities[index]=priority,this.siftDown_(startIndex,index)},PriorityQueue.prototype.siftDown_=function(startIndex,index){for(var elements=this.elements_,priorities=this.priorities_,element=elements[index],priority=priorities[index];index>startIndex;){var parentIndex=this.getParentIndex_(index);if(!(priorities[parentIndex]>priority))break;elements[index]=elements[parentIndex],priorities[index]=priorities[parentIndex],index=parentIndex}elements[index]=element,priorities[index]=priority},PriorityQueue.prototype.reprioritize=function(){var element,i,priority,priorityFunction=this.priorityFunction_,elements=this.elements_,priorities=this.priorities_,index=0,n=elements.length;for(i=0;i<n;++i)(priority=priorityFunction(element=elements[i]))==DROP?delete this.queuedElements_[this.keyFunction_(element)]:(priorities[index]=priority,elements[index++]=element);elements.length=index,priorities.length=index,this.heapify_()};var TileQueue=function(PriorityQueue$$1){function TileQueue(tilePriorityFunction,tileChangeCallback){PriorityQueue$$1.call(this,function(element){return tilePriorityFunction.apply(null,element)},function(element){return element[0].getKey()}),this.tileChangeCallback_=tileChangeCallback,this.tilesLoading_=0,this.tilesLoadingKeys_={}}return PriorityQueue$$1&&(TileQueue.__proto__=PriorityQueue$$1),TileQueue.prototype=Object.create(PriorityQueue$$1&&PriorityQueue$$1.prototype),TileQueue.prototype.constructor=TileQueue,TileQueue.prototype.enqueue=function(element){var added=PriorityQueue$$1.prototype.enqueue.call(this,element);added&&listen(element[0],EventType.CHANGE,this.handleTileChange,this);return added},TileQueue.prototype.getTilesLoading=function(){return this.tilesLoading_},TileQueue.prototype.handleTileChange=function(event){var tile=event.target,state=tile.getState();if(state===TileState.LOADED||state===TileState.ERROR||state===TileState.EMPTY||state===TileState.ABORT){unlisten(tile,EventType.CHANGE,this.handleTileChange,this);var tileKey=tile.getKey();tileKey in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[tileKey],--this.tilesLoading_),this.tileChangeCallback_()}},TileQueue.prototype.loadMoreTiles=function(maxTotalLoading,maxNewLoads){for(var state,tile,tileKey,newLoads=0,abortedTiles=!1;this.tilesLoading_<maxTotalLoading&&newLoads<maxNewLoads&&this.getCount()>0;)tileKey=(tile=this.dequeue()[0]).getKey(),(state=tile.getState())===TileState.ABORT?abortedTiles=!0:state!==TileState.IDLE||tileKey in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[tileKey]=!0,++this.tilesLoading_,++newLoads,tile.load());0===newLoads&&abortedTiles&&this.tileChangeCallback_()},TileQueue}(PriorityQueue),DEFAULT_TILE_SIZE=256;function clamp(value,min,max){return Math.min(Math.max(value,min),max)}var cosh="cosh"in Math?Math.cosh:function(x){var y=Math.exp(x);return(y+1/y)/2};function squaredSegmentDistance(x,y,x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;if(0!==dx||0!==dy){var t=((x-x1)*dx+(y-y1)*dy)/(dx*dx+dy*dy);t>1?(x1=x2,y1=y2):t>0&&(x1+=dx*t,y1+=dy*t)}return squaredDistance(x,y,x1,y1)}function squaredDistance(x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;return dx*dx+dy*dy}function solveLinearSystem(mat){for(var n=mat.length,i=0;i<n;i++){for(var maxRow=i,maxEl=Math.abs(mat[i][i]),r=i+1;r<n;r++){var absValue=Math.abs(mat[r][i]);absValue>maxEl&&(maxEl=absValue,maxRow=r)}if(0===maxEl)return null;var tmp=mat[maxRow];mat[maxRow]=mat[i],mat[i]=tmp;for(var j=i+1;j<n;j++)for(var coef=-mat[j][i]/mat[i][i],k=i;k<n+1;k++)i==k?mat[j][k]=0:mat[j][k]+=coef*mat[i][k]}for(var x=new Array(n),l=n-1;l>=0;l--){x[l]=mat[l][n]/mat[l][l];for(var m=l-1;m>=0;m--)mat[m][n]-=mat[m][l]*x[l]}return x}function toRadians(angleInDegrees){return angleInDegrees*Math.PI/180}function modulo(a,b){var r=a%b;return r*b<0?r+b:r}function lerp(a,b,x){return a+x*(b-a)}function createExtent(extent){return function(center){return center?[clamp(center[0],extent[0],extent[2]),clamp(center[1],extent[1],extent[3])]:void 0}}function none(center){return center}function createSnapToResolutions(resolutions){return function(resolution,delta,direction){if(void 0!==resolution){var z=linearFindNearest(resolutions,resolution,direction);z=clamp(z+delta,0,resolutions.length-1);var index=Math.floor(z);if(z!=index&&index<resolutions.length-1){var power=resolutions[index]/resolutions[index+1];return resolutions[index]/Math.pow(power,z-index)}return resolutions[index]}}}function createSnapToPower(power,maxResolution,opt_maxLevel){return function(resolution,delta,direction){if(void 0!==resolution){var offset=-direction/2+.5,oldLevel=Math.floor(Math.log(maxResolution/resolution)/Math.log(power)+offset),newLevel=Math.max(oldLevel+delta,0);return void 0!==opt_maxLevel&&(newLevel=Math.min(newLevel,opt_maxLevel)),maxResolution/Math.pow(power,newLevel)}}}function disable(rotation,delta){return void 0!==rotation?0:void 0}function none$1(rotation,delta){return void 0!==rotation?rotation+delta:void 0}function createSnapToN(n){var theta=2*Math.PI/n;return function(rotation,delta){return void 0!==rotation?rotation=Math.floor((rotation+delta)/theta+.5)*theta:void 0}}function createSnapToZero(opt_tolerance){var tolerance=opt_tolerance||toRadians(5);return function(rotation,delta){return void 0!==rotation?Math.abs(rotation+delta)<=tolerance?0:rotation+delta:void 0}}var ViewHint={ANIMATING:0,INTERACTING:1},ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function add(coordinate,delta){return coordinate[0]+=delta[0],coordinate[1]+=delta[1],coordinate}function closestOnCircle(coordinate,circle){var r=circle.getRadius(),center=circle.getCenter(),x0=center[0],y0=center[1],dx=coordinate[0]-x0,dy=coordinate[1]-y0;0===dx&&0===dy&&(dx=1);var d=Math.sqrt(dx*dx+dy*dy);return[x0+r*dx/d,y0+r*dy/d]}function closestOnSegment(coordinate,segment){var x,y,x0=coordinate[0],y0=coordinate[1],start=segment[0],end=segment[1],x1=start[0],y1=start[1],x2=end[0],y2=end[1],dx=x2-x1,dy=y2-y1,along=0===dx&&0===dy?0:(dx*(x0-x1)+dy*(y0-y1))/(dx*dx+dy*dy||0);return along<=0?(x=x1,y=y1):along>=1?(x=x2,y=y2):(x=x1+along*dx,y=y1+along*dy),[x,y]}function equals$1(coordinate1,coordinate2){for(var equals=!0,i=coordinate1.length-1;i>=0;--i)if(coordinate1[i]!=coordinate2[i]){equals=!1;break}return equals}function rotate(coordinate,angle){var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle),x=coordinate[0]*cosAngle-coordinate[1]*sinAngle,y=coordinate[1]*cosAngle+coordinate[0]*sinAngle;return coordinate[0]=x,coordinate[1]=y,coordinate}function scale(coordinate,scale){return coordinate[0]*=scale,coordinate[1]*=scale,coordinate}function squaredDistance$1(coord1,coord2){var dx=coord1[0]-coord2[0],dy=coord1[1]-coord2[1];return dx*dx+dy*dy}function distance(coord1,coord2){return Math.sqrt(squaredDistance$1(coord1,coord2))}function squaredDistanceToSegment(coordinate,segment){return squaredDistance$1(coordinate,closestOnSegment(coordinate,segment))}function easeIn(t){return Math.pow(t,3)}function easeOut(t){return 1-easeIn(1-t)}function inAndOut(t){return 3*t*t-2*t*t*t}function linear(t){return t}var Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(coordinates){for(var extent=createEmpty(),i=0,ii=coordinates.length;i<ii;++i)extendCoordinate(extent,coordinates[i]);return extent}function _boundingExtentXYs(xs,ys,opt_extent){return createOrUpdate(Math.min.apply(null,xs),Math.min.apply(null,ys),Math.max.apply(null,xs),Math.max.apply(null,ys),opt_extent)}function buffer(extent,value,opt_extent){return opt_extent?(opt_extent[0]=extent[0]-value,opt_extent[1]=extent[1]-value,opt_extent[2]=extent[2]+value,opt_extent[3]=extent[3]+value,opt_extent):[extent[0]-value,extent[1]-value,extent[2]+value,extent[3]+value]}function clone(extent,opt_extent){return opt_extent?(opt_extent[0]=extent[0],opt_extent[1]=extent[1],opt_extent[2]=extent[2],opt_extent[3]=extent[3],opt_extent):extent.slice()}function closestSquaredDistanceXY(extent,x,y){var dx,dy;return(dx=x<extent[0]?extent[0]-x:extent[2]<x?x-extent[2]:0)*dx+(dy=y<extent[1]?extent[1]-y:extent[3]<y?y-extent[3]:0)*dy}function containsCoordinate(extent,coordinate){return containsXY(extent,coordinate[0],coordinate[1])}function containsExtent(extent1,extent2){return extent1[0]<=extent2[0]&&extent2[2]<=extent1[2]&&extent1[1]<=extent2[1]&&extent2[3]<=extent1[3]}function containsXY(extent,x,y){return extent[0]<=x&&x<=extent[2]&&extent[1]<=y&&y<=extent[3]}function coordinateRelationship(extent,coordinate){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],x=coordinate[0],y=coordinate[1],relationship=Relationship.UNKNOWN;return x<minX?relationship|=Relationship.LEFT:x>maxX&&(relationship|=Relationship.RIGHT),y<minY?relationship|=Relationship.BELOW:y>maxY&&(relationship|=Relationship.ABOVE),relationship===Relationship.UNKNOWN&&(relationship=Relationship.INTERSECTING),relationship}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate(minX,minY,maxX,maxY,opt_extent){return opt_extent?(opt_extent[0]=minX,opt_extent[1]=minY,opt_extent[2]=maxX,opt_extent[3]=maxY,opt_extent):[minX,minY,maxX,maxY]}function createOrUpdateEmpty(opt_extent){return createOrUpdate(1/0,1/0,-1/0,-1/0,opt_extent)}function createOrUpdateFromCoordinate(coordinate,opt_extent){var x=coordinate[0],y=coordinate[1];return createOrUpdate(x,y,x,y,opt_extent)}function createOrUpdateFromCoordinates(coordinates,opt_extent){return extendCoordinates(createOrUpdateEmpty(opt_extent),coordinates)}function createOrUpdateFromFlatCoordinates(flatCoordinates,offset,end,stride,opt_extent){return extendFlatCoordinates(createOrUpdateEmpty(opt_extent),flatCoordinates,offset,end,stride)}function equals$2(extent1,extent2){return extent1[0]==extent2[0]&&extent1[2]==extent2[2]&&extent1[1]==extent2[1]&&extent1[3]==extent2[3]}function extend$1(extent1,extent2){return extent2[0]<extent1[0]&&(extent1[0]=extent2[0]),extent2[2]>extent1[2]&&(extent1[2]=extent2[2]),extent2[1]<extent1[1]&&(extent1[1]=extent2[1]),extent2[3]>extent1[3]&&(extent1[3]=extent2[3]),extent1}function extendCoordinate(extent,coordinate){coordinate[0]<extent[0]&&(extent[0]=coordinate[0]),coordinate[0]>extent[2]&&(extent[2]=coordinate[0]),coordinate[1]<extent[1]&&(extent[1]=coordinate[1]),coordinate[1]>extent[3]&&(extent[3]=coordinate[1])}function extendCoordinates(extent,coordinates){for(var i=0,ii=coordinates.length;i<ii;++i)extendCoordinate(extent,coordinates[i]);return extent}function extendFlatCoordinates(extent,flatCoordinates,offset,end,stride){for(;offset<end;offset+=stride)extendXY(extent,flatCoordinates[offset],flatCoordinates[offset+1]);return extent}function extendXY(extent,x,y){extent[0]=Math.min(extent[0],x),extent[1]=Math.min(extent[1],y),extent[2]=Math.max(extent[2],x),extent[3]=Math.max(extent[3],y)}function forEachCorner(extent,callback,opt_this){var val;return(val=callback.call(opt_this,getBottomLeft(extent)))?val:(val=callback.call(opt_this,getBottomRight(extent)))?val:(val=callback.call(opt_this,getTopRight(extent)))?val:(val=callback.call(opt_this,getTopLeft(extent)))||!1}function getArea(extent){var area=0;return isEmpty$1(extent)||(area=getWidth(extent)*getHeight(extent)),area}function getBottomLeft(extent){return[extent[0],extent[1]]}function getBottomRight(extent){return[extent[2],extent[1]]}function getCenter(extent){return[(extent[0]+extent[2])/2,(extent[1]+extent[3])/2]}function getForViewAndSize(center,resolution,rotation,size,opt_extent){var dx=resolution*size[0]/2,dy=resolution*size[1]/2,cosRotation=Math.cos(rotation),sinRotation=Math.sin(rotation),xCos=dx*cosRotation,xSin=dx*sinRotation,yCos=dy*cosRotation,ySin=dy*sinRotation,x=center[0],y=center[1],x0=x-xCos+ySin,x1=x-xCos-ySin,x2=x+xCos-ySin,x3=x+xCos+ySin,y0=y-xSin-yCos,y1=y-xSin+yCos,y2=y+xSin+yCos,y3=y+xSin-yCos;return createOrUpdate(Math.min(x0,x1,x2,x3),Math.min(y0,y1,y2,y3),Math.max(x0,x1,x2,x3),Math.max(y0,y1,y2,y3),opt_extent)}function getHeight(extent){return extent[3]-extent[1]}function getIntersection(extent1,extent2,opt_extent){var intersection=opt_extent||createEmpty();return intersects(extent1,extent2)?(extent1[0]>extent2[0]?intersection[0]=extent1[0]:intersection[0]=extent2[0],extent1[1]>extent2[1]?intersection[1]=extent1[1]:intersection[1]=extent2[1],extent1[2]<extent2[2]?intersection[2]=extent1[2]:intersection[2]=extent2[2],extent1[3]<extent2[3]?intersection[3]=extent1[3]:intersection[3]=extent2[3]):createOrUpdateEmpty(intersection),intersection}function getTopLeft(extent){return[extent[0],extent[3]]}function getTopRight(extent){return[extent[2],extent[3]]}function getWidth(extent){return extent[2]-extent[0]}function intersects(extent1,extent2){return extent1[0]<=extent2[2]&&extent1[2]>=extent2[0]&&extent1[1]<=extent2[3]&&extent1[3]>=extent2[1]}function isEmpty$1(extent){return extent[2]<extent[0]||extent[3]<extent[1]}function returnOrUpdate(extent,opt_extent){return opt_extent?(opt_extent[0]=extent[0],opt_extent[1]=extent[1],opt_extent[2]=extent[2],opt_extent[3]=extent[3],opt_extent):extent}function scaleFromCenter(extent,value){var deltaX=(extent[2]-extent[0])/2*(value-1),deltaY=(extent[3]-extent[1])/2*(value-1);extent[0]-=deltaX,extent[2]+=deltaX,extent[1]-=deltaY,extent[3]+=deltaY}function intersectsSegment(extent,start,end){var intersects=!1,startRel=coordinateRelationship(extent,start),endRel=coordinateRelationship(extent,end);if(startRel===Relationship.INTERSECTING||endRel===Relationship.INTERSECTING)intersects=!0;else{var x,y,minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],startX=start[0],startY=start[1],endX=end[0],endY=end[1],slope=(endY-startY)/(endX-startX);endRel&Relationship.ABOVE&&!(startRel&Relationship.ABOVE)&&(intersects=(x=endX-(endY-maxY)/slope)>=minX&&x<=maxX),intersects||!(endRel&Relationship.RIGHT)||startRel&Relationship.RIGHT||(intersects=(y=endY-(endX-maxX)*slope)>=minY&&y<=maxY),intersects||!(endRel&Relationship.BELOW)||startRel&Relationship.BELOW||(intersects=(x=endX-(endY-minY)/slope)>=minX&&x<=maxX),intersects||!(endRel&Relationship.LEFT)||startRel&Relationship.LEFT||(intersects=(y=endY-(endX-minX)*slope)>=minY&&y<=maxY)}return intersects}function applyTransform(extent,transformFn,opt_extent){var coordinates=[extent[0],extent[1],extent[0],extent[3],extent[2],extent[1],extent[2],extent[3]];return transformFn(coordinates,coordinates,2),_boundingExtentXYs([coordinates[0],coordinates[2],coordinates[4],coordinates[6]],[coordinates[1],coordinates[3],coordinates[5],coordinates[7]],opt_extent)}var GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},GeometryLayout={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function transform2D(flatCoordinates,offset,end,stride,transform,opt_dest){for(var dest=opt_dest||[],i=0,j=offset;j<end;j+=stride){var x=flatCoordinates[j],y=flatCoordinates[j+1];dest[i++]=transform[0]*x+transform[2]*y+transform[4],dest[i++]=transform[1]*x+transform[3]*y+transform[5]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}function rotate$1(flatCoordinates,offset,end,stride,angle,anchor,opt_dest){for(var dest=opt_dest||[],cos=Math.cos(angle),sin=Math.sin(angle),anchorX=anchor[0],anchorY=anchor[1],i=0,j=offset;j<end;j+=stride){var deltaX=flatCoordinates[j]-anchorX,deltaY=flatCoordinates[j+1]-anchorY;dest[i++]=anchorX+deltaX*cos-deltaY*sin,dest[i++]=anchorY+deltaX*sin+deltaY*cos;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}function scale$1(flatCoordinates,offset,end,stride,sx,sy,anchor,opt_dest){for(var dest=opt_dest||[],anchorX=anchor[0],anchorY=anchor[1],i=0,j=offset;j<end;j+=stride){var deltaX=flatCoordinates[j]-anchorX,deltaY=flatCoordinates[j+1]-anchorY;dest[i++]=anchorX+sx*deltaX,dest[i++]=anchorY+sy*deltaY;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}function translate(flatCoordinates,offset,end,stride,deltaX,deltaY,opt_dest){for(var dest=opt_dest||[],i=0,j=offset;j<end;j+=stride){dest[i++]=flatCoordinates[j]+deltaX,dest[i++]=flatCoordinates[j+1]+deltaY;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}var DEFAULT_RADIUS=6371008.8;function getDistance(c1,c2,opt_radius){var radius=opt_radius||DEFAULT_RADIUS,lat1=toRadians(c1[1]),lat2=toRadians(c2[1]),deltaLatBy2=(lat2-lat1)/2,deltaLonBy2=toRadians(c2[0]-c1[0])/2,a=Math.sin(deltaLatBy2)*Math.sin(deltaLatBy2)+Math.sin(deltaLonBy2)*Math.sin(deltaLonBy2)*Math.cos(lat1)*Math.cos(lat2);return 2*radius*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var Units={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},METERS_PER_UNIT={};METERS_PER_UNIT[Units.DEGREES]=2*Math.PI*6370997/360,METERS_PER_UNIT[Units.FEET]=.3048,METERS_PER_UNIT[Units.METERS]=1,METERS_PER_UNIT[Units.USFEET]=1200/3937;var Projection=function(options){this.code_=options.code,this.units_=options.units,this.extent_=void 0!==options.extent?options.extent:null,this.worldExtent_=void 0!==options.worldExtent?options.worldExtent:null,this.axisOrientation_=void 0!==options.axisOrientation?options.axisOrientation:"enu",this.global_=void 0!==options.global&&options.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=options.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=options.metersPerUnit};Projection.prototype.canWrapX=function(){return this.canWrapX_},Projection.prototype.getCode=function(){return this.code_},Projection.prototype.getExtent=function(){return this.extent_},Projection.prototype.getUnits=function(){return this.units_},Projection.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||METERS_PER_UNIT[this.units_]},Projection.prototype.getWorldExtent=function(){return this.worldExtent_},Projection.prototype.getAxisOrientation=function(){return this.axisOrientation_},Projection.prototype.isGlobal=function(){return this.global_},Projection.prototype.setGlobal=function(global){this.global_=global,this.canWrapX_=!(!global||!this.extent_)},Projection.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},Projection.prototype.setDefaultTileGrid=function(tileGrid){this.defaultTileGrid_=tileGrid},Projection.prototype.setExtent=function(extent){this.extent_=extent,this.canWrapX_=!(!this.global_||!extent)},Projection.prototype.setWorldExtent=function(worldExtent){this.worldExtent_=worldExtent},Projection.prototype.setGetPointResolution=function(func){this.getPointResolutionFunc_=func},Projection.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var RADIUS=6378137,HALF_SIZE=Math.PI*RADIUS,EXTENT=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],EPSG3857Projection=function(Projection$$1){function EPSG3857Projection(code){Projection$$1.call(this,{code:code,units:Units.METERS,extent:EXTENT,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(resolution,point){return resolution/cosh(point[1]/RADIUS)}})}return Projection$$1&&(EPSG3857Projection.__proto__=Projection$$1),EPSG3857Projection.prototype=Object.create(Projection$$1&&Projection$$1.prototype),EPSG3857Projection.prototype.constructor=EPSG3857Projection,EPSG3857Projection}(Projection),PROJECTIONS=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("urn:ogc:def:crs:EPSG:6.18:3:3857"),new EPSG3857Projection("urn:ogc:def:crs:EPSG::3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(input,opt_output,opt_dimension){var length=input.length,dimension=opt_dimension>1?opt_dimension:2,output=opt_output;void 0===output&&(output=dimension>2?input.slice():new Array(length));for(var halfSize=HALF_SIZE,i=0;i<length;i+=dimension){output[i]=halfSize*input[i]/180;var y=RADIUS*Math.log(Math.tan(Math.PI*(input[i+1]+90)/360));y>halfSize?y=halfSize:y<-halfSize&&(y=-halfSize),output[i+1]=y}return output}function toEPSG4326(input,opt_output,opt_dimension){var length=input.length,dimension=opt_dimension>1?opt_dimension:2,output=opt_output;void 0===output&&(output=dimension>2?input.slice():new Array(length));for(var i=0;i<length;i+=dimension)output[i]=180*input[i]/HALF_SIZE,output[i+1]=360*Math.atan(Math.exp(input[i+1]/RADIUS))/Math.PI-90;return output}var RADIUS$1=6378137,EXTENT$1=[-180,-90,180,90],METERS_PER_UNIT$1=Math.PI*RADIUS$1/180,EPSG4326Projection=function(Projection$$1){function EPSG4326Projection(code,opt_axisOrientation){Projection$$1.call(this,{code:code,units:Units.DEGREES,extent:EXTENT$1,axisOrientation:opt_axisOrientation,global:!0,metersPerUnit:METERS_PER_UNIT$1,worldExtent:EXTENT$1})}return Projection$$1&&(EPSG4326Projection.__proto__=Projection$$1),EPSG4326Projection.prototype=Object.create(Projection$$1&&Projection$$1.prototype),EPSG4326Projection.prototype.constructor=EPSG4326Projection,EPSG4326Projection}(Projection),PROJECTIONS$1=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:EPSG::4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("urn:x-ogc:def:crs:EPSG:4326","neu")],cache={};function get(code){return cache[code]||null}function add$1(code,projection){cache[code]=projection}var transforms={};function add$2(source,destination,transformFn){var sourceCode=source.getCode(),destinationCode=destination.getCode();sourceCode in transforms||(transforms[sourceCode]={}),transforms[sourceCode][destinationCode]=transformFn}function get$1(sourceCode,destinationCode){var transform;return sourceCode in transforms&&destinationCode in transforms[sourceCode]&&(transform=transforms[sourceCode][destinationCode]),transform}function cloneTransform(input,opt_output,opt_dimension){var output;if(void 0!==opt_output){for(var i=0,ii=input.length;i<ii;++i)opt_output[i]=input[i];output=opt_output}else output=input.slice();return output}function identityTransform(input,opt_output,opt_dimension){if(void 0!==opt_output&&input!==opt_output){for(var i=0,ii=input.length;i<ii;++i)opt_output[i]=input[i];input=opt_output}return input}function addProjection(projection){add$1(projection.getCode(),projection),add$2(projection,projection,cloneTransform)}function addProjections(projections){projections.forEach(addProjection)}function get$2(projectionLike){return"string"==typeof projectionLike?get(projectionLike):projectionLike||null}function getPointResolution(projection,resolution,point,opt_units){var pointResolution,getter=(projection=get$2(projection)).getPointResolutionFunc();if(getter)pointResolution=getter(resolution,point);else if(projection.getUnits()==Units.DEGREES&&!opt_units||opt_units==Units.DEGREES)pointResolution=resolution;else{var toEPSG4326$$1=getTransformFromProjections(projection,get$2("EPSG:4326")),vertices=[point[0]-resolution/2,point[1],point[0]+resolution/2,point[1],point[0],point[1]-resolution/2,point[0],point[1]+resolution/2];pointResolution=(getDistance((vertices=toEPSG4326$$1(vertices,vertices,2)).slice(0,2),vertices.slice(2,4))+getDistance(vertices.slice(4,6),vertices.slice(6,8)))/2;var metersPerUnit=opt_units?METERS_PER_UNIT[opt_units]:projection.getMetersPerUnit();void 0!==metersPerUnit&&(pointResolution/=metersPerUnit)}return pointResolution}function addEquivalentProjections(projections){addProjections(projections),projections.forEach(function(source){projections.forEach(function(destination){source!==destination&&add$2(source,destination,cloneTransform)})})}function addEquivalentTransforms(projections1,projections2,forwardTransform,inverseTransform){projections1.forEach(function(projection1){projections2.forEach(function(projection2){add$2(projection1,projection2,forwardTransform),add$2(projection2,projection1,inverseTransform)})})}function createProjection(projection,defaultCode){return projection?"string"==typeof projection?get$2(projection):projection:get$2(defaultCode)}function equivalent(projection1,projection2){if(projection1===projection2)return!0;var equalUnits=projection1.getUnits()===projection2.getUnits();return projection1.getCode()===projection2.getCode()?equalUnits:getTransformFromProjections(projection1,projection2)===cloneTransform&&equalUnits}function getTransformFromProjections(sourceProjection,destinationProjection){var transformFunc=get$1(sourceProjection.getCode(),destinationProjection.getCode());return transformFunc||(transformFunc=identityTransform),transformFunc}function getTransform(source,destination){return getTransformFromProjections(get$2(source),get$2(destination))}function transform(coordinate,source,destination){return getTransform(source,destination)(coordinate,void 0,coordinate.length)}function transformExtent(extent,source,destination){return applyTransform(extent,getTransform(source,destination))}function addCommon(){addEquivalentProjections(PROJECTIONS),addEquivalentProjections(PROJECTIONS$1),addEquivalentTransforms(PROJECTIONS$1,PROJECTIONS,fromEPSG4326,toEPSG4326)}addCommon();var tmp_=new Array(6);function create(){return[1,0,0,1,0,0]}function reset(transform){return set(transform,1,0,0,1,0,0)}function multiply(transform1,transform2){var a1=transform1[0],b1=transform1[1],c1=transform1[2],d1=transform1[3],e1=transform1[4],f1=transform1[5],a2=transform2[0],b2=transform2[1],c2=transform2[2],d2=transform2[3],e2=transform2[4],f2=transform2[5];return transform1[0]=a1*a2+c1*b2,transform1[1]=b1*a2+d1*b2,transform1[2]=a1*c2+c1*d2,transform1[3]=b1*c2+d1*d2,transform1[4]=a1*e2+c1*f2+e1,transform1[5]=b1*e2+d1*f2+f1,transform1}function set(transform,a,b,c,d,e,f){return transform[0]=a,transform[1]=b,transform[2]=c,transform[3]=d,transform[4]=e,transform[5]=f,transform}function setFromArray(transform1,transform2){return transform1[0]=transform2[0],transform1[1]=transform2[1],transform1[2]=transform2[2],transform1[3]=transform2[3],transform1[4]=transform2[4],transform1[5]=transform2[5],transform1}function apply(transform,coordinate){var x=coordinate[0],y=coordinate[1];return coordinate[0]=transform[0]*x+transform[2]*y+transform[4],coordinate[1]=transform[1]*x+transform[3]*y+transform[5],coordinate}function scale$2(transform,x,y){return multiply(transform,set(tmp_,x,0,0,y,0,0))}function translate$1(transform,dx,dy){return multiply(transform,set(tmp_,1,0,0,1,dx,dy))}function compose(transform,dx1,dy1,sx,sy,angle,dx2,dy2){var sin=Math.sin(angle),cos=Math.cos(angle);return transform[0]=sx*cos,transform[1]=sy*sin,transform[2]=-sx*sin,transform[3]=sy*cos,transform[4]=dx2*sx*cos-dy2*sx*sin+dx1,transform[5]=dx2*sy*sin+dy2*sy*cos+dy1,transform}function invert(transform){var det=determinant(transform);assert(0!==det,32);var a=transform[0],b=transform[1],c=transform[2],d=transform[3],e=transform[4],f=transform[5];return transform[0]=d/det,transform[1]=-b/det,transform[2]=-c/det,transform[3]=a/det,transform[4]=(c*f-d*e)/det,transform[5]=-(a*f-b*e)/det,transform}function determinant(mat){return mat[0]*mat[3]-mat[1]*mat[2]}var tmpTransform=create(),Geometry=function(BaseObject$$1){function Geometry(){BaseObject$$1.call(this),this.extent_=createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0}return BaseObject$$1&&(Geometry.__proto__=BaseObject$$1),Geometry.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),Geometry.prototype.constructor=Geometry,Geometry.prototype.clone=function(){return abstract()},Geometry.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return abstract()},Geometry.prototype.containsXY=function(x,y){return!1},Geometry.prototype.getClosestPoint=function(point,opt_closestPoint){var closestPoint=opt_closestPoint||[NaN,NaN];return this.closestPointXY(point[0],point[1],closestPoint,1/0),closestPoint},Geometry.prototype.intersectsCoordinate=function(coordinate){return this.containsXY(coordinate[0],coordinate[1])},Geometry.prototype.computeExtent=function(extent){return abstract()},Geometry.prototype.getExtent=function(opt_extent){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),returnOrUpdate(this.extent_,opt_extent)},Geometry.prototype.rotate=function(angle,anchor){abstract()},Geometry.prototype.scale=function(sx,opt_sy,opt_anchor){abstract()},Geometry.prototype.simplify=function(tolerance){return this.getSimplifiedGeometry(tolerance*tolerance)},Geometry.prototype.getSimplifiedGeometry=function(squaredTolerance){return abstract()},Geometry.prototype.getType=function(){return abstract()},Geometry.prototype.applyTransform=function(transformFn){abstract()},Geometry.prototype.intersectsExtent=function(extent){return abstract()},Geometry.prototype.translate=function(deltaX,deltaY){abstract()},Geometry.prototype.transform=function(source,destination){var sourceProj=get$2(source),transformFn=sourceProj.getUnits()==Units.TILE_PIXELS?function(inCoordinates,outCoordinates,stride){var pixelExtent=sourceProj.getExtent(),projectedExtent=sourceProj.getWorldExtent(),scale=getHeight(projectedExtent)/getHeight(pixelExtent);return compose(tmpTransform,projectedExtent[0],projectedExtent[3],scale,-scale,0,0,0),transform2D(inCoordinates,0,inCoordinates.length,stride,tmpTransform,outCoordinates),getTransform(sourceProj,destination)(inCoordinates,outCoordinates,stride)}:getTransform(sourceProj,destination);return this.applyTransform(transformFn),this},Geometry}(BaseObject),SimpleGeometry=function(Geometry$$1){function SimpleGeometry(){Geometry$$1.call(this),this.layout=GeometryLayout.XY,this.stride=2,this.flatCoordinates=null}return Geometry$$1&&(SimpleGeometry.__proto__=Geometry$$1),SimpleGeometry.prototype=Object.create(Geometry$$1&&Geometry$$1.prototype),SimpleGeometry.prototype.constructor=SimpleGeometry,SimpleGeometry.prototype.computeExtent=function(extent){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,extent)},SimpleGeometry.prototype.getCoordinates=function(){return abstract()},SimpleGeometry.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},SimpleGeometry.prototype.getFlatCoordinates=function(){return this.flatCoordinates},SimpleGeometry.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},SimpleGeometry.prototype.getLayout=function(){return this.layout},SimpleGeometry.prototype.getSimplifiedGeometry=function(squaredTolerance){if(this.simplifiedGeometryRevision!=this.getRevision()&&(clear(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),squaredTolerance<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&squaredTolerance<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var key=squaredTolerance.toString();if(this.simplifiedGeometryCache.hasOwnProperty(key))return this.simplifiedGeometryCache[key];var simplifiedGeometry=this.getSimplifiedGeometryInternal(squaredTolerance);return simplifiedGeometry.getFlatCoordinates().length<this.flatCoordinates.length?(this.simplifiedGeometryCache[key]=simplifiedGeometry,simplifiedGeometry):(this.simplifiedGeometryMaxMinSquaredTolerance=squaredTolerance,this)},SimpleGeometry.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){return this},SimpleGeometry.prototype.getStride=function(){return this.stride},SimpleGeometry.prototype.setFlatCoordinates=function(layout,flatCoordinates){this.stride=getStrideForLayout(layout),this.layout=layout,this.flatCoordinates=flatCoordinates},SimpleGeometry.prototype.setCoordinates=function(coordinates,opt_layout){abstract()},SimpleGeometry.prototype.setLayout=function(layout,coordinates,nesting){var stride;if(layout)stride=getStrideForLayout(layout);else{for(var i=0;i<nesting;++i){if(0===coordinates.length)return this.layout=GeometryLayout.XY,void(this.stride=2);coordinates=coordinates[0]}layout=getLayoutForStride(stride=coordinates.length)}this.layout=layout,this.stride=stride},SimpleGeometry.prototype.applyTransform=function(transformFn){this.flatCoordinates&&(transformFn(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},SimpleGeometry.prototype.rotate=function(angle,anchor){var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();rotate$1(flatCoordinates,0,flatCoordinates.length,stride,angle,anchor,flatCoordinates),this.changed()}},SimpleGeometry.prototype.scale=function(sx,opt_sy,opt_anchor){var sy=opt_sy;void 0===sy&&(sy=sx);var anchor=opt_anchor;anchor||(anchor=getCenter(this.getExtent()));var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();scale$1(flatCoordinates,0,flatCoordinates.length,stride,sx,sy,anchor,flatCoordinates),this.changed()}},SimpleGeometry.prototype.translate=function(deltaX,deltaY){var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();translate(flatCoordinates,0,flatCoordinates.length,stride,deltaX,deltaY,flatCoordinates),this.changed()}},SimpleGeometry}(Geometry);function getLayoutForStride(stride){var layout;return 2==stride?layout=GeometryLayout.XY:3==stride?layout=GeometryLayout.XYZ:4==stride&&(layout=GeometryLayout.XYZM),layout}function getStrideForLayout(layout){var stride;return layout==GeometryLayout.XY?stride=2:layout==GeometryLayout.XYZ||layout==GeometryLayout.XYM?stride=3:layout==GeometryLayout.XYZM&&(stride=4),stride}function transformGeom2D(simpleGeometry,transform,opt_dest){var flatCoordinates=simpleGeometry.getFlatCoordinates();if(flatCoordinates){var stride=simpleGeometry.getStride();return transform2D(flatCoordinates,0,flatCoordinates.length,stride,transform,opt_dest)}return null}function linearRing(flatCoordinates,offset,end,stride){for(var twiceArea=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];twiceArea+=y1*x2-x1*y2,x1=x2,y1=y2}return twiceArea/2}function linearRings(flatCoordinates,offset,ends,stride){for(var area=0,i=0,ii=ends.length;i<ii;++i){var end=ends[i];area+=linearRing(flatCoordinates,offset,end,stride),offset=end}return area}function linearRingss(flatCoordinates,offset,endss,stride){for(var area=0,i=0,ii=endss.length;i<ii;++i){var ends=endss[i];area+=linearRings(flatCoordinates,offset,ends,stride),offset=ends[ends.length-1]}return area}function assignClosest(flatCoordinates,offset1,offset2,stride,x,y,closestPoint){var offset,x1=flatCoordinates[offset1],y1=flatCoordinates[offset1+1],dx=flatCoordinates[offset2]-x1,dy=flatCoordinates[offset2+1]-y1;if(0===dx&&0===dy)offset=offset1;else{var t=((x-x1)*dx+(y-y1)*dy)/(dx*dx+dy*dy);if(t>1)offset=offset2;else{if(t>0){for(var i=0;i<stride;++i)closestPoint[i]=lerp(flatCoordinates[offset1+i],flatCoordinates[offset2+i],t);return void(closestPoint.length=stride)}offset=offset1}}for(var i$1=0;i$1<stride;++i$1)closestPoint[i$1]=flatCoordinates[offset+i$1];closestPoint.length=stride}function maxSquaredDelta(flatCoordinates,offset,end,stride,max){var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1];for(offset+=stride;offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1],squaredDelta=squaredDistance(x1,y1,x2,y2);squaredDelta>max&&(max=squaredDelta),x1=x2,y1=y2}return max}function arrayMaxSquaredDelta(flatCoordinates,offset,ends,stride,max){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];max=maxSquaredDelta(flatCoordinates,offset,end,stride,max),offset=end}return max}function multiArrayMaxSquaredDelta(flatCoordinates,offset,endss,stride,max){for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];max=arrayMaxSquaredDelta(flatCoordinates,offset,ends,stride,max),offset=ends[ends.length-1]}return max}function assignClosestPoint(flatCoordinates,offset,end,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){if(offset==end)return minSquaredDistance;var i,squaredDistance$$1;if(0===maxDelta){if((squaredDistance$$1=squaredDistance(x,y,flatCoordinates[offset],flatCoordinates[offset+1]))<minSquaredDistance){for(i=0;i<stride;++i)closestPoint[i]=flatCoordinates[offset+i];return closestPoint.length=stride,squaredDistance$$1}return minSquaredDistance}for(var tmpPoint=opt_tmpPoint||[NaN,NaN],index=offset+stride;index<end;)if(assignClosest(flatCoordinates,index-stride,index,stride,x,y,tmpPoint),(squaredDistance$$1=squaredDistance(x,y,tmpPoint[0],tmpPoint[1]))<minSquaredDistance){for(minSquaredDistance=squaredDistance$$1,i=0;i<stride;++i)closestPoint[i]=tmpPoint[i];closestPoint.length=stride,index+=stride}else index+=stride*Math.max((Math.sqrt(squaredDistance$$1)-Math.sqrt(minSquaredDistance))/maxDelta|0,1);if(isRing&&(assignClosest(flatCoordinates,end-stride,offset,stride,x,y,tmpPoint),(squaredDistance$$1=squaredDistance(x,y,tmpPoint[0],tmpPoint[1]))<minSquaredDistance)){for(minSquaredDistance=squaredDistance$$1,i=0;i<stride;++i)closestPoint[i]=tmpPoint[i];closestPoint.length=stride}return minSquaredDistance}function assignClosestArrayPoint(flatCoordinates,offset,ends,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){for(var tmpPoint=opt_tmpPoint||[NaN,NaN],i=0,ii=ends.length;i<ii;++i){var end=ends[i];minSquaredDistance=assignClosestPoint(flatCoordinates,offset,end,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,tmpPoint),offset=end}return minSquaredDistance}function assignClosestMultiArrayPoint(flatCoordinates,offset,endss,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){for(var tmpPoint=opt_tmpPoint||[NaN,NaN],i=0,ii=endss.length;i<ii;++i){var ends=endss[i];minSquaredDistance=assignClosestArrayPoint(flatCoordinates,offset,ends,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,tmpPoint),offset=ends[ends.length-1]}return minSquaredDistance}function deflateCoordinate(flatCoordinates,offset,coordinate,stride){for(var i=0,ii=coordinate.length;i<ii;++i)flatCoordinates[offset++]=coordinate[i];return offset}function deflateCoordinates(flatCoordinates,offset,coordinates,stride){for(var i=0,ii=coordinates.length;i<ii;++i)for(var coordinate=coordinates[i],j=0;j<stride;++j)flatCoordinates[offset++]=coordinate[j];return offset}function deflateCoordinatesArray(flatCoordinates,offset,coordinatess,stride,opt_ends){for(var ends=opt_ends||[],i=0,j=0,jj=coordinatess.length;j<jj;++j){var end=deflateCoordinates(flatCoordinates,offset,coordinatess[j],stride);ends[i++]=end,offset=end}return ends.length=i,ends}function deflateMultiCoordinatesArray(flatCoordinates,offset,coordinatesss,stride,opt_endss){for(var endss=opt_endss||[],i=0,j=0,jj=coordinatesss.length;j<jj;++j){var ends=deflateCoordinatesArray(flatCoordinates,offset,coordinatesss[j],stride,endss[i]);endss[i++]=ends,offset=ends[ends.length-1]}return endss.length=i,endss}function inflateCoordinates(flatCoordinates,offset,end,stride,opt_coordinates){for(var coordinates=void 0!==opt_coordinates?opt_coordinates:[],i=0,j=offset;j<end;j+=stride)coordinates[i++]=flatCoordinates.slice(j,j+stride);return coordinates.length=i,coordinates}function inflateCoordinatesArray(flatCoordinates,offset,ends,stride,opt_coordinatess){for(var coordinatess=void 0!==opt_coordinatess?opt_coordinatess:[],i=0,j=0,jj=ends.length;j<jj;++j){var end=ends[j];coordinatess[i++]=inflateCoordinates(flatCoordinates,offset,end,stride,coordinatess[i]),offset=end}return coordinatess.length=i,coordinatess}function inflateMultiCoordinatesArray(flatCoordinates,offset,endss,stride,opt_coordinatesss){for(var coordinatesss=void 0!==opt_coordinatesss?opt_coordinatesss:[],i=0,j=0,jj=endss.length;j<jj;++j){var ends=endss[j];coordinatesss[i++]=inflateCoordinatesArray(flatCoordinates,offset,ends,stride,coordinatesss[i]),offset=ends[ends.length-1]}return coordinatesss.length=i,coordinatesss}function douglasPeucker(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset){var n=(end-offset)/stride;if(n<3){for(;offset<end;offset+=stride)simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+1];return simplifiedOffset}var markers=new Array(n);markers[0]=1,markers[n-1]=1;for(var stack=[offset,end-stride],index=0;stack.length>0;){for(var last=stack.pop(),first=stack.pop(),maxSquaredDistance=0,x1=flatCoordinates[first],y1=flatCoordinates[first+1],x2=flatCoordinates[last],y2=flatCoordinates[last+1],i=first+stride;i<last;i+=stride){var squaredDistance$$1=squaredSegmentDistance(flatCoordinates[i],flatCoordinates[i+1],x1,y1,x2,y2);squaredDistance$$1>maxSquaredDistance&&(index=i,maxSquaredDistance=squaredDistance$$1)}maxSquaredDistance>squaredTolerance&&(markers[(index-offset)/stride]=1,first+stride<index&&stack.push(first,index),index+stride<last&&stack.push(index,last))}for(var i$1=0;i$1<n;++i$1)markers[i$1]&&(simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+i$1*stride],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+i$1*stride+1]);return simplifiedOffset}function douglasPeuckerArray(flatCoordinates,offset,ends,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];simplifiedOffset=douglasPeucker(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset),simplifiedEnds.push(simplifiedOffset),offset=end}return simplifiedOffset}function snap(value,tolerance){return tolerance*Math.round(value/tolerance)}function quantize(flatCoordinates,offset,end,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset){if(offset==end)return simplifiedOffset;var x2,y2,x1=snap(flatCoordinates[offset],tolerance),y1=snap(flatCoordinates[offset+1],tolerance);offset+=stride,simplifiedFlatCoordinates[simplifiedOffset++]=x1,simplifiedFlatCoordinates[simplifiedOffset++]=y1;do{if(x2=snap(flatCoordinates[offset],tolerance),y2=snap(flatCoordinates[offset+1],tolerance),(offset+=stride)==end)return simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,simplifiedOffset}while(x2==x1&&y2==y1);for(;offset<end;){var x3=snap(flatCoordinates[offset],tolerance),y3=snap(flatCoordinates[offset+1],tolerance);if(offset+=stride,x3!=x2||y3!=y2){var dx1=x2-x1,dy1=y2-y1,dx2=x3-x1,dy2=y3-y1;dx1*dy2==dy1*dx2&&(dx1<0&&dx2<dx1||dx1==dx2||dx1>0&&dx2>dx1)&&(dy1<0&&dy2<dy1||dy1==dy2||dy1>0&&dy2>dy1)?(x2=x3,y2=y3):(simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,x1=x2,y1=y2,x2=x3,y2=y3)}}return simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,simplifiedOffset}function quantizeArray(flatCoordinates,offset,ends,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];simplifiedOffset=quantize(flatCoordinates,offset,end,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset),simplifiedEnds.push(simplifiedOffset),offset=end}return simplifiedOffset}function quantizeMultiArray(flatCoordinates,offset,endss,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEndss){for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i],simplifiedEnds=[];simplifiedOffset=quantizeArray(flatCoordinates,offset,ends,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds),simplifiedEndss.push(simplifiedEnds),offset=ends[ends.length-1]}return simplifiedOffset}var LinearRing=function(SimpleGeometry$$1){function LinearRing(coordinates,opt_layout){SimpleGeometry$$1.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===opt_layout||Array.isArray(coordinates[0])?this.setCoordinates(coordinates,opt_layout):this.setFlatCoordinates(opt_layout,coordinates)}return SimpleGeometry$$1&&(LinearRing.__proto__=SimpleGeometry$$1),LinearRing.prototype=Object.create(SimpleGeometry$$1&&SimpleGeometry$$1.prototype),LinearRing.prototype.constructor=LinearRing,LinearRing.prototype.clone=function(){return new LinearRing(this.flatCoordinates.slice(),this.layout)},LinearRing.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},LinearRing.prototype.getArea=function(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LinearRing.prototype.getCoordinates=function(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LinearRing.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[];return simplifiedFlatCoordinates.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,squaredTolerance,simplifiedFlatCoordinates,0),new LinearRing(simplifiedFlatCoordinates,GeometryLayout.XY)},LinearRing.prototype.getType=function(){return GeometryType.LINEAR_RING},LinearRing.prototype.intersectsExtent=function(extent){return!1},LinearRing.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,coordinates,this.stride),this.changed()},LinearRing}(SimpleGeometry),Point=function(SimpleGeometry$$1){function Point(coordinates,opt_layout){SimpleGeometry$$1.call(this),this.setCoordinates(coordinates,opt_layout)}return SimpleGeometry$$1&&(Point.__proto__=SimpleGeometry$$1),Point.prototype=Object.create(SimpleGeometry$$1&&SimpleGeometry$$1.prototype),Point.prototype.constructor=Point,Point.prototype.clone=function(){return new Point(this.flatCoordinates.slice(),this.layout)},Point.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){var flatCoordinates=this.flatCoordinates,squaredDistance$$1=squaredDistance(x,y,flatCoordinates[0],flatCoordinates[1]);if(squaredDistance$$1<minSquaredDistance){for(var stride=this.stride,i=0;i<stride;++i)closestPoint[i]=flatCoordinates[i];return closestPoint.length=stride,squaredDistance$$1}return minSquaredDistance},Point.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},Point.prototype.computeExtent=function(extent){return createOrUpdateFromCoordinate(this.flatCoordinates,extent)},Point.prototype.getType=function(){return GeometryType.POINT},Point.prototype.intersectsExtent=function(extent){return containsXY(extent,this.flatCoordinates[0],this.flatCoordinates[1])},Point.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,coordinates,this.stride),this.changed()},Point}(SimpleGeometry);function linearRingContainsExtent(flatCoordinates,offset,end,stride,extent){return!forEachCorner(extent,function(coordinate){return!linearRingContainsXY(flatCoordinates,offset,end,stride,coordinate[0],coordinate[1])})}function linearRingContainsXY(flatCoordinates,offset,end,stride,x,y){for(var wn=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];y1<=y?y2>y&&(x2-x1)*(y-y1)-(x-x1)*(y2-y1)>0&&wn++:y2<=y&&(x2-x1)*(y-y1)-(x-x1)*(y2-y1)<0&&wn--,x1=x2,y1=y2}return 0!==wn}function linearRingsContainsXY(flatCoordinates,offset,ends,stride,x,y){if(0===ends.length)return!1;if(!linearRingContainsXY(flatCoordinates,offset,ends[0],stride,x,y))return!1;for(var i=1,ii=ends.length;i<ii;++i)if(linearRingContainsXY(flatCoordinates,ends[i-1],ends[i],stride,x,y))return!1;return!0}function linearRingssContainsXY(flatCoordinates,offset,endss,stride,x,y){if(0===endss.length)return!1;for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];if(linearRingsContainsXY(flatCoordinates,offset,ends,stride,x,y))return!0;offset=ends[ends.length-1]}return!1}function getInteriorPointOfArray(flatCoordinates,offset,ends,stride,flatCenters,flatCentersOffset,opt_dest){for(var i,ii,x,x1,x2,y1,y2,y=flatCenters[flatCentersOffset+1],intersections=[],r=0,rr=ends.length;r<rr;++r){var end=ends[r];for(x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1],i=offset;i<end;i+=stride)x2=flatCoordinates[i],y2=flatCoordinates[i+1],(y<=y1&&y2<=y||y1<=y&&y<=y2)&&(x=(y-y1)/(y2-y1)*(x2-x1)+x1,intersections.push(x)),x1=x2,y1=y2}var pointX=NaN,maxSegmentLength=-1/0;for(intersections.sort(numberSafeCompareFunction),x1=intersections[0],i=1,ii=intersections.length;i<ii;++i){x2=intersections[i];var segmentLength=Math.abs(x2-x1);segmentLength>maxSegmentLength&&linearRingsContainsXY(flatCoordinates,offset,ends,stride,x=(x1+x2)/2,y)&&(pointX=x,maxSegmentLength=segmentLength),x1=x2}return isNaN(pointX)&&(pointX=flatCenters[flatCentersOffset]),opt_dest?(opt_dest.push(pointX,y,maxSegmentLength),opt_dest):[pointX,y,maxSegmentLength]}function getInteriorPointsOfMultiArray(flatCoordinates,offset,endss,stride,flatCenters){for(var interiorPoints=[],i=0,ii=endss.length;i<ii;++i){var ends=endss[i];interiorPoints=getInteriorPointOfArray(flatCoordinates,offset,ends,stride,flatCenters,2*i,interiorPoints),offset=ends[ends.length-1]}return interiorPoints}function forEach(flatCoordinates,offset,end,stride,callback,opt_this){for(var ret,point1=[flatCoordinates[offset],flatCoordinates[offset+1]],point2=[];offset+stride<end;offset+=stride){if(point2[0]=flatCoordinates[offset+stride],point2[1]=flatCoordinates[offset+stride+1],ret=callback.call(opt_this,point1,point2))return ret;point1[0]=point2[0],point1[1]=point2[1]}return!1}function intersectsLineString(flatCoordinates,offset,end,stride,extent){var coordinatesExtent=extendFlatCoordinates(createEmpty(),flatCoordinates,offset,end,stride);return!!intersects(extent,coordinatesExtent)&&(!!containsExtent(extent,coordinatesExtent)||(coordinatesExtent[0]>=extent[0]&&coordinatesExtent[2]<=extent[2]||(coordinatesExtent[1]>=extent[1]&&coordinatesExtent[3]<=extent[3]||forEach(flatCoordinates,offset,end,stride,function(point1,point2){return intersectsSegment(extent,point1,point2)}))))}function intersectsLineStringArray(flatCoordinates,offset,ends,stride,extent){for(var i=0,ii=ends.length;i<ii;++i){if(intersectsLineString(flatCoordinates,offset,ends[i],stride,extent))return!0;offset=ends[i]}return!1}function intersectsLinearRing(flatCoordinates,offset,end,stride,extent){return!!intersectsLineString(flatCoordinates,offset,end,stride,extent)||(!!linearRingContainsXY(flatCoordinates,offset,end,stride,extent[0],extent[1])||(!!linearRingContainsXY(flatCoordinates,offset,end,stride,extent[0],extent[3])||(!!linearRingContainsXY(flatCoordinates,offset,end,stride,extent[2],extent[1])||!!linearRingContainsXY(flatCoordinates,offset,end,stride,extent[2],extent[3]))))}function intersectsLinearRingArray(flatCoordinates,offset,ends,stride,extent){if(!intersectsLinearRing(flatCoordinates,offset,ends[0],stride,extent))return!1;if(1===ends.length)return!0;for(var i=1,ii=ends.length;i<ii;++i)if(linearRingContainsExtent(flatCoordinates,ends[i-1],ends[i],stride,extent)&&!intersectsLineString(flatCoordinates,ends[i-1],ends[i],stride,extent))return!1;return!0}function intersectsLinearRingMultiArray(flatCoordinates,offset,endss,stride,extent){for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];if(intersectsLinearRingArray(flatCoordinates,offset,ends,stride,extent))return!0;offset=ends[ends.length-1]}return!1}function coordinates(flatCoordinates,offset,end,stride){for(;offset<end-stride;){for(var i=0;i<stride;++i){var tmp=flatCoordinates[offset+i];flatCoordinates[offset+i]=flatCoordinates[end-stride+i],flatCoordinates[end-stride+i]=tmp}offset+=stride,end-=stride}}function linearRingIsClockwise(flatCoordinates,offset,end,stride){for(var edge=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];edge+=(x2-x1)*(y2+y1),x1=x2,y1=y2}return edge>0}function linearRingIsOriented(flatCoordinates,offset,ends,stride,opt_right){for(var right=void 0!==opt_right&&opt_right,i=0,ii=ends.length;i<ii;++i){var end=ends[i],isClockwise=linearRingIsClockwise(flatCoordinates,offset,end,stride);if(0===i){if(right&&isClockwise||!right&&!isClockwise)return!1}else if(right&&!isClockwise||!right&&isClockwise)return!1;offset=end}return!0}function linearRingsAreOriented(flatCoordinates,offset,endss,stride,opt_right){for(var i=0,ii=endss.length;i<ii;++i)if(!linearRingIsOriented(flatCoordinates,offset,endss[i],stride,opt_right))return!1;return!0}function orientLinearRings(flatCoordinates,offset,ends,stride,opt_right){for(var right=void 0!==opt_right&&opt_right,i=0,ii=ends.length;i<ii;++i){var end=ends[i],isClockwise=linearRingIsClockwise(flatCoordinates,offset,end,stride);(0===i?right&&isClockwise||!right&&!isClockwise:right&&!isClockwise||!right&&isClockwise)&&coordinates(flatCoordinates,offset,end,stride),offset=end}return offset}function orientLinearRingsArray(flatCoordinates,offset,endss,stride,opt_right){for(var i=0,ii=endss.length;i<ii;++i)offset=orientLinearRings(flatCoordinates,offset,endss[i],stride,opt_right);return offset}var Polygon=function(SimpleGeometry$$1){function Polygon(coordinates,opt_layout,opt_ends){SimpleGeometry$$1.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==opt_layout&&opt_ends?(this.setFlatCoordinates(opt_layout,coordinates),this.ends_=opt_ends):this.setCoordinates(coordinates,opt_layout)}return SimpleGeometry$$1&&(Polygon.__proto__=SimpleGeometry$$1),Polygon.prototype=Object.create(SimpleGeometry$$1&&SimpleGeometry$$1.prototype),Polygon.prototype.constructor=Polygon,Polygon.prototype.appendLinearRing=function(linearRing$$1){this.flatCoordinates?extend(this.flatCoordinates,linearRing$$1.getFlatCoordinates()):this.flatCoordinates=linearRing$$1.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},Polygon.prototype.clone=function(){return new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},Polygon.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},Polygon.prototype.containsXY=function(x,y){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,x,y)},Polygon.prototype.getArea=function(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},Polygon.prototype.getCoordinates=function(opt_right){var flatCoordinates;return void 0!==opt_right?orientLinearRings(flatCoordinates=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,opt_right):flatCoordinates=this.flatCoordinates,inflateCoordinatesArray(flatCoordinates,0,this.ends_,this.stride)},Polygon.prototype.getEnds=function(){return this.ends_},Polygon.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var flatCenter=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,flatCenter,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},Polygon.prototype.getInteriorPoint=function(){return new Point(this.getFlatInteriorPoint(),GeometryLayout.XYM)},Polygon.prototype.getLinearRingCount=function(){return this.ends_.length},Polygon.prototype.getLinearRing=function(index){return index<0||this.ends_.length<=index?null:new LinearRing(this.flatCoordinates.slice(0===index?0:this.ends_[index-1],this.ends_[index]),this.layout)},Polygon.prototype.getLinearRings=function(){for(var layout=this.layout,flatCoordinates=this.flatCoordinates,ends=this.ends_,linearRings$$1=[],offset$$1=0,i=0,ii=ends.length;i<ii;++i){var end=ends[i],linearRing$$1=new LinearRing(flatCoordinates.slice(offset$$1,end),layout);linearRings$$1.push(linearRing$$1),offset$$1=end}return linearRings$$1},Polygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var flatCoordinates=this.flatCoordinates;linearRingIsOriented(flatCoordinates,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=flatCoordinates:(this.orientedFlatCoordinates_=flatCoordinates.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},Polygon.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[],simplifiedEnds=[];return simplifiedFlatCoordinates.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(squaredTolerance),simplifiedFlatCoordinates,0,simplifiedEnds),new Polygon(simplifiedFlatCoordinates,GeometryLayout.XY,simplifiedEnds)},Polygon.prototype.getType=function(){return GeometryType.POLYGON},Polygon.prototype.intersectsExtent=function(extent){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,extent)},Polygon.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,2),this.flatCoordinates||(this.flatCoordinates=[]);var ends=deflateCoordinatesArray(this.flatCoordinates,0,coordinates,this.stride,this.ends_);this.flatCoordinates.length=0===ends.length?0:ends[ends.length-1],this.changed()},Polygon}(SimpleGeometry);function fromExtent(extent){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],flatCoordinates=[minX,minY,minX,maxY,maxX,maxY,maxX,minY,minX,minY];return new Polygon(flatCoordinates,GeometryLayout.XY,[flatCoordinates.length])}function fromCircle(circle,opt_sides,opt_angle){for(var sides=opt_sides||32,stride=circle.getStride(),layout=circle.getLayout(),center=circle.getCenter(),arrayLength=stride*(sides+1),flatCoordinates=new Array(arrayLength),i=0;i<arrayLength;i+=stride){flatCoordinates[i]=0,flatCoordinates[i+1]=0;for(var j=2;j<stride;j++)flatCoordinates[i+j]=center[j]}var ends=[flatCoordinates.length],polygon=new Polygon(flatCoordinates,layout,ends);return makeRegular(polygon,center,circle.getRadius(),opt_angle),polygon}function makeRegular(polygon,center,radius,opt_angle){for(var flatCoordinates=polygon.getFlatCoordinates(),stride=polygon.getStride(),sides=flatCoordinates.length/stride-1,startAngle=opt_angle||0,i=0;i<=sides;++i){var offset$$1=i*stride,angle=startAngle+2*modulo(i,sides)*Math.PI/sides;flatCoordinates[offset$$1]=center[0]+radius*Math.cos(angle),flatCoordinates[offset$$1+1]=center[1]+radius*Math.sin(angle)}polygon.changed()}var DEFAULT_MIN_ZOOM=0,View=function(BaseObject$$1){function View(opt_options){BaseObject$$1.call(this);var options=assign({},opt_options);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=createProjection(options.projection,"EPSG:3857"),this.applyOptions_(options)}return BaseObject$$1&&(View.__proto__=BaseObject$$1),View.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),View.prototype.constructor=View,View.prototype.applyOptions_=function(options){var properties={};properties[ViewProperty.CENTER]=void 0!==options.center?options.center:null;var resolutionConstraintInfo=createResolutionConstraint(options);this.maxResolution_=resolutionConstraintInfo.maxResolution,this.minResolution_=resolutionConstraintInfo.minResolution,this.zoomFactor_=resolutionConstraintInfo.zoomFactor,this.resolutions_=options.resolutions,this.minZoom_=resolutionConstraintInfo.minZoom;var centerConstraint=createCenterConstraint(options),resolutionConstraint=resolutionConstraintInfo.constraint,rotationConstraint=createRotationConstraint(options);this.constraints_={center:centerConstraint,resolution:resolutionConstraint,rotation:rotationConstraint},void 0!==options.resolution?properties[ViewProperty.RESOLUTION]=options.resolution:void 0!==options.zoom&&(properties[ViewProperty.RESOLUTION]=this.constrainResolution(this.maxResolution_,options.zoom-this.minZoom_),this.resolutions_&&(properties[ViewProperty.RESOLUTION]=clamp(Number(this.getResolution()||properties[ViewProperty.RESOLUTION]),this.minResolution_,this.maxResolution_))),properties[ViewProperty.ROTATION]=void 0!==options.rotation?options.rotation:0,this.setProperties(properties),this.options_=options},View.prototype.getUpdatedOptions_=function(newOptions){var options=assign({},this.options_);return void 0!==options.resolution?options.resolution=this.getResolution():options.zoom=this.getZoom(),options.center=this.getCenter(),options.rotation=this.getRotation(),assign({},options,newOptions)},View.prototype.animate=function(var_args){var callback,arguments$1=arguments,animationCount=arguments.length;if(animationCount>1&&"function"==typeof arguments[animationCount-1]&&(callback=arguments[animationCount-1],--animationCount),!this.isDef()){var state=arguments[animationCount-1];return state.center&&this.setCenter(state.center),void 0!==state.zoom&&this.setZoom(state.zoom),void 0!==state.rotation&&this.setRotation(state.rotation),void(callback&&animationCallback(callback,!0))}for(var start=Date.now(),center=this.getCenter().slice(),resolution=this.getResolution(),rotation=this.getRotation(),series=[],i=0;i<animationCount;++i){var options=arguments$1[i],animation={start:start,complete:!1,anchor:options.anchor,duration:void 0!==options.duration?options.duration:1e3,easing:options.easing||inAndOut};if(options.center&&(animation.sourceCenter=center,animation.targetCenter=options.center,center=animation.targetCenter),void 0!==options.zoom?(animation.sourceResolution=resolution,animation.targetResolution=this.constrainResolution(this.maxResolution_,options.zoom-this.minZoom_,0),resolution=animation.targetResolution):options.resolution&&(animation.sourceResolution=resolution,animation.targetResolution=options.resolution,resolution=animation.targetResolution),void 0!==options.rotation){animation.sourceRotation=rotation;var delta=modulo(options.rotation-rotation+Math.PI,2*Math.PI)-Math.PI;animation.targetRotation=rotation+delta,rotation=animation.targetRotation}animation.callback=callback,isNoopAnimation(animation)?animation.complete=!0:start+=animation.duration,series.push(animation)}this.animations_.push(series),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()},View.prototype.getAnimating=function(){return this.hints_[ViewHint.ANIMATING]>0},View.prototype.getInteracting=function(){return this.hints_[ViewHint.INTERACTING]>0},View.prototype.cancelAnimations=function(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);for(var i=0,ii=this.animations_.length;i<ii;++i){var series=this.animations_[i];series[0].callback&&animationCallback(series[0].callback,!1)}this.animations_.length=0},View.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var now=Date.now(),more=!1,i=this.animations_.length-1;i>=0;--i){for(var series=this.animations_[i],seriesComplete=!0,j=0,jj=series.length;j<jj;++j){var animation=series[j];if(!animation.complete){var elapsed=now-animation.start,fraction=animation.duration>0?elapsed/animation.duration:1;fraction>=1?(animation.complete=!0,fraction=1):seriesComplete=!1;var progress=animation.easing(fraction);if(animation.sourceCenter){var x0=animation.sourceCenter[0],y0=animation.sourceCenter[1],x=x0+progress*(animation.targetCenter[0]-x0),y=y0+progress*(animation.targetCenter[1]-y0);this.set(ViewProperty.CENTER,[x,y])}if(animation.sourceResolution&&animation.targetResolution){var resolution=1===progress?animation.targetResolution:animation.sourceResolution+progress*(animation.targetResolution-animation.sourceResolution);animation.anchor&&this.set(ViewProperty.CENTER,this.calculateCenterZoom(resolution,animation.anchor)),this.set(ViewProperty.RESOLUTION,resolution)}if(void 0!==animation.sourceRotation&&void 0!==animation.targetRotation){var rotation=1===progress?modulo(animation.targetRotation+Math.PI,2*Math.PI)-Math.PI:animation.sourceRotation+progress*(animation.targetRotation-animation.sourceRotation);animation.anchor&&this.set(ViewProperty.CENTER,this.calculateCenterRotate(rotation,animation.anchor)),this.set(ViewProperty.ROTATION,rotation)}if(more=!0,!animation.complete)break}}if(seriesComplete){this.animations_[i]=null,this.setHint(ViewHint.ANIMATING,-1);var callback=series[0].callback;callback&&animationCallback(callback,!0)}}this.animations_=this.animations_.filter(Boolean),more&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}},View.prototype.calculateCenterRotate=function(rotation,anchor){var center,currentCenter=this.getCenter();return void 0!==currentCenter&&(rotate(center=[currentCenter[0]-anchor[0],currentCenter[1]-anchor[1]],rotation-this.getRotation()),add(center,anchor)),center},View.prototype.calculateCenterZoom=function(resolution,anchor){var center,currentCenter=this.getCenter(),currentResolution=this.getResolution();void 0!==currentCenter&&void 0!==currentResolution&&(center=[anchor[0]-resolution*(anchor[0]-currentCenter[0])/currentResolution,anchor[1]-resolution*(anchor[1]-currentCenter[1])/currentResolution]);return center},View.prototype.getSizeFromViewport_=function(){var size=[100,100],selector='.ol-viewport[data-view="'+getUid(this)+'"]',element=document.querySelector(selector);if(element){var metrics=getComputedStyle(element);size[0]=parseInt(metrics.width,10),size[1]=parseInt(metrics.height,10)}return size},View.prototype.constrainCenter=function(center){return this.constraints_.center(center)},View.prototype.constrainResolution=function(resolution,opt_delta,opt_direction){var delta=opt_delta||0,direction=opt_direction||0;return this.constraints_.resolution(resolution,delta,direction)},View.prototype.constrainRotation=function(rotation,opt_delta){var delta=opt_delta||0;return this.constraints_.rotation(rotation,delta)},View.prototype.getCenter=function(){return this.get(ViewProperty.CENTER)},View.prototype.getConstraints=function(){return this.constraints_},View.prototype.getHints=function(opt_hints){return void 0!==opt_hints?(opt_hints[0]=this.hints_[0],opt_hints[1]=this.hints_[1],opt_hints):this.hints_.slice()},View.prototype.calculateExtent=function(opt_size){var size=opt_size||this.getSizeFromViewport_(),center=this.getCenter();assert(center,1);var resolution=this.getResolution();assert(void 0!==resolution,2);var rotation=this.getRotation();return assert(void 0!==rotation,3),getForViewAndSize(center,resolution,rotation,size)},View.prototype.getMaxResolution=function(){return this.maxResolution_},View.prototype.getMinResolution=function(){return this.minResolution_},View.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},View.prototype.setMaxZoom=function(zoom){this.applyOptions_(this.getUpdatedOptions_({maxZoom:zoom}))},View.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},View.prototype.setMinZoom=function(zoom){this.applyOptions_(this.getUpdatedOptions_({minZoom:zoom}))},View.prototype.getProjection=function(){return this.projection_},View.prototype.getResolution=function(){return this.get(ViewProperty.RESOLUTION)},View.prototype.getResolutions=function(){return this.resolutions_},View.prototype.getResolutionForExtent=function(extent,opt_size){var size=opt_size||this.getSizeFromViewport_(),xResolution=getWidth(extent)/size[0],yResolution=getHeight(extent)/size[1];return Math.max(xResolution,yResolution)},View.prototype.getResolutionForValueFunction=function(opt_power){var power=opt_power||2,maxResolution=this.maxResolution_,minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(value){return maxResolution/Math.pow(power,value*max)}},View.prototype.getRotation=function(){return this.get(ViewProperty.ROTATION)},View.prototype.getValueForResolutionFunction=function(opt_power){var power=opt_power||2,maxResolution=this.maxResolution_,minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(resolution){return Math.log(maxResolution/resolution)/Math.log(power)/max}},View.prototype.getState=function(pixelRatio){var center=this.getCenter(),projection=this.getProjection(),resolution=this.getResolution(),pixelResolution=resolution/pixelRatio,rotation=this.getRotation();return{center:[Math.round(center[0]/pixelResolution)*pixelResolution,Math.round(center[1]/pixelResolution)*pixelResolution],projection:void 0!==projection?projection:null,resolution:resolution,rotation:rotation,zoom:this.getZoom()}},View.prototype.getZoom=function(){var zoom,resolution=this.getResolution();return void 0!==resolution&&(zoom=this.getZoomForResolution(resolution)),zoom},View.prototype.getZoomForResolution=function(resolution){var max,zoomFactor,offset=this.minZoom_||0;if(this.resolutions_){var nearest=linearFindNearest(this.resolutions_,resolution,1);offset=nearest,max=this.resolutions_[nearest],zoomFactor=nearest==this.resolutions_.length-1?2:max/this.resolutions_[nearest+1]}else max=this.maxResolution_,zoomFactor=this.zoomFactor_;return offset+Math.log(max/resolution)/Math.log(zoomFactor)},View.prototype.getResolutionForZoom=function(zoom){return this.constrainResolution(this.maxResolution_,zoom-this.minZoom_,0)},View.prototype.fit=function(geometryOrExtent,opt_options){var geometry,options=opt_options||{},size=options.size;size||(size=this.getSizeFromViewport_()),assert(Array.isArray(geometryOrExtent)||"function"==typeof geometryOrExtent.getSimplifiedGeometry,24),Array.isArray(geometryOrExtent)?(assert(!isEmpty$1(geometryOrExtent),25),geometry=fromExtent(geometryOrExtent)):geometryOrExtent.getType()===GeometryType.CIRCLE?(geometry=fromExtent(geometryOrExtent=geometryOrExtent.getExtent())).rotate(this.getRotation(),getCenter(geometryOrExtent)):geometry=geometryOrExtent;var minResolution,padding=void 0!==options.padding?options.padding:[0,0,0,0],constrainResolution=void 0===options.constrainResolution||options.constrainResolution,nearest=void 0!==options.nearest&&options.nearest;minResolution=void 0!==options.minResolution?options.minResolution:void 0!==options.maxZoom?this.constrainResolution(this.maxResolution_,options.maxZoom-this.minZoom_,0):0;for(var coords=geometry.getFlatCoordinates(),rotation=this.getRotation(),cosAngle=Math.cos(-rotation),sinAngle=Math.sin(-rotation),minRotX=1/0,minRotY=1/0,maxRotX=-1/0,maxRotY=-1/0,stride=geometry.getStride(),i=0,ii=coords.length;i<ii;i+=stride){var rotX=coords[i]*cosAngle-coords[i+1]*sinAngle,rotY=coords[i]*sinAngle+coords[i+1]*cosAngle;minRotX=Math.min(minRotX,rotX),minRotY=Math.min(minRotY,rotY),maxRotX=Math.max(maxRotX,rotX),maxRotY=Math.max(maxRotY,rotY)}var resolution=this.getResolutionForExtent([minRotX,minRotY,maxRotX,maxRotY],[size[0]-padding[1]-padding[3],size[1]-padding[0]-padding[2]]);if(resolution=isNaN(resolution)?minResolution:Math.max(resolution,minResolution),constrainResolution){var constrainedResolution=this.constrainResolution(resolution,0,0);!nearest&&constrainedResolution<resolution&&(constrainedResolution=this.constrainResolution(constrainedResolution,-1,0)),resolution=constrainedResolution}sinAngle=-sinAngle;var centerRotX=(minRotX+maxRotX)/2,centerRotY=(minRotY+maxRotY)/2,center=[(centerRotX+=(padding[1]-padding[3])/2*resolution)*cosAngle-(centerRotY+=(padding[0]-padding[2])/2*resolution)*sinAngle,centerRotY*cosAngle+centerRotX*sinAngle],callback=options.callback?options.callback:VOID;void 0!==options.duration?this.animate({resolution:resolution,center:center,duration:options.duration,easing:options.easing},callback):(this.setResolution(resolution),this.setCenter(center),animationCallback(callback,!0))},View.prototype.centerOn=function(coordinate,size,position){var rotation=this.getRotation(),cosAngle=Math.cos(-rotation),sinAngle=Math.sin(-rotation),rotX=coordinate[0]*cosAngle-coordinate[1]*sinAngle,rotY=coordinate[1]*cosAngle+coordinate[0]*sinAngle,resolution=this.getResolution(),centerX=(rotX+=(size[0]/2-position[0])*resolution)*cosAngle-(rotY+=(position[1]-size[1]/2)*resolution)*(sinAngle=-sinAngle),centerY=rotY*cosAngle+rotX*sinAngle;this.setCenter([centerX,centerY])},View.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()},View.prototype.rotate=function(rotation,opt_anchor){if(void 0!==opt_anchor){var center=this.calculateCenterRotate(rotation,opt_anchor);this.setCenter(center)}this.setRotation(rotation)},View.prototype.setCenter=function(center){this.set(ViewProperty.CENTER,center),this.getAnimating()&&this.cancelAnimations()},View.prototype.setHint=function(hint,delta){return this.hints_[hint]+=delta,this.changed(),this.hints_[hint]},View.prototype.setResolution=function(resolution){this.set(ViewProperty.RESOLUTION,resolution),this.getAnimating()&&this.cancelAnimations()},View.prototype.setRotation=function(rotation){this.set(ViewProperty.ROTATION,rotation),this.getAnimating()&&this.cancelAnimations()},View.prototype.setZoom=function(zoom){this.setResolution(this.getResolutionForZoom(zoom))},View}(BaseObject);function animationCallback(callback,returnValue){setTimeout(function(){callback(returnValue)},0)}function createCenterConstraint(options){return void 0!==options.extent?createExtent(options.extent):none}function createResolutionConstraint(options){var resolutionConstraint,maxResolution,minResolution,minZoom=void 0!==options.minZoom?options.minZoom:DEFAULT_MIN_ZOOM,maxZoom=void 0!==options.maxZoom?options.maxZoom:28,zoomFactor=void 0!==options.zoomFactor?options.zoomFactor:2;if(void 0!==options.resolutions){var resolutions=options.resolutions;maxResolution=resolutions[minZoom],minResolution=void 0!==resolutions[maxZoom]?resolutions[maxZoom]:resolutions[resolutions.length-1],resolutionConstraint=createSnapToResolutions(resolutions)}else{var projection=createProjection(options.projection,"EPSG:3857"),extent=projection.getExtent(),defaultMaxResolution=(extent?Math.max(getWidth(extent),getHeight(extent)):360*METERS_PER_UNIT[Units.DEGREES]/projection.getMetersPerUnit())/DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),defaultMinResolution=defaultMaxResolution/Math.pow(2,28-DEFAULT_MIN_ZOOM);void 0!==(maxResolution=options.maxResolution)?minZoom=0:maxResolution=defaultMaxResolution/Math.pow(zoomFactor,minZoom),void 0===(minResolution=options.minResolution)&&(minResolution=void 0!==options.maxZoom?void 0!==options.maxResolution?maxResolution/Math.pow(zoomFactor,maxZoom):defaultMaxResolution/Math.pow(zoomFactor,maxZoom):defaultMinResolution),maxZoom=minZoom+Math.floor(Math.log(maxResolution/minResolution)/Math.log(zoomFactor)),minResolution=maxResolution/Math.pow(zoomFactor,maxZoom-minZoom),resolutionConstraint=createSnapToPower(zoomFactor,maxResolution,maxZoom-minZoom)}return{constraint:resolutionConstraint,maxResolution:maxResolution,minResolution:minResolution,minZoom:minZoom,zoomFactor:zoomFactor}}function createRotationConstraint(options){if(void 0===options.enableRotation||options.enableRotation){var constrainRotation=options.constrainRotation;return void 0===constrainRotation||!0===constrainRotation?createSnapToZero():!1===constrainRotation?none$1:"number"==typeof constrainRotation?createSnapToN(constrainRotation):none$1}return disable}function isNoopAnimation(animation){return!(animation.sourceCenter&&animation.targetCenter&&!equals$1(animation.sourceCenter,animation.targetCenter))&&(animation.sourceResolution===animation.targetResolution&&animation.sourceRotation===animation.targetRotation)}function createCanvasContext2D(opt_width,opt_height){var canvas=document.createElement("canvas");return opt_width&&(canvas.width=opt_width),opt_height&&(canvas.height=opt_height),canvas.getContext("2d")}function replaceNode(newNode,oldNode){var parent=oldNode.parentNode;parent&&parent.replaceChild(newNode,oldNode)}function removeNode(node){return node&&node.parentNode?node.parentNode.removeChild(node):null}function removeChildren(node){for(;node.lastChild;)node.removeChild(node.lastChild)}var LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"},BaseLayer=function(BaseObject$$1){function BaseLayer(options){BaseObject$$1.call(this);var properties=assign({},options);properties[LayerProperty.OPACITY]=void 0!==options.opacity?options.opacity:1,properties[LayerProperty.VISIBLE]=void 0===options.visible||options.visible,properties[LayerProperty.Z_INDEX]=options.zIndex,properties[LayerProperty.MAX_RESOLUTION]=void 0!==options.maxResolution?options.maxResolution:1/0,properties[LayerProperty.MIN_RESOLUTION]=void 0!==options.minResolution?options.minResolution:0,this.setProperties(properties),this.state_=null,this.type}return BaseObject$$1&&(BaseLayer.__proto__=BaseObject$$1),BaseLayer.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),BaseLayer.prototype.constructor=BaseLayer,BaseLayer.prototype.getType=function(){return this.type},BaseLayer.prototype.getLayerState=function(){var state=this.state_||{layer:this,managed:!0};return state.opacity=clamp(this.getOpacity(),0,1),state.sourceState=this.getSourceState(),state.visible=this.getVisible(),state.extent=this.getExtent(),state.zIndex=this.getZIndex()||0,state.maxResolution=this.getMaxResolution(),state.minResolution=Math.max(this.getMinResolution(),0),this.state_=state,state},BaseLayer.prototype.getLayersArray=function(opt_array){return abstract()},BaseLayer.prototype.getLayerStatesArray=function(opt_states){return abstract()},BaseLayer.prototype.getExtent=function(){return this.get(LayerProperty.EXTENT)},BaseLayer.prototype.getMaxResolution=function(){return this.get(LayerProperty.MAX_RESOLUTION)},BaseLayer.prototype.getMinResolution=function(){return this.get(LayerProperty.MIN_RESOLUTION)},BaseLayer.prototype.getOpacity=function(){return this.get(LayerProperty.OPACITY)},BaseLayer.prototype.getSourceState=function(){return abstract()},BaseLayer.prototype.getVisible=function(){return this.get(LayerProperty.VISIBLE)},BaseLayer.prototype.getZIndex=function(){return this.get(LayerProperty.Z_INDEX)},BaseLayer.prototype.setExtent=function(extent){this.set(LayerProperty.EXTENT,extent)},BaseLayer.prototype.setMaxResolution=function(maxResolution){this.set(LayerProperty.MAX_RESOLUTION,maxResolution)},BaseLayer.prototype.setMinResolution=function(minResolution){this.set(LayerProperty.MIN_RESOLUTION,minResolution)},BaseLayer.prototype.setOpacity=function(opacity){this.set(LayerProperty.OPACITY,opacity)},BaseLayer.prototype.setVisible=function(visible){this.set(LayerProperty.VISIBLE,visible)},BaseLayer.prototype.setZIndex=function(zindex){this.set(LayerProperty.Z_INDEX,zindex)},BaseLayer}(BaseObject),SourceState={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},Property$1={LAYERS:"layers"},LayerGroup=function(BaseLayer$$1){function LayerGroup(opt_options){var options=opt_options||{},baseOptions=assign({},options);delete baseOptions.layers;var layers=options.layers;BaseLayer$$1.call(this,baseOptions),this.layersListenerKeys_=[],this.listenerKeys_={},listen(this,getChangeEventType(Property$1.LAYERS),this.handleLayersChanged_,this),layers?Array.isArray(layers)?layers=new Collection(layers.slice(),{unique:!0}):assert("function"==typeof layers.getArray,43):layers=new Collection(void 0,{unique:!0}),this.setLayers(layers)}return BaseLayer$$1&&(LayerGroup.__proto__=BaseLayer$$1),LayerGroup.prototype=Object.create(BaseLayer$$1&&BaseLayer$$1.prototype),LayerGroup.prototype.constructor=LayerGroup,LayerGroup.prototype.handleLayerChange_=function(){this.changed()},LayerGroup.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;var layers=this.getLayers();for(var id in this.layersListenerKeys_.push(listen(layers,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(layers,CollectionEventType.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[id].forEach(unlistenByKey);clear(this.listenerKeys_);for(var layersArray=layers.getArray(),i=0,ii=layersArray.length;i<ii;i++){var layer=layersArray[i];this.listenerKeys_[getUid(layer)]=[listen(layer,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(layer,EventType.CHANGE,this.handleLayerChange_,this)]}this.changed()},LayerGroup.prototype.handleLayersAdd_=function(collectionEvent){var layer=collectionEvent.element;this.listenerKeys_[getUid(layer)]=[listen(layer,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(layer,EventType.CHANGE,this.handleLayerChange_,this)],this.changed()},LayerGroup.prototype.handleLayersRemove_=function(collectionEvent){var key=getUid(collectionEvent.element);this.listenerKeys_[key].forEach(unlistenByKey),delete this.listenerKeys_[key],this.changed()},LayerGroup.prototype.getLayers=function(){return this.get(Property$1.LAYERS)},LayerGroup.prototype.setLayers=function(layers){this.set(Property$1.LAYERS,layers)},LayerGroup.prototype.getLayersArray=function(opt_array){var array=void 0!==opt_array?opt_array:[];return this.getLayers().forEach(function(layer){layer.getLayersArray(array)}),array},LayerGroup.prototype.getLayerStatesArray=function(opt_states){var states=void 0!==opt_states?opt_states:[],pos=states.length;this.getLayers().forEach(function(layer){layer.getLayerStatesArray(states)});for(var ownLayerState=this.getLayerState(),i=pos,ii=states.length;i<ii;i++){var layerState=states[i];layerState.opacity*=ownLayerState.opacity,layerState.visible=layerState.visible&&ownLayerState.visible,layerState.maxResolution=Math.min(layerState.maxResolution,ownLayerState.maxResolution),layerState.minResolution=Math.max(layerState.minResolution,ownLayerState.minResolution),void 0!==ownLayerState.extent&&(void 0!==layerState.extent?layerState.extent=getIntersection(layerState.extent,ownLayerState.extent):layerState.extent=ownLayerState.extent)}return states},LayerGroup.prototype.getSourceState=function(){return SourceState.READY},LayerGroup}(BaseLayer);function hasArea(size){return size[0]>0&&size[1]>0}var PluggableMap=function(BaseObject$$1){function PluggableMap(options){BaseObject$$1.call(this);var optionsInternal=createOptionsInternal(options);this.maxTilesLoading_=void 0!==options.maxTilesLoading?options.maxTilesLoading:16,this.loadTilesWhileAnimating_=void 0!==options.loadTilesWhileAnimating&&options.loadTilesWhileAnimating,this.loadTilesWhileInteracting_=void 0!==options.loadTilesWhileInteracting&&options.loadTilesWhileInteracting,this.pixelRatio_=void 0!==options.pixelRatio?options.pixelRatio:DEVICE_PIXEL_RATIO,this.animationDelayKey_,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}.bind(this),this.coordinateToPixelTransform_=create(),this.pixelToCoordinateTransform_=create(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+(TOUCH?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var overlayEvents=[EventType.CLICK,EventType.DBLCLICK,EventType.MOUSEDOWN,EventType.TOUCHSTART,EventType.MSPOINTERDOWN,MapBrowserEventType.POINTERDOWN,EventType.MOUSEWHEEL,EventType.WHEEL],i=0,ii=overlayEvents.length;i<ii;++i)listen(this.overlayContainerStopEvent_,overlayEvents[i],stopPropagation);for(var key in this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new MapBrowserEventHandler(this,options.moveTolerance),MapBrowserEventType)listen(this.mapBrowserEventHandler_,MapBrowserEventType[key],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=optionsInternal.keyboardEventTarget,this.keyHandlerKeys_=null,listen(this.viewport_,EventType.CONTEXTMENU,this.handleBrowserEvent,this),listen(this.viewport_,EventType.WHEEL,this.handleBrowserEvent,this),listen(this.viewport_,EventType.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=optionsInternal.controls||new Collection,this.interactions=optionsInternal.interactions||new Collection,this.overlays_=optionsInternal.overlays,this.overlayIdIndex_={},this.renderer_=this.createRenderer(),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},listen(this,getChangeEventType(MapProperty.LAYERGROUP),this.handleLayerGroupChanged_,this),listen(this,getChangeEventType(MapProperty.VIEW),this.handleViewChanged_,this),listen(this,getChangeEventType(MapProperty.SIZE),this.handleSizeChanged_,this),listen(this,getChangeEventType(MapProperty.TARGET),this.handleTargetChanged_,this),this.setProperties(optionsInternal.values),this.controls.forEach(function(control){control.setMap(this)}.bind(this)),listen(this.controls,CollectionEventType.ADD,function(event){event.element.setMap(this)},this),listen(this.controls,CollectionEventType.REMOVE,function(event){event.element.setMap(null)},this),this.interactions.forEach(function(interaction){interaction.setMap(this)}.bind(this)),listen(this.interactions,CollectionEventType.ADD,function(event){event.element.setMap(this)},this),listen(this.interactions,CollectionEventType.REMOVE,function(event){event.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_.bind(this)),listen(this.overlays_,CollectionEventType.ADD,function(event){this.addOverlayInternal_(event.element)},this),listen(this.overlays_,CollectionEventType.REMOVE,function(event){var id=event.element.getId();void 0!==id&&delete this.overlayIdIndex_[id.toString()],event.element.setMap(null)},this)}return BaseObject$$1&&(PluggableMap.__proto__=BaseObject$$1),PluggableMap.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),PluggableMap.prototype.constructor=PluggableMap,PluggableMap.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},PluggableMap.prototype.addControl=function(control){this.getControls().push(control)},PluggableMap.prototype.addInteraction=function(interaction){this.getInteractions().push(interaction)},PluggableMap.prototype.addLayer=function(layer){this.getLayerGroup().getLayers().push(layer)},PluggableMap.prototype.addOverlay=function(overlay){this.getOverlays().push(overlay)},PluggableMap.prototype.addOverlayInternal_=function(overlay){var id=overlay.getId();void 0!==id&&(this.overlayIdIndex_[id.toString()]=overlay),overlay.setMap(this)},PluggableMap.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),unlisten(this.viewport_,EventType.CONTEXTMENU,this.handleBrowserEvent,this),unlisten(this.viewport_,EventType.WHEEL,this.handleBrowserEvent,this),unlisten(this.viewport_,EventType.MOUSEWHEEL,this.handleBrowserEvent,this),void 0!==this.handleResize_&&(removeEventListener(EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),BaseObject$$1.prototype.disposeInternal.call(this)},PluggableMap.prototype.forEachFeatureAtPixel=function(pixel,callback,opt_options){if(this.frameState_){var coordinate=this.getCoordinateFromPixel(pixel),hitTolerance=void 0!==(opt_options=void 0!==opt_options?opt_options:{}).hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0,layerFilter=void 0!==opt_options.layerFilter?opt_options.layerFilter:TRUE;return this.renderer_.forEachFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,callback,null,layerFilter,null)}},PluggableMap.prototype.getFeaturesAtPixel=function(pixel,opt_options){var features=null;return this.forEachFeatureAtPixel(pixel,function(feature){features||(features=[]),features.push(feature)},opt_options),features},PluggableMap.prototype.forEachLayerAtPixel=function(pixel,callback,opt_options){if(this.frameState_){var options=opt_options||{},hitTolerance=void 0!==options.hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0,layerFilter=options.layerFilter||TRUE;return this.renderer_.forEachLayerAtPixel(pixel,this.frameState_,hitTolerance,callback,null,layerFilter,null)}},PluggableMap.prototype.hasFeatureAtPixel=function(pixel,opt_options){if(!this.frameState_)return!1;var coordinate=this.getCoordinateFromPixel(pixel),layerFilter=void 0!==(opt_options=void 0!==opt_options?opt_options:{}).layerFilter?opt_options.layerFilter:TRUE,hitTolerance=void 0!==opt_options.hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,layerFilter,null)},PluggableMap.prototype.getEventCoordinate=function(event){return this.getCoordinateFromPixel(this.getEventPixel(event))},PluggableMap.prototype.getEventPixel=function(event){var viewportPosition=this.viewport_.getBoundingClientRect(),eventPosition="changedTouches"in event?event.changedTouches[0]:event;return[eventPosition.clientX-viewportPosition.left,eventPosition.clientY-viewportPosition.top]},PluggableMap.prototype.getTarget=function(){return this.get(MapProperty.TARGET)},PluggableMap.prototype.getTargetElement=function(){var target=this.getTarget();return void 0!==target?"string"==typeof target?document.getElementById(target):target:null},PluggableMap.prototype.getCoordinateFromPixel=function(pixel){var frameState=this.frameState_;return frameState?apply(frameState.pixelToCoordinateTransform,pixel.slice()):null},PluggableMap.prototype.getControls=function(){return this.controls},PluggableMap.prototype.getOverlays=function(){return this.overlays_},PluggableMap.prototype.getOverlayById=function(id){var overlay=this.overlayIdIndex_[id.toString()];return void 0!==overlay?overlay:null},PluggableMap.prototype.getInteractions=function(){return this.interactions},PluggableMap.prototype.getLayerGroup=function(){return this.get(MapProperty.LAYERGROUP)},PluggableMap.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},PluggableMap.prototype.getPixelFromCoordinate=function(coordinate){var frameState=this.frameState_;return frameState?apply(frameState.coordinateToPixelTransform,coordinate.slice(0,2)):null},PluggableMap.prototype.getRenderer=function(){return this.renderer_},PluggableMap.prototype.getSize=function(){return this.get(MapProperty.SIZE)},PluggableMap.prototype.getView=function(){return this.get(MapProperty.VIEW)},PluggableMap.prototype.getViewport=function(){return this.viewport_},PluggableMap.prototype.getOverlayContainer=function(){return this.overlayContainer_},PluggableMap.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},PluggableMap.prototype.getTilePriority=function(tile,tileSourceKey,tileCenter,tileResolution){var frameState=this.frameState_;if(!(frameState&&tileSourceKey in frameState.wantedTiles))return DROP;if(!frameState.wantedTiles[tileSourceKey][tile.getKey()])return DROP;var deltaX=tileCenter[0]-frameState.focus[0],deltaY=tileCenter[1]-frameState.focus[1];return 65536*Math.log(tileResolution)+Math.sqrt(deltaX*deltaX+deltaY*deltaY)/tileResolution},PluggableMap.prototype.handleBrowserEvent=function(browserEvent,opt_type){var type=opt_type||browserEvent.type,mapBrowserEvent=new MapBrowserEvent(type,this,browserEvent);this.handleMapBrowserEvent(mapBrowserEvent)},PluggableMap.prototype.handleMapBrowserEvent=function(mapBrowserEvent){if(this.frameState_){this.focus_=mapBrowserEvent.coordinate,mapBrowserEvent.frameState=this.frameState_;var interactionsArray=this.getInteractions().getArray();if(!1!==this.dispatchEvent(mapBrowserEvent))for(var i=interactionsArray.length-1;i>=0;i--){var interaction=interactionsArray[i];if(interaction.getActive())if(!interaction.handleEvent(mapBrowserEvent))break}}},PluggableMap.prototype.handlePostRender=function(){var frameState=this.frameState_,tileQueue=this.tileQueue_;if(!tileQueue.isEmpty()){var maxTotalLoading=this.maxTilesLoading_,maxNewLoads=maxTotalLoading;if(frameState){var hints=frameState.viewHints;hints[ViewHint.ANIMATING]&&(maxTotalLoading=this.loadTilesWhileAnimating_?8:0,maxNewLoads=2),hints[ViewHint.INTERACTING]&&(maxTotalLoading=this.loadTilesWhileInteracting_?8:0,maxNewLoads=2)}tileQueue.getTilesLoading()<maxTotalLoading&&(tileQueue.reprioritize(),tileQueue.loadMoreTiles(maxTotalLoading,maxNewLoads))}!frameState||!this.hasListener(RenderEventType.RENDERCOMPLETE)||frameState.animate||this.tileQueue_.getTilesLoading()||getLoading(this.getLayers().getArray())||this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,frameState);for(var postRenderFunctions=this.postRenderFunctions_,i=0,ii=postRenderFunctions.length;i<ii;++i)postRenderFunctions[i](this,frameState);postRenderFunctions.length=0},PluggableMap.prototype.handleSizeChanged_=function(){this.render()},PluggableMap.prototype.handleTargetChanged_=function(){var targetElement;if(this.getTarget()&&(targetElement=this.getTargetElement()),this.keyHandlerKeys_){for(var i=0,ii=this.keyHandlerKeys_.length;i<ii;++i)unlistenByKey(this.keyHandlerKeys_[i]);this.keyHandlerKeys_=null}if(targetElement){targetElement.appendChild(this.viewport_);var keyboardEventTarget=this.keyboardEventTarget_?this.keyboardEventTarget_:targetElement;this.keyHandlerKeys_=[listen(keyboardEventTarget,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(keyboardEventTarget,EventType.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(EventType.RESIZE,this.handleResize_,!1))}else this.renderer_.removeLayerRenderers(),removeNode(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.updateSize()},PluggableMap.prototype.handleTileChange_=function(){this.render()},PluggableMap.prototype.handleViewPropertyChanged_=function(){this.render()},PluggableMap.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var view=this.getView();view&&(this.viewport_.setAttribute("data-view",getUid(view)),this.viewPropertyListenerKey_=listen(view,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(view,EventType.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},PluggableMap.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);var layerGroup=this.getLayerGroup();layerGroup&&(this.layerGroupPropertyListenerKeys_=[listen(layerGroup,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(layerGroup,EventType.CHANGE,this.render,this)]),this.render()},PluggableMap.prototype.isRendered=function(){return!!this.frameState_},PluggableMap.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},PluggableMap.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},PluggableMap.prototype.removeControl=function(control){return this.getControls().remove(control)},PluggableMap.prototype.removeInteraction=function(interaction){return this.getInteractions().remove(interaction)},PluggableMap.prototype.removeLayer=function(layer){return this.getLayerGroup().getLayers().remove(layer)},PluggableMap.prototype.removeOverlay=function(overlay){return this.getOverlays().remove(overlay)},PluggableMap.prototype.renderFrame_=function(time){var viewState,size=this.getSize(),view=this.getView(),extent=createEmpty(),previousFrameState=this.frameState_,frameState=null;if(void 0!==size&&hasArea(size)&&view&&view.isDef()){for(var viewHints=view.getHints(this.frameState_?this.frameState_.viewHints:void 0),layerStatesArray=this.getLayerGroup().getLayerStatesArray(),layerStates={},i=0,ii=layerStatesArray.length;i<ii;++i)layerStates[getUid(layerStatesArray[i].layer)]=layerStatesArray[i];viewState=view.getState(this.pixelRatio_),frameState={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:extent,focus:this.focus_?this.focus_:viewState.center,index:this.frameIndex_++,layerStates:layerStates,layerStatesArray:layerStatesArray,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:size,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:time,usedTiles:{},viewState:viewState,viewHints:viewHints,wantedTiles:{}}}if(frameState&&(frameState.extent=getForViewAndSize(viewState.center,viewState.resolution,viewState.rotation,frameState.size,extent)),this.frameState_=frameState,this.renderer_.renderFrame(frameState),frameState){if(frameState.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,frameState.postRenderFunctions),previousFrameState)(!this.previousExtent_||!isEmpty$1(this.previousExtent_)&&!equals$2(frameState.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent(MapEventType.MOVESTART,this,previousFrameState)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_));this.previousExtent_&&!frameState.viewHints[ViewHint.ANIMATING]&&!frameState.viewHints[ViewHint.INTERACTING]&&!equals$2(frameState.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent(MapEventType.MOVEEND,this,frameState)),clone(frameState.extent,this.previousExtent_))}this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER,this,frameState)),setTimeout(this.handlePostRender.bind(this),0)},PluggableMap.prototype.setLayerGroup=function(layerGroup){this.set(MapProperty.LAYERGROUP,layerGroup)},PluggableMap.prototype.setSize=function(size){this.set(MapProperty.SIZE,size)},PluggableMap.prototype.setTarget=function(target){this.set(MapProperty.TARGET,target)},PluggableMap.prototype.setView=function(view){this.set(MapProperty.VIEW,view)},PluggableMap.prototype.skipFeature=function(feature){this.skippedFeatureUids_[getUid(feature)]=!0,this.render()},PluggableMap.prototype.updateSize=function(){var targetElement=this.getTargetElement();if(targetElement){var computedStyle=getComputedStyle(targetElement);this.setSize([targetElement.offsetWidth-parseFloat(computedStyle.borderLeftWidth)-parseFloat(computedStyle.paddingLeft)-parseFloat(computedStyle.paddingRight)-parseFloat(computedStyle.borderRightWidth),targetElement.offsetHeight-parseFloat(computedStyle.borderTopWidth)-parseFloat(computedStyle.paddingTop)-parseFloat(computedStyle.paddingBottom)-parseFloat(computedStyle.borderBottomWidth)])}else this.setSize(void 0)},PluggableMap.prototype.unskipFeature=function(feature){delete this.skippedFeatureUids_[getUid(feature)],this.render()},PluggableMap}(BaseObject);function createOptionsInternal(options){var keyboardEventTarget=null;void 0!==options.keyboardEventTarget&&(keyboardEventTarget="string"==typeof options.keyboardEventTarget?document.getElementById(options.keyboardEventTarget):options.keyboardEventTarget);var controls,interactions,overlays,values={},layerGroup=options.layers&&"function"==typeof options.layers.getLayers?options.layers:new LayerGroup({layers:options.layers});return values[MapProperty.LAYERGROUP]=layerGroup,values[MapProperty.TARGET]=options.target,values[MapProperty.VIEW]=void 0!==options.view?options.view:new View,void 0!==options.controls&&(Array.isArray(options.controls)?controls=new Collection(options.controls.slice()):(assert("function"==typeof options.controls.getArray,47),controls=options.controls)),void 0!==options.interactions&&(Array.isArray(options.interactions)?interactions=new Collection(options.interactions.slice()):(assert("function"==typeof options.interactions.getArray,48),interactions=options.interactions)),void 0!==options.overlays?Array.isArray(options.overlays)?overlays=new Collection(options.overlays.slice()):(assert("function"==typeof options.overlays.getArray,49),overlays=options.overlays):overlays=new Collection,{controls:controls,interactions:interactions,keyboardEventTarget:keyboardEventTarget,overlays:overlays,values:values}}function getLoading(layers){for(var i=0,ii=layers.length;i<ii;++i){var layer=layers[i];if("function"==typeof layer.getLayers)return getLoading(layer.getLayers().getArray());var source=layer.getSource();if(source&&source.loading)return!0}return!1}var Control=function(BaseObject$$1){function Control(options){BaseObject$$1.call(this),this.element=options.element?options.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=options.render?options.render:VOID,options.target&&this.setTarget(options.target)}return BaseObject$$1&&(Control.__proto__=BaseObject$$1),Control.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),Control.prototype.constructor=Control,Control.prototype.disposeInternal=function(){removeNode(this.element),BaseObject$$1.prototype.disposeInternal.call(this)},Control.prototype.getMap=function(){return this.map_},Control.prototype.setMap=function(map){this.map_&&removeNode(this.element);for(var i=0,ii=this.listenerKeys.length;i<ii;++i)unlistenByKey(this.listenerKeys[i]);(this.listenerKeys.length=0,this.map_=map,this.map_)&&((this.target_?this.target_:map.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(map,MapEventType.POSTRENDER,this.render,this)),map.render())},Control.prototype.setTarget=function(target){this.target_="string"==typeof target?document.getElementById(target):target},Control}(BaseObject),CLASS_HIDDEN="ol-hidden",CLASS_UNSELECTABLE="ol-unselectable",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",getFontFamilies=function(){var style,cache={};return function(font){if(style||(style=document.createElement("div").style),!(font in cache)){style.font=font;var family=style.fontFamily;if(style.font="",!family)return null;cache[font]=family.split(/,\s?/)}return cache[font]}}(),Layer=function(BaseLayer$$1){function Layer(options){var baseOptions=assign({},options);delete baseOptions.source,BaseLayer$$1.call(this,baseOptions),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,options.map&&this.setMap(options.map),listen(this,getChangeEventType(LayerProperty.SOURCE),this.handleSourcePropertyChange_,this);var source=options.source?options.source:null;this.setSource(source)}return BaseLayer$$1&&(Layer.__proto__=BaseLayer$$1),Layer.prototype=Object.create(BaseLayer$$1&&BaseLayer$$1.prototype),Layer.prototype.constructor=Layer,Layer.prototype.getLayersArray=function(opt_array){var array=opt_array||[];return array.push(this),array},Layer.prototype.getLayerStatesArray=function(opt_states){var states=opt_states||[];return states.push(this.getLayerState()),states},Layer.prototype.getSource=function(){return this.get(LayerProperty.SOURCE)||null},Layer.prototype.getSourceState=function(){var source=this.getSource();return source?source.getState():SourceState.UNDEFINED},Layer.prototype.handleSourceChange_=function(){this.changed()},Layer.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null);var source=this.getSource();source&&(this.sourceChangeKey_=listen(source,EventType.CHANGE,this.handleSourceChange_,this)),this.changed()},Layer.prototype.setMap=function(map){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),map||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),map&&(this.mapPrecomposeKey_=listen(map,RenderEventType.PRECOMPOSE,function(evt){var renderEvent=evt,layerState=this.getLayerState();layerState.managed=!1,void 0===this.getZIndex()&&(layerState.zIndex=1/0),renderEvent.frameState.layerStatesArray.push(layerState),renderEvent.frameState.layerStates[getUid(this)]=layerState},this),this.mapRenderKey_=listen(this,EventType.CHANGE,map.render,map),this.changed())},Layer.prototype.setSource=function(source){this.set(LayerProperty.SOURCE,source)},Layer}(BaseLayer);function visibleAtResolution(layerState,resolution){return layerState.visible&&resolution>=layerState.minResolution&&resolution<layerState.maxResolution}var Attribution=function(Control$$1){function Attribution(opt_options){var options=opt_options||{};Control$$1.call(this,{element:document.createElement("div"),render:options.render||render,target:options.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===options.collapsed||options.collapsed,this.overrideCollapsible_=void 0!==options.collapsible,this.collapsible_=void 0===options.collapsible||options.collapsible,this.collapsible_||(this.collapsed_=!1);var className=void 0!==options.className?options.className:"ol-attribution",tipLabel=void 0!==options.tipLabel?options.tipLabel:"Attributions",collapseLabel=void 0!==options.collapseLabel?options.collapseLabel:"";"string"==typeof collapseLabel?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=collapseLabel):this.collapseLabel_=collapseLabel;var label=void 0!==options.label?options.label:"i";"string"==typeof label?(this.label_=document.createElement("span"),this.label_.textContent=label):this.label_=label;var activeLabel=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,button=document.createElement("button");button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(activeLabel),listen(button,EventType.CLICK,this.handleClick_,this);var cssClasses=className+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),element=this.element;element.className=cssClasses,element.appendChild(this.ulElement_),element.appendChild(button),this.renderedAttributions_=[],this.renderedVisible_=!0}return Control$$1&&(Attribution.__proto__=Control$$1),Attribution.prototype=Object.create(Control$$1&&Control$$1.prototype),Attribution.prototype.constructor=Attribution,Attribution.prototype.collectSourceAttributions_=function(frameState){for(var lookup={},visibleAttributions=[],layerStatesArray=frameState.layerStatesArray,resolution=frameState.viewState.resolution,i=0,ii=layerStatesArray.length;i<ii;++i){var layerState=layerStatesArray[i];if(visibleAtResolution(layerState,resolution)){var source=layerState.layer.getSource();if(source){var attributionGetter=source.getAttributions();if(attributionGetter){var attributions=attributionGetter(frameState);if(attributions)if(this.overrideCollapsible_||!1!==source.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(attributions))for(var j=0,jj=attributions.length;j<jj;++j)attributions[j]in lookup||(visibleAttributions.push(attributions[j]),lookup[attributions[j]]=!0);else attributions in lookup||(visibleAttributions.push(attributions),lookup[attributions]=!0)}}}}return visibleAttributions},Attribution.prototype.updateElement_=function(frameState){if(frameState){var attributions=this.collectSourceAttributions_(frameState),visible=attributions.length>0;if(this.renderedVisible_!=visible&&(this.element.style.display=visible?"":"none",this.renderedVisible_=visible),!equals(attributions,this.renderedAttributions_)){removeChildren(this.ulElement_);for(var i=0,ii=attributions.length;i<ii;++i){var element=document.createElement("li");element.innerHTML=attributions[i],this.ulElement_.appendChild(element)}this.renderedAttributions_=attributions}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},Attribution.prototype.handleClick_=function(event){event.preventDefault(),this.handleToggle_()},Attribution.prototype.handleToggle_=function(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},Attribution.prototype.getCollapsible=function(){return this.collapsible_},Attribution.prototype.setCollapsible=function(collapsible){this.collapsible_!==collapsible&&(this.collapsible_=collapsible,this.element.classList.toggle("ol-uncollapsible"),!collapsible&&this.collapsed_&&this.handleToggle_())},Attribution.prototype.setCollapsed=function(collapsed){this.collapsible_&&this.collapsed_!==collapsed&&this.handleToggle_()},Attribution.prototype.getCollapsed=function(){return this.collapsed_},Attribution}(Control);function render(mapEvent){this.updateElement_(mapEvent.frameState)}var Rotate=function(Control$$1){function Rotate(opt_options){var options=opt_options||{};Control$$1.call(this,{element:document.createElement("div"),render:options.render||render$1,target:options.target});var className=void 0!==options.className?options.className:"ol-rotate",label=void 0!==options.label?options.label:"";this.label_=null,"string"==typeof label?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=label):(this.label_=label,this.label_.classList.add("ol-compass"));var tipLabel=options.tipLabel?options.tipLabel:"Reset rotation",button=document.createElement("button");button.className=className+"-reset",button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(this.label_),listen(button,EventType.CLICK,this.handleClick_,this);var cssClasses=className+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,element=this.element;element.className=cssClasses,element.appendChild(button),this.callResetNorth_=options.resetNorth?options.resetNorth:void 0,this.duration_=void 0!==options.duration?options.duration:250,this.autoHide_=void 0===options.autoHide||options.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CLASS_HIDDEN)}return Control$$1&&(Rotate.__proto__=Control$$1),Rotate.prototype=Object.create(Control$$1&&Control$$1.prototype),Rotate.prototype.constructor=Rotate,Rotate.prototype.handleClick_=function(event){event.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},Rotate.prototype.resetNorth_=function(){var view=this.getMap().getView();view&&void 0!==view.getRotation()&&(this.duration_>0?view.animate({rotation:0,duration:this.duration_,easing:easeOut}):view.setRotation(0))},Rotate}(Control);function render$1(mapEvent){var frameState=mapEvent.frameState;if(frameState){var rotation=frameState.viewState.rotation;if(rotation!=this.rotation_){var transform="rotate("+rotation+"rad)";if(this.autoHide_){var contains=this.element.classList.contains(CLASS_HIDDEN);contains||0!==rotation?contains&&0!==rotation&&this.element.classList.remove(CLASS_HIDDEN):this.element.classList.add(CLASS_HIDDEN)}this.label_.style.msTransform=transform,this.label_.style.webkitTransform=transform,this.label_.style.transform=transform}this.rotation_=rotation}}var Zoom=function(Control$$1){function Zoom(opt_options){var options=opt_options||{};Control$$1.call(this,{element:document.createElement("div"),target:options.target});var className=void 0!==options.className?options.className:"ol-zoom",delta=void 0!==options.delta?options.delta:1,zoomInLabel=void 0!==options.zoomInLabel?options.zoomInLabel:"+",zoomOutLabel=void 0!==options.zoomOutLabel?options.zoomOutLabel:"",zoomInTipLabel=void 0!==options.zoomInTipLabel?options.zoomInTipLabel:"Zoom in",zoomOutTipLabel=void 0!==options.zoomOutTipLabel?options.zoomOutTipLabel:"Zoom out",inElement=document.createElement("button");inElement.className=className+"-in",inElement.setAttribute("type","button"),inElement.title=zoomInTipLabel,inElement.appendChild("string"==typeof zoomInLabel?document.createTextNode(zoomInLabel):zoomInLabel),listen(inElement,EventType.CLICK,this.handleClick_.bind(this,delta));var outElement=document.createElement("button");outElement.className=className+"-out",outElement.setAttribute("type","button"),outElement.title=zoomOutTipLabel,outElement.appendChild("string"==typeof zoomOutLabel?document.createTextNode(zoomOutLabel):zoomOutLabel),listen(outElement,EventType.CLICK,this.handleClick_.bind(this,-delta));var cssClasses=className+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,element=this.element;element.className=cssClasses,element.appendChild(inElement),element.appendChild(outElement),this.duration_=void 0!==options.duration?options.duration:250}return Control$$1&&(Zoom.__proto__=Control$$1),Zoom.prototype=Object.create(Control$$1&&Control$$1.prototype),Zoom.prototype.constructor=Zoom,Zoom.prototype.handleClick_=function(delta,event){event.preventDefault(),this.zoomByDelta_(delta)},Zoom.prototype.zoomByDelta_=function(delta){var view=this.getMap().getView();if(view){var currentResolution=view.getResolution();if(currentResolution){var newResolution=view.constrainResolution(currentResolution,delta);this.duration_>0?(view.getAnimating()&&view.cancelAnimations(),view.animate({resolution:newResolution,duration:this.duration_,easing:easeOut})):view.setResolution(newResolution)}}},Zoom}(Control);function defaults(opt_options){var options=opt_options||{},controls=new Collection;return(void 0===options.zoom||options.zoom)&&controls.push(new Zoom(options.zoomOptions)),(void 0===options.rotate||options.rotate)&&controls.push(new Rotate(options.rotateOptions)),(void 0===options.attribution||options.attribution)&&controls.push(new Attribution(options.attributionOptions)),controls}var Kinetic=function(decay,minVelocity,delay){this.decay_=decay,this.minVelocity_=minVelocity,this.delay_=delay,this.points_=[],this.angle_=0,this.initialVelocity_=0};Kinetic.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},Kinetic.prototype.update=function(x,y){this.points_.push(x,y,Date.now())},Kinetic.prototype.end=function(){if(this.points_.length<6)return!1;var delay=Date.now()-this.delay_,lastIndex=this.points_.length-3;if(this.points_[lastIndex+2]<delay)return!1;for(var firstIndex=lastIndex-3;firstIndex>0&&this.points_[firstIndex+2]>delay;)firstIndex-=3;var duration=this.points_[lastIndex+2]-this.points_[firstIndex+2];if(duration<1e3/60)return!1;var dx=this.points_[lastIndex]-this.points_[firstIndex],dy=this.points_[lastIndex+1]-this.points_[firstIndex+1];return this.angle_=Math.atan2(dy,dx),this.initialVelocity_=Math.sqrt(dx*dx+dy*dy)/duration,this.initialVelocity_>this.minVelocity_},Kinetic.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},Kinetic.prototype.getAngle=function(){return this.angle_};var InteractionProperty={ACTIVE:"active"},Interaction=function(BaseObject$$1){function Interaction(options){BaseObject$$1.call(this),options.handleEvent&&(this.handleEvent=options.handleEvent),this.map_=null,this.setActive(!0)}return BaseObject$$1&&(Interaction.__proto__=BaseObject$$1),Interaction.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),Interaction.prototype.constructor=Interaction,Interaction.prototype.getActive=function(){return this.get(InteractionProperty.ACTIVE)},Interaction.prototype.getMap=function(){return this.map_},Interaction.prototype.handleEvent=function(mapBrowserEvent){return!0},Interaction.prototype.setActive=function(active){this.set(InteractionProperty.ACTIVE,active)},Interaction.prototype.setMap=function(map){this.map_=map},Interaction}(BaseObject);function pan(view,delta,opt_duration){var currentCenter=view.getCenter();if(currentCenter){var center=view.constrainCenter([currentCenter[0]+delta[0],currentCenter[1]+delta[1]]);opt_duration?view.animate({duration:opt_duration,easing:linear,center:center}):view.setCenter(center)}}function rotate$3(view,rotation,opt_anchor,opt_duration){rotation=view.constrainRotation(rotation,0),rotateWithoutConstraints(view,rotation,opt_anchor,opt_duration)}function rotateWithoutConstraints(view,rotation,opt_anchor,opt_duration){if(void 0!==rotation){var currentRotation=view.getRotation(),currentCenter=view.getCenter();void 0!==currentRotation&&currentCenter&&opt_duration>0?view.animate({rotation:rotation,anchor:opt_anchor,duration:opt_duration,easing:easeOut}):view.rotate(rotation,opt_anchor)}}function zoom(view,resolution,opt_anchor,opt_duration,opt_direction){resolution=view.constrainResolution(resolution,0,opt_direction),zoomWithoutConstraints(view,resolution,opt_anchor,opt_duration)}function zoomByDelta(view,delta,opt_anchor,opt_duration){var currentResolution=view.getResolution(),resolution=view.constrainResolution(currentResolution,delta,0);if(void 0!==resolution){var resolutions=view.getResolutions();resolution=clamp(resolution,view.getMinResolution()||resolutions[resolutions.length-1],view.getMaxResolution()||resolutions[0])}if(opt_anchor&&void 0!==resolution&&resolution!==currentResolution){var currentCenter=view.getCenter(),center=view.calculateCenterZoom(resolution,opt_anchor);center=view.constrainCenter(center),opt_anchor=[(resolution*currentCenter[0]-currentResolution*center[0])/(resolution-currentResolution),(resolution*currentCenter[1]-currentResolution*center[1])/(resolution-currentResolution)]}zoomWithoutConstraints(view,resolution,opt_anchor,opt_duration)}function zoomWithoutConstraints(view,resolution,opt_anchor,opt_duration){if(resolution){var currentResolution=view.getResolution(),currentCenter=view.getCenter();if(void 0!==currentResolution&&currentCenter&&resolution!==currentResolution&&opt_duration)view.animate({resolution:resolution,anchor:opt_anchor,duration:opt_duration,easing:easeOut});else{if(opt_anchor){var center=view.calculateCenterZoom(resolution,opt_anchor);view.setCenter(center)}view.setResolution(resolution)}}}var DoubleClickZoom=function(Interaction$$1){function DoubleClickZoom(opt_options){Interaction$$1.call(this,{handleEvent:handleEvent});var options=opt_options||{};this.delta_=options.delta?options.delta:1,this.duration_=void 0!==options.duration?options.duration:250}return Interaction$$1&&(DoubleClickZoom.__proto__=Interaction$$1),DoubleClickZoom.prototype=Object.create(Interaction$$1&&Interaction$$1.prototype),DoubleClickZoom.prototype.constructor=DoubleClickZoom,DoubleClickZoom}(Interaction);function handleEvent(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==MapBrowserEventType.DBLCLICK){var browserEvent=mapBrowserEvent.originalEvent,map=mapBrowserEvent.map,anchor=mapBrowserEvent.coordinate,delta=browserEvent.shiftKey?-this.delta_:this.delta_;zoomByDelta(map.getView(),delta,anchor,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}return!stopEvent}var altKeyOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&!originalEvent.shiftKey},altShiftKeysOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},focus=function(event){return event.target.getTargetElement()===document.activeElement},always=TRUE,mouseActionButton=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return 0==originalEvent.button&&!(WEBKIT&&MAC&&originalEvent.ctrlKey)},never=FALSE,pointerMove$1=function(mapBrowserEvent){return"pointermove"==mapBrowserEvent.type},singleClick=function(mapBrowserEvent){return mapBrowserEvent.type==MapBrowserEventType.SINGLECLICK},noModifierKeys=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&!originalEvent.shiftKey},shiftKeyOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},targetNotEditable=function(mapBrowserEvent){var tagName=mapBrowserEvent.originalEvent.target.tagName;return"INPUT"!==tagName&&"SELECT"!==tagName&&"TEXTAREA"!==tagName},mouseOnly=function(mapBrowserEvent){var pointerEvent=mapBrowserEvent.pointerEvent;return assert(void 0!==pointerEvent,56),"mouse"==pointerEvent.pointerType},primaryAction=function(mapBrowserEvent){var pointerEvent=mapBrowserEvent.pointerEvent;return assert(void 0!==pointerEvent,56),pointerEvent.isPrimary&&0===pointerEvent.button},PointerInteraction=function(Interaction$$1){function PointerInteraction(opt_options){var options=opt_options||{};Interaction$$1.call(this,options),options.handleDownEvent&&(this.handleDownEvent=options.handleDownEvent),options.handleDragEvent&&(this.handleDragEvent=options.handleDragEvent),options.handleMoveEvent&&(this.handleMoveEvent=options.handleMoveEvent),options.handleUpEvent&&(this.handleUpEvent=options.handleUpEvent),options.stopDown&&(this.stopDown=options.stopDown),this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]}return Interaction$$1&&(PointerInteraction.__proto__=Interaction$$1),PointerInteraction.prototype=Object.create(Interaction$$1&&Interaction$$1.prototype),PointerInteraction.prototype.constructor=PointerInteraction,PointerInteraction.prototype.handleDownEvent=function(mapBrowserEvent){return!1},PointerInteraction.prototype.handleDragEvent=function(mapBrowserEvent){},PointerInteraction.prototype.handleEvent=function(mapBrowserEvent){if(!mapBrowserEvent.pointerEvent)return!0;var stopEvent=!1;if(this.updateTrackedPointers_(mapBrowserEvent),this.handlingDownUpSequence){if(mapBrowserEvent.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(mapBrowserEvent);else if(mapBrowserEvent.type==MapBrowserEventType.POINTERUP){var handledUp=this.handleUpEvent(mapBrowserEvent);this.handlingDownUpSequence=handledUp&&this.targetPointers.length>0}}else if(mapBrowserEvent.type==MapBrowserEventType.POINTERDOWN){var handled=this.handleDownEvent(mapBrowserEvent);handled&&mapBrowserEvent.preventDefault(),this.handlingDownUpSequence=handled,stopEvent=this.stopDown(handled)}else mapBrowserEvent.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(mapBrowserEvent);return!stopEvent},PointerInteraction.prototype.handleMoveEvent=function(mapBrowserEvent){},PointerInteraction.prototype.handleUpEvent=function(mapBrowserEvent){return!1},PointerInteraction.prototype.stopDown=function(handled){return handled},PointerInteraction.prototype.updateTrackedPointers_=function(mapBrowserEvent){if(isPointerDraggingEvent(mapBrowserEvent)){var event=mapBrowserEvent.pointerEvent,id=event.pointerId.toString();mapBrowserEvent.type==MapBrowserEventType.POINTERUP?delete this.trackedPointers_[id]:mapBrowserEvent.type==MapBrowserEventType.POINTERDOWN?this.trackedPointers_[id]=event:id in this.trackedPointers_&&(this.trackedPointers_[id]=event),this.targetPointers=getValues(this.trackedPointers_)}},PointerInteraction}(Interaction);function centroid(pointerEvents){for(var length=pointerEvents.length,clientX=0,clientY=0,i=0;i<length;i++)clientX+=pointerEvents[i].clientX,clientY+=pointerEvents[i].clientY;return[clientX/length,clientY/length]}function isPointerDraggingEvent(mapBrowserEvent){var type=mapBrowserEvent.type;return type===MapBrowserEventType.POINTERDOWN||type===MapBrowserEventType.POINTERDRAG||type===MapBrowserEventType.POINTERUP}var DragPan=function(PointerInteraction$$1){function DragPan(opt_options){PointerInteraction$$1.call(this,{stopDown:FALSE});var options=opt_options||{};this.kinetic_=options.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1,this.condition_=options.condition?options.condition:noModifierKeys,this.noKinetic_=!1}return PointerInteraction$$1&&(DragPan.__proto__=PointerInteraction$$1),DragPan.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),DragPan.prototype.constructor=DragPan,DragPan.prototype.handleDragEvent=function(mapBrowserEvent){this.panning_||(this.panning_=!0,this.getMap().getView().setHint(ViewHint.INTERACTING,1));var targetPointers=this.targetPointers,centroid$$1=centroid(targetPointers);if(targetPointers.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(centroid$$1[0],centroid$$1[1]),this.lastCentroid){var deltaX=this.lastCentroid[0]-centroid$$1[0],deltaY=centroid$$1[1]-this.lastCentroid[1],view=mapBrowserEvent.map.getView(),center=[deltaX,deltaY];scale(center,view.getResolution()),rotate(center,view.getRotation()),add(center,view.getCenter()),center=view.constrainCenter(center),view.setCenter(center)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=centroid$$1,this.lastPointersCount_=targetPointers.length},DragPan.prototype.handleUpEvent=function(mapBrowserEvent){var map=mapBrowserEvent.map,view=map.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var distance$$1=this.kinetic_.getDistance(),angle=this.kinetic_.getAngle(),center=view.getCenter(),centerpx=map.getPixelFromCoordinate(center),dest=map.getCoordinateFromPixel([centerpx[0]-distance$$1*Math.cos(angle),centerpx[1]-distance$$1*Math.sin(angle)]);view.animate({center:view.constrainCenter(dest),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,view.setHint(ViewHint.INTERACTING,-1)),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},DragPan.prototype.handleDownEvent=function(mapBrowserEvent){if(this.targetPointers.length>0&&this.condition_(mapBrowserEvent)){var view=mapBrowserEvent.map.getView();return this.lastCentroid=null,view.getAnimating()&&view.setCenter(mapBrowserEvent.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},DragPan}(PointerInteraction),DragRotate=function(PointerInteraction$$1){function DragRotate(opt_options){var options=opt_options||{};PointerInteraction$$1.call(this,{stopDown:FALSE}),this.condition_=options.condition?options.condition:altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=void 0!==options.duration?options.duration:250}return PointerInteraction$$1&&(DragRotate.__proto__=PointerInteraction$$1),DragRotate.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),DragRotate.prototype.constructor=DragRotate,DragRotate.prototype.handleDragEvent=function(mapBrowserEvent){if(mouseOnly(mapBrowserEvent)){var map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation!==disable){var size=map.getSize(),offset=mapBrowserEvent.pixel,theta=Math.atan2(size[1]/2-offset[1],offset[0]-size[0]/2);if(void 0!==this.lastAngle_){var delta=theta-this.lastAngle_,rotation=view.getRotation();rotateWithoutConstraints(view,rotation-delta)}this.lastAngle_=theta}}},DragRotate.prototype.handleUpEvent=function(mapBrowserEvent){if(!mouseOnly(mapBrowserEvent))return!0;var view=mapBrowserEvent.map.getView();view.setHint(ViewHint.INTERACTING,-1);var rotation=view.getRotation();return rotate$3(view,rotation,void 0,this.duration_),!1},DragRotate.prototype.handleDownEvent=function(mapBrowserEvent){return!!mouseOnly(mapBrowserEvent)&&(!(!mouseActionButton(mapBrowserEvent)||!this.condition_(mapBrowserEvent))&&(mapBrowserEvent.map.getView().setHint(ViewHint.INTERACTING,1),this.lastAngle_=void 0,!0))},DragRotate}(PointerInteraction),RenderBox=function(Disposable$$1){function RenderBox(className){Disposable$$1.call(this),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.className="ol-box "+className,this.map_=null,this.startPixel_=null,this.endPixel_=null}return Disposable$$1&&(RenderBox.__proto__=Disposable$$1),RenderBox.prototype=Object.create(Disposable$$1&&Disposable$$1.prototype),RenderBox.prototype.constructor=RenderBox,RenderBox.prototype.disposeInternal=function(){this.setMap(null)},RenderBox.prototype.render_=function(){var startPixel=this.startPixel_,endPixel=this.endPixel_,style=this.element_.style;style.left=Math.min(startPixel[0],endPixel[0])+"px",style.top=Math.min(startPixel[1],endPixel[1])+"px",style.width=Math.abs(endPixel[0]-startPixel[0])+"px",style.height=Math.abs(endPixel[1]-startPixel[1])+"px"},RenderBox.prototype.setMap=function(map){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var style=this.element_.style;style.left=style.top=style.width=style.height="inherit"}this.map_=map,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},RenderBox.prototype.setPixels=function(startPixel,endPixel){this.startPixel_=startPixel,this.endPixel_=endPixel,this.createOrUpdateGeometry(),this.render_()},RenderBox.prototype.createOrUpdateGeometry=function(){var startPixel=this.startPixel_,endPixel=this.endPixel_,coordinates=[startPixel,[startPixel[0],endPixel[1]],endPixel,[endPixel[0],startPixel[1]]].map(this.map_.getCoordinateFromPixel,this.map_);coordinates[4]=coordinates[0].slice(),this.geometry_?this.geometry_.setCoordinates([coordinates]):this.geometry_=new Polygon([coordinates])},RenderBox.prototype.getGeometry=function(){return this.geometry_},RenderBox}(Disposable),DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},DragBoxEvent=function(Event$$1){function DragBoxEvent(type,coordinate,mapBrowserEvent){Event$$1.call(this,type),this.coordinate=coordinate,this.mapBrowserEvent=mapBrowserEvent}return Event$$1&&(DragBoxEvent.__proto__=Event$$1),DragBoxEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),DragBoxEvent.prototype.constructor=DragBoxEvent,DragBoxEvent}(Event),DragBox=function(PointerInteraction$$1){function DragBox(opt_options){PointerInteraction$$1.call(this);var options=opt_options||{};this.box_=new RenderBox(options.className||"ol-dragbox"),this.minArea_=void 0!==options.minArea?options.minArea:64,this.onBoxEnd_=options.onBoxEnd?options.onBoxEnd:VOID,this.startPixel_=null,this.condition_=options.condition?options.condition:always,this.boxEndCondition_=options.boxEndCondition?options.boxEndCondition:this.defaultBoxEndCondition}return PointerInteraction$$1&&(DragBox.__proto__=PointerInteraction$$1),DragBox.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),DragBox.prototype.constructor=DragBox,DragBox.prototype.defaultBoxEndCondition=function(mapBrowserEvent,startPixel,endPixel){var width=endPixel[0]-startPixel[0],height=endPixel[1]-startPixel[1];return width*width+height*height>=this.minArea_},DragBox.prototype.getGeometry=function(){return this.box_.getGeometry()},DragBox.prototype.handleDragEvent=function(mapBrowserEvent){mouseOnly(mapBrowserEvent)&&(this.box_.setPixels(this.startPixel_,mapBrowserEvent.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,mapBrowserEvent.coordinate,mapBrowserEvent)))},DragBox.prototype.handleUpEvent=function(mapBrowserEvent){return!mouseOnly(mapBrowserEvent)||(this.box_.setMap(null),this.boxEndCondition_(mapBrowserEvent,this.startPixel_,mapBrowserEvent.pixel)&&(this.onBoxEnd_(mapBrowserEvent),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXEND,mapBrowserEvent.coordinate,mapBrowserEvent))),!1)},DragBox.prototype.handleDownEvent=function(mapBrowserEvent){return!!mouseOnly(mapBrowserEvent)&&(!(!mouseActionButton(mapBrowserEvent)||!this.condition_(mapBrowserEvent))&&(this.startPixel_=mapBrowserEvent.pixel,this.box_.setMap(mapBrowserEvent.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,mapBrowserEvent.coordinate,mapBrowserEvent)),!0))},DragBox}(PointerInteraction),DragZoom=function(DragBox$$1){function DragZoom(opt_options){var options=opt_options||{},condition=options.condition?options.condition:shiftKeyOnly;DragBox$$1.call(this,{condition:condition,className:options.className||"ol-dragzoom",onBoxEnd:onBoxEnd}),this.duration_=void 0!==options.duration?options.duration:200,this.out_=void 0!==options.out&&options.out}return DragBox$$1&&(DragZoom.__proto__=DragBox$$1),DragZoom.prototype=Object.create(DragBox$$1&&DragBox$$1.prototype),DragZoom.prototype.constructor=DragZoom,DragZoom}(DragBox);function onBoxEnd(){var map=this.getMap(),view=map.getView(),size=map.getSize(),extent=this.getGeometry().getExtent();if(this.out_){var mapExtent=view.calculateExtent(size),boxPixelExtent=createOrUpdateFromCoordinates([map.getPixelFromCoordinate(getBottomLeft(extent)),map.getPixelFromCoordinate(getTopRight(extent))]);scaleFromCenter(mapExtent,1/view.getResolutionForExtent(boxPixelExtent,size)),extent=mapExtent}var resolution=view.constrainResolution(view.getResolutionForExtent(extent,size)),center=getCenter(extent);center=view.constrainCenter(center),view.animate({resolution:resolution,center:center,duration:this.duration_,easing:easeOut})}var KeyCode={LEFT:37,UP:38,RIGHT:39,DOWN:40},KeyboardPan=function(Interaction$$1){function KeyboardPan(opt_options){Interaction$$1.call(this,{handleEvent:handleEvent$1});var options=opt_options||{};this.defaultCondition_=function(mapBrowserEvent){return noModifierKeys(mapBrowserEvent)&&targetNotEditable(mapBrowserEvent)},this.condition_=void 0!==options.condition?options.condition:this.defaultCondition_,this.duration_=void 0!==options.duration?options.duration:100,this.pixelDelta_=void 0!==options.pixelDelta?options.pixelDelta:128}return Interaction$$1&&(KeyboardPan.__proto__=Interaction$$1),KeyboardPan.prototype=Object.create(Interaction$$1&&Interaction$$1.prototype),KeyboardPan.prototype.constructor=KeyboardPan,KeyboardPan}(Interaction);function handleEvent$1(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==EventType.KEYDOWN){var keyCode=mapBrowserEvent.originalEvent.keyCode;if(this.condition_(mapBrowserEvent)&&(keyCode==KeyCode.DOWN||keyCode==KeyCode.LEFT||keyCode==KeyCode.RIGHT||keyCode==KeyCode.UP)){var view=mapBrowserEvent.map.getView(),mapUnitsDelta=view.getResolution()*this.pixelDelta_,deltaX=0,deltaY=0;keyCode==KeyCode.DOWN?deltaY=-mapUnitsDelta:keyCode==KeyCode.LEFT?deltaX=-mapUnitsDelta:keyCode==KeyCode.RIGHT?deltaX=mapUnitsDelta:deltaY=mapUnitsDelta;var delta=[deltaX,deltaY];rotate(delta,view.getRotation()),pan(view,delta,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}}return!stopEvent}var KeyboardZoom=function(Interaction$$1){function KeyboardZoom(opt_options){Interaction$$1.call(this,{handleEvent:handleEvent$2});var options=opt_options||{};this.condition_=options.condition?options.condition:targetNotEditable,this.delta_=options.delta?options.delta:1,this.duration_=void 0!==options.duration?options.duration:100}return Interaction$$1&&(KeyboardZoom.__proto__=Interaction$$1),KeyboardZoom.prototype=Object.create(Interaction$$1&&Interaction$$1.prototype),KeyboardZoom.prototype.constructor=KeyboardZoom,KeyboardZoom}(Interaction);function handleEvent$2(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==EventType.KEYDOWN||mapBrowserEvent.type==EventType.KEYPRESS){var charCode=mapBrowserEvent.originalEvent.charCode;if(this.condition_(mapBrowserEvent)&&(charCode=="+".charCodeAt(0)||charCode=="-".charCodeAt(0))){var map=mapBrowserEvent.map,delta=charCode=="+".charCodeAt(0)?this.delta_:-this.delta_;zoomByDelta(map.getView(),delta,void 0,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}}return!stopEvent}var MAX_DELTA=1,Mode={TRACKPAD:"trackpad",WHEEL:"wheel"},MouseWheelZoom=function(Interaction$$1){function MouseWheelZoom(opt_options){var options=opt_options||{};Interaction$$1.call(this,options),this.delta_=0,this.duration_=void 0!==options.duration?options.duration:250,this.timeout_=void 0!==options.timeout?options.timeout:80,this.useAnchor_=void 0===options.useAnchor||options.useAnchor,this.constrainResolution_=options.constrainResolution||!1,this.condition_=options.condition?options.condition:always,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5}return Interaction$$1&&(MouseWheelZoom.__proto__=Interaction$$1),MouseWheelZoom.prototype=Object.create(Interaction$$1&&Interaction$$1.prototype),MouseWheelZoom.prototype.constructor=MouseWheelZoom,MouseWheelZoom.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().setHint(ViewHint.INTERACTING,-1)},MouseWheelZoom.prototype.handleEvent=function(mapBrowserEvent){if(!this.condition_(mapBrowserEvent))return!0;var type=mapBrowserEvent.type;if(type!==EventType.WHEEL&&type!==EventType.MOUSEWHEEL)return!0;mapBrowserEvent.preventDefault();var delta,map=mapBrowserEvent.map,wheelEvent=mapBrowserEvent.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=mapBrowserEvent.coordinate),mapBrowserEvent.type==EventType.WHEEL?(delta=wheelEvent.deltaY,FIREFOX&&wheelEvent.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(delta/=DEVICE_PIXEL_RATIO),wheelEvent.deltaMode===WheelEvent.DOM_DELTA_LINE&&(delta*=40)):mapBrowserEvent.type==EventType.MOUSEWHEEL&&(delta=-wheelEvent.wheelDeltaY,SAFARI&&(delta/=3)),0===delta)return!1;var now=Date.now();if(void 0===this.startTime_&&(this.startTime_=now),(!this.mode_||now-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(delta)<4?Mode.TRACKPAD:Mode.WHEEL),this.mode_===Mode.TRACKPAD){var view=map.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):view.setHint(ViewHint.INTERACTING,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var resolution=view.getResolution()*Math.pow(2,delta/this.trackpadDeltaPerZoom_),minResolution=view.getMinResolution(),maxResolution=view.getMaxResolution(),rebound=0;if(resolution<minResolution?(resolution=Math.max(resolution,minResolution/this.trackpadZoomBuffer_),rebound=1):resolution>maxResolution&&(resolution=Math.min(resolution,maxResolution*this.trackpadZoomBuffer_),rebound=-1),this.lastAnchor_){var center=view.calculateCenterZoom(resolution,this.lastAnchor_);view.setCenter(view.constrainCenter(center))}return view.setResolution(resolution),0===rebound&&this.constrainResolution_&&view.animate({resolution:view.constrainResolution(resolution,delta>0?-1:1),easing:easeOut,anchor:this.lastAnchor_,duration:this.duration_}),rebound>0?view.animate({resolution:minResolution,easing:easeOut,anchor:this.lastAnchor_,duration:500}):rebound<0&&view.animate({resolution:maxResolution,easing:easeOut,anchor:this.lastAnchor_,duration:500}),this.startTime_=now,!1}this.delta_+=delta;var timeLeft=Math.max(this.timeout_-(now-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,map),timeLeft),!1},MouseWheelZoom.prototype.handleWheelZoom_=function(map){var view=map.getView();view.getAnimating()&&view.cancelAnimations();var maxDelta=MAX_DELTA;zoomByDelta(view,-clamp(this.delta_,-maxDelta,maxDelta),this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},MouseWheelZoom.prototype.setMouseAnchor=function(useAnchor){this.useAnchor_=useAnchor,useAnchor||(this.lastAnchor_=null)},MouseWheelZoom}(Interaction),PinchRotate=function(PointerInteraction$$1){function PinchRotate(opt_options){var options=opt_options||{},pointerOptions=options;pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),PointerInteraction$$1.call(this,pointerOptions),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==options.threshold?options.threshold:.3,this.duration_=void 0!==options.duration?options.duration:250}return PointerInteraction$$1&&(PinchRotate.__proto__=PointerInteraction$$1),PinchRotate.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),PinchRotate.prototype.constructor=PinchRotate,PinchRotate.prototype.handleDragEvent=function(mapBrowserEvent){var rotationDelta=0,touch0=this.targetPointers[0],touch1=this.targetPointers[1],angle=Math.atan2(touch1.clientY-touch0.clientY,touch1.clientX-touch0.clientX);if(void 0!==this.lastAngle_){var delta=angle-this.lastAngle_;this.rotationDelta_+=delta,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),rotationDelta=delta}this.lastAngle_=angle;var map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation!==disable){var viewportPosition=map.getViewport().getBoundingClientRect(),centroid$$1=centroid(this.targetPointers);if(centroid$$1[0]-=viewportPosition.left,centroid$$1[1]-=viewportPosition.top,this.anchor_=map.getCoordinateFromPixel(centroid$$1),this.rotating_){var rotation=view.getRotation();map.render(),rotateWithoutConstraints(view,rotation+rotationDelta,this.anchor_)}}},PinchRotate.prototype.handleUpEvent=function(mapBrowserEvent){if(this.targetPointers.length<2){var view=mapBrowserEvent.map.getView();if(view.setHint(ViewHint.INTERACTING,-1),this.rotating_){var rotation=view.getRotation();rotate$3(view,rotation,this.anchor_,this.duration_)}return!1}return!0},PinchRotate.prototype.handleDownEvent=function(mapBrowserEvent){if(this.targetPointers.length>=2){var map=mapBrowserEvent.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||map.getView().setHint(ViewHint.INTERACTING,1),!0}return!1},PinchRotate}(PointerInteraction),PinchZoom=function(PointerInteraction$$1){function PinchZoom(opt_options){var options=opt_options||{},pointerOptions=options;pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),PointerInteraction$$1.call(this,pointerOptions),this.constrainResolution_=options.constrainResolution||!1,this.anchor_=null,this.duration_=void 0!==options.duration?options.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}return PointerInteraction$$1&&(PinchZoom.__proto__=PointerInteraction$$1),PinchZoom.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),PinchZoom.prototype.constructor=PinchZoom,PinchZoom.prototype.handleDragEvent=function(mapBrowserEvent){var scaleDelta=1,touch0=this.targetPointers[0],touch1=this.targetPointers[1],dx=touch0.clientX-touch1.clientX,dy=touch0.clientY-touch1.clientY,distance=Math.sqrt(dx*dx+dy*dy);void 0!==this.lastDistance_&&(scaleDelta=this.lastDistance_/distance),this.lastDistance_=distance;var map=mapBrowserEvent.map,view=map.getView(),resolution=view.getResolution(),maxResolution=view.getMaxResolution(),minResolution=view.getMinResolution(),newResolution=resolution*scaleDelta;newResolution>maxResolution?(scaleDelta=maxResolution/resolution,newResolution=maxResolution):newResolution<minResolution&&(scaleDelta=minResolution/resolution,newResolution=minResolution),1!=scaleDelta&&(this.lastScaleDelta_=scaleDelta);var viewportPosition=map.getViewport().getBoundingClientRect(),centroid$$1=centroid(this.targetPointers);centroid$$1[0]-=viewportPosition.left,centroid$$1[1]-=viewportPosition.top,this.anchor_=map.getCoordinateFromPixel(centroid$$1),map.render(),zoomWithoutConstraints(view,newResolution,this.anchor_)},PinchZoom.prototype.handleUpEvent=function(mapBrowserEvent){if(this.targetPointers.length<2){var view=mapBrowserEvent.map.getView();view.setHint(ViewHint.INTERACTING,-1);var resolution=view.getResolution();if(this.constrainResolution_||resolution<view.getMinResolution()||resolution>view.getMaxResolution()){var direction=this.lastScaleDelta_-1;zoom(view,resolution,this.anchor_,this.duration_,direction)}return!1}return!0},PinchZoom.prototype.handleDownEvent=function(mapBrowserEvent){if(this.targetPointers.length>=2){var map=mapBrowserEvent.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||map.getView().setHint(ViewHint.INTERACTING,1),!0}return!1},PinchZoom}(PointerInteraction),DragAndDropEventType={ADD_FEATURES:"addfeatures"},DragAndDropEvent=function(Event$$1){function DragAndDropEvent(type,file,opt_features,opt_projection){Event$$1.call(this,type),this.features=opt_features,this.file=file,this.projection=opt_projection}return Event$$1&&(DragAndDropEvent.__proto__=Event$$1),DragAndDropEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),DragAndDropEvent.prototype.constructor=DragAndDropEvent,DragAndDropEvent}(Event),DragAndDrop=function(Interaction$$1){function DragAndDrop(opt_options){var options=opt_options||{};Interaction$$1.call(this,{handleEvent:TRUE}),this.formatConstructors_=options.formatConstructors?options.formatConstructors:[],this.projection_=options.projection?get$2(options.projection):null,this.dropListenKeys_=null,this.source_=options.source||null,this.target=options.target?options.target:null}return Interaction$$1&&(DragAndDrop.__proto__=Interaction$$1),DragAndDrop.prototype=Object.create(Interaction$$1&&Interaction$$1.prototype),DragAndDrop.prototype.constructor=DragAndDrop,DragAndDrop.prototype.handleResult_=function(file,event){var result=event.target.result,map=this.getMap(),projection=this.projection_;projection||(projection=map.getView().getProjection());for(var formatConstructors=this.formatConstructors_,features=[],i=0,ii=formatConstructors.length;i<ii;++i){var format=new formatConstructors[i];if((features=this.tryReadFeatures_(format,result,{featureProjection:projection}))&&features.length>0)break}this.source_&&(this.source_.clear(),this.source_.addFeatures(features)),this.dispatchEvent(new DragAndDropEvent(DragAndDropEventType.ADD_FEATURES,file,features,projection))},DragAndDrop.prototype.registerListeners_=function(){var map=this.getMap();if(map){var dropArea=this.target?this.target:map.getViewport();this.dropListenKeys_=[listen(dropArea,EventType.DROP,handleDrop,this),listen(dropArea,EventType.DRAGENTER,handleStop,this),listen(dropArea,EventType.DRAGOVER,handleStop,this),listen(dropArea,EventType.DROP,handleStop,this)]}},DragAndDrop.prototype.setActive=function(active){Interaction$$1.prototype.setActive.call(this,active),active?this.registerListeners_():this.unregisterListeners_()},DragAndDrop.prototype.setMap=function(map){this.unregisterListeners_(),Interaction$$1.prototype.setMap.call(this,map),this.getActive()&&this.registerListeners_()},DragAndDrop.prototype.tryReadFeatures_=function(format,text,options){try{return format.readFeatures(text,options)}catch(e){return null}},DragAndDrop.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(unlistenByKey),this.dropListenKeys_=null)},DragAndDrop}(Interaction);function handleDrop(event){for(var files=event.dataTransfer.files,i=0,ii=files.length;i<ii;++i){var file=files.item(i),reader=new FileReader;reader.addEventListener(EventType.LOAD,this.handleResult_.bind(this,file)),reader.readAsText(file)}}function handleStop(event){event.stopPropagation(),event.preventDefault(),event.dataTransfer.dropEffect="copy"}var DragRotateAndZoom=function(PointerInteraction$$1){function DragRotateAndZoom(opt_options){var options=opt_options||{};PointerInteraction$$1.call(this,options),this.condition_=options.condition?options.condition:shiftKeyOnly,this.lastAngle_=void 0,this.lastMagnitude_=void 0,this.lastScaleDelta_=0,this.duration_=void 0!==options.duration?options.duration:400}return PointerInteraction$$1&&(DragRotateAndZoom.__proto__=PointerInteraction$$1),DragRotateAndZoom.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),DragRotateAndZoom.prototype.constructor=DragRotateAndZoom,DragRotateAndZoom.prototype.handleDragEvent=function(mapBrowserEvent){if(mouseOnly(mapBrowserEvent)){var map=mapBrowserEvent.map,size=map.getSize(),offset=mapBrowserEvent.pixel,deltaX=offset[0]-size[0]/2,deltaY=size[1]/2-offset[1],theta=Math.atan2(deltaY,deltaX),magnitude=Math.sqrt(deltaX*deltaX+deltaY*deltaY),view=map.getView();if(view.getConstraints().rotation!==disable&&void 0!==this.lastAngle_){var angleDelta=theta-this.lastAngle_;rotateWithoutConstraints(view,view.getRotation()-angleDelta)}if(this.lastAngle_=theta,void 0!==this.lastMagnitude_){var resolution=this.lastMagnitude_*(view.getResolution()/magnitude);zoomWithoutConstraints(view,resolution)}void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/magnitude),this.lastMagnitude_=magnitude}},DragRotateAndZoom.prototype.handleUpEvent=function(mapBrowserEvent){if(!mouseOnly(mapBrowserEvent))return!0;var view=mapBrowserEvent.map.getView();view.setHint(ViewHint.INTERACTING,-1);var direction=this.lastScaleDelta_-1;return rotate$3(view,view.getRotation()),zoom(view,view.getResolution(),void 0,this.duration_,direction),this.lastScaleDelta_=0,!1},DragRotateAndZoom.prototype.handleDownEvent=function(mapBrowserEvent){return!!mouseOnly(mapBrowserEvent)&&(!!this.condition_(mapBrowserEvent)&&(mapBrowserEvent.map.getView().setHint(ViewHint.INTERACTING,1),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0))},DragRotateAndZoom}(PointerInteraction),Feature=function(BaseObject$$1){function Feature(opt_geometryOrProperties){if(BaseObject$$1.call(this),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,listen(this,getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),opt_geometryOrProperties)if("function"==typeof opt_geometryOrProperties.getSimplifiedGeometry){var geometry=opt_geometryOrProperties;this.setGeometry(geometry)}else{var properties=opt_geometryOrProperties;this.setProperties(properties)}}return BaseObject$$1&&(Feature.__proto__=BaseObject$$1),Feature.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),Feature.prototype.constructor=Feature,Feature.prototype.clone=function(){var clone=new Feature(this.getProperties());clone.setGeometryName(this.getGeometryName());var geometry=this.getGeometry();geometry&&clone.setGeometry(geometry.clone());var style=this.getStyle();return style&&clone.setStyle(style),clone},Feature.prototype.getGeometry=function(){return this.get(this.geometryName_)},Feature.prototype.getId=function(){return this.id_},Feature.prototype.getGeometryName=function(){return this.geometryName_},Feature.prototype.getStyle=function(){return this.style_},Feature.prototype.getStyleFunction=function(){return this.styleFunction_},Feature.prototype.handleGeometryChange_=function(){this.changed()},Feature.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);var geometry=this.getGeometry();geometry&&(this.geometryChangeKey_=listen(geometry,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()},Feature.prototype.setGeometry=function(geometry){this.set(this.geometryName_,geometry)},Feature.prototype.setStyle=function(style){this.style_=style,this.styleFunction_=style?createStyleFunction(style):void 0,this.changed()},Feature.prototype.setId=function(id){this.id_=id,this.changed()},Feature.prototype.setGeometryName=function(name){unlisten(this,getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=name,listen(this,getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()},Feature}(BaseObject);function createStyleFunction(obj){return"function"==typeof obj?obj:(Array.isArray(obj)?styles=obj:(assert("function"==typeof obj.getZIndex,41),styles=[obj]),function(){return styles});var styles}var Circle=function(SimpleGeometry$$1){function Circle(center,opt_radius,opt_layout){if(SimpleGeometry$$1.call(this),void 0!==opt_layout&&void 0===opt_radius)this.setFlatCoordinates(opt_layout,center);else{var radius=opt_radius||0;this.setCenterAndRadius(center,radius,opt_layout)}}return SimpleGeometry$$1&&(Circle.__proto__=SimpleGeometry$$1),Circle.prototype=Object.create(SimpleGeometry$$1&&SimpleGeometry$$1.prototype),Circle.prototype.constructor=Circle,Circle.prototype.clone=function(){return new Circle(this.flatCoordinates.slice(),void 0,this.layout)},Circle.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){var flatCoordinates=this.flatCoordinates,dx=x-flatCoordinates[0],dy=y-flatCoordinates[1],squaredDistance=dx*dx+dy*dy;if(squaredDistance<minSquaredDistance){if(0===squaredDistance)for(var i=0;i<this.stride;++i)closestPoint[i]=flatCoordinates[i];else{var delta=this.getRadius()/Math.sqrt(squaredDistance);closestPoint[0]=flatCoordinates[0]+delta*dx,closestPoint[1]=flatCoordinates[1]+delta*dy;for(var i$1=2;i$1<this.stride;++i$1)closestPoint[i$1]=flatCoordinates[i$1]}return closestPoint.length=this.stride,squaredDistance}return minSquaredDistance},Circle.prototype.containsXY=function(x,y){var flatCoordinates=this.flatCoordinates,dx=x-flatCoordinates[0],dy=y-flatCoordinates[1];return dx*dx+dy*dy<=this.getRadiusSquared_()},Circle.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},Circle.prototype.computeExtent=function(extent){var flatCoordinates=this.flatCoordinates,radius=flatCoordinates[this.stride]-flatCoordinates[0];return createOrUpdate(flatCoordinates[0]-radius,flatCoordinates[1]-radius,flatCoordinates[0]+radius,flatCoordinates[1]+radius,extent)},Circle.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},Circle.prototype.getRadiusSquared_=function(){var dx=this.flatCoordinates[this.stride]-this.flatCoordinates[0],dy=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return dx*dx+dy*dy},Circle.prototype.getType=function(){return GeometryType.CIRCLE},Circle.prototype.intersectsExtent=function(extent){if(intersects(extent,this.getExtent())){var center=this.getCenter();return extent[0]<=center[0]&&extent[2]>=center[0]||(extent[1]<=center[1]&&extent[3]>=center[1]||forEachCorner(extent,this.intersectsCoordinate,this))}return!1},Circle.prototype.setCenter=function(center){var stride=this.stride,radius=this.flatCoordinates[stride]-this.flatCoordinates[0],flatCoordinates=center.slice();flatCoordinates[stride]=flatCoordinates[0]+radius;for(var i=1;i<stride;++i)flatCoordinates[stride+i]=center[i];this.setFlatCoordinates(this.layout,flatCoordinates),this.changed()},Circle.prototype.setCenterAndRadius=function(center,radius,opt_layout){this.setLayout(opt_layout,center,0),this.flatCoordinates||(this.flatCoordinates=[]);var flatCoordinates=this.flatCoordinates,offset=deflateCoordinate(flatCoordinates,0,center,this.stride);flatCoordinates[offset++]=flatCoordinates[0]+radius;for(var i=1,ii=this.stride;i<ii;++i)flatCoordinates[offset++]=flatCoordinates[i];flatCoordinates.length=offset,this.changed()},Circle.prototype.getCoordinates=function(){return null},Circle.prototype.setCoordinates=function(coordinates,opt_layout){},Circle.prototype.setRadius=function(radius){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+radius,this.changed()},Circle}(SimpleGeometry);function interpolatePoint(flatCoordinates,offset,end,stride,fraction,opt_dest){var pointX=NaN,pointY=NaN,n=(end-offset)/stride;if(1===n)pointX=flatCoordinates[offset],pointY=flatCoordinates[offset+1];else if(2==n)pointX=(1-fraction)*flatCoordinates[offset]+fraction*flatCoordinates[offset+stride],pointY=(1-fraction)*flatCoordinates[offset+1]+fraction*flatCoordinates[offset+stride+1];else if(0!==n){for(var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],length=0,cumulativeLengths=[0],i=offset+stride;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];length+=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)),cumulativeLengths.push(length),x1=x2,y1=y2}var target=fraction*length,index=binarySearch(cumulativeLengths,target);if(index<0){var t=(target-cumulativeLengths[-index-2])/(cumulativeLengths[-index-1]-cumulativeLengths[-index-2]),o=offset+(-index-2)*stride;pointX=lerp(flatCoordinates[o],flatCoordinates[o+stride],t),pointY=lerp(flatCoordinates[o+1],flatCoordinates[o+stride+1],t)}else pointX=flatCoordinates[offset+index*stride],pointY=flatCoordinates[offset+index*stride+1]}return opt_dest?(opt_dest[0]=pointX,opt_dest[1]=pointY,opt_dest):[pointX,pointY]}function lineStringCoordinateAtM(flatCoordinates,offset,end,stride,m,extrapolate){if(end==offset)return null;var coordinate;if(m<flatCoordinates[offset+stride-1])return extrapolate?((coordinate=flatCoordinates.slice(offset,offset+stride))[stride-1]=m,coordinate):null;if(flatCoordinates[end-1]<m)return extrapolate?((coordinate=flatCoordinates.slice(end-stride,end))[stride-1]=m,coordinate):null;if(m==flatCoordinates[offset+stride-1])return flatCoordinates.slice(offset,offset+stride);for(var lo=offset/stride,hi=end/stride;lo<hi;){var mid=lo+hi>>1;m<flatCoordinates[(mid+1)*stride-1]?hi=mid:lo=mid+1}var m0=flatCoordinates[lo*stride-1];if(m==m0)return flatCoordinates.slice((lo-1)*stride,(lo-1)*stride+stride);var t=(m-m0)/(flatCoordinates[(lo+1)*stride-1]-m0);coordinate=[];for(var i=0;i<stride-1;++i)coordinate.push(lerp(flatCoordinates[(lo-1)*stride+i],flatCoordinates[lo*stride+i],t));return coordinate.push(m),coordinate}function lineStringsCoordinateAtM(flatCoordinates,offset,ends,stride,m,extrapolate,interpolate){if(interpolate)return lineStringCoordinateAtM(flatCoordinates,offset,ends[ends.length-1],stride,m,extrapolate);var coordinate;if(m<flatCoordinates[stride-1])return extrapolate?((coordinate=flatCoordinates.slice(0,stride))[stride-1]=m,coordinate):null;if(flatCoordinates[flatCoordinates.length-1]<m)return extrapolate?((coordinate=flatCoordinates.slice(flatCoordinates.length-stride))[stride-1]=m,coordinate):null;for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];if(offset!=end){if(m<flatCoordinates[offset+stride-1])return null;if(m<=flatCoordinates[end-1])return lineStringCoordinateAtM(flatCoordinates,offset,end,stride,m,!1);offset=end}}return null}function lineStringLength(flatCoordinates,offset,end,stride){for(var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],length=0,i=offset+stride;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];length+=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)),x1=x2,y1=y2}return length}Circle.prototype.transform;var LineString=function(SimpleGeometry$$1){function LineString(coordinates,opt_layout){SimpleGeometry$$1.call(this),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===opt_layout||Array.isArray(coordinates[0])?this.setCoordinates(coordinates,opt_layout):this.setFlatCoordinates(opt_layout,coordinates)}return SimpleGeometry$$1&&(LineString.__proto__=SimpleGeometry$$1),LineString.prototype=Object.create(SimpleGeometry$$1&&SimpleGeometry$$1.prototype),LineString.prototype.constructor=LineString,LineString.prototype.appendCoordinate=function(coordinate){this.flatCoordinates?extend(this.flatCoordinates,coordinate):this.flatCoordinates=coordinate.slice(),this.changed()},LineString.prototype.clone=function(){return new LineString(this.flatCoordinates.slice(),this.layout)},LineString.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,x,y,closestPoint,minSquaredDistance))},LineString.prototype.forEachSegment=function(callback){return forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,callback)},LineString.prototype.getCoordinateAtM=function(m,opt_extrapolate){if(this.layout!=GeometryLayout.XYM&&this.layout!=GeometryLayout.XYZM)return null;var extrapolate=void 0!==opt_extrapolate&&opt_extrapolate;return lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,m,extrapolate)},LineString.prototype.getCoordinates=function(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LineString.prototype.getCoordinateAt=function(fraction,opt_dest){return interpolatePoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,fraction,opt_dest)},LineString.prototype.getLength=function(){return lineStringLength(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LineString.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},LineString.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[];return simplifiedFlatCoordinates.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,squaredTolerance,simplifiedFlatCoordinates,0),new LineString(simplifiedFlatCoordinates,GeometryLayout.XY)},LineString.prototype.getType=function(){return GeometryType.LINE_STRING},LineString.prototype.intersectsExtent=function(extent){return intersectsLineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,extent)},LineString.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,coordinates,this.stride),this.changed()},LineString}(SimpleGeometry),MultiLineString=function(SimpleGeometry$$1){function MultiLineString(coordinates,opt_layout,opt_ends){if(SimpleGeometry$$1.call(this),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(coordinates[0]))this.setCoordinates(coordinates,opt_layout);else if(void 0!==opt_layout&&opt_ends)this.setFlatCoordinates(opt_layout,coordinates),this.ends_=opt_ends;else{for(var layout=this.getLayout(),lineStrings=coordinates,flatCoordinates=[],ends=[],i=0,ii=lineStrings.length;i<ii;++i){var lineString=lineStrings[i];0===i&&(layout=lineString.getLayout()),extend(flatCoordinates,lineString.getFlatCoordinates()),ends.push(flatCoordinates.length)}this.setFlatCoordinates(layout,flatCoordinates),this.ends_=ends}}return SimpleGeometry$$1&&(MultiLineString.__proto__=SimpleGeometry$$1),MultiLineString.prototype=Object.create(SimpleGeometry$$1&&SimpleGeometry$$1.prototype),MultiLineString.prototype.constructor=MultiLineString,MultiLineString.prototype.appendLineString=function(lineString){this.flatCoordinates?extend(this.flatCoordinates,lineString.getFlatCoordinates().slice()):this.flatCoordinates=lineString.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},MultiLineString.prototype.clone=function(){return new MultiLineString(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},MultiLineString.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,x,y,closestPoint,minSquaredDistance))},MultiLineString.prototype.getCoordinateAtM=function(m,opt_extrapolate,opt_interpolate){if(this.layout!=GeometryLayout.XYM&&this.layout!=GeometryLayout.XYZM||0===this.flatCoordinates.length)return null;var extrapolate=void 0!==opt_extrapolate&&opt_extrapolate,interpolate=void 0!==opt_interpolate&&opt_interpolate;return lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,m,extrapolate,interpolate)},MultiLineString.prototype.getCoordinates=function(){return inflateCoordinatesArray(this.flatCoordinates,0,this.ends_,this.stride)},MultiLineString.prototype.getEnds=function(){return this.ends_},MultiLineString.prototype.getLineString=function(index){return index<0||this.ends_.length<=index?null:new LineString(this.flatCoordinates.slice(0===index?0:this.ends_[index-1],this.ends_[index]),this.layout)},MultiLineString.prototype.getLineStrings=function(){for(var flatCoordinates=this.flatCoordinates,ends=this.ends_,layout=this.layout,lineStrings=[],offset=0,i=0,ii=ends.length;i<ii;++i){var end=ends[i],lineString=new LineString(flatCoordinates.slice(offset,end),layout);lineStrings.push(lineString),offset=end}return lineStrings},MultiLineString.prototype.getFlatMidpoints=function(){for(var midpoints=[],flatCoordinates=this.flatCoordinates,offset=0,ends=this.ends_,stride=this.stride,i=0,ii=ends.length;i<ii;++i){var end=ends[i];extend(midpoints,interpolatePoint(flatCoordinates,offset,end,stride,.5)),offset=end}return midpoints},MultiLineString.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[],simplifiedEnds=[];return simplifiedFlatCoordinates.length=douglasPeuckerArray(this.flatCoordinates,0,this.ends_,this.stride,squaredTolerance,simplifiedFlatCoordinates,0,simplifiedEnds),new MultiLineString(simplifiedFlatCoordinates,GeometryLayout.XY,simplifiedEnds)},MultiLineString.prototype.getType=function(){return GeometryType.MULTI_LINE_STRING},MultiLineString.prototype.intersectsExtent=function(extent){return intersectsLineStringArray(this.flatCoordinates,0,this.ends_,this.stride,extent)},MultiLineString.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,2),this.flatCoordinates||(this.flatCoordinates=[]);var ends=deflateCoordinatesArray(this.flatCoordinates,0,coordinates,this.stride,this.ends_);this.flatCoordinates.length=0===ends.length?0:ends[ends.length-1],this.changed()},MultiLineString}(SimpleGeometry),MultiPoint=function(SimpleGeometry$$1){function MultiPoint(coordinates,opt_layout){SimpleGeometry$$1.call(this),opt_layout&&!Array.isArray(coordinates[0])?this.setFlatCoordinates(opt_layout,coordinates):this.setCoordinates(coordinates,opt_layout)}return SimpleGeometry$$1&&(MultiPoint.__proto__=SimpleGeometry$$1),MultiPoint.prototype=Object.create(SimpleGeometry$$1&&SimpleGeometry$$1.prototype),MultiPoint.prototype.constructor=MultiPoint,MultiPoint.prototype.appendPoint=function(point){this.flatCoordinates?extend(this.flatCoordinates,point.getFlatCoordinates()):this.flatCoordinates=point.getFlatCoordinates().slice(),this.changed()},MultiPoint.prototype.clone=function(){return new MultiPoint(this.flatCoordinates.slice(),this.layout)},MultiPoint.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){if(minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y))return minSquaredDistance;for(var flatCoordinates=this.flatCoordinates,stride=this.stride,i=0,ii=flatCoordinates.length;i<ii;i+=stride){var squaredDistance$$1=squaredDistance(x,y,flatCoordinates[i],flatCoordinates[i+1]);if(squaredDistance$$1<minSquaredDistance){minSquaredDistance=squaredDistance$$1;for(var j=0;j<stride;++j)closestPoint[j]=flatCoordinates[i+j];closestPoint.length=stride}}return minSquaredDistance},MultiPoint.prototype.getCoordinates=function(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},MultiPoint.prototype.getPoint=function(index){var n=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return index<0||n<=index?null:new Point(this.flatCoordinates.slice(index*this.stride,(index+1)*this.stride),this.layout)},MultiPoint.prototype.getPoints=function(){for(var flatCoordinates=this.flatCoordinates,layout=this.layout,stride=this.stride,points=[],i=0,ii=flatCoordinates.length;i<ii;i+=stride){var point=new Point(flatCoordinates.slice(i,i+stride),layout);points.push(point)}return points},MultiPoint.prototype.getType=function(){return GeometryType.MULTI_POINT},MultiPoint.prototype.intersectsExtent=function(extent){for(var flatCoordinates=this.flatCoordinates,stride=this.stride,i=0,ii=flatCoordinates.length;i<ii;i+=stride){if(containsXY(extent,flatCoordinates[i],flatCoordinates[i+1]))return!0}return!1},MultiPoint.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,coordinates,this.stride),this.changed()},MultiPoint}(SimpleGeometry);function linearRingss$1(flatCoordinates,offset,endss,stride){for(var flatCenters=[],extent=createEmpty(),i=0,ii=endss.length;i<ii;++i){var ends=endss[i];extent=createOrUpdateFromFlatCoordinates(flatCoordinates,offset,ends[0],stride),flatCenters.push((extent[0]+extent[2])/2,(extent[1]+extent[3])/2),offset=ends[ends.length-1]}return flatCenters}var MultiPolygon=function(SimpleGeometry$$1){function MultiPolygon(coordinates,opt_layout,opt_endss){if(SimpleGeometry$$1.call(this),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!opt_endss&&!Array.isArray(coordinates[0])){for(var layout=this.getLayout(),polygons=coordinates,flatCoordinates=[],endss=[],i=0,ii=polygons.length;i<ii;++i){var polygon=polygons[i];0===i&&(layout=polygon.getLayout());for(var offset=flatCoordinates.length,ends=polygon.getEnds(),j=0,jj=ends.length;j<jj;++j)ends[j]+=offset;extend(flatCoordinates,polygon.getFlatCoordinates()),endss.push(ends)}opt_layout=layout,coordinates=flatCoordinates,opt_endss=endss}void 0!==opt_layout&&opt_endss?(this.setFlatCoordinates(opt_layout,coordinates),this.endss_=opt_endss):this.setCoordinates(coordinates,opt_layout)}return SimpleGeometry$$1&&(MultiPolygon.__proto__=SimpleGeometry$$1),MultiPolygon.prototype=Object.create(SimpleGeometry$$1&&SimpleGeometry$$1.prototype),MultiPolygon.prototype.constructor=MultiPolygon,MultiPolygon.prototype.appendPolygon=function(polygon){var ends;if(this.flatCoordinates){var offset=this.flatCoordinates.length;extend(this.flatCoordinates,polygon.getFlatCoordinates());for(var i=0,ii=(ends=polygon.getEnds().slice()).length;i<ii;++i)ends[i]+=offset}else this.flatCoordinates=polygon.getFlatCoordinates().slice(),ends=polygon.getEnds().slice(),this.endss_.push();this.endss_.push(ends),this.changed()},MultiPolygon.prototype.clone=function(){for(var len=this.endss_.length,newEndss=new Array(len),i=0;i<len;++i)newEndss[i]=this.endss_[i].slice();return new MultiPolygon(this.flatCoordinates.slice(),this.layout,newEndss)},MultiPolygon.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(multiArrayMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestMultiArrayPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},MultiPolygon.prototype.containsXY=function(x,y){return linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,x,y)},MultiPolygon.prototype.getArea=function(){return linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},MultiPolygon.prototype.getCoordinates=function(opt_right){var flatCoordinates;return void 0!==opt_right?orientLinearRingsArray(flatCoordinates=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,opt_right):flatCoordinates=this.flatCoordinates,inflateMultiCoordinatesArray(flatCoordinates,0,this.endss_,this.stride)},MultiPolygon.prototype.getEndss=function(){return this.endss_},MultiPolygon.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var flatCenters=linearRingss$1(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,flatCenters),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},MultiPolygon.prototype.getInteriorPoints=function(){return new MultiPoint(this.getFlatInteriorPoints().slice(),GeometryLayout.XYM)},MultiPolygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var flatCoordinates=this.flatCoordinates;linearRingsAreOriented(flatCoordinates,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=flatCoordinates:(this.orientedFlatCoordinates_=flatCoordinates.slice(),this.orientedFlatCoordinates_.length=orientLinearRingsArray(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},MultiPolygon.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[],simplifiedEndss=[];return simplifiedFlatCoordinates.length=quantizeMultiArray(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(squaredTolerance),simplifiedFlatCoordinates,0,simplifiedEndss),new MultiPolygon(simplifiedFlatCoordinates,GeometryLayout.XY,simplifiedEndss)},MultiPolygon.prototype.getPolygon=function(index){if(index<0||this.endss_.length<=index)return null;var offset;if(0===index)offset=0;else{var prevEnds=this.endss_[index-1];offset=prevEnds[prevEnds.length-1]}var ends=this.endss_[index].slice(),end=ends[ends.length-1];if(0!==offset)for(var i=0,ii=ends.length;i<ii;++i)ends[i]-=offset;return new Polygon(this.flatCoordinates.slice(offset,end),this.layout,ends)},MultiPolygon.prototype.getPolygons=function(){for(var layout=this.layout,flatCoordinates=this.flatCoordinates,endss=this.endss_,polygons=[],offset=0,i=0,ii=endss.length;i<ii;++i){var ends=endss[i].slice(),end=ends[ends.length-1];if(0!==offset)for(var j=0,jj=ends.length;j<jj;++j)ends[j]-=offset;var polygon=new Polygon(flatCoordinates.slice(offset,end),layout,ends);polygons.push(polygon),offset=end}return polygons},MultiPolygon.prototype.getType=function(){return GeometryType.MULTI_POLYGON},MultiPolygon.prototype.intersectsExtent=function(extent){return intersectsLinearRingMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,extent)},MultiPolygon.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,3),this.flatCoordinates||(this.flatCoordinates=[]);var endss=deflateMultiCoordinatesArray(this.flatCoordinates,0,coordinates,this.stride,this.endss_);if(0===endss.length)this.flatCoordinates.length=0;else{var lastEnds=endss[endss.length-1];this.flatCoordinates.length=0===lastEnds.length?0:lastEnds[lastEnds.length-1]}this.changed()},MultiPolygon}(SimpleGeometry),LayerType={IMAGE:"IMAGE",TILE:"TILE",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR"},VectorRenderType={IMAGE:"image",VECTOR:"vector"},HEX_COLOR_RE_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,NAMED_COLOR_RE_=/^([a-z]*)$/i;function asString(color){return"string"==typeof color?color:toString(color)}function fromNamed(color){var el=document.createElement("div");if(el.style.color=color,""!==el.style.color){document.body.appendChild(el);var rgb=getComputedStyle(el).color;return document.body.removeChild(el),rgb}return""}var fromString=function(){var cache={},cacheSize=0;return function(s){var color;if(cache.hasOwnProperty(s))color=cache[s];else{if(cacheSize>=1024){var i=0;for(var key in cache)0==(3&i++)&&(delete cache[key],--cacheSize)}color=fromStringInternal_(s),cache[s]=color,++cacheSize}return color}}();function asArray(color){return Array.isArray(color)?color:fromString(color)}function fromStringInternal_(s){var r,g,b,a,color;if(NAMED_COLOR_RE_.exec(s)&&(s=fromNamed(s)),HEX_COLOR_RE_.exec(s)){var d,n=s.length-1;d=n<=4?1:2;var hasAlpha=4===n||8===n;r=parseInt(s.substr(1+0*d,d),16),g=parseInt(s.substr(1+1*d,d),16),b=parseInt(s.substr(1+2*d,d),16),a=hasAlpha?parseInt(s.substr(1+3*d,d),16):255,1==d&&(r=(r<<4)+r,g=(g<<4)+g,b=(b<<4)+b,hasAlpha&&(a=(a<<4)+a)),color=[r,g,b,a/255]}else 0==s.indexOf("rgba(")?normalize(color=s.slice(5,-1).split(",").map(Number)):0==s.indexOf("rgb(")?((color=s.slice(4,-1).split(",").map(Number)).push(1),normalize(color)):assert(!1,14);return color}function normalize(color){return color[0]=clamp(color[0]+.5|0,0,255),color[1]=clamp(color[1]+.5|0,0,255),color[2]=clamp(color[2]+.5|0,0,255),color[3]=clamp(color[3],0,1),color}function toString(color){var r=color[0];r!=(0|r)&&(r=r+.5|0);var g=color[1];g!=(0|g)&&(g=g+.5|0);var b=color[2];return b!=(0|b)&&(b=b+.5|0),"rgba("+r+","+g+","+b+","+(void 0===color[3]?1:color[3])+")"}function asColorLike(color){return Array.isArray(color)?toString(color):color}var ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3},LRUCache=function(EventTarget){function LRUCache(opt_highWaterMark){EventTarget.call(this),this.highWaterMark=void 0!==opt_highWaterMark?opt_highWaterMark:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return EventTarget&&(LRUCache.__proto__=EventTarget),LRUCache.prototype=Object.create(EventTarget&&EventTarget.prototype),LRUCache.prototype.constructor=LRUCache,LRUCache.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},LRUCache.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(EventType.CLEAR)},LRUCache.prototype.containsKey=function(key){return this.entries_.hasOwnProperty(key)},LRUCache.prototype.forEach=function(f,opt_this){for(var entry=this.oldest_;entry;)f.call(opt_this,entry.value_,entry.key_,this),entry=entry.newer},LRUCache.prototype.get=function(key){var entry=this.entries_[key];return assert(void 0!==entry,15),entry===this.newest_?entry.value_:(entry===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(entry.newer.older=entry.older,entry.older.newer=entry.newer),entry.newer=null,entry.older=this.newest_,this.newest_.newer=entry,this.newest_=entry,entry.value_)},LRUCache.prototype.remove=function(key){var entry=this.entries_[key];return assert(void 0!==entry,15),entry===this.newest_?(this.newest_=entry.older,this.newest_&&(this.newest_.newer=null)):entry===this.oldest_?(this.oldest_=entry.newer,this.oldest_&&(this.oldest_.older=null)):(entry.newer.older=entry.older,entry.older.newer=entry.newer),delete this.entries_[key],--this.count_,entry.value_},LRUCache.prototype.getCount=function(){return this.count_},LRUCache.prototype.getKeys=function(){var entry,keys=new Array(this.count_),i=0;for(entry=this.newest_;entry;entry=entry.older)keys[i++]=entry.key_;return keys},LRUCache.prototype.getValues=function(){var entry,values=new Array(this.count_),i=0;for(entry=this.newest_;entry;entry=entry.older)values[i++]=entry.value_;return values},LRUCache.prototype.peekLast=function(){return this.oldest_.value_},LRUCache.prototype.peekLastKey=function(){return this.oldest_.key_},LRUCache.prototype.peekFirstKey=function(){return this.newest_.key_},LRUCache.prototype.pop=function(){var entry=this.oldest_;return delete this.entries_[entry.key_],entry.newer&&(entry.newer.older=null),this.oldest_=entry.newer,this.oldest_||(this.newest_=null),--this.count_,entry.value_},LRUCache.prototype.replace=function(key,value){this.get(key),this.entries_[key].value_=value},LRUCache.prototype.set=function(key,value){assert(!(key in this.entries_),16);var entry={key_:key,newer:null,older:this.newest_,value_:value};this.newest_?this.newest_.newer=entry:this.oldest_=entry,this.newest_=entry,this.entries_[key]=entry,++this.count_},LRUCache.prototype.setSize=function(size){this.highWaterMark=size},LRUCache.prototype.prune=function(){for(;this.canExpireCache();)this.pop()},LRUCache}(Target),defaultFont="10px sans-serif",defaultFillStyle=[0,0,0,1],defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle=[0,0,0,1],defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,labelCache=new LRUCache,checkedFonts={},measureContext=null,textHeights={},checkFont=function(){var interval,referenceWidth,retries=60,checked=checkedFonts,size="32px ",referenceFonts=["monospace","serif"],len=referenceFonts.length,text="wmytzilWMYTZIL@#/&?$%10";function isAvailable(font){for(var context=getMeasureContext(),weight=100;weight<=700;weight+=300){for(var fontWeight=weight+" ",available=!0,i=0;i<len;++i){var referenceFont=referenceFonts[i];if(context.font=fontWeight+size+referenceFont,referenceWidth=context.measureText(text).width,font!=referenceFont){context.font=fontWeight+size+font+","+referenceFont;var width=context.measureText(text).width;available=available&&width!=referenceWidth}}if(available)return!0}return!1}function check(){var done=!0;for(var font in checked)checked[font]<retries&&(isAvailable(font)?(checked[font]=retries,clear(textHeights),measureContext=null,labelCache.clear()):(++checked[font],done=!1));done&&(clearInterval(interval),interval=void 0)}return function(fontSpec){var fontFamilies=getFontFamilies(fontSpec);if(fontFamilies)for(var i=0,ii=fontFamilies.length;i<ii;++i){var fontFamily=fontFamilies[i];fontFamily in checked||(checked[fontFamily]=retries,isAvailable(fontFamily)||(checked[fontFamily]=0,void 0===interval&&(interval=setInterval(check,32))))}}}();function getMeasureContext(){return measureContext||(measureContext=createCanvasContext2D(1,1)),measureContext}var measureTextHeight=function(){var span,heights=textHeights;return function(font){var height=heights[font];return null==height&&(span||((span=document.createElement("span")).textContent="M",span.style.margin=span.style.padding="0 !important",span.style.position="absolute !important",span.style.left="-99999px !important"),span.style.font=font,document.body.appendChild(span),height=heights[font]=span.offsetHeight,document.body.removeChild(span)),height}}();function measureTextWidth(font,text){var measureContext=getMeasureContext();return font!=measureContext.font&&(measureContext.font=font),measureContext.measureText(text).width}function rotateAtOffset(context,rotation,offsetX,offsetY){0!==rotation&&(context.translate(offsetX,offsetY),context.rotate(rotation),context.translate(-offsetX,-offsetY))}var resetTransform=create();function drawImage(context,transform,opacity,image,originX,originY,w,h,x,y,scale){var alpha;1!=opacity&&(alpha=context.globalAlpha,context.globalAlpha=alpha*opacity),transform&&context.setTransform.apply(context,transform),context.drawImage(image,originX,originY,w,h,x,y,w*scale,h*scale),alpha&&(context.globalAlpha=alpha),transform&&context.setTransform.apply(context,resetTransform)}var ImageStyle=function(options){this.opacity_=options.opacity,this.rotateWithView_=options.rotateWithView,this.rotation_=options.rotation,this.scale_=options.scale};ImageStyle.prototype.clone=function(){return new ImageStyle({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},ImageStyle.prototype.getOpacity=function(){return this.opacity_},ImageStyle.prototype.getRotateWithView=function(){return this.rotateWithView_},ImageStyle.prototype.getRotation=function(){return this.rotation_},ImageStyle.prototype.getScale=function(){return this.scale_},ImageStyle.prototype.getSnapToPixel=function(){return!1},ImageStyle.prototype.getAnchor=function(){return abstract()},ImageStyle.prototype.getImage=function(pixelRatio){return abstract()},ImageStyle.prototype.getHitDetectionImage=function(pixelRatio){return abstract()},ImageStyle.prototype.getImageState=function(){return abstract()},ImageStyle.prototype.getImageSize=function(){return abstract()},ImageStyle.prototype.getHitDetectionImageSize=function(){return abstract()},ImageStyle.prototype.getOrigin=function(){return abstract()},ImageStyle.prototype.getSize=function(){return abstract()},ImageStyle.prototype.setOpacity=function(opacity){this.opacity_=opacity},ImageStyle.prototype.setRotateWithView=function(rotateWithView){this.rotateWithView_=rotateWithView},ImageStyle.prototype.setRotation=function(rotation){this.rotation_=rotation},ImageStyle.prototype.setScale=function(scale){this.scale_=scale},ImageStyle.prototype.setSnapToPixel=function(snapToPixel){},ImageStyle.prototype.listenImageChange=function(listener,thisArg){return abstract()},ImageStyle.prototype.load=function(){abstract()},ImageStyle.prototype.unlistenImageChange=function(listener,thisArg){abstract()};var RegularShape=function(ImageStyle$$1){function RegularShape(options){var rotateWithView=void 0!==options.rotateWithView&&options.rotateWithView;ImageStyle$$1.call(this,{opacity:1,rotateWithView:rotateWithView,rotation:void 0!==options.rotation?options.rotation:0,scale:1}),this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=void 0!==options.fill?options.fill:null,this.origin_=[0,0],this.points_=options.points,this.radius_=void 0!==options.radius?options.radius:options.radius1,this.radius2_=options.radius2,this.angle_=void 0!==options.angle?options.angle:0,this.stroke_=void 0!==options.stroke?options.stroke:null,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=options.atlasManager,this.render_(this.atlasManager_)}return ImageStyle$$1&&(RegularShape.__proto__=ImageStyle$$1),RegularShape.prototype=Object.create(ImageStyle$$1&&ImageStyle$$1.prototype),RegularShape.prototype.constructor=RegularShape,RegularShape.prototype.clone=function(){var style=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return style.setOpacity(this.getOpacity()),style.setScale(this.getScale()),style},RegularShape.prototype.getAnchor=function(){return this.anchor_},RegularShape.prototype.getAngle=function(){return this.angle_},RegularShape.prototype.getFill=function(){return this.fill_},RegularShape.prototype.getHitDetectionImage=function(pixelRatio){return this.hitDetectionCanvas_},RegularShape.prototype.getImage=function(pixelRatio){return this.canvas_},RegularShape.prototype.getImageSize=function(){return this.imageSize_},RegularShape.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},RegularShape.prototype.getImageState=function(){return ImageState.LOADED},RegularShape.prototype.getOrigin=function(){return this.origin_},RegularShape.prototype.getPoints=function(){return this.points_},RegularShape.prototype.getRadius=function(){return this.radius_},RegularShape.prototype.getRadius2=function(){return this.radius2_},RegularShape.prototype.getSize=function(){return this.size_},RegularShape.prototype.getStroke=function(){return this.stroke_},RegularShape.prototype.listenImageChange=function(listener,thisArg){},RegularShape.prototype.load=function(){},RegularShape.prototype.unlistenImageChange=function(listener,thisArg){},RegularShape.prototype.render_=function(atlasManager){var imageSize,strokeStyle,lineCap="",lineJoin="",miterLimit=0,lineDash=null,lineDashOffset=0,strokeWidth=0;this.stroke_&&(null===(strokeStyle=this.stroke_.getColor())&&(strokeStyle=defaultStrokeStyle),strokeStyle=asColorLike(strokeStyle),void 0===(strokeWidth=this.stroke_.getWidth())&&(strokeWidth=defaultLineWidth),lineDash=this.stroke_.getLineDash(),lineDashOffset=this.stroke_.getLineDashOffset(),CANVAS_LINE_DASH||(lineDash=null,lineDashOffset=0),void 0===(lineJoin=this.stroke_.getLineJoin())&&(lineJoin=defaultLineJoin),void 0===(lineCap=this.stroke_.getLineCap())&&(lineCap=defaultLineCap),void 0===(miterLimit=this.stroke_.getMiterLimit())&&(miterLimit=defaultMiterLimit));var size=2*(this.radius_+strokeWidth)+1,renderOptions={strokeStyle:strokeStyle,strokeWidth:strokeWidth,size:size,lineCap:lineCap,lineDash:lineDash,lineDashOffset:lineDashOffset,lineJoin:lineJoin,miterLimit:miterLimit};if(void 0===atlasManager){var context=createCanvasContext2D(size,size);this.canvas_=context.canvas,imageSize=size=this.canvas_.width,this.draw_(renderOptions,context,0,0),this.createHitDetectionCanvas_(renderOptions)}else{size=Math.round(size);var renderHitDetectionCallback,hasCustomHitDetectionImage=!this.fill_;hasCustomHitDetectionImage&&(renderHitDetectionCallback=this.drawHitDetectionCanvas_.bind(this,renderOptions));var id=this.getChecksum(),info=atlasManager.add(id,size,size,this.draw_.bind(this,renderOptions),renderHitDetectionCallback);this.canvas_=info.image,this.origin_=[info.offsetX,info.offsetY],imageSize=info.image.width,hasCustomHitDetectionImage?(this.hitDetectionCanvas_=info.hitImage,this.hitDetectionImageSize_=[info.hitImage.width,info.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,this.hitDetectionImageSize_=[imageSize,imageSize])}this.anchor_=[size/2,size/2],this.size_=[size,size],this.imageSize_=[imageSize,imageSize]},RegularShape.prototype.draw_=function(renderOptions,context,x,y){var i,angle0,radiusC;context.setTransform(1,0,0,1,0,0),context.translate(x,y),context.beginPath();var points=this.points_;if(points===1/0)context.arc(renderOptions.size/2,renderOptions.size/2,this.radius_,0,2*Math.PI,!0);else{var radius2=void 0!==this.radius2_?this.radius2_:this.radius_;for(radius2!==this.radius_&&(points*=2),i=0;i<=points;i++)angle0=2*i*Math.PI/points-Math.PI/2+this.angle_,radiusC=i%2==0?this.radius_:radius2,context.lineTo(renderOptions.size/2+radiusC*Math.cos(angle0),renderOptions.size/2+radiusC*Math.sin(angle0))}if(this.fill_){var color=this.fill_.getColor();null===color&&(color=defaultFillStyle),context.fillStyle=asColorLike(color),context.fill()}this.stroke_&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.lineCap=renderOptions.lineCap,context.lineJoin=renderOptions.lineJoin,context.miterLimit=renderOptions.miterLimit,context.stroke()),context.closePath()},RegularShape.prototype.createHitDetectionCanvas_=function(renderOptions){if(this.hitDetectionImageSize_=[renderOptions.size,renderOptions.size],this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var context=createCanvasContext2D(renderOptions.size,renderOptions.size);this.hitDetectionCanvas_=context.canvas,this.drawHitDetectionCanvas_(renderOptions,context,0,0)}},RegularShape.prototype.drawHitDetectionCanvas_=function(renderOptions,context,x,y){context.setTransform(1,0,0,1,0,0),context.translate(x,y),context.beginPath();var points=this.points_;if(points===1/0)context.arc(renderOptions.size/2,renderOptions.size/2,this.radius_,0,2*Math.PI,!0);else{var i,radiusC,angle0,radius2=void 0!==this.radius2_?this.radius2_:this.radius_;for(radius2!==this.radius_&&(points*=2),i=0;i<=points;i++)angle0=2*i*Math.PI/points-Math.PI/2+this.angle_,radiusC=i%2==0?this.radius_:radius2,context.lineTo(renderOptions.size/2+radiusC*Math.cos(angle0),renderOptions.size/2+radiusC*Math.sin(angle0))}context.fillStyle=asString(defaultFillStyle),context.fill(),this.stroke_&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.stroke()),context.closePath()},RegularShape.prototype.getChecksum=function(){var strokeChecksum=this.stroke_?this.stroke_.getChecksum():"-",fillChecksum=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||strokeChecksum!=this.checksums_[1]||fillChecksum!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var checksum="r"+strokeChecksum+fillChecksum+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[checksum,strokeChecksum,fillChecksum,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]},RegularShape}(ImageStyle),CircleStyle=function(RegularShape$$1){function CircleStyle(opt_options){var options=opt_options||{};RegularShape$$1.call(this,{points:1/0,fill:options.fill,radius:options.radius,stroke:options.stroke,atlasManager:options.atlasManager})}return RegularShape$$1&&(CircleStyle.__proto__=RegularShape$$1),CircleStyle.prototype=Object.create(RegularShape$$1&&RegularShape$$1.prototype),CircleStyle.prototype.constructor=CircleStyle,CircleStyle.prototype.clone=function(){var style=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),atlasManager:this.atlasManager_});return style.setOpacity(this.getOpacity()),style.setScale(this.getScale()),style},CircleStyle.prototype.setRadius=function(radius){this.radius_=radius,this.render_(this.atlasManager_)},CircleStyle}(RegularShape),Fill=function(opt_options){var options=opt_options||{};this.color_=void 0!==options.color?options.color:null,this.checksum_=void 0};Fill.prototype.clone=function(){var color=this.getColor();return new Fill({color:Array.isArray(color)?color.slice():color||void 0})},Fill.prototype.getColor=function(){return this.color_},Fill.prototype.setColor=function(color){this.color_=color,this.checksum_=void 0},Fill.prototype.getChecksum=function(){if(void 0===this.checksum_){var color=this.color_;color?Array.isArray(color)||"string"==typeof color?this.checksum_="f"+asString(color):this.checksum_=getUid(this.color_):this.checksum_="f-"}return this.checksum_};var Stroke=function(opt_options){var options=opt_options||{};this.color_=void 0!==options.color?options.color:null,this.lineCap_=options.lineCap,this.lineDash_=void 0!==options.lineDash?options.lineDash:null,this.lineDashOffset_=options.lineDashOffset,this.lineJoin_=options.lineJoin,this.miterLimit_=options.miterLimit,this.width_=options.width,this.checksum_=void 0};Stroke.prototype.clone=function(){var color=this.getColor();return new Stroke({color:Array.isArray(color)?color.slice():color||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},Stroke.prototype.getColor=function(){return this.color_},Stroke.prototype.getLineCap=function(){return this.lineCap_},Stroke.prototype.getLineDash=function(){return this.lineDash_},Stroke.prototype.getLineDashOffset=function(){return this.lineDashOffset_},Stroke.prototype.getLineJoin=function(){return this.lineJoin_},Stroke.prototype.getMiterLimit=function(){return this.miterLimit_},Stroke.prototype.getWidth=function(){return this.width_},Stroke.prototype.setColor=function(color){this.color_=color,this.checksum_=void 0},Stroke.prototype.setLineCap=function(lineCap){this.lineCap_=lineCap,this.checksum_=void 0},Stroke.prototype.setLineDash=function(lineDash){this.lineDash_=lineDash,this.checksum_=void 0},Stroke.prototype.setLineDashOffset=function(lineDashOffset){this.lineDashOffset_=lineDashOffset,this.checksum_=void 0},Stroke.prototype.setLineJoin=function(lineJoin){this.lineJoin_=lineJoin,this.checksum_=void 0},Stroke.prototype.setMiterLimit=function(miterLimit){this.miterLimit_=miterLimit,this.checksum_=void 0},Stroke.prototype.setWidth=function(width){this.width_=width,this.checksum_=void 0},Stroke.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_="s",this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=getUid(this.color_):this.checksum_+="-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")),this.checksum_};var Style=function(opt_options){var options=opt_options||{};this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,void 0!==options.geometry&&this.setGeometry(options.geometry),this.fill_=void 0!==options.fill?options.fill:null,this.image_=void 0!==options.image?options.image:null,this.renderer_=void 0!==options.renderer?options.renderer:null,this.stroke_=void 0!==options.stroke?options.stroke:null,this.text_=void 0!==options.text?options.text:null,this.zIndex_=options.zIndex};function toFunction(obj){var styleFunction;if("function"==typeof obj)styleFunction=obj;else{var styles;if(Array.isArray(obj))styles=obj;else assert("function"==typeof obj.getZIndex,41),styles=[obj];styleFunction=function(){return styles}}return styleFunction}Style.prototype.clone=function(){var geometry=this.getGeometry();return geometry&&"object"==typeof geometry&&(geometry=geometry.clone()),new Style({geometry:geometry,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},Style.prototype.getRenderer=function(){return this.renderer_},Style.prototype.setRenderer=function(renderer){this.renderer_=renderer},Style.prototype.getGeometry=function(){return this.geometry_},Style.prototype.getGeometryFunction=function(){return this.geometryFunction_},Style.prototype.getFill=function(){return this.fill_},Style.prototype.setFill=function(fill){this.fill_=fill},Style.prototype.getImage=function(){return this.image_},Style.prototype.setImage=function(image){this.image_=image},Style.prototype.getStroke=function(){return this.stroke_},Style.prototype.setStroke=function(stroke){this.stroke_=stroke},Style.prototype.getText=function(){return this.text_},Style.prototype.setText=function(text){this.text_=text},Style.prototype.getZIndex=function(){return this.zIndex_},Style.prototype.setGeometry=function(geometry){"function"==typeof geometry?this.geometryFunction_=geometry:"string"==typeof geometry?this.geometryFunction_=function(feature){return feature.get(geometry)}:geometry?void 0!==geometry&&(this.geometryFunction_=function(){return geometry}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=geometry},Style.prototype.setZIndex=function(zIndex){this.zIndex_=zIndex};var defaultStyles=null;function createDefaultStyle(feature,resolution){if(!defaultStyles){var fill=new Fill({color:"rgba(255,255,255,0.4)"}),stroke=new Stroke({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new CircleStyle({fill:fill,stroke:stroke,radius:5}),fill:fill,stroke:stroke})]}return defaultStyles}function createEditingStyle(){var styles={},white=[255,255,255,1],blue=[0,153,255,1];return styles[GeometryType.POLYGON]=[new Style({fill:new Fill({color:[255,255,255,.5]})})],styles[GeometryType.MULTI_POLYGON]=styles[GeometryType.POLYGON],styles[GeometryType.LINE_STRING]=[new Style({stroke:new Stroke({color:white,width:5})}),new Style({stroke:new Stroke({color:blue,width:3})})],styles[GeometryType.MULTI_LINE_STRING]=styles[GeometryType.LINE_STRING],styles[GeometryType.CIRCLE]=styles[GeometryType.POLYGON].concat(styles[GeometryType.LINE_STRING]),styles[GeometryType.POINT]=[new Style({image:new CircleStyle({radius:6,fill:new Fill({color:blue}),stroke:new Stroke({color:white,width:1.5})}),zIndex:1/0})],styles[GeometryType.MULTI_POINT]=styles[GeometryType.POINT],styles[GeometryType.GEOMETRY_COLLECTION]=styles[GeometryType.POLYGON].concat(styles[GeometryType.LINE_STRING],styles[GeometryType.POINT]),styles}function defaultGeometryFunction(feature){return feature.getGeometry()}var Property$2={RENDER_ORDER:"renderOrder"},VectorLayer=function(Layer$$1){function VectorLayer(opt_options){var options=opt_options||{},baseOptions=assign({},options);delete baseOptions.style,delete baseOptions.renderBuffer,delete baseOptions.updateWhileAnimating,delete baseOptions.updateWhileInteracting,Layer$$1.call(this,baseOptions),this.declutter_=void 0!==options.declutter&&options.declutter,this.renderBuffer_=void 0!==options.renderBuffer?options.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(options.style),this.updateWhileAnimating_=void 0!==options.updateWhileAnimating&&options.updateWhileAnimating,this.updateWhileInteracting_=void 0!==options.updateWhileInteracting&&options.updateWhileInteracting,this.renderMode_=options.renderMode||VectorRenderType.VECTOR,this.type=LayerType.VECTOR}return Layer$$1&&(VectorLayer.__proto__=Layer$$1),VectorLayer.prototype=Object.create(Layer$$1&&Layer$$1.prototype),VectorLayer.prototype.constructor=VectorLayer,VectorLayer.prototype.getDeclutter=function(){return this.declutter_},VectorLayer.prototype.setDeclutter=function(declutter){this.declutter_=declutter},VectorLayer.prototype.getRenderBuffer=function(){return this.renderBuffer_},VectorLayer.prototype.getRenderOrder=function(){return this.get(Property$2.RENDER_ORDER)},VectorLayer.prototype.getStyle=function(){return this.style_},VectorLayer.prototype.getStyleFunction=function(){return this.styleFunction_},VectorLayer.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},VectorLayer.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},VectorLayer.prototype.setRenderOrder=function(renderOrder){this.set(Property$2.RENDER_ORDER,renderOrder)},VectorLayer.prototype.setStyle=function(style){this.style_=void 0!==style?style:createDefaultStyle,this.styleFunction_=null===style?void 0:toFunction(this.style_),this.changed()},VectorLayer.prototype.getRenderMode=function(){return this.renderMode_},VectorLayer}(Layer);VectorLayer.prototype.getSource;var FormatType={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function loadFeaturesXhr(url,format,success,failure){return function(extent,resolution,projection){var xhr=new XMLHttpRequest;xhr.open("GET","function"==typeof url?url(extent,resolution,projection):url,!0),format.getType()==FormatType.ARRAY_BUFFER&&(xhr.responseType="arraybuffer"),xhr.onload=function(event){if(!xhr.status||xhr.status>=200&&xhr.status<300){var source,type=format.getType();type==FormatType.JSON||type==FormatType.TEXT?source=xhr.responseText:type==FormatType.XML?(source=xhr.responseXML)||(source=(new DOMParser).parseFromString(xhr.responseText,"application/xml")):type==FormatType.ARRAY_BUFFER&&(source=xhr.response),source?success.call(this,format.readFeatures(source,{featureProjection:projection}),format.readProjection(source),format.getLastExtent()):failure.call(this)}else failure.call(this)}.bind(this),xhr.onerror=function(){failure.call(this)}.bind(this),xhr.send()}}function xhr(url,format){return loadFeaturesXhr(url,format,function(features,dataProjection){"function"==typeof this.addFeatures&&this.addFeatures(features)},VOID)}function all(extent,resolution){return[[-1/0,-1/0,1/0,1/0]]}var Source=function(BaseObject$$1){function Source(options){BaseObject$$1.call(this),this.projection_=get$2(options.projection),this.attributions_=adaptAttributions(options.attributions),this.attributionsCollapsible_=void 0===options.attributionsCollapsible||options.attributionsCollapsible,this.loading=!1,this.state_=void 0!==options.state?options.state:SourceState.READY,this.wrapX_=void 0!==options.wrapX&&options.wrapX}return BaseObject$$1&&(Source.__proto__=BaseObject$$1),Source.prototype=Object.create(BaseObject$$1&&BaseObject$$1.prototype),Source.prototype.constructor=Source,Source.prototype.getAttributions=function(){return this.attributions_},Source.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},Source.prototype.getProjection=function(){return this.projection_},Source.prototype.getResolutions=function(){return abstract()},Source.prototype.getState=function(){return this.state_},Source.prototype.getWrapX=function(){return this.wrapX_},Source.prototype.refresh=function(){this.changed()},Source.prototype.setAttributions=function(attributions){this.attributions_=adaptAttributions(attributions),this.changed()},Source.prototype.setState=function(state){this.state_=state,this.changed()},Source}(BaseObject);function adaptAttributions(attributionLike){return attributionLike?Array.isArray(attributionLike)?function(frameState){return attributionLike}:"function"==typeof attributionLike?attributionLike:function(frameState){return[attributionLike]}:null}var VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}var quickselect=createCommonjsModule(function(module,exports){module.exports=function(){function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}return function(arr,k,left,right,compare){!function quickselectStep(arr,k,left,right,compare){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1),newLeft=Math.max(left,Math.floor(k-m*s/n+sd)),newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));quickselectStep(arr,k,newLeft,newRight,compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}}()}),rbush_1=rbush,default_1=rbush;function rbush(maxEntries,format){if(!(this instanceof rbush))return new rbush(maxEntries,format);this._maxEntries=Math.max(4,maxEntries||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),format&&this._initFormat(format),this.clear()}function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(var i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){destNode||(destNode=createNode(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(var child,i=k;i<p;i++)child=node.children[i],extend$2(destNode,node.leaf?toBBox(child):child);return destNode}function extend$2(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function enlargedArea(a,b){return(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))}function intersectionArea(a,b){var minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects$1(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children:children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(arr,left,right,n,compare){for(var mid,stack=[left,right];stack.length;)(right=stack.pop())-(left=stack.pop())<=n||(mid=left+Math.ceil((right-left)/n/2)*n,quickselect(arr,mid,left,right,compare),stack.push(left,mid,mid,right))}rbush.prototype={all:function(){return this._all(this.data,[])},search:function(bbox){var node=this.data,result=[],toBBox=this.toBBox;if(!intersects$1(bbox,node))return result;for(var i,len,child,childBBox,nodesToSearch=[];node;){for(i=0,len=node.children.length;i<len;i++)child=node.children[i],intersects$1(bbox,childBBox=node.leaf?toBBox(child):child)&&(node.leaf?result.push(child):contains(bbox,childBBox)?this._all(child,result):nodesToSearch.push(child));node=nodesToSearch.pop()}return result},collides:function(bbox){var node=this.data,toBBox=this.toBBox;if(!intersects$1(bbox,node))return!1;for(var i,len,child,childBBox,nodesToSearch=[];node;){for(i=0,len=node.children.length;i<len;i++)if(child=node.children[i],intersects$1(bbox,childBBox=node.leaf?toBBox(child):child)){if(node.leaf||contains(bbox,childBBox))return!0;nodesToSearch.push(child)}node=nodesToSearch.pop()}return!1},load:function(data){if(!data||!data.length)return this;if(data.length<this._minEntries){for(var i=0,len=data.length;i<len;i++)this.insert(data[i]);return this}var node=this._build(data.slice(),0,data.length-1,0);if(this.data.children.length)if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}else this.data=node;return this},insert:function(item){return item&&this._insert(item,this.data.height-1),this},clear:function(){return this.data=createNode([]),this},remove:function(item,equalsFn){if(!item)return this;for(var i,parent,index,goingUp,node=this.data,bbox=this.toBBox(item),path=[],indexes=[];node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf&&-1!==(index=findItem(item,node.children,equalsFn)))return node.children.splice(index,1),path.push(node),this._condense(path),this;goingUp||node.leaf||!contains(node,bbox)?parent?(i++,node=parent.children[i],goingUp=!1):node=null:(path.push(node),indexes.push(i),i=0,parent=node,node=node.children[0])}return this},toBBox:function(item){return item},compareMinX:compareNodeMinX,compareMinY:compareNodeMinY,toJSON:function(){return this.data},fromJSON:function(data){return this.data=data,this},_all:function(node,result){for(var nodesToSearch=[];node;)node.leaf?result.push.apply(result,node.children):nodesToSearch.push.apply(nodesToSearch,node.children),node=nodesToSearch.pop();return result},_build:function(items,left,right,height){var node,N=right-left+1,M=this._maxEntries;if(N<=M)return calcBBox(node=createNode(items.slice(left,right+1)),this.toBBox),node;height||(height=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height-1))),(node=createNode([])).leaf=!1,node.height=height;var i,j,right2,right3,N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M));for(multiSelect(items,left,right,N1,this.compareMinX),i=left;i<=right;i+=N1)for(multiSelect(items,i,right2=Math.min(i+N1-1,right),N2,this.compareMinY),j=i;j<=right2;j+=N2)right3=Math.min(j+N2-1,right2),node.children.push(this._build(items,j,right3,height-1));return calcBBox(node,this.toBBox),node},_chooseSubtree:function(bbox,node,level,path){for(var i,len,child,targetNode,area,enlargement,minArea,minEnlargement;path.push(node),!node.leaf&&path.length-1!==level;){for(minArea=minEnlargement=1/0,i=0,len=node.children.length;i<len;i++)area=bboxArea(child=node.children[i]),(enlargement=enlargedArea(bbox,child)-area)<minEnlargement?(minEnlargement=enlargement,minArea=area<minArea?area:minArea,targetNode=child):enlargement===minEnlargement&&area<minArea&&(minArea=area,targetNode=child);node=targetNode||node.children[0]}return node},_insert:function(item,level,isNode){var toBBox=this.toBBox,bbox=isNode?item:toBBox(item),insertPath=[],node=this._chooseSubtree(bbox,this.data,level,insertPath);for(node.children.push(item),extend$2(node,bbox);level>=0&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox,insertPath,level)},_split:function(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox(node,this.toBBox),calcBBox(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)},_splitRoot:function(node,newNode){this.data=createNode([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)},_chooseSplitIndex:function(node,m,M){var i,bbox1,bbox2,overlap,area,minOverlap,minArea,index;for(minOverlap=minArea=1/0,i=m;i<=M-m;i++)overlap=intersectionArea(bbox1=distBBox(node,0,i,this.toBBox),bbox2=distBBox(node,i,M,this.toBBox)),area=bboxArea(bbox1)+bboxArea(bbox2),overlap<minOverlap?(minOverlap=overlap,index=i,minArea=area<minArea?area:minArea):overlap===minOverlap&&area<minArea&&(minArea=area,index=i);return index},_chooseSplitAxis:function(node,m,M){var compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(node,m,M,compareMinX)<this._allDistMargin(node,m,M,compareMinY)&&node.children.sort(compareMinX)},_allDistMargin:function(node,m,M,compare){node.children.sort(compare);var i,child,toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox),margin=bboxMargin(leftBBox)+bboxMargin(rightBBox);for(i=m;i<M-m;i++)child=node.children[i],extend$2(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(leftBBox);for(i=M-m-1;i>=m;i--)child=node.children[i],extend$2(rightBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(rightBBox);return margin},_adjustParentBBoxes:function(bbox,path,level){for(var i=level;i>=0;i--)extend$2(path[i],bbox)},_condense:function(path){for(var siblings,i=path.length-1;i>=0;i--)0===path[i].children.length?i>0?(siblings=path[i-1].children).splice(siblings.indexOf(path[i]),1):this.clear():calcBBox(path[i],this.toBBox)},_initFormat:function(format){var compareArr=["return a"," - b",";"];this.compareMinX=new Function("a","b",compareArr.join(format[0])),this.compareMinY=new Function("a","b",compareArr.join(format[1])),this.toBBox=new Function("a","return {minX: a"+format[0]+", minY: a"+format[1]+", maxX: a"+format[2]+", maxY: a"+format[3]+"};")}},rbush_1.default=default_1;var RBush=function(opt_maxEntries){this.rbush_=rbush_1(opt_maxEntries,void 0),this.items_={}};RBush.prototype.insert=function(extent,value){var item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value:value};this.rbush_.insert(item),this.items_[getUid(value)]=item},RBush.prototype.load=function(extents,values){for(var items=new Array(values.length),i=0,l=values.length;i<l;i++){var extent=extents[i],value=values[i],item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value:value};items[i]=item,this.items_[getUid(value)]=item}this.rbush_.load(items)},RBush.prototype.remove=function(value){var uid=getUid(value),item=this.items_[uid];return delete this.items_[uid],null!==this.rbush_.remove(item)},RBush.prototype.update=function(extent,value){var item=this.items_[getUid(value)];equals$2([item.minX,item.minY,item.maxX,item.maxY],extent)||(this.remove(value),this.insert(extent,value))},RBush.prototype.getAll=function(){return this.rbush_.all().map(function(item){return item.value})},RBush.prototype.getInExtent=function(extent){var bbox={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3]};return this.rbush_.search(bbox).map(function(item){return item.value})},RBush.prototype.forEach=function(callback,opt_this){return this.forEach_(this.getAll(),callback,opt_this)},RBush.prototype.forEachInExtent=function(extent,callback,opt_this){return this.forEach_(this.getInExtent(extent),callback,opt_this)},RBush.prototype.forEach_=function(values,callback,opt_this){for(var result,i=0,l=values.length;i<l;i++)if(result=callback.call(opt_this,values[i]))return result;return result},RBush.prototype.isEmpty=function(){return isEmpty(this.items_)},RBush.prototype.clear=function(){this.rbush_.clear(),this.items_={}},RBush.prototype.getExtent=function(opt_extent){var data=this.rbush_.toJSON();return createOrUpdate(data.minX,data.minY,data.maxX,data.maxY,opt_extent)},RBush.prototype.concat=function(rbush){for(var i in this.rbush_.load(rbush.rbush_.all()),rbush.items_)this.items_[i]=rbush.items_[i]};var VectorSourceEvent=function(Event$$1){function VectorSourceEvent(type,opt_feature){Event$$1.call(this,type),this.feature=opt_feature}return Event$$1&&(VectorSourceEvent.__proto__=Event$$1),VectorSourceEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),VectorSourceEvent.prototype.constructor=VectorSourceEvent,VectorSourceEvent}(Event),VectorSource=function(Source$$1){function VectorSource(opt_options){var options=opt_options||{};Source$$1.call(this,{attributions:options.attributions,projection:void 0,state:SourceState.READY,wrapX:void 0===options.wrapX||options.wrapX}),this.loader_=VOID,this.format_=options.format,this.overlaps_=null==options.overlaps||options.overlaps,this.url_=options.url,void 0!==options.loader?this.loader_=options.loader:void 0!==this.url_&&(assert(this.format_,7),this.loader_=xhr(this.url_,this.format_)),this.strategy_=void 0!==options.strategy?options.strategy:all;var collection,features,useSpatialIndex=void 0===options.useSpatialIndex||options.useSpatialIndex;this.featuresRtree_=useSpatialIndex?new RBush:null,this.loadedExtentsRtree_=new RBush,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(options.features)?features=options.features:options.features&&(features=(collection=options.features).getArray()),useSpatialIndex||void 0!==collection||(collection=new Collection(features)),void 0!==features&&this.addFeaturesInternal(features),void 0!==collection&&this.bindFeaturesCollection_(collection)}return Source$$1&&(VectorSource.__proto__=Source$$1),VectorSource.prototype=Object.create(Source$$1&&Source$$1.prototype),VectorSource.prototype.constructor=VectorSource,VectorSource.prototype.addFeature=function(feature){this.addFeatureInternal(feature),this.changed()},VectorSource.prototype.addFeatureInternal=function(feature){var featureKey=getUid(feature);if(this.addToIndex_(featureKey,feature)){this.setupChangeEvents_(featureKey,feature);var geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)}else this.nullGeometryFeatures_[featureKey]=feature;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,feature))}},VectorSource.prototype.setupChangeEvents_=function(featureKey,feature){this.featureChangeKeys_[featureKey]=[listen(feature,EventType.CHANGE,this.handleFeatureChange_,this),listen(feature,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)]},VectorSource.prototype.addToIndex_=function(featureKey,feature){var valid=!0,id=feature.getId();return void 0!==id?id.toString()in this.idIndex_?valid=!1:this.idIndex_[id.toString()]=feature:(assert(!(featureKey in this.undefIdIndex_),30),this.undefIdIndex_[featureKey]=feature),valid},VectorSource.prototype.addFeatures=function(features){this.addFeaturesInternal(features),this.changed()},VectorSource.prototype.addFeaturesInternal=function(features){for(var extents=[],newFeatures=[],geometryFeatures=[],i=0,length=features.length;i<length;i++){var feature=features[i],featureKey=getUid(feature);this.addToIndex_(featureKey,feature)&&newFeatures.push(feature)}for(var i$1=0,length$1=newFeatures.length;i$1<length$1;i$1++){var feature$1=newFeatures[i$1],featureKey$1=getUid(feature$1);this.setupChangeEvents_(featureKey$1,feature$1);var geometry=feature$1.getGeometry();if(geometry){var extent=geometry.getExtent();extents.push(extent),geometryFeatures.push(feature$1)}else this.nullGeometryFeatures_[featureKey$1]=feature$1}this.featuresRtree_&&this.featuresRtree_.load(extents,geometryFeatures);for(var i$2=0,length$2=newFeatures.length;i$2<length$2;i$2++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,newFeatures[i$2]))},VectorSource.prototype.bindFeaturesCollection_=function(collection){var modifyingCollection=!1;listen(this,VectorEventType.ADDFEATURE,function(evt){modifyingCollection||(modifyingCollection=!0,collection.push(evt.feature),modifyingCollection=!1)}),listen(this,VectorEventType.REMOVEFEATURE,function(evt){modifyingCollection||(modifyingCollection=!0,collection.remove(evt.feature),modifyingCollection=!1)}),listen(collection,CollectionEventType.ADD,function(evt){modifyingCollection||(modifyingCollection=!0,this.addFeature(evt.element),modifyingCollection=!1)},this),listen(collection,CollectionEventType.REMOVE,function(evt){modifyingCollection||(modifyingCollection=!0,this.removeFeature(evt.element),modifyingCollection=!1)},this),this.featuresCollection_=collection},VectorSource.prototype.clear=function(opt_fast){if(opt_fast){for(var featureId in this.featureChangeKeys_){this.featureChangeKeys_[featureId].forEach(unlistenByKey)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_)for(var id in this.featuresRtree_.forEach(this.removeFeatureInternal,this),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[id]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.loadedExtentsRtree_.clear(),this.nullGeometryFeatures_={};var clearEvent=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(clearEvent),this.changed()},VectorSource.prototype.forEachFeature=function(callback){if(this.featuresRtree_)return this.featuresRtree_.forEach(callback);this.featuresCollection_&&this.featuresCollection_.forEach(callback)},VectorSource.prototype.forEachFeatureAtCoordinateDirect=function(coordinate,callback){var extent=[coordinate[0],coordinate[1],coordinate[0],coordinate[1]];return this.forEachFeatureInExtent(extent,function(feature){return feature.getGeometry().intersectsCoordinate(coordinate)?callback(feature):void 0})},VectorSource.prototype.forEachFeatureInExtent=function(extent,callback){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(extent,callback);this.featuresCollection_&&this.featuresCollection_.forEach(callback)},VectorSource.prototype.forEachFeatureIntersectingExtent=function(extent,callback){return this.forEachFeatureInExtent(extent,function(feature){if(feature.getGeometry().intersectsExtent(extent)){var result=callback(feature);if(result)return result}})},VectorSource.prototype.getFeaturesCollection=function(){return this.featuresCollection_},VectorSource.prototype.getFeatures=function(){var features;return this.featuresCollection_?features=this.featuresCollection_.getArray():this.featuresRtree_&&(features=this.featuresRtree_.getAll(),isEmpty(this.nullGeometryFeatures_)||extend(features,getValues(this.nullGeometryFeatures_))),features},VectorSource.prototype.getFeaturesAtCoordinate=function(coordinate){var features=[];return this.forEachFeatureAtCoordinateDirect(coordinate,function(feature){features.push(feature)}),features},VectorSource.prototype.getFeaturesInExtent=function(extent){return this.featuresRtree_.getInExtent(extent)},VectorSource.prototype.getClosestFeatureToCoordinate=function(coordinate,opt_filter){var x=coordinate[0],y=coordinate[1],closestFeature=null,closestPoint=[NaN,NaN],minSquaredDistance=1/0,extent=[-1/0,-1/0,1/0,1/0],filter=opt_filter||TRUE;return this.featuresRtree_.forEachInExtent(extent,function(feature){if(filter(feature)){var geometry=feature.getGeometry(),previousMinSquaredDistance=minSquaredDistance;if((minSquaredDistance=geometry.closestPointXY(x,y,closestPoint,minSquaredDistance))<previousMinSquaredDistance){closestFeature=feature;var minDistance=Math.sqrt(minSquaredDistance);extent[0]=x-minDistance,extent[1]=y-minDistance,extent[2]=x+minDistance,extent[3]=y+minDistance}}}),closestFeature},VectorSource.prototype.getExtent=function(opt_extent){return this.featuresRtree_.getExtent(opt_extent)},VectorSource.prototype.getFeatureById=function(id){var feature=this.idIndex_[id.toString()];return void 0!==feature?feature:null},VectorSource.prototype.getFormat=function(){return this.format_},VectorSource.prototype.getOverlaps=function(){return this.overlaps_},VectorSource.prototype.getUrl=function(){return this.url_},VectorSource.prototype.handleFeatureChange_=function(event){var feature=event.target,featureKey=getUid(feature),geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();featureKey in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[featureKey],this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)):this.featuresRtree_&&this.featuresRtree_.update(extent,feature)}else featureKey in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(feature),this.nullGeometryFeatures_[featureKey]=feature);var id=feature.getId();if(void 0!==id){var sid=id.toString();featureKey in this.undefIdIndex_?(delete this.undefIdIndex_[featureKey],this.idIndex_[sid]=feature):this.idIndex_[sid]!==feature&&(this.removeFromIdIndex_(feature),this.idIndex_[sid]=feature)}else featureKey in this.undefIdIndex_||(this.removeFromIdIndex_(feature),this.undefIdIndex_[featureKey]=feature);this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,feature))},VectorSource.prototype.hasFeature=function(feature){var id=feature.getId();return void 0!==id?id in this.idIndex_:getUid(feature)in this.undefIdIndex_},VectorSource.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&isEmpty(this.nullGeometryFeatures_)},VectorSource.prototype.loadFeatures=function(extent,resolution,projection){var this$1=this,loadedExtentsRtree=this.loadedExtentsRtree_,extentsToLoad=this.strategy_(extent,resolution);this.loading=!1;for(var loop=function(i,ii){var extentToLoad=extentsToLoad[i];loadedExtentsRtree.forEachInExtent(extentToLoad,function(object){return containsExtent(object.extent,extentToLoad)})||(this$1.loader_.call(this$1,extentToLoad,resolution,projection),loadedExtentsRtree.insert(extentToLoad,{extent:extentToLoad.slice()}),this$1.loading=this$1.loader_!==VOID)},i=0,ii=extentsToLoad.length;i<ii;++i)loop(i)},VectorSource.prototype.removeLoadedExtent=function(extent){var obj,loadedExtentsRtree=this.loadedExtentsRtree_;loadedExtentsRtree.forEachInExtent(extent,function(object){if(equals$2(object.extent,extent))return obj=object,!0}),obj&&loadedExtentsRtree.remove(obj)},VectorSource.prototype.removeFeature=function(feature){var featureKey=getUid(feature);featureKey in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[featureKey]:this.featuresRtree_&&this.featuresRtree_.remove(feature),this.removeFeatureInternal(feature),this.changed()},VectorSource.prototype.removeFeatureInternal=function(feature){var featureKey=getUid(feature);this.featureChangeKeys_[featureKey].forEach(unlistenByKey),delete this.featureChangeKeys_[featureKey];var id=feature.getId();void 0!==id?delete this.idIndex_[id.toString()]:delete this.undefIdIndex_[featureKey],this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,feature))},VectorSource.prototype.removeFromIdIndex_=function(feature){var removed=!1;for(var id in this.idIndex_)if(this.idIndex_[id]===feature){delete this.idIndex_[id],removed=!0;break}return removed},VectorSource.prototype.setLoader=function(loader){this.loader_=loader},VectorSource}(Source),Mode$1={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend"},DrawEvent=function(Event$$1){function DrawEvent(type,feature){Event$$1.call(this,type),this.feature=feature}return Event$$1&&(DrawEvent.__proto__=Event$$1),DrawEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),DrawEvent.prototype.constructor=DrawEvent,DrawEvent}(Event),Draw=function(PointerInteraction$$1){function Draw(options){var pointerOptions=options;pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),PointerInteraction$$1.call(this,pointerOptions),this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.freehand_=!1,this.source_=options.source?options.source:null,this.features_=options.features?options.features:null,this.snapTolerance_=options.snapTolerance?options.snapTolerance:12,this.type_=options.type,this.mode_=getMode(this.type_),this.stopClick_=!!options.stopClick,this.minPoints_=options.minPoints?options.minPoints:this.mode_===Mode$1.POLYGON?3:2,this.maxPoints_=options.maxPoints?options.maxPoints:1/0,this.finishCondition_=options.finishCondition?options.finishCondition:TRUE;var geometryFunction=options.geometryFunction;if(!geometryFunction)if(this.type_===GeometryType.CIRCLE)geometryFunction=function(coordinates,opt_geometry){var circle=opt_geometry||new Circle([NaN,NaN]),squaredLength=squaredDistance$1(coordinates[0],coordinates[1]);return circle.setCenterAndRadius(coordinates[0],Math.sqrt(squaredLength)),circle};else{var Constructor,mode=this.mode_;mode===Mode$1.POINT?Constructor=Point:mode===Mode$1.LINE_STRING?Constructor=LineString:mode===Mode$1.POLYGON&&(Constructor=Polygon),geometryFunction=function(coordinates,opt_geometry){var geometry=opt_geometry;return geometry?mode===Mode$1.POLYGON?coordinates[0].length?geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]):geometry.setCoordinates([]):geometry.setCoordinates(coordinates):geometry=new Constructor(coordinates),geometry}}this.geometryFunction_=geometryFunction,this.dragVertexDelay_=void 0!==options.dragVertexDelay?options.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=options.clickTolerance?options.clickTolerance*options.clickTolerance:36,this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!options.wrapX&&options.wrapX}),style:options.style?options.style:getDefaultStyleFunction(),updateWhileInteracting:!0}),this.geometryName_=options.geometryName,this.condition_=options.condition?options.condition:noModifierKeys,this.freehandCondition_,options.freehand?this.freehandCondition_=always:this.freehandCondition_=options.freehandCondition?options.freehandCondition:shiftKeyOnly,listen(this,getChangeEventType(InteractionProperty.ACTIVE),this.updateState_,this)}return PointerInteraction$$1&&(Draw.__proto__=PointerInteraction$$1),Draw.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),Draw.prototype.constructor=Draw,Draw.prototype.setMap=function(map){PointerInteraction$$1.prototype.setMap.call(this,map),this.updateState_()},Draw.prototype.getOverlay=function(){return this.overlay_},Draw.prototype.handleEvent=function(event){event.originalEvent.type===EventType.CONTEXTMENU&&event.preventDefault(),this.freehand_=this.mode_!==Mode$1.POINT&&this.freehandCondition_(event);var move=event.type===MapBrowserEventType.POINTERMOVE,pass=!0;!this.freehand_&&this.lastDragTime_&&event.type===MapBrowserEventType.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=event.pixel,this.shouldHandle_=!this.freehand_,move=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&event.type===MapBrowserEventType.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(event),pass=!1):this.freehand_&&event.type===MapBrowserEventType.POINTERDOWN?pass=!1:move?(pass=event.type===MapBrowserEventType.POINTERMOVE)&&this.freehand_?pass=this.handlePointerMove_(event):(event.pointerEvent.pointerType==POINTER_TYPE||event.type===MapBrowserEventType.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(event):event.type===MapBrowserEventType.DBLCLICK&&(pass=!1),PointerInteraction$$1.prototype.handleEvent.call(this,event)&&pass},Draw.prototype.handleDownEvent=function(event){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=event.pixel,this.finishCoordinate_||this.startDrawing_(event),!0):!!this.condition_(event)&&(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new MapBrowserPointerEvent(MapBrowserEventType.POINTERMOVE,event.map,event.pointerEvent,!1,event.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=event.pixel,!0)},Draw.prototype.handleUpEvent=function(event){var pass=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(event);var circleMode=this.mode_===Mode$1.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||circleMode?this.finishDrawing():this.atFinish_(event)?this.finishCondition_(event)&&this.finishDrawing():this.addToDrawing_(event):(this.startDrawing_(event),this.mode_===Mode$1.POINT&&this.finishDrawing()),pass=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!pass&&this.stopClick_&&event.stopPropagation(),pass},Draw.prototype.handlePointerMove_=function(event){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var downPx=this.downPx_,clickPx=event.pixel,dx=downPx[0]-clickPx[0],dy=downPx[1]-clickPx[1],squaredDistance$$1=dx*dx+dy*dy;if(this.shouldHandle_=this.freehand_?squaredDistance$$1>this.squaredClickTolerance_:squaredDistance$$1<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(event):this.createOrUpdateSketchPoint_(event),!0},Draw.prototype.atFinish_=function(event){var at=!1;if(this.sketchFeature_){var potentiallyDone=!1,potentiallyFinishCoordinates=[this.finishCoordinate_];if(this.mode_===Mode$1.LINE_STRING)potentiallyDone=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===Mode$1.POLYGON){var sketchCoords=this.sketchCoords_;potentiallyDone=sketchCoords[0].length>this.minPoints_,potentiallyFinishCoordinates=[sketchCoords[0][0],sketchCoords[0][sketchCoords[0].length-2]]}if(potentiallyDone)for(var map=event.map,i=0,ii=potentiallyFinishCoordinates.length;i<ii;i++){var finishCoordinate=potentiallyFinishCoordinates[i],finishPixel=map.getPixelFromCoordinate(finishCoordinate),pixel=event.pixel,dx=pixel[0]-finishPixel[0],dy=pixel[1]-finishPixel[1],snapTolerance=this.freehand_?1:this.snapTolerance_;if(at=Math.sqrt(dx*dx+dy*dy)<=snapTolerance){this.finishCoordinate_=finishCoordinate;break}}}return at},Draw.prototype.createOrUpdateSketchPoint_=function(event){var coordinates=event.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(coordinates):(this.sketchPoint_=new Feature(new Point(coordinates)),this.updateSketchFeatures_())},Draw.prototype.startDrawing_=function(event){var start=event.coordinate;this.finishCoordinate_=start,this.mode_===Mode$1.POINT?this.sketchCoords_=start.slice():this.mode_===Mode$1.POLYGON?(this.sketchCoords_=[[start.slice(),start.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[start.slice(),start.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Feature(new LineString(this.sketchLineCoords_)));var geometry=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new Feature,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(geometry),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))},Draw.prototype.modifyDrawing_=function(event){var coordinates,last,sketchLineGeom,coordinate=event.coordinate,geometry=this.sketchFeature_.getGeometry();(this.mode_===Mode$1.POINT?last=this.sketchCoords_:this.mode_===Mode$1.POLYGON?(last=(coordinates=this.sketchCoords_[0])[coordinates.length-1],this.atFinish_(event)&&(coordinate=this.finishCoordinate_.slice())):last=(coordinates=this.sketchCoords_)[coordinates.length-1],last[0]=coordinate[0],last[1]=coordinate[1],this.geometryFunction_(this.sketchCoords_,geometry),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(coordinate);if(geometry.getType()==GeometryType.POLYGON&&this.mode_!==Mode$1.POLYGON){this.sketchLine_||(this.sketchLine_=new Feature);var ring=geometry.getLinearRing(0);(sketchLineGeom=this.sketchLine_.getGeometry())?(sketchLineGeom.setFlatCoordinates(ring.getLayout(),ring.getFlatCoordinates()),sketchLineGeom.changed()):(sketchLineGeom=new LineString(ring.getFlatCoordinates(),ring.getLayout()),this.sketchLine_.setGeometry(sketchLineGeom))}else this.sketchLineCoords_&&(sketchLineGeom=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},Draw.prototype.addToDrawing_=function(event){var done,coordinates,coordinate=event.coordinate,geometry=this.sketchFeature_.getGeometry();this.mode_===Mode$1.LINE_STRING?(this.finishCoordinate_=coordinate.slice(),(coordinates=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?coordinates.pop():done=!0),coordinates.push(coordinate.slice()),this.geometryFunction_(coordinates,geometry)):this.mode_===Mode$1.POLYGON&&((coordinates=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?coordinates.pop():done=!0),coordinates.push(coordinate.slice()),done&&(this.finishCoordinate_=coordinates[0]),this.geometryFunction_(this.sketchCoords_,geometry)),this.updateSketchFeatures_(),done&&this.finishDrawing()},Draw.prototype.removeLastPoint=function(){if(this.sketchFeature_){var coordinates,geometry=this.sketchFeature_.getGeometry();this.mode_===Mode$1.LINE_STRING?((coordinates=this.sketchCoords_).splice(-2,1),this.geometryFunction_(coordinates,geometry),coordinates.length>=2&&(this.finishCoordinate_=coordinates[coordinates.length-2].slice())):this.mode_===Mode$1.POLYGON&&((coordinates=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(coordinates),this.geometryFunction_(this.sketchCoords_,geometry)),0===coordinates.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}},Draw.prototype.finishDrawing=function(){var sketchFeature=this.abortDrawing_();if(sketchFeature){var coordinates=this.sketchCoords_,geometry=sketchFeature.getGeometry();this.mode_===Mode$1.LINE_STRING?(coordinates.pop(),this.geometryFunction_(coordinates,geometry)):this.mode_===Mode$1.POLYGON&&(coordinates[0].pop(),this.geometryFunction_(coordinates,geometry),coordinates=geometry.getCoordinates()),this.type_===GeometryType.MULTI_POINT?sketchFeature.setGeometry(new MultiPoint([coordinates])):this.type_===GeometryType.MULTI_LINE_STRING?sketchFeature.setGeometry(new MultiLineString([coordinates])):this.type_===GeometryType.MULTI_POLYGON&&sketchFeature.setGeometry(new MultiPolygon([coordinates])),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND,sketchFeature)),this.features_&&this.features_.push(sketchFeature),this.source_&&this.source_.addFeature(sketchFeature)}},Draw.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var sketchFeature=this.sketchFeature_;return sketchFeature&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),sketchFeature},Draw.prototype.extend=function(feature){var lineString=feature.getGeometry();this.sketchFeature_=feature,this.sketchCoords_=lineString.getCoordinates();var last=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=last.slice(),this.sketchCoords_.push(last.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))},Draw.prototype.updateSketchFeatures_=function(){var sketchFeatures=[];this.sketchFeature_&&sketchFeatures.push(this.sketchFeature_),this.sketchLine_&&sketchFeatures.push(this.sketchLine_),this.sketchPoint_&&sketchFeatures.push(this.sketchPoint_);var overlaySource=this.overlay_.getSource();overlaySource.clear(!0),overlaySource.addFeatures(sketchFeatures)},Draw.prototype.updateState_=function(){var map=this.getMap(),active=this.getActive();map&&active||this.abortDrawing_(),this.overlay_.setMap(active?map:null)},Draw}(PointerInteraction);function getDefaultStyleFunction(){var styles=createEditingStyle();return function(feature,resolution){return styles[feature.getGeometry().getType()]}}function getMode(type){var mode;return type===GeometryType.POINT||type===GeometryType.MULTI_POINT?mode=Mode$1.POINT:type===GeometryType.LINE_STRING||type===GeometryType.MULTI_LINE_STRING?mode=Mode$1.LINE_STRING:type===GeometryType.POLYGON||type===GeometryType.MULTI_POLYGON?mode=Mode$1.POLYGON:type===GeometryType.CIRCLE&&(mode=Mode$1.CIRCLE),mode}var ExtentEventType={EXTENTCHANGED:"extentchanged"},ExtentInteractionEvent=function(Event$$1){function ExtentInteractionEvent(extent){Event$$1.call(this,ExtentEventType.EXTENTCHANGED),this.extent=extent}return Event$$1&&(ExtentInteractionEvent.__proto__=Event$$1),ExtentInteractionEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),ExtentInteractionEvent.prototype.constructor=ExtentInteractionEvent,ExtentInteractionEvent}(Event),ExtentInteraction=function(PointerInteraction$$1){function ExtentInteraction(opt_options){var options=opt_options||{};PointerInteraction$$1.call(this,options),this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=void 0!==options.pixelTolerance?options.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,opt_options||(opt_options={}),this.extentOverlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!opt_options.wrapX}),style:opt_options.boxStyle?opt_options.boxStyle:getDefaultExtentStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!opt_options.wrapX}),style:opt_options.pointerStyle?opt_options.pointerStyle:getDefaultPointerStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),opt_options.extent&&this.setExtent(opt_options.extent)}return PointerInteraction$$1&&(ExtentInteraction.__proto__=PointerInteraction$$1),ExtentInteraction.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),ExtentInteraction.prototype.constructor=ExtentInteraction,ExtentInteraction.prototype.snapToVertex_=function(pixel,map){var pixelCoordinate=map.getCoordinateFromPixel(pixel),extent=this.getExtent();if(extent){var segments=getSegments(extent);segments.sort(function(a,b){return squaredDistanceToSegment(pixelCoordinate,a)-squaredDistanceToSegment(pixelCoordinate,b)});var closestSegment=segments[0],vertex=closestOnSegment(pixelCoordinate,closestSegment),vertexPixel=map.getPixelFromCoordinate(vertex);if(distance(pixel,vertexPixel)<=this.pixelTolerance_){var pixel1=map.getPixelFromCoordinate(closestSegment[0]),pixel2=map.getPixelFromCoordinate(closestSegment[1]),squaredDist1=squaredDistance$1(vertexPixel,pixel1),squaredDist2=squaredDistance$1(vertexPixel,pixel2),dist=Math.sqrt(Math.min(squaredDist1,squaredDist2));return this.snappedToVertex_=dist<=this.pixelTolerance_,this.snappedToVertex_&&(vertex=squaredDist1>squaredDist2?closestSegment[1]:closestSegment[0]),vertex}}return null},ExtentInteraction.prototype.handlePointerMove_=function(mapBrowserEvent){var pixel=mapBrowserEvent.pixel,map=mapBrowserEvent.map,vertex=this.snapToVertex_(pixel,map);vertex||(vertex=map.getCoordinateFromPixel(pixel)),this.createOrUpdatePointerFeature_(vertex)},ExtentInteraction.prototype.createOrUpdateExtentFeature_=function(extent){var extentFeature=this.extentFeature_;return extentFeature?extent?extentFeature.setGeometry(fromExtent(extent)):extentFeature.setGeometry(void 0):(extentFeature=new Feature(extent?fromExtent(extent):{}),this.extentFeature_=extentFeature,this.extentOverlay_.getSource().addFeature(extentFeature)),extentFeature},ExtentInteraction.prototype.createOrUpdatePointerFeature_=function(vertex){var vertexFeature=this.vertexFeature_;vertexFeature?vertexFeature.getGeometry().setCoordinates(vertex):(vertexFeature=new Feature(new Point(vertex)),this.vertexFeature_=vertexFeature,this.vertexOverlay_.getSource().addFeature(vertexFeature));return vertexFeature},ExtentInteraction.prototype.handleEvent=function(mapBrowserEvent){return!mapBrowserEvent.pointerEvent||(mapBrowserEvent.type!=MapBrowserEventType.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(mapBrowserEvent),PointerInteraction$$1.prototype.handleEvent.call(this,mapBrowserEvent),!1)},ExtentInteraction.prototype.handleDownEvent=function(mapBrowserEvent){var pixel=mapBrowserEvent.pixel,map=mapBrowserEvent.map,extent=this.getExtent(),vertex=this.snapToVertex_(pixel,map),getOpposingPoint=function(point){var x_=null,y_=null;return point[0]==extent[0]?x_=extent[2]:point[0]==extent[2]&&(x_=extent[0]),point[1]==extent[1]?y_=extent[3]:point[1]==extent[3]&&(y_=extent[1]),null!==x_&&null!==y_?[x_,y_]:null};if(vertex&&extent){var x=vertex[0]==extent[0]||vertex[0]==extent[2]?vertex[0]:null,y=vertex[1]==extent[1]||vertex[1]==extent[3]?vertex[1]:null;null!==x&&null!==y?this.pointerHandler_=getPointHandler(getOpposingPoint(vertex)):null!==x?this.pointerHandler_=getEdgeHandler(getOpposingPoint([x,extent[1]]),getOpposingPoint([x,extent[3]])):null!==y&&(this.pointerHandler_=getEdgeHandler(getOpposingPoint([extent[0],y]),getOpposingPoint([extent[2],y])))}else vertex=map.getCoordinateFromPixel(pixel),this.setExtent([vertex[0],vertex[1],vertex[0],vertex[1]]),this.pointerHandler_=getPointHandler(vertex);return!0},ExtentInteraction.prototype.handleDragEvent=function(mapBrowserEvent){if(this.pointerHandler_){var pixelCoordinate=mapBrowserEvent.coordinate;this.setExtent(this.pointerHandler_(pixelCoordinate)),this.createOrUpdatePointerFeature_(pixelCoordinate)}return!0},ExtentInteraction.prototype.handleUpEvent=function(mapBrowserEvent){this.pointerHandler_=null;var extent=this.getExtent();return extent&&0!==getArea(extent)||this.setExtent(null),!1},ExtentInteraction.prototype.setMap=function(map){this.extentOverlay_.setMap(map),this.vertexOverlay_.setMap(map),PointerInteraction$$1.prototype.setMap.call(this,map)},ExtentInteraction.prototype.getExtent=function(){return this.extent_},ExtentInteraction.prototype.setExtent=function(extent){this.extent_=extent||null,this.createOrUpdateExtentFeature_(extent),this.dispatchEvent(new ExtentInteractionEvent(this.extent_))},ExtentInteraction}(PointerInteraction);function getDefaultExtentStyleFunction(){var style=createEditingStyle();return function(feature,resolution){return style[GeometryType.POLYGON]}}function getDefaultPointerStyleFunction(){var style=createEditingStyle();return function(feature,resolution){return style[GeometryType.POINT]}}function getPointHandler(fixedPoint){return function(point){return boundingExtent([fixedPoint,point])}}function getEdgeHandler(fixedP1,fixedP2){return fixedP1[0]==fixedP2[0]?function(point){return boundingExtent([fixedP1,[point[0],fixedP2[1]]])}:fixedP1[1]==fixedP2[1]?function(point){return boundingExtent([fixedP1,[fixedP2[0],point[1]]])}:null}function getSegments(extent){return[[[extent[0],extent[1]],[extent[0],extent[3]]],[[extent[0],extent[3]],[extent[2],extent[3]]],[[extent[2],extent[3]],[extent[2],extent[1]]],[[extent[2],extent[1]],[extent[0],extent[1]]]]}var CIRCLE_CENTER_INDEX=0,CIRCLE_CIRCUMFERENCE_INDEX=1,ModifyEventType={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"},ModifyEvent=function(Event$$1){function ModifyEvent(type,features,mapBrowserPointerEvent){Event$$1.call(this,type),this.features=features,this.mapBrowserEvent=mapBrowserPointerEvent}return Event$$1&&(ModifyEvent.__proto__=Event$$1),ModifyEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),ModifyEvent.prototype.constructor=ModifyEvent,ModifyEvent}(Event),Modify=function(PointerInteraction$$1){function Modify(options){var features;if(PointerInteraction$$1.call(this,options),this.condition_=options.condition?options.condition:primaryAction,this.defaultDeleteCondition_=function(mapBrowserEvent){return altKeyOnly(mapBrowserEvent)&&singleClick(mapBrowserEvent)},this.deleteCondition_=options.deleteCondition?options.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=options.insertVertexCondition?options.insertVertexCondition:always,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new RBush,this.pixelTolerance_=void 0!==options.pixelTolerance?options.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!options.wrapX}),style:options.style?options.style:getDefaultStyleFunction$1(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,options.source?(this.source_=options.source,features=new Collection(this.source_.getFeatures()),listen(this.source_,VectorEventType.ADDFEATURE,this.handleSourceAdd_,this),listen(this.source_,VectorEventType.REMOVEFEATURE,this.handleSourceRemove_,this)):features=options.features,!features)throw new Error("The modify interaction requires features or a source");this.features_=features,this.features_.forEach(this.addFeature_.bind(this)),listen(this.features_,CollectionEventType.ADD,this.handleFeatureAdd_,this),listen(this.features_,CollectionEventType.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null}return PointerInteraction$$1&&(Modify.__proto__=PointerInteraction$$1),Modify.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),Modify.prototype.constructor=Modify,Modify.prototype.addFeature_=function(feature){var geometry=feature.getGeometry();geometry&&geometry.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[geometry.getType()].call(this,feature,geometry);var map=this.getMap();map&&map.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,map),listen(feature,EventType.CHANGE,this.handleFeatureChange_,this)},Modify.prototype.willModifyFeatures_=function(evt){this.modified_||(this.modified_=!0,this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYSTART,this.features_,evt)))},Modify.prototype.removeFeature_=function(feature){this.removeFeatureSegmentData_(feature),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),unlisten(feature,EventType.CHANGE,this.handleFeatureChange_,this)},Modify.prototype.removeFeatureSegmentData_=function(feature){var rBush=this.rBush_,nodesToRemove=[];rBush.forEach(function(node){feature===node.feature&&nodesToRemove.push(node)});for(var i=nodesToRemove.length-1;i>=0;--i)rBush.remove(nodesToRemove[i])},Modify.prototype.setActive=function(active){this.vertexFeature_&&!active&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),PointerInteraction$$1.prototype.setActive.call(this,active)},Modify.prototype.setMap=function(map){this.overlay_.setMap(map),PointerInteraction$$1.prototype.setMap.call(this,map)},Modify.prototype.getOverlay=function(){return this.overlay_},Modify.prototype.handleSourceAdd_=function(event){event.feature&&this.features_.push(event.feature)},Modify.prototype.handleSourceRemove_=function(event){event.feature&&this.features_.remove(event.feature)},Modify.prototype.handleFeatureAdd_=function(evt){this.addFeature_(evt.element)},Modify.prototype.handleFeatureChange_=function(evt){if(!this.changingFeature_){var feature=evt.target;this.removeFeature_(feature),this.addFeature_(feature)}},Modify.prototype.handleFeatureRemove_=function(evt){var feature=evt.element;this.removeFeature_(feature)},Modify.prototype.writePointGeometry_=function(feature,geometry){var coordinates=geometry.getCoordinates(),segmentData={feature:feature,geometry:geometry,segment:[coordinates,coordinates]};this.rBush_.insert(geometry.getExtent(),segmentData)},Modify.prototype.writeMultiPointGeometry_=function(feature,geometry){for(var points=geometry.getCoordinates(),i=0,ii=points.length;i<ii;++i){var coordinates=points[i],segmentData={feature:feature,geometry:geometry,depth:[i],index:i,segment:[coordinates,coordinates]};this.rBush_.insert(geometry.getExtent(),segmentData)}},Modify.prototype.writeLineStringGeometry_=function(feature,geometry){for(var coordinates=geometry.getCoordinates(),i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,geometry:geometry,index:i,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Modify.prototype.writeMultiLineStringGeometry_=function(feature,geometry){for(var lines=geometry.getCoordinates(),j=0,jj=lines.length;j<jj;++j)for(var coordinates=lines[j],i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,geometry:geometry,depth:[j],index:i,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Modify.prototype.writePolygonGeometry_=function(feature,geometry){for(var rings=geometry.getCoordinates(),j=0,jj=rings.length;j<jj;++j)for(var coordinates=rings[j],i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,geometry:geometry,depth:[j],index:i,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Modify.prototype.writeMultiPolygonGeometry_=function(feature,geometry){for(var polygons=geometry.getCoordinates(),k=0,kk=polygons.length;k<kk;++k)for(var rings=polygons[k],j=0,jj=rings.length;j<jj;++j)for(var coordinates=rings[j],i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,geometry:geometry,depth:[j,k],index:i,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Modify.prototype.writeCircleGeometry_=function(feature,geometry){var coordinates=geometry.getCenter(),centerSegmentData={feature:feature,geometry:geometry,index:CIRCLE_CENTER_INDEX,segment:[coordinates,coordinates]},circumferenceSegmentData={feature:feature,geometry:geometry,index:CIRCLE_CIRCUMFERENCE_INDEX,segment:[coordinates,coordinates]},featureSegments=[centerSegmentData,circumferenceSegmentData];centerSegmentData.featureSegments=circumferenceSegmentData.featureSegments=featureSegments,this.rBush_.insert(createOrUpdateFromCoordinate(coordinates),centerSegmentData),this.rBush_.insert(geometry.getExtent(),circumferenceSegmentData)},Modify.prototype.writeGeometryCollectionGeometry_=function(feature,geometry){for(var geometries=geometry.getGeometriesArray(),i=0;i<geometries.length;++i)this.SEGMENT_WRITERS_[geometries[i].getType()].call(this,feature,geometries[i])},Modify.prototype.createOrUpdateVertexFeature_=function(coordinates){var vertexFeature=this.vertexFeature_;vertexFeature?vertexFeature.getGeometry().setCoordinates(coordinates):(vertexFeature=new Feature(new Point(coordinates)),this.vertexFeature_=vertexFeature,this.overlay_.getSource().addFeature(vertexFeature));return vertexFeature},Modify.prototype.handleEvent=function(mapBrowserEvent){return!mapBrowserEvent.pointerEvent||(this.lastPointerEvent_=mapBrowserEvent,mapBrowserEvent.map.getView().getInteracting()||mapBrowserEvent.type!=MapBrowserEventType.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(mapBrowserEvent),this.vertexFeature_&&this.deleteCondition_(mapBrowserEvent)&&(handled=!(mapBrowserEvent.type!=MapBrowserEventType.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),mapBrowserEvent.type==MapBrowserEventType.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),PointerInteraction$$1.prototype.handleEvent.call(this,mapBrowserEvent)&&!handled);var handled},Modify.prototype.handleDragEvent=function(evt){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(evt);for(var vertex=evt.coordinate,i=0,ii=this.dragSegments_.length;i<ii;++i){for(var dragSegment=this.dragSegments_[i],segmentData=dragSegment[0],depth=segmentData.depth,geometry=segmentData.geometry,coordinates=void 0,segment=segmentData.segment,index=dragSegment[1];vertex.length<geometry.getStride();)vertex.push(segment[index][vertex.length]);switch(geometry.getType()){case GeometryType.POINT:coordinates=vertex,segment[0]=segment[1]=vertex;break;case GeometryType.MULTI_POINT:(coordinates=geometry.getCoordinates())[segmentData.index]=vertex,segment[0]=segment[1]=vertex;break;case GeometryType.LINE_STRING:(coordinates=geometry.getCoordinates())[segmentData.index+index]=vertex,segment[index]=vertex;break;case GeometryType.MULTI_LINE_STRING:case GeometryType.POLYGON:(coordinates=geometry.getCoordinates())[depth[0]][segmentData.index+index]=vertex,segment[index]=vertex;break;case GeometryType.MULTI_POLYGON:(coordinates=geometry.getCoordinates())[depth[1]][depth[0]][segmentData.index+index]=vertex,segment[index]=vertex;break;case GeometryType.CIRCLE:segment[0]=segment[1]=vertex,segmentData.index===CIRCLE_CENTER_INDEX?(this.changingFeature_=!0,geometry.setCenter(vertex),this.changingFeature_=!1):(this.changingFeature_=!0,geometry.setRadius(distance(geometry.getCenter(),vertex)),this.changingFeature_=!1)}coordinates&&this.setGeometryCoordinates_(geometry,coordinates)}this.createOrUpdateVertexFeature_(vertex)},Modify.prototype.handleDownEvent=function(evt){if(!this.condition_(evt))return!1;this.handlePointerAtPixel_(evt.pixel,evt.map);var pixelCoordinate=evt.map.getCoordinateFromPixel(evt.pixel);this.dragSegments_.length=0,this.modified_=!1;var vertexFeature=this.vertexFeature_;if(vertexFeature){var insertVertices=[],vertex=vertexFeature.getGeometry().getCoordinates(),vertexExtent=boundingExtent([vertex]),segmentDataMatches=this.rBush_.getInExtent(vertexExtent),componentSegments={};segmentDataMatches.sort(compareIndexes);for(var i=0,ii=segmentDataMatches.length;i<ii;++i){var segmentDataMatch=segmentDataMatches[i],segment=segmentDataMatch.segment,uid=getUid(segmentDataMatch.feature),depth=segmentDataMatch.depth;if(depth&&(uid+="-"+depth.join("-")),componentSegments[uid]||(componentSegments[uid]=new Array(2)),segmentDataMatch.geometry.getType()===GeometryType.CIRCLE&&segmentDataMatch.index===CIRCLE_CIRCUMFERENCE_INDEX)equals$1(closestOnSegmentData(pixelCoordinate,segmentDataMatch),vertex)&&!componentSegments[uid][0]&&(this.dragSegments_.push([segmentDataMatch,0]),componentSegments[uid][0]=segmentDataMatch);else if(equals$1(segment[0],vertex)&&!componentSegments[uid][0])this.dragSegments_.push([segmentDataMatch,0]),componentSegments[uid][0]=segmentDataMatch;else if(equals$1(segment[1],vertex)&&!componentSegments[uid][1]){if((segmentDataMatch.geometry.getType()===GeometryType.LINE_STRING||segmentDataMatch.geometry.getType()===GeometryType.MULTI_LINE_STRING)&&componentSegments[uid][0]&&0===componentSegments[uid][0].index)continue;this.dragSegments_.push([segmentDataMatch,1]),componentSegments[uid][1]=segmentDataMatch}else this.insertVertexCondition_(evt)&&getUid(segment)in this.vertexSegments_&&!componentSegments[uid][0]&&!componentSegments[uid][1]&&insertVertices.push([segmentDataMatch,vertex])}insertVertices.length&&this.willModifyFeatures_(evt);for(var j=insertVertices.length-1;j>=0;--j)this.insertVertex_.apply(this,insertVertices[j])}return!!this.vertexFeature_},Modify.prototype.handleUpEvent=function(evt){for(var i=this.dragSegments_.length-1;i>=0;--i){var segmentData=this.dragSegments_[i][0],geometry=segmentData.geometry;if(geometry.getType()===GeometryType.CIRCLE){var coordinates=geometry.getCenter(),centerSegmentData=segmentData.featureSegments[0],circumferenceSegmentData=segmentData.featureSegments[1];centerSegmentData.segment[0]=centerSegmentData.segment[1]=coordinates,circumferenceSegmentData.segment[0]=circumferenceSegmentData.segment[1]=coordinates,this.rBush_.update(createOrUpdateFromCoordinate(coordinates),centerSegmentData),this.rBush_.update(geometry.getExtent(),circumferenceSegmentData)}else this.rBush_.update(boundingExtent(segmentData.segment),segmentData)}return this.modified_&&(this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.features_,evt)),this.modified_=!1),!1},Modify.prototype.handlePointerMove_=function(evt){this.lastPixel_=evt.pixel,this.handlePointerAtPixel_(evt.pixel,evt.map)},Modify.prototype.handlePointerAtPixel_=function(pixel,map){var pixelCoordinate=map.getCoordinateFromPixel(pixel),box=buffer(createOrUpdateFromCoordinate(pixelCoordinate),map.getView().getResolution()*this.pixelTolerance_),nodes=this.rBush_.getInExtent(box);if(nodes.length>0){nodes.sort(function(a,b){return pointDistanceToSegmentDataSquared(pixelCoordinate,a)-pointDistanceToSegmentDataSquared(pixelCoordinate,b)});var node=nodes[0],closestSegment=node.segment,vertex=closestOnSegmentData(pixelCoordinate,node),vertexPixel=map.getPixelFromCoordinate(vertex),dist=distance(pixel,vertexPixel);if(dist<=this.pixelTolerance_){var vertexSegments={};if(node.geometry.getType()===GeometryType.CIRCLE&&node.index===CIRCLE_CIRCUMFERENCE_INDEX)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(vertex);else{var pixel1=map.getPixelFromCoordinate(closestSegment[0]),pixel2=map.getPixelFromCoordinate(closestSegment[1]),squaredDist1=squaredDistance$1(vertexPixel,pixel1),squaredDist2=squaredDistance$1(vertexPixel,pixel2);dist=Math.sqrt(Math.min(squaredDist1,squaredDist2)),this.snappedToVertex_=dist<=this.pixelTolerance_,this.snappedToVertex_&&(vertex=squaredDist1>squaredDist2?closestSegment[1]:closestSegment[0]),this.createOrUpdateVertexFeature_(vertex);for(var i=1,ii=nodes.length;i<ii;++i){var segment=nodes[i].segment;if(!(equals$1(closestSegment[0],segment[0])&&equals$1(closestSegment[1],segment[1])||equals$1(closestSegment[0],segment[1])&&equals$1(closestSegment[1],segment[0])))break;vertexSegments[getUid(segment)]=!0}}return vertexSegments[getUid(closestSegment)]=!0,void(this.vertexSegments_=vertexSegments)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},Modify.prototype.insertVertex_=function(segmentData,vertex){for(var coordinates,segment=segmentData.segment,feature=segmentData.feature,geometry=segmentData.geometry,depth=segmentData.depth,index=segmentData.index;vertex.length<geometry.getStride();)vertex.push(0);switch(geometry.getType()){case GeometryType.MULTI_LINE_STRING:case GeometryType.POLYGON:(coordinates=geometry.getCoordinates())[depth[0]].splice(index+1,0,vertex);break;case GeometryType.MULTI_POLYGON:(coordinates=geometry.getCoordinates())[depth[1]][depth[0]].splice(index+1,0,vertex);break;case GeometryType.LINE_STRING:(coordinates=geometry.getCoordinates()).splice(index+1,0,vertex);break;default:return}this.setGeometryCoordinates_(geometry,coordinates);var rTree=this.rBush_;rTree.remove(segmentData),this.updateSegmentIndices_(geometry,index,depth,1);var newSegmentData={segment:[segment[0],vertex],feature:feature,geometry:geometry,depth:depth,index:index};rTree.insert(boundingExtent(newSegmentData.segment),newSegmentData),this.dragSegments_.push([newSegmentData,1]);var newSegmentData2={segment:[vertex,segment[1]],feature:feature,geometry:geometry,depth:depth,index:index+1};rTree.insert(boundingExtent(newSegmentData2.segment),newSegmentData2),this.dragSegments_.push([newSegmentData2,0]),this.ignoreNextSingleClick_=!0},Modify.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=MapBrowserEventType.POINTERDRAG){var evt=this.lastPointerEvent_;return this.willModifyFeatures_(evt),this.removeVertex_(),this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.features_,evt)),this.modified_=!1,!0}return!1},Modify.prototype.removeVertex_=function(){var component,coordinates,dragSegment,geometry,i,index,left,newIndex,right,segmentData,uid,dragSegments=this.dragSegments_,segmentsByFeature={},deleted=!1;for(i=dragSegments.length-1;i>=0;--i)uid=getUid((segmentData=(dragSegment=dragSegments[i])[0]).feature),segmentData.depth&&(uid+="-"+segmentData.depth.join("-")),uid in segmentsByFeature||(segmentsByFeature[uid]={}),0===dragSegment[1]?(segmentsByFeature[uid].right=segmentData,segmentsByFeature[uid].index=segmentData.index):1==dragSegment[1]&&(segmentsByFeature[uid].left=segmentData,segmentsByFeature[uid].index=segmentData.index+1);for(uid in segmentsByFeature){switch(right=segmentsByFeature[uid].right,left=segmentsByFeature[uid].left,(newIndex=(index=segmentsByFeature[uid].index)-1)<0&&(newIndex=0),component=coordinates=(geometry=(segmentData=void 0!==left?left:right).geometry).getCoordinates(),deleted=!1,geometry.getType()){case GeometryType.MULTI_LINE_STRING:coordinates[segmentData.depth[0]].length>2&&(coordinates[segmentData.depth[0]].splice(index,1),deleted=!0);break;case GeometryType.LINE_STRING:coordinates.length>2&&(coordinates.splice(index,1),deleted=!0);break;case GeometryType.MULTI_POLYGON:component=component[segmentData.depth[1]];case GeometryType.POLYGON:(component=component[segmentData.depth[0]]).length>4&&(index==component.length-1&&(index=0),component.splice(index,1),deleted=!0,0===index&&(component.pop(),component.push(component[0]),newIndex=component.length-1))}if(deleted){this.setGeometryCoordinates_(geometry,coordinates);var segments=[];if(void 0!==left&&(this.rBush_.remove(left),segments.push(left.segment[0])),void 0!==right&&(this.rBush_.remove(right),segments.push(right.segment[1])),void 0!==left&&void 0!==right){var newSegmentData={depth:segmentData.depth,feature:segmentData.feature,geometry:segmentData.geometry,index:newIndex,segment:segments};this.rBush_.insert(boundingExtent(newSegmentData.segment),newSegmentData)}this.updateSegmentIndices_(geometry,index,segmentData.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),dragSegments.length=0}}return deleted},Modify.prototype.setGeometryCoordinates_=function(geometry,coordinates){this.changingFeature_=!0,geometry.setCoordinates(coordinates),this.changingFeature_=!1},Modify.prototype.updateSegmentIndices_=function(geometry,index,depth,delta){this.rBush_.forEachInExtent(geometry.getExtent(),function(segmentDataMatch){segmentDataMatch.geometry===geometry&&(void 0===depth||void 0===segmentDataMatch.depth||equals(segmentDataMatch.depth,depth))&&segmentDataMatch.index>index&&(segmentDataMatch.index+=delta)})},Modify}(PointerInteraction);function compareIndexes(a,b){return a.index-b.index}function pointDistanceToSegmentDataSquared(pointCoordinates,segmentData){var geometry=segmentData.geometry;if(geometry.getType()===GeometryType.CIRCLE){var circleGeometry=geometry;if(segmentData.index===CIRCLE_CIRCUMFERENCE_INDEX){var distanceToCenterSquared=squaredDistance$1(circleGeometry.getCenter(),pointCoordinates),distanceToCircumference=Math.sqrt(distanceToCenterSquared)-circleGeometry.getRadius();return distanceToCircumference*distanceToCircumference}}return squaredDistanceToSegment(pointCoordinates,segmentData.segment)}function closestOnSegmentData(pointCoordinates,segmentData){var geometry=segmentData.geometry;return geometry.getType()===GeometryType.CIRCLE&&segmentData.index===CIRCLE_CIRCUMFERENCE_INDEX?geometry.getClosestPoint(pointCoordinates):closestOnSegment(pointCoordinates,segmentData.segment)}function getDefaultStyleFunction$1(){var style=createEditingStyle();return function(feature,resolution){return style[GeometryType.POINT]}}var SelectEventType={SELECT:"select"},SelectEvent=function(Event$$1){function SelectEvent(type,selected,deselected,mapBrowserEvent){Event$$1.call(this,type),this.selected=selected,this.deselected=deselected,this.mapBrowserEvent=mapBrowserEvent}return Event$$1&&(SelectEvent.__proto__=Event$$1),SelectEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),SelectEvent.prototype.constructor=SelectEvent,SelectEvent}(Event),Select=function(Interaction$$1){function Select(opt_options){Interaction$$1.call(this,{handleEvent:handleEvent$3});var options=opt_options||{};this.condition_=options.condition?options.condition:singleClick,this.addCondition_=options.addCondition?options.addCondition:never,this.removeCondition_=options.removeCondition?options.removeCondition:never,this.toggleCondition_=options.toggleCondition?options.toggleCondition:shiftKeyOnly,this.multi_=!!options.multi&&options.multi,this.filter_=options.filter?options.filter:TRUE,this.hitTolerance_=options.hitTolerance?options.hitTolerance:0;var layerFilter,featureOverlay=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,features:options.features,wrapX:options.wrapX}),style:options.style?options.style:getDefaultStyleFunction$2(),updateWhileAnimating:!0,updateWhileInteracting:!0});if(this.featureOverlay_=featureOverlay,options.layers)if("function"==typeof options.layers)layerFilter=options.layers;else{var layers=options.layers;layerFilter=function(layer){return includes(layers,layer)}}else layerFilter=TRUE;this.layerFilter_=layerFilter,this.featureLayerAssociation_={};var features=this.getFeatures();listen(features,CollectionEventType.ADD,this.addFeature_,this),listen(features,CollectionEventType.REMOVE,this.removeFeature_,this)}return Interaction$$1&&(Select.__proto__=Interaction$$1),Select.prototype=Object.create(Interaction$$1&&Interaction$$1.prototype),Select.prototype.constructor=Select,Select.prototype.addFeatureLayerAssociation_=function(feature,layer){this.featureLayerAssociation_[getUid(feature)]=layer},Select.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},Select.prototype.getHitTolerance=function(){return this.hitTolerance_},Select.prototype.getLayer=function(feature){return this.featureLayerAssociation_[getUid(feature)]},Select.prototype.getOverlay=function(){return this.featureOverlay_},Select.prototype.setHitTolerance=function(hitTolerance){this.hitTolerance_=hitTolerance},Select.prototype.setMap=function(map){var currentMap=this.getMap(),selectedFeatures=this.getFeatures();currentMap&&selectedFeatures.forEach(currentMap.unskipFeature.bind(currentMap)),Interaction$$1.prototype.setMap.call(this,map),this.featureOverlay_.setMap(map),map&&selectedFeatures.forEach(map.skipFeature.bind(map))},Select.prototype.addFeature_=function(evt){var map=this.getMap();map&&map.skipFeature(evt.element)},Select.prototype.removeFeature_=function(evt){var map=this.getMap();map&&map.unskipFeature(evt.element)},Select.prototype.removeFeatureLayerAssociation_=function(feature){delete this.featureLayerAssociation_[getUid(feature)]},Select}(Interaction);function handleEvent$3(mapBrowserEvent){if(!this.condition_(mapBrowserEvent))return!0;var add=this.addCondition_(mapBrowserEvent),remove$$1=this.removeCondition_(mapBrowserEvent),toggle=this.toggleCondition_(mapBrowserEvent),set=!add&&!remove$$1&&!toggle,map=mapBrowserEvent.map,features=this.getFeatures(),deselected=[],selected=[];if(set){clear(this.featureLayerAssociation_),map.forEachFeatureAtPixel(mapBrowserEvent.pixel,function(feature,layer){if(this.filter_(feature,layer))return selected.push(feature),this.addFeatureLayerAssociation_(feature,layer),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var i=features.getLength()-1;i>=0;--i){var feature=features.item(i),index=selected.indexOf(feature);index>-1?selected.splice(index,1):(features.remove(feature),deselected.push(feature))}0!==selected.length&&features.extend(selected)}else{map.forEachFeatureAtPixel(mapBrowserEvent.pixel,function(feature,layer){if(this.filter_(feature,layer))return!add&&!toggle||includes(features.getArray(),feature)?(remove$$1||toggle)&&includes(features.getArray(),feature)&&(deselected.push(feature),this.removeFeatureLayerAssociation_(feature)):(selected.push(feature),this.addFeatureLayerAssociation_(feature,layer)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var j=deselected.length-1;j>=0;--j)features.remove(deselected[j]);features.extend(selected)}return(selected.length>0||deselected.length>0)&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,selected,deselected,mapBrowserEvent)),pointerMove$1(mapBrowserEvent)}function getDefaultStyleFunction$2(){var styles=createEditingStyle();return extend(styles[GeometryType.POLYGON],styles[GeometryType.LINE_STRING]),extend(styles[GeometryType.GEOMETRY_COLLECTION],styles[GeometryType.LINE_STRING]),function(feature,resolution){return feature.getGeometry()?styles[feature.getGeometry().getType()]:null}}function getFeatureFromEvent(evt){return evt.feature?evt.feature:evt.element?evt.element:void 0}var Snap=function(PointerInteraction$$1){function Snap(opt_options){var options=opt_options||{},pointerOptions=options;pointerOptions.handleDownEvent||(pointerOptions.handleDownEvent=TRUE),pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),PointerInteraction$$1.call(this,pointerOptions),this.source_=options.source?options.source:null,this.vertex_=void 0===options.vertex||options.vertex,this.edge_=void 0===options.edge||options.edge,this.features_=options.features?options.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelCoordinate_=null,this.pixelTolerance_=void 0!==options.pixelTolerance?options.pixelTolerance:10,this.sortByDistance_=sortByDistance.bind(this),this.rBush_=new RBush,this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}}return PointerInteraction$$1&&(Snap.__proto__=PointerInteraction$$1),Snap.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),Snap.prototype.constructor=Snap,Snap.prototype.addFeature=function(feature,opt_listen){var register=void 0===opt_listen||opt_listen,feature_uid=getUid(feature),geometry=feature.getGeometry();if(geometry){var segmentWriter=this.SEGMENT_WRITERS_[geometry.getType()];segmentWriter&&(this.indexedFeaturesExtents_[feature_uid]=geometry.getExtent(createEmpty()),segmentWriter.call(this,feature,geometry))}register&&(this.featureChangeListenerKeys_[feature_uid]=listen(feature,EventType.CHANGE,this.handleFeatureChange_,this))},Snap.prototype.forEachFeatureAdd_=function(feature){this.addFeature(feature)},Snap.prototype.forEachFeatureRemove_=function(feature){this.removeFeature(feature)},Snap.prototype.getFeatures_=function(){var features;return this.features_?features=this.features_:this.source_&&(features=this.source_.getFeatures()),features},Snap.prototype.handleEvent=function(evt){var result=this.snapTo(evt.pixel,evt.coordinate,evt.map);return result.snapped&&(evt.coordinate=result.vertex.slice(0,2),evt.pixel=result.vertexPixel),PointerInteraction$$1.prototype.handleEvent.call(this,evt)},Snap.prototype.handleFeatureAdd_=function(evt){var feature=getFeatureFromEvent(evt);this.addFeature(feature)},Snap.prototype.handleFeatureRemove_=function(evt){var feature=getFeatureFromEvent(evt);this.removeFeature(feature)},Snap.prototype.handleFeatureChange_=function(evt){var feature=evt.target;if(this.handlingDownUpSequence){var uid=getUid(feature);uid in this.pendingFeatures_||(this.pendingFeatures_[uid]=feature)}else this.updateFeature_(feature)},Snap.prototype.handleUpEvent=function(evt){var featuresToUpdate=getValues(this.pendingFeatures_);return featuresToUpdate.length&&(featuresToUpdate.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},Snap.prototype.removeFeature=function(feature,opt_unlisten){var unregister=void 0===opt_unlisten||opt_unlisten,feature_uid=getUid(feature),extent=this.indexedFeaturesExtents_[feature_uid];if(extent){var rBush=this.rBush_,nodesToRemove=[];rBush.forEachInExtent(extent,function(node){feature===node.feature&&nodesToRemove.push(node)});for(var i=nodesToRemove.length-1;i>=0;--i)rBush.remove(nodesToRemove[i])}unregister&&(unlistenByKey(this.featureChangeListenerKeys_[feature_uid]),delete this.featureChangeListenerKeys_[feature_uid])},Snap.prototype.setMap=function(map){var currentMap=this.getMap(),keys=this.featuresListenerKeys_,features=this.getFeatures_();currentMap&&(keys.forEach(unlistenByKey),keys.length=0,features.forEach(this.forEachFeatureRemove_.bind(this))),PointerInteraction$$1.prototype.setMap.call(this,map),map&&(this.features_?keys.push(listen(this.features_,CollectionEventType.ADD,this.handleFeatureAdd_,this),listen(this.features_,CollectionEventType.REMOVE,this.handleFeatureRemove_,this)):this.source_&&keys.push(listen(this.source_,VectorEventType.ADDFEATURE,this.handleFeatureAdd_,this),listen(this.source_,VectorEventType.REMOVEFEATURE,this.handleFeatureRemove_,this)),features.forEach(this.forEachFeatureAdd_.bind(this)))},Snap.prototype.snapTo=function(pixel,pixelCoordinate,map){var box=boundingExtent([map.getCoordinateFromPixel([pixel[0]-this.pixelTolerance_,pixel[1]+this.pixelTolerance_]),map.getCoordinateFromPixel([pixel[0]+this.pixelTolerance_,pixel[1]-this.pixelTolerance_])]),segments=this.rBush_.getInExtent(box);this.vertex_&&!this.edge_&&(segments=segments.filter(function(segment){return segment.feature.getGeometry().getType()!==GeometryType.CIRCLE}));var pixel1,pixel2,squaredDist1,squaredDist2,snapped=!1,vertex=null,vertexPixel=null;if(segments.length>0){this.pixelCoordinate_=pixelCoordinate,segments.sort(this.sortByDistance_);var closestSegment=segments[0].segment,isCircle=segments[0].feature.getGeometry().getType()===GeometryType.CIRCLE;this.vertex_&&!this.edge_?(pixel1=map.getPixelFromCoordinate(closestSegment[0]),pixel2=map.getPixelFromCoordinate(closestSegment[1]),squaredDist1=squaredDistance$1(pixel,pixel1),squaredDist2=squaredDistance$1(pixel,pixel2),Math.sqrt(Math.min(squaredDist1,squaredDist2))<=this.pixelTolerance_&&(snapped=!0,vertex=squaredDist1>squaredDist2?closestSegment[1]:closestSegment[0],vertexPixel=map.getPixelFromCoordinate(vertex))):this.edge_&&(vertex=isCircle?closestOnCircle(pixelCoordinate,segments[0].feature.getGeometry()):closestOnSegment(pixelCoordinate,closestSegment),distance(pixel,vertexPixel=map.getPixelFromCoordinate(vertex))<=this.pixelTolerance_&&(snapped=!0,this.vertex_&&!isCircle&&(pixel1=map.getPixelFromCoordinate(closestSegment[0]),pixel2=map.getPixelFromCoordinate(closestSegment[1]),squaredDist1=squaredDistance$1(vertexPixel,pixel1),squaredDist2=squaredDistance$1(vertexPixel,pixel2),Math.sqrt(Math.min(squaredDist1,squaredDist2))<=this.pixelTolerance_&&(vertex=squaredDist1>squaredDist2?closestSegment[1]:closestSegment[0],vertexPixel=map.getPixelFromCoordinate(vertex))))),snapped&&(vertexPixel=[Math.round(vertexPixel[0]),Math.round(vertexPixel[1])])}return{snapped:snapped,vertex:vertex,vertexPixel:vertexPixel}},Snap.prototype.updateFeature_=function(feature){this.removeFeature(feature,!1),this.addFeature(feature,!1)},Snap.prototype.writeCircleGeometry_=function(feature,geometry){for(var coordinates=fromCircle(geometry).getCoordinates()[0],i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Snap.prototype.writeGeometryCollectionGeometry_=function(feature,geometry){for(var geometries=geometry.getGeometriesArray(),i=0;i<geometries.length;++i){var segmentWriter=this.SEGMENT_WRITERS_[geometries[i].getType()];segmentWriter&&segmentWriter.call(this,feature,geometries[i])}},Snap.prototype.writeLineStringGeometry_=function(feature,geometry){for(var coordinates=geometry.getCoordinates(),i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Snap.prototype.writeMultiLineStringGeometry_=function(feature,geometry){for(var lines=geometry.getCoordinates(),j=0,jj=lines.length;j<jj;++j)for(var coordinates=lines[j],i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Snap.prototype.writeMultiPointGeometry_=function(feature,geometry){for(var points=geometry.getCoordinates(),i=0,ii=points.length;i<ii;++i){var coordinates=points[i],segmentData={feature:feature,segment:[coordinates,coordinates]};this.rBush_.insert(geometry.getExtent(),segmentData)}},Snap.prototype.writeMultiPolygonGeometry_=function(feature,geometry){for(var polygons=geometry.getCoordinates(),k=0,kk=polygons.length;k<kk;++k)for(var rings=polygons[k],j=0,jj=rings.length;j<jj;++j)for(var coordinates=rings[j],i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Snap.prototype.writePointGeometry_=function(feature,geometry){var coordinates=geometry.getCoordinates(),segmentData={feature:feature,segment:[coordinates,coordinates]};this.rBush_.insert(geometry.getExtent(),segmentData)},Snap.prototype.writePolygonGeometry_=function(feature,geometry){for(var rings=geometry.getCoordinates(),j=0,jj=rings.length;j<jj;++j)for(var coordinates=rings[j],i=0,ii=coordinates.length-1;i<ii;++i){var segment=coordinates.slice(i,i+2),segmentData={feature:feature,segment:segment};this.rBush_.insert(boundingExtent(segment),segmentData)}},Snap}(PointerInteraction);function sortByDistance(a,b){return squaredDistanceToSegment(this.pixelCoordinate_,a.segment)-squaredDistanceToSegment(this.pixelCoordinate_,b.segment)}var TranslateEventType={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"},TranslateEvent=function(Event$$1){function TranslateEvent(type,features,coordinate){Event$$1.call(this,type),this.features=features,this.coordinate=coordinate}return Event$$1&&(TranslateEvent.__proto__=Event$$1),TranslateEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),TranslateEvent.prototype.constructor=TranslateEvent,TranslateEvent}(Event),Translate=function(PointerInteraction$$1){function Translate(opt_options){var layerFilter,options=opt_options||{};if(PointerInteraction$$1.call(this,options),this.lastCoordinate_=null,this.features_=void 0!==options.features?options.features:null,options.layers)if("function"==typeof options.layers)layerFilter=options.layers;else{var layers=options.layers;layerFilter=function(layer){return includes(layers,layer)}}else layerFilter=TRUE;this.layerFilter_=layerFilter,this.hitTolerance_=options.hitTolerance?options.hitTolerance:0,this.lastFeature_=null,listen(this,getChangeEventType(InteractionProperty.ACTIVE),this.handleActiveChanged_,this)}return PointerInteraction$$1&&(Translate.__proto__=PointerInteraction$$1),Translate.prototype=Object.create(PointerInteraction$$1&&PointerInteraction$$1.prototype),Translate.prototype.constructor=Translate,Translate.prototype.handleDownEvent=function(event){if(this.lastFeature_=this.featuresAtPixel_(event.pixel,event.map),!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=event.coordinate,this.handleMoveEvent(event);var features=this.features_||new Collection([this.lastFeature_]);return this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATESTART,features,event.coordinate)),!0}return!1},Translate.prototype.handleUpEvent=function(event){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(event);var features=this.features_||new Collection([this.lastFeature_]);return this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATEEND,features,event.coordinate)),!0}return!1},Translate.prototype.handleDragEvent=function(event){if(this.lastCoordinate_){var newCoordinate=event.coordinate,deltaX=newCoordinate[0]-this.lastCoordinate_[0],deltaY=newCoordinate[1]-this.lastCoordinate_[1],features=this.features_||new Collection([this.lastFeature_]);features.forEach(function(feature){var geom=feature.getGeometry();geom.translate(deltaX,deltaY),feature.setGeometry(geom)}),this.lastCoordinate_=newCoordinate,this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATING,features,newCoordinate))}},Translate.prototype.handleMoveEvent=function(event){var elem=event.map.getViewport();this.featuresAtPixel_(event.pixel,event.map)?(elem.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),elem.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):elem.classList.remove("ol-grab","ol-grabbing")},Translate.prototype.featuresAtPixel_=function(pixel,map){return map.forEachFeatureAtPixel(pixel,function(feature){if(!this.features_||includes(this.features_.getArray(),feature))return feature}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},Translate.prototype.getHitTolerance=function(){return this.hitTolerance_},Translate.prototype.setHitTolerance=function(hitTolerance){this.hitTolerance_=hitTolerance},Translate.prototype.setMap=function(map){var oldMap=this.getMap();PointerInteraction$$1.prototype.setMap.call(this,map),this.updateState_(oldMap)},Translate.prototype.handleActiveChanged_=function(){this.updateState_(null)},Translate.prototype.updateState_=function(oldMap){var map=this.getMap(),active=this.getActive();map&&active||(map=map||oldMap)&&map.getViewport().classList.remove("ol-grab","ol-grabbing")},Translate}(PointerInteraction);function defaults$1(opt_options){var options=opt_options||{},interactions=new Collection,kinetic=new Kinetic(-.005,.05,100);return(void 0===options.altShiftDragRotate||options.altShiftDragRotate)&&interactions.push(new DragRotate),(void 0===options.doubleClickZoom||options.doubleClickZoom)&&interactions.push(new DoubleClickZoom({delta:options.zoomDelta,duration:options.zoomDuration})),(void 0===options.dragPan||options.dragPan)&&interactions.push(new DragPan({condition:options.onFocusOnly?focus:void 0,kinetic:kinetic})),(void 0===options.pinchRotate||options.pinchRotate)&&interactions.push(new PinchRotate),(void 0===options.pinchZoom||options.pinchZoom)&&interactions.push(new PinchZoom({constrainResolution:options.constrainResolution,duration:options.zoomDuration})),(void 0===options.keyboard||options.keyboard)&&(interactions.push(new KeyboardPan),interactions.push(new KeyboardZoom({delta:options.zoomDelta,duration:options.zoomDuration}))),(void 0===options.mouseWheelZoom||options.mouseWheelZoom)&&interactions.push(new MouseWheelZoom({condition:options.onFocusOnly?focus:void 0,constrainResolution:options.constrainResolution,duration:options.zoomDuration})),(void 0===options.shiftDragZoom||options.shiftDragZoom)&&interactions.push(new DragZoom({duration:options.zoomDuration})),interactions}var ERROR_THRESHOLD=.5,ImageBase=function(EventTarget){function ImageBase(extent,resolution,pixelRatio,state){EventTarget.call(this),this.extent=extent,this.pixelRatio_=pixelRatio,this.resolution=resolution,this.state=state}return EventTarget&&(ImageBase.__proto__=EventTarget),ImageBase.prototype=Object.create(EventTarget&&EventTarget.prototype),ImageBase.prototype.constructor=ImageBase,ImageBase.prototype.changed=function(){this.dispatchEvent(EventType.CHANGE)},ImageBase.prototype.getExtent=function(){return this.extent},ImageBase.prototype.getImage=function(){return abstract()},ImageBase.prototype.getPixelRatio=function(){return this.pixelRatio_},ImageBase.prototype.getResolution=function(){return this.resolution},ImageBase.prototype.getState=function(){return this.state},ImageBase.prototype.load=function(){abstract()},ImageBase}(Target),ImageCanvas=function(ImageBase$$1){function ImageCanvas(extent,resolution,pixelRatio,canvas,opt_loader){var state=void 0!==opt_loader?ImageState.IDLE:ImageState.LOADED;ImageBase$$1.call(this,extent,resolution,pixelRatio,state),this.loader_=void 0!==opt_loader?opt_loader:null,this.canvas_=canvas,this.error_=null}return ImageBase$$1&&(ImageCanvas.__proto__=ImageBase$$1),ImageCanvas.prototype=Object.create(ImageBase$$1&&ImageBase$$1.prototype),ImageCanvas.prototype.constructor=ImageCanvas,ImageCanvas.prototype.getError=function(){return this.error_},ImageCanvas.prototype.handleLoad_=function(err){err?(this.error_=err,this.state=ImageState.ERROR):this.state=ImageState.LOADED,this.changed()},ImageCanvas.prototype.load=function(){this.state==ImageState.IDLE&&(this.state=ImageState.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},ImageCanvas.prototype.getImage=function(){return this.canvas_},ImageCanvas}(ImageBase),RenderEvent=function(Event$$1){function RenderEvent(type,opt_vectorContext,opt_frameState,opt_context,opt_glContext){Event$$1.call(this,type),this.vectorContext=opt_vectorContext,this.frameState=opt_frameState,this.context=opt_context,this.glContext=opt_glContext}return Event$$1&&(RenderEvent.__proto__=Event$$1),RenderEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),RenderEvent.prototype.constructor=RenderEvent,RenderEvent}(Event),VectorContext=function(){};VectorContext.prototype.drawCustom=function(geometry,feature,renderer){},VectorContext.prototype.drawGeometry=function(geometry){},VectorContext.prototype.setStyle=function(style){},VectorContext.prototype.drawCircle=function(circleGeometry,feature){},VectorContext.prototype.drawFeature=function(feature,style){},VectorContext.prototype.drawGeometryCollection=function(geometryCollectionGeometry,feature){},VectorContext.prototype.drawLineString=function(lineStringGeometry,feature){},VectorContext.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){},VectorContext.prototype.drawMultiPoint=function(multiPointGeometry,feature){},VectorContext.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){},VectorContext.prototype.drawPoint=function(pointGeometry,feature){},VectorContext.prototype.drawPolygon=function(polygonGeometry,feature){},VectorContext.prototype.drawText=function(geometry,feature){},VectorContext.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){},VectorContext.prototype.setImageStyle=function(imageStyle,opt_declutterGroup){},VectorContext.prototype.setTextStyle=function(textStyle,opt_declutterGroup){};var CanvasImmediateRenderer=function(VectorContext$$1){function CanvasImmediateRenderer(context,pixelRatio,extent,transform,viewRotation){VectorContext$$1.call(this),this.context_=context,this.pixelRatio_=pixelRatio,this.extent_=extent,this.transform_=transform,this.viewRotation_=viewRotation,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=create()}return VectorContext$$1&&(CanvasImmediateRenderer.__proto__=VectorContext$$1),CanvasImmediateRenderer.prototype=Object.create(VectorContext$$1&&VectorContext$$1.prototype),CanvasImmediateRenderer.prototype.constructor=CanvasImmediateRenderer,CanvasImmediateRenderer.prototype.drawImages_=function(flatCoordinates,offset,end,stride){if(this.image_){var pixelCoordinates=transform2D(flatCoordinates,offset,end,2,this.transform_,this.pixelCoordinates_),context=this.context_,localTransform=this.tmpLocalTransform_,alpha=context.globalAlpha;1!=this.imageOpacity_&&(context.globalAlpha=alpha*this.imageOpacity_);var rotation=this.imageRotation_;this.imageRotateWithView_&&(rotation+=this.viewRotation_);for(var i=0,ii=pixelCoordinates.length;i<ii;i+=2){var x=pixelCoordinates[i]-this.imageAnchorX_,y=pixelCoordinates[i+1]-this.imageAnchorY_;if(0!==rotation||1!=this.imageScale_){var centerX=x+this.imageAnchorX_,centerY=y+this.imageAnchorY_;compose(localTransform,centerX,centerY,this.imageScale_,this.imageScale_,rotation,-centerX,-centerY),context.setTransform.apply(context,localTransform)}context.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,x,y,this.imageWidth_,this.imageHeight_)}0===rotation&&1==this.imageScale_||context.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(context.globalAlpha=alpha)}},CanvasImmediateRenderer.prototype.drawText_=function(flatCoordinates,offset,end,stride){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var pixelCoordinates=transform2D(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_),context=this.context_,rotation=this.textRotation_;for(this.textRotateWithView_&&(rotation+=this.viewRotation_);offset<end;offset+=stride){var x=pixelCoordinates[offset]+this.textOffsetX_,y=pixelCoordinates[offset+1]+this.textOffsetY_;if(0!==rotation||1!=this.textScale_){var localTransform=compose(this.tmpLocalTransform_,x,y,this.textScale_,this.textScale_,rotation,-x,-y);context.setTransform.apply(context,localTransform)}this.textStrokeState_&&context.strokeText(this.text_,x,y),this.textFillState_&&context.fillText(this.text_,x,y)}0===rotation&&1==this.textScale_||context.setTransform(1,0,0,1,0,0)}},CanvasImmediateRenderer.prototype.moveToLineTo_=function(flatCoordinates,offset,end,stride,close){var context=this.context_,pixelCoordinates=transform2D(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_);context.moveTo(pixelCoordinates[0],pixelCoordinates[1]);var length=pixelCoordinates.length;close&&(length-=2);for(var i=2;i<length;i+=2)context.lineTo(pixelCoordinates[i],pixelCoordinates[i+1]);return close&&context.closePath(),end},CanvasImmediateRenderer.prototype.drawRings_=function(flatCoordinates,offset,ends,stride){for(var i=0,ii=ends.length;i<ii;++i)offset=this.moveToLineTo_(flatCoordinates,offset,ends[i],stride,!0);return offset},CanvasImmediateRenderer.prototype.drawCircle=function(geometry){if(intersects(this.extent_,geometry.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var pixelCoordinates=transformGeom2D(geometry,this.transform_,this.pixelCoordinates_),dx=pixelCoordinates[2]-pixelCoordinates[0],dy=pixelCoordinates[3]-pixelCoordinates[1],radius=Math.sqrt(dx*dx+dy*dy),context=this.context_;context.beginPath(),context.arc(pixelCoordinates[0],pixelCoordinates[1],radius,0,2*Math.PI),this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}""!==this.text_&&this.drawText_(geometry.getCenter(),0,2,2)}},CanvasImmediateRenderer.prototype.setStyle=function(style){this.setFillStrokeStyle(style.getFill(),style.getStroke()),this.setImageStyle(style.getImage()),this.setTextStyle(style.getText())},CanvasImmediateRenderer.prototype.drawGeometry=function(geometry){switch(geometry.getType()){case GeometryType.POINT:this.drawPoint(geometry);break;case GeometryType.LINE_STRING:this.drawLineString(geometry);break;case GeometryType.POLYGON:this.drawPolygon(geometry);break;case GeometryType.MULTI_POINT:this.drawMultiPoint(geometry);break;case GeometryType.MULTI_LINE_STRING:this.drawMultiLineString(geometry);break;case GeometryType.MULTI_POLYGON:this.drawMultiPolygon(geometry);break;case GeometryType.GEOMETRY_COLLECTION:this.drawGeometryCollection(geometry);break;case GeometryType.CIRCLE:this.drawCircle(geometry)}},CanvasImmediateRenderer.prototype.drawFeature=function(feature,style){var geometry=style.getGeometryFunction()(feature);geometry&&intersects(this.extent_,geometry.getExtent())&&(this.setStyle(style),this.drawGeometry(geometry))},CanvasImmediateRenderer.prototype.drawGeometryCollection=function(geometry){for(var geometries=geometry.getGeometriesArray(),i=0,ii=geometries.length;i<ii;++i)this.drawGeometry(geometries[i])},CanvasImmediateRenderer.prototype.drawPoint=function(geometry){var flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride();this.image_&&this.drawImages_(flatCoordinates,0,flatCoordinates.length,stride),""!==this.text_&&this.drawText_(flatCoordinates,0,flatCoordinates.length,stride)},CanvasImmediateRenderer.prototype.drawMultiPoint=function(geometry){var flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride();this.image_&&this.drawImages_(flatCoordinates,0,flatCoordinates.length,stride),""!==this.text_&&this.drawText_(flatCoordinates,0,flatCoordinates.length,stride)},CanvasImmediateRenderer.prototype.drawLineString=function(geometry){if(intersects(this.extent_,geometry.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var context=this.context_,flatCoordinates=geometry.getFlatCoordinates();context.beginPath(),this.moveToLineTo_(flatCoordinates,0,flatCoordinates.length,geometry.getStride(),!1),context.stroke()}if(""!==this.text_){var flatMidpoint=geometry.getFlatMidpoint();this.drawText_(flatMidpoint,0,2,2)}}},CanvasImmediateRenderer.prototype.drawMultiLineString=function(geometry){var geometryExtent=geometry.getExtent();if(intersects(this.extent_,geometryExtent)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var context=this.context_,flatCoordinates=geometry.getFlatCoordinates(),offset=0,ends=geometry.getEnds(),stride=geometry.getStride();context.beginPath();for(var i=0,ii=ends.length;i<ii;++i)offset=this.moveToLineTo_(flatCoordinates,offset,ends[i],stride,!1);context.stroke()}if(""!==this.text_){var flatMidpoints=geometry.getFlatMidpoints();this.drawText_(flatMidpoints,0,flatMidpoints.length,2)}}},CanvasImmediateRenderer.prototype.drawPolygon=function(geometry){if(intersects(this.extent_,geometry.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var context=this.context_;context.beginPath(),this.drawRings_(geometry.getOrientedFlatCoordinates(),0,geometry.getEnds(),geometry.getStride()),this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}if(""!==this.text_){var flatInteriorPoint=geometry.getFlatInteriorPoint();this.drawText_(flatInteriorPoint,0,2,2)}}},CanvasImmediateRenderer.prototype.drawMultiPolygon=function(geometry){if(intersects(this.extent_,geometry.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var context=this.context_,flatCoordinates=geometry.getOrientedFlatCoordinates(),offset=0,endss=geometry.getEndss(),stride=geometry.getStride();context.beginPath();for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];offset=this.drawRings_(flatCoordinates,offset,ends,stride)}this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}if(""!==this.text_){var flatInteriorPoints=geometry.getFlatInteriorPoints();this.drawText_(flatInteriorPoints,0,flatInteriorPoints.length,2)}}},CanvasImmediateRenderer.prototype.setContextFillState_=function(fillState){var context=this.context_,contextFillState=this.contextFillState_;contextFillState?contextFillState.fillStyle!=fillState.fillStyle&&(contextFillState.fillStyle=context.fillStyle=fillState.fillStyle):(context.fillStyle=fillState.fillStyle,this.contextFillState_={fillStyle:fillState.fillStyle})},CanvasImmediateRenderer.prototype.setContextStrokeState_=function(strokeState){var context=this.context_,contextStrokeState=this.contextStrokeState_;contextStrokeState?(contextStrokeState.lineCap!=strokeState.lineCap&&(contextStrokeState.lineCap=context.lineCap=strokeState.lineCap),CANVAS_LINE_DASH&&(equals(contextStrokeState.lineDash,strokeState.lineDash)||context.setLineDash(contextStrokeState.lineDash=strokeState.lineDash),contextStrokeState.lineDashOffset!=strokeState.lineDashOffset&&(contextStrokeState.lineDashOffset=context.lineDashOffset=strokeState.lineDashOffset)),contextStrokeState.lineJoin!=strokeState.lineJoin&&(contextStrokeState.lineJoin=context.lineJoin=strokeState.lineJoin),contextStrokeState.lineWidth!=strokeState.lineWidth&&(contextStrokeState.lineWidth=context.lineWidth=strokeState.lineWidth),contextStrokeState.miterLimit!=strokeState.miterLimit&&(contextStrokeState.miterLimit=context.miterLimit=strokeState.miterLimit),contextStrokeState.strokeStyle!=strokeState.strokeStyle&&(contextStrokeState.strokeStyle=context.strokeStyle=strokeState.strokeStyle)):(context.lineCap=strokeState.lineCap,CANVAS_LINE_DASH&&(context.setLineDash(strokeState.lineDash),context.lineDashOffset=strokeState.lineDashOffset),context.lineJoin=strokeState.lineJoin,context.lineWidth=strokeState.lineWidth,context.miterLimit=strokeState.miterLimit,context.strokeStyle=strokeState.strokeStyle,this.contextStrokeState_={lineCap:strokeState.lineCap,lineDash:strokeState.lineDash,lineDashOffset:strokeState.lineDashOffset,lineJoin:strokeState.lineJoin,lineWidth:strokeState.lineWidth,miterLimit:strokeState.miterLimit,strokeStyle:strokeState.strokeStyle})},CanvasImmediateRenderer.prototype.setContextTextState_=function(textState){var context=this.context_,contextTextState=this.contextTextState_,textAlign=textState.textAlign?textState.textAlign:defaultTextAlign;contextTextState?(contextTextState.font!=textState.font&&(contextTextState.font=context.font=textState.font),contextTextState.textAlign!=textAlign&&(contextTextState.textAlign=context.textAlign=textAlign),contextTextState.textBaseline!=textState.textBaseline&&(contextTextState.textBaseline=context.textBaseline=textState.textBaseline)):(context.font=textState.font,context.textAlign=textAlign,context.textBaseline=textState.textBaseline,this.contextTextState_={font:textState.font,textAlign:textAlign,textBaseline:textState.textBaseline})},CanvasImmediateRenderer.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){if(fillStyle){var fillStyleColor=fillStyle.getColor();this.fillState_={fillStyle:asColorLike(fillStyleColor||defaultFillStyle)}}else this.fillState_=null;if(strokeStyle){var strokeStyleColor=strokeStyle.getColor(),strokeStyleLineCap=strokeStyle.getLineCap(),strokeStyleLineDash=strokeStyle.getLineDash(),strokeStyleLineDashOffset=strokeStyle.getLineDashOffset(),strokeStyleLineJoin=strokeStyle.getLineJoin(),strokeStyleWidth=strokeStyle.getWidth(),strokeStyleMiterLimit=strokeStyle.getMiterLimit();this.strokeState_={lineCap:void 0!==strokeStyleLineCap?strokeStyleLineCap:defaultLineCap,lineDash:strokeStyleLineDash||defaultLineDash,lineDashOffset:strokeStyleLineDashOffset||defaultLineDashOffset,lineJoin:void 0!==strokeStyleLineJoin?strokeStyleLineJoin:defaultLineJoin,lineWidth:this.pixelRatio_*(void 0!==strokeStyleWidth?strokeStyleWidth:defaultLineWidth),miterLimit:void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:defaultMiterLimit,strokeStyle:asColorLike(strokeStyleColor||defaultStrokeStyle)}}else this.strokeState_=null},CanvasImmediateRenderer.prototype.setImageStyle=function(imageStyle){if(imageStyle){var imageAnchor=imageStyle.getAnchor(),imageImage=imageStyle.getImage(1),imageOrigin=imageStyle.getOrigin(),imageSize=imageStyle.getSize();this.imageAnchorX_=imageAnchor[0],this.imageAnchorY_=imageAnchor[1],this.imageHeight_=imageSize[1],this.image_=imageImage,this.imageOpacity_=imageStyle.getOpacity(),this.imageOriginX_=imageOrigin[0],this.imageOriginY_=imageOrigin[1],this.imageRotateWithView_=imageStyle.getRotateWithView(),this.imageRotation_=imageStyle.getRotation(),this.imageScale_=imageStyle.getScale()*this.pixelRatio_,this.imageWidth_=imageSize[0]}else this.image_=null},CanvasImmediateRenderer.prototype.setTextStyle=function(textStyle){if(textStyle){var textFillStyle=textStyle.getFill();if(textFillStyle){var textFillStyleColor=textFillStyle.getColor();this.textFillState_={fillStyle:asColorLike(textFillStyleColor||defaultFillStyle)}}else this.textFillState_=null;var textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){var textStrokeStyleColor=textStrokeStyle.getColor(),textStrokeStyleLineCap=textStrokeStyle.getLineCap(),textStrokeStyleLineDash=textStrokeStyle.getLineDash(),textStrokeStyleLineDashOffset=textStrokeStyle.getLineDashOffset(),textStrokeStyleLineJoin=textStrokeStyle.getLineJoin(),textStrokeStyleWidth=textStrokeStyle.getWidth(),textStrokeStyleMiterLimit=textStrokeStyle.getMiterLimit();this.textStrokeState_={lineCap:void 0!==textStrokeStyleLineCap?textStrokeStyleLineCap:defaultLineCap,lineDash:textStrokeStyleLineDash||defaultLineDash,lineDashOffset:textStrokeStyleLineDashOffset||defaultLineDashOffset,lineJoin:void 0!==textStrokeStyleLineJoin?textStrokeStyleLineJoin:defaultLineJoin,lineWidth:void 0!==textStrokeStyleWidth?textStrokeStyleWidth:defaultLineWidth,miterLimit:void 0!==textStrokeStyleMiterLimit?textStrokeStyleMiterLimit:defaultMiterLimit,strokeStyle:asColorLike(textStrokeStyleColor||defaultStrokeStyle)}}else this.textStrokeState_=null;var textFont=textStyle.getFont(),textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation(),textScale=textStyle.getScale(),textText=textStyle.getText(),textTextAlign=textStyle.getTextAlign(),textTextBaseline=textStyle.getTextBaseline();this.textState_={font:void 0!==textFont?textFont:defaultFont,textAlign:void 0!==textTextAlign?textTextAlign:defaultTextAlign,textBaseline:void 0!==textTextBaseline?textTextBaseline:defaultTextBaseline},this.text_=void 0!==textText?textText:"",this.textOffsetX_=void 0!==textOffsetX?this.pixelRatio_*textOffsetX:0,this.textOffsetY_=void 0!==textOffsetY?this.pixelRatio_*textOffsetY:0,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0!==textRotation?textRotation:0,this.textScale_=this.pixelRatio_*(void 0!==textScale?textScale:1)}else this.text_=""},CanvasImmediateRenderer}(VectorContext),IconImageCache=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};function getKey(src,crossOrigin,color){return crossOrigin+":"+src+":"+(color?asString(color):"null")}IconImageCache.prototype.clear=function(){this.cache_={},this.cacheSize_=0},IconImageCache.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var i=0;for(var key in this.cache_){var iconImage=this.cache_[key];0!=(3&i++)||iconImage.hasListener()||(delete this.cache_[key],--this.cacheSize_)}}},IconImageCache.prototype.get=function(src,crossOrigin,color){var key=getKey(src,crossOrigin,color);return key in this.cache_?this.cache_[key]:null},IconImageCache.prototype.set=function(src,crossOrigin,color,iconImage){var key=getKey(src,crossOrigin,color);this.cache_[key]=iconImage,++this.cacheSize_},IconImageCache.prototype.setSize=function(maxCacheSize){this.maxCacheSize_=maxCacheSize,this.expire()};var shared=new IconImageCache,MapRenderer=function(Disposable$$1){function MapRenderer(map){Disposable$$1.call(this),this.map_=map,this.layerRenderers_={},this.layerRendererListeners_={},this.layerRendererConstructors_=[]}return Disposable$$1&&(MapRenderer.__proto__=Disposable$$1),MapRenderer.prototype=Object.create(Disposable$$1&&Disposable$$1.prototype),MapRenderer.prototype.constructor=MapRenderer,MapRenderer.prototype.dispatchRenderEvent=function(type,frameState){abstract()},MapRenderer.prototype.registerLayerRenderers=function(constructors){this.layerRendererConstructors_.push.apply(this.layerRendererConstructors_,constructors)},MapRenderer.prototype.calculateMatrices2D=function(frameState){var viewState=frameState.viewState,coordinateToPixelTransform=frameState.coordinateToPixelTransform,pixelToCoordinateTransform=frameState.pixelToCoordinateTransform;compose(coordinateToPixelTransform,frameState.size[0]/2,frameState.size[1]/2,1/viewState.resolution,-1/viewState.resolution,-viewState.rotation,-viewState.center[0],-viewState.center[1]),invert(setFromArray(pixelToCoordinateTransform,coordinateToPixelTransform))},MapRenderer.prototype.removeLayerRenderers=function(){for(var key in this.layerRenderers_)this.removeLayerRendererByKey_(key).dispose()},MapRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg,layerFilter,thisArg2){var result,viewState=frameState.viewState,viewResolution=viewState.resolution;function forEachFeatureAtCoordinate(feature,layer){var managed=frameState.layerStates[getUid(layer)].managed;if(!(getUid(feature)in frameState.skippedFeatureUids)||managed)return callback.call(thisArg,feature,managed?layer:null)}var projection=viewState.projection,translatedCoordinate=coordinate;if(projection.canWrapX()){var projectionExtent=projection.getExtent(),worldWidth=getWidth(projectionExtent),x=coordinate[0];if(x<projectionExtent[0]||x>projectionExtent[2])translatedCoordinate=[x+worldWidth*Math.ceil((projectionExtent[0]-x)/worldWidth),coordinate[1]]}var i,layerStates=frameState.layerStatesArray;for(i=layerStates.length-1;i>=0;--i){var layerState=layerStates[i],layer=layerState.layer;if(visibleAtResolution(layerState,viewResolution)&&layerFilter.call(thisArg2,layer)){var layerRenderer=this.getLayerRenderer(layer),source=layer.getSource();if(source&&(result=layerRenderer.forEachFeatureAtCoordinate(source.getWrapX()?translatedCoordinate:coordinate,frameState,hitTolerance,forEachFeatureAtCoordinate)),result)return result}}},MapRenderer.prototype.forEachLayerAtPixel=function(pixel,frameState,hitTolerance,callback,thisArg,layerFilter,thisArg2){return abstract()},MapRenderer.prototype.hasFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,layerFilter,thisArg){return void 0!==this.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,TRUE,this,layerFilter,thisArg)},MapRenderer.prototype.getLayerRenderer=function(layer){var layerKey=getUid(layer);if(layerKey in this.layerRenderers_)return this.layerRenderers_[layerKey];for(var renderer,i=0,ii=this.layerRendererConstructors_.length;i<ii;++i){var candidate=this.layerRendererConstructors_[i];if(candidate.handles(layer)){renderer=candidate.create(this,layer);break}}if(!renderer)throw new Error("Unable to create renderer for layer: "+layer.getType());return this.layerRenderers_[layerKey]=renderer,this.layerRendererListeners_[layerKey]=listen(renderer,EventType.CHANGE,this.handleLayerRendererChange_,this),renderer},MapRenderer.prototype.getLayerRendererByKey=function(layerKey){return this.layerRenderers_[layerKey]},MapRenderer.prototype.getLayerRenderers=function(){return this.layerRenderers_},MapRenderer.prototype.getMap=function(){return this.map_},MapRenderer.prototype.handleLayerRendererChange_=function(){this.map_.render()},MapRenderer.prototype.removeLayerRendererByKey_=function(layerKey){var layerRenderer=this.layerRenderers_[layerKey];return delete this.layerRenderers_[layerKey],unlistenByKey(this.layerRendererListeners_[layerKey]),delete this.layerRendererListeners_[layerKey],layerRenderer},MapRenderer.prototype.removeUnusedLayerRenderers_=function(map,frameState){for(var layerKey in this.layerRenderers_)frameState&&layerKey in frameState.layerStates||this.removeLayerRendererByKey_(layerKey).dispose()},MapRenderer.prototype.renderFrame=function(frameState){abstract()},MapRenderer.prototype.scheduleExpireIconCache=function(frameState){frameState.postRenderFunctions.push(expireIconCache)},MapRenderer.prototype.scheduleRemoveUnusedLayerRenderers=function(frameState){for(var layerKey in this.layerRenderers_)if(!(layerKey in frameState.layerStates))return void frameState.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this))},MapRenderer}(Disposable);function expireIconCache(map,frameState){shared.expire()}function sortByZIndex(state1,state2){return state1.zIndex-state2.zIndex}var layerRendererConstructors=[],CanvasMapRenderer=function(MapRenderer$$1){function CanvasMapRenderer(map){MapRenderer$$1.call(this,map);var container=map.getViewport();this.context_=createCanvasContext2D(),this.canvas_=this.context_.canvas,this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className=CLASS_UNSELECTABLE,container.insertBefore(this.canvas_,container.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=create()}return MapRenderer$$1&&(CanvasMapRenderer.__proto__=MapRenderer$$1),CanvasMapRenderer.prototype=Object.create(MapRenderer$$1&&MapRenderer$$1.prototype),CanvasMapRenderer.prototype.constructor=CanvasMapRenderer,CanvasMapRenderer.prototype.dispatchRenderEvent=function(type,frameState){var map=this.getMap(),context=this.context_;if(map.hasListener(type)){var extent=frameState.extent,pixelRatio=frameState.pixelRatio,rotation=frameState.viewState.rotation,transform=this.getTransform(frameState),vectorContext=new CanvasImmediateRenderer(context,pixelRatio,extent,transform,rotation),composeEvent=new RenderEvent(type,vectorContext,frameState,context,null);map.dispatchEvent(composeEvent)}},CanvasMapRenderer.prototype.getTransform=function(frameState){var viewState=frameState.viewState,dx1=this.canvas_.width/2,dy1=this.canvas_.height/2,sx=frameState.pixelRatio/viewState.resolution,sy=-sx,angle=-viewState.rotation,dx2=-viewState.center[0],dy2=-viewState.center[1];return compose(this.transform_,dx1,dy1,sx,sy,angle,dx2,dy2)},CanvasMapRenderer.prototype.renderFrame=function(frameState){if(frameState){var context=this.context_,pixelRatio=frameState.pixelRatio,width=Math.round(frameState.size[0]*pixelRatio),height=Math.round(frameState.size[1]*pixelRatio);this.canvas_.width!=width||this.canvas_.height!=height?(this.canvas_.width=width,this.canvas_.height=height):context.clearRect(0,0,width,height);var rotation=frameState.viewState.rotation;this.calculateMatrices2D(frameState),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,frameState);var layerStatesArray=frameState.layerStatesArray;stableSort(layerStatesArray,sortByZIndex),rotation&&(context.save(),rotateAtOffset(context,rotation,width/2,height/2));var i,ii,viewResolution=frameState.viewState.resolution;for(i=0,ii=layerStatesArray.length;i<ii;++i){var layerState=layerStatesArray[i],layer=layerState.layer,layerRenderer=this.getLayerRenderer(layer);visibleAtResolution(layerState,viewResolution)&&layerState.sourceState==SourceState.READY&&(layerRenderer.prepareFrame(frameState,layerState)&&layerRenderer.composeFrame(frameState,layerState,context))}rotation&&context.restore(),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,frameState),this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(frameState),this.scheduleExpireIconCache(frameState)}else this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1)},CanvasMapRenderer.prototype.forEachLayerAtPixel=function(pixel,frameState,hitTolerance,callback,thisArg,layerFilter,thisArg2){var result,i,viewResolution=frameState.viewState.resolution,layerStates=frameState.layerStatesArray,numLayers=layerStates.length,coordinate=apply(frameState.pixelToCoordinateTransform,pixel.slice());for(i=numLayers-1;i>=0;--i){var layerState=layerStates[i],layer=layerState.layer;if(visibleAtResolution(layerState,viewResolution)&&layerFilter.call(thisArg2,layer))if(result=this.getLayerRenderer(layer).forEachLayerAtCoordinate(coordinate,frameState,hitTolerance,callback,thisArg))return result}},CanvasMapRenderer.prototype.registerLayerRenderers=function(constructors){MapRenderer$$1.prototype.registerLayerRenderers.call(this,constructors);for(var i=0,ii=constructors.length;i<ii;++i){var ctor=constructors[i];includes(layerRendererConstructors,ctor)||layerRendererConstructors.push(ctor)}},CanvasMapRenderer}(MapRenderer),LayerRenderer=function(Observable$$1){function LayerRenderer(layer){Observable$$1.call(this),this.layer_=layer}return Observable$$1&&(LayerRenderer.__proto__=Observable$$1),LayerRenderer.prototype=Object.create(Observable$$1&&Observable$$1.prototype),LayerRenderer.prototype.constructor=LayerRenderer,LayerRenderer.prototype.createLoadedTileFinder=function(source,projection,tiles){return function(zoom,tileRange){return source.forEachLoadedTile(projection,zoom,tileRange,function(tile){tiles[zoom]||(tiles[zoom]={}),tiles[zoom][tile.tileCoord.toString()]=tile})}},LayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback){},LayerRenderer.prototype.getLayer=function(){return this.layer_},LayerRenderer.prototype.handleImageChange_=function(event){event.target.getState()===ImageState.LOADED&&this.renderIfReadyAndVisible()},LayerRenderer.prototype.hasFeatureAtCoordinate=function(coordinate,frameState){return!1},LayerRenderer.prototype.loadImage=function(image){var imageState=image.getState();return imageState!=ImageState.LOADED&&imageState!=ImageState.ERROR&&listen(image,EventType.CHANGE,this.handleImageChange_,this),imageState==ImageState.IDLE&&(image.load(),imageState=image.getState()),imageState==ImageState.LOADED},LayerRenderer.prototype.renderIfReadyAndVisible=function(){var layer=this.getLayer();layer.getVisible()&&layer.getSourceState()==SourceState.READY&&this.changed()},LayerRenderer.prototype.scheduleExpireCache=function(frameState,tileSource){if(tileSource.canExpireCache()){var postRenderFunction=function(tileSource,map,frameState){var tileSourceKey=getUid(tileSource);tileSourceKey in frameState.usedTiles&&tileSource.expireCache(frameState.viewState.projection,frameState.usedTiles[tileSourceKey])}.bind(null,tileSource);frameState.postRenderFunctions.push(postRenderFunction)}},LayerRenderer.prototype.updateUsedTiles=function(usedTiles,tileSource,z,tileRange){var tileSourceKey=getUid(tileSource),zKey=z.toString();tileSourceKey in usedTiles?zKey in usedTiles[tileSourceKey]?usedTiles[tileSourceKey][zKey].extend(tileRange):usedTiles[tileSourceKey][zKey]=tileRange:(usedTiles[tileSourceKey]={},usedTiles[tileSourceKey][zKey]=tileRange)},LayerRenderer.prototype.manageTilePyramid=function(frameState,tileSource,tileGrid,pixelRatio,projection,extent,currentZ,preload,opt_tileCallback,opt_this){var tileSourceKey=getUid(tileSource);tileSourceKey in frameState.wantedTiles||(frameState.wantedTiles[tileSourceKey]={});var tile,tileRange,tileResolution,x,y,z,wantedTiles=frameState.wantedTiles[tileSourceKey],tileQueue=frameState.tileQueue;for(z=tileGrid.getMinZoom();z<=currentZ;++z)for(tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z,tileRange),tileResolution=tileGrid.getResolution(z),x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y)currentZ-z<=preload?((tile=tileSource.getTile(z,x,y,pixelRatio,projection)).getState()==TileState.IDLE&&(wantedTiles[tile.getKey()]=!0,tileQueue.isKeyQueued(tile.getKey())||tileQueue.enqueue([tile,tileSourceKey,tileGrid.getTileCoordCenter(tile.tileCoord),tileResolution])),void 0!==opt_tileCallback&&opt_tileCallback.call(opt_this,tile)):tileSource.useTile(z,x,y,projection)},LayerRenderer}(Observable),CanvasLayerRenderer=function(LayerRenderer$$1){function CanvasLayerRenderer(layer){LayerRenderer$$1.call(this,layer),this.renderedResolution,this.transform_=create()}return LayerRenderer$$1&&(CanvasLayerRenderer.__proto__=LayerRenderer$$1),CanvasLayerRenderer.prototype=Object.create(LayerRenderer$$1&&LayerRenderer$$1.prototype),CanvasLayerRenderer.prototype.constructor=CanvasLayerRenderer,CanvasLayerRenderer.prototype.clip=function(context,frameState,extent){var pixelRatio=frameState.pixelRatio,width=frameState.size[0]*pixelRatio,height=frameState.size[1]*pixelRatio,rotation=frameState.viewState.rotation,topLeft=getTopLeft(extent),topRight=getTopRight(extent),bottomRight=getBottomRight(extent),bottomLeft=getBottomLeft(extent);apply(frameState.coordinateToPixelTransform,topLeft),apply(frameState.coordinateToPixelTransform,topRight),apply(frameState.coordinateToPixelTransform,bottomRight),apply(frameState.coordinateToPixelTransform,bottomLeft),context.save(),rotateAtOffset(context,-rotation,width/2,height/2),context.beginPath(),context.moveTo(topLeft[0]*pixelRatio,topLeft[1]*pixelRatio),context.lineTo(topRight[0]*pixelRatio,topRight[1]*pixelRatio),context.lineTo(bottomRight[0]*pixelRatio,bottomRight[1]*pixelRatio),context.lineTo(bottomLeft[0]*pixelRatio,bottomLeft[1]*pixelRatio),context.clip(),rotateAtOffset(context,rotation,width/2,height/2)},CanvasLayerRenderer.prototype.dispatchComposeEvent_=function(type,context,frameState,opt_transform){var layer=this.getLayer();if(layer.hasListener(type)){var width=frameState.size[0]*frameState.pixelRatio,height=frameState.size[1]*frameState.pixelRatio,rotation=frameState.viewState.rotation;rotateAtOffset(context,-rotation,width/2,height/2);var transform=void 0!==opt_transform?opt_transform:this.getTransform(frameState,0),render=new CanvasImmediateRenderer(context,frameState.pixelRatio,frameState.extent,transform,frameState.viewState.rotation),composeEvent=new RenderEvent(type,render,frameState,context,null);layer.dispatchEvent(composeEvent),rotateAtOffset(context,rotation,width/2,height/2)}},CanvasLayerRenderer.prototype.forEachLayerAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){return this.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,TRUE)?callback.call(thisArg,this.getLayer(),null):void 0},CanvasLayerRenderer.prototype.postCompose=function(context,frameState,layerState,opt_transform){this.dispatchComposeEvent_(RenderEventType.POSTCOMPOSE,context,frameState,opt_transform)},CanvasLayerRenderer.prototype.preCompose=function(context,frameState,opt_transform){this.dispatchComposeEvent_(RenderEventType.PRECOMPOSE,context,frameState,opt_transform)},CanvasLayerRenderer.prototype.dispatchRenderEvent=function(context,frameState,opt_transform){this.dispatchComposeEvent_(RenderEventType.RENDER,context,frameState,opt_transform)},CanvasLayerRenderer.prototype.getTransform=function(frameState,offsetX){var viewState=frameState.viewState,pixelRatio=frameState.pixelRatio,dx1=pixelRatio*frameState.size[0]/2,dy1=pixelRatio*frameState.size[1]/2,sx=pixelRatio/viewState.resolution,sy=-sx,angle=-viewState.rotation,dx2=-viewState.center[0]+offsetX,dy2=-viewState.center[1];return compose(this.transform_,dx1,dy1,sx,sy,angle,dx2,dy2)},CanvasLayerRenderer.prototype.composeFrame=function(frameState,layerState,context){abstract()},CanvasLayerRenderer.prototype.prepareFrame=function(frameState,layerState){return abstract()},CanvasLayerRenderer}(LayerRenderer),IntermediateCanvasRenderer=function(CanvasLayerRenderer$$1){function IntermediateCanvasRenderer(layer){CanvasLayerRenderer$$1.call(this,layer),this.coordinateToCanvasPixelTransform=create(),this.hitCanvasContext_=null}return CanvasLayerRenderer$$1&&(IntermediateCanvasRenderer.__proto__=CanvasLayerRenderer$$1),IntermediateCanvasRenderer.prototype=Object.create(CanvasLayerRenderer$$1&&CanvasLayerRenderer$$1.prototype),IntermediateCanvasRenderer.prototype.constructor=IntermediateCanvasRenderer,IntermediateCanvasRenderer.prototype.composeFrame=function(frameState,layerState,context){this.preCompose(context,frameState);var image=this.getImage();if(image){var extent=layerState.extent,clipped=void 0!==extent&&!containsExtent(extent,frameState.extent)&&intersects(extent,frameState.extent);clipped&&this.clip(context,frameState,extent);var imageTransform=this.getImageTransform(),alpha=context.globalAlpha;context.globalAlpha=layerState.opacity;var dx=imageTransform[4],dy=imageTransform[5],dw=image.width*imageTransform[0],dh=image.height*imageTransform[3];dw>=.5&&dh>=.5&&context.drawImage(image,0,0,+image.width,+image.height,Math.round(dx),Math.round(dy),Math.round(dw),Math.round(dh)),context.globalAlpha=alpha,clipped&&context.restore()}this.postCompose(context,frameState,layerState)},IntermediateCanvasRenderer.prototype.getImage=function(){return abstract()},IntermediateCanvasRenderer.prototype.getImageTransform=function(){return abstract()},IntermediateCanvasRenderer.prototype.forEachLayerAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){if(this.getImage()){var pixel=apply(this.coordinateToCanvasPixelTransform,coordinate.slice());scale(pixel,frameState.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=createCanvasContext2D(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),pixel[0],pixel[1],1,1,0,0,1,1);var imageData=this.hitCanvasContext_.getImageData(0,0,1,1).data;return imageData[3]>0?callback.call(thisArg,this.getLayer(),imageData):void 0}},IntermediateCanvasRenderer}(CanvasLayerRenderer),CanvasImageLayerRenderer=function(IntermediateCanvasRenderer$$1){function CanvasImageLayerRenderer(imageLayer){if(IntermediateCanvasRenderer$$1.call(this,imageLayer),this.image_=null,this.imageTransform_=create(),this.skippedFeatures_=[],this.vectorRenderer_=null,imageLayer.getType()===LayerType.VECTOR)for(var i=0,ii=layerRendererConstructors.length;i<ii;++i){var ctor=layerRendererConstructors[i];if(ctor!==CanvasImageLayerRenderer&&ctor.handles(imageLayer)){this.vectorRenderer_=new ctor(imageLayer);break}}}return IntermediateCanvasRenderer$$1&&(CanvasImageLayerRenderer.__proto__=IntermediateCanvasRenderer$$1),CanvasImageLayerRenderer.prototype=Object.create(IntermediateCanvasRenderer$$1&&IntermediateCanvasRenderer$$1.prototype),CanvasImageLayerRenderer.prototype.constructor=CanvasImageLayerRenderer,CanvasImageLayerRenderer.prototype.disposeInternal=function(){this.vectorRenderer_&&this.vectorRenderer_.dispose(),IntermediateCanvasRenderer$$1.prototype.disposeInternal.call(this)},CanvasImageLayerRenderer.prototype.getImage=function(){return this.image_?this.image_.getImage():null},CanvasImageLayerRenderer.prototype.getImageTransform=function(){return this.imageTransform_},CanvasImageLayerRenderer.prototype.prepareFrame=function(frameState,layerState){var image,pixelRatio=frameState.pixelRatio,size=frameState.size,viewState=frameState.viewState,viewCenter=viewState.center,viewResolution=viewState.resolution,imageSource=this.getLayer().getSource(),hints=frameState.viewHints,vectorRenderer=this.vectorRenderer_,renderedExtent=frameState.extent;if(vectorRenderer||void 0===layerState.extent||(renderedExtent=getIntersection(renderedExtent,layerState.extent)),!hints[ViewHint.ANIMATING]&&!hints[ViewHint.INTERACTING]&&!isEmpty$1(renderedExtent)){var projection=viewState.projection,skippedFeatures=this.skippedFeatures_;if(vectorRenderer){var context=vectorRenderer.context,imageFrameState=assign({},frameState,{size:[getWidth(renderedExtent)/viewResolution,getHeight(renderedExtent)/viewResolution],viewState:assign({},frameState.viewState,{rotation:0})}),newSkippedFeatures=Object.keys(imageFrameState.skippedFeatureUids).sort();image=new ImageCanvas(renderedExtent,viewResolution,pixelRatio,context.canvas,function(callback){!vectorRenderer.prepareFrame(imageFrameState,layerState)||!vectorRenderer.replayGroupChanged&&equals(skippedFeatures,newSkippedFeatures)||(context.canvas.width=imageFrameState.size[0]*pixelRatio,context.canvas.height=imageFrameState.size[1]*pixelRatio,vectorRenderer.compose(context,imageFrameState,layerState),skippedFeatures=newSkippedFeatures,callback())})}else image=imageSource.getImage(renderedExtent,viewResolution,pixelRatio,projection);image&&this.loadImage(image)&&(this.image_=image,this.skippedFeatures_=skippedFeatures)}if(this.image_){var imageExtent=(image=this.image_).getExtent(),imageResolution=image.getResolution(),imagePixelRatio=image.getPixelRatio(),scale=pixelRatio*imageResolution/(viewResolution*imagePixelRatio),transform=compose(this.imageTransform_,pixelRatio*size[0]/2,pixelRatio*size[1]/2,scale,scale,0,imagePixelRatio*(imageExtent[0]-viewCenter[0])/imageResolution,imagePixelRatio*(viewCenter[1]-imageExtent[3])/imageResolution);compose(this.coordinateToCanvasPixelTransform,pixelRatio*size[0]/2-transform[4],pixelRatio*size[1]/2-transform[5],pixelRatio/viewResolution,-pixelRatio/viewResolution,0,-viewCenter[0],-viewCenter[1]),this.renderedResolution=imageResolution*pixelRatio/imagePixelRatio}return!!this.image_},CanvasImageLayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,callback):IntermediateCanvasRenderer$$1.prototype.forEachFeatureAtCoordinate.call(this,coordinate,frameState,hitTolerance,callback)},CanvasImageLayerRenderer}(IntermediateCanvasRenderer);CanvasImageLayerRenderer.handles=function(layer){return layer.getType()===LayerType.IMAGE||layer.getType()===LayerType.VECTOR&&layer.getRenderMode()===VectorRenderType.IMAGE},CanvasImageLayerRenderer.create=function(mapRenderer,layer){return new CanvasImageLayerRenderer(layer)};var TileRange=function(minX,maxX,minY,maxY){this.minX=minX,this.maxX=maxX,this.minY=minY,this.maxY=maxY};TileRange.prototype.contains=function(tileCoord){return this.containsXY(tileCoord[1],tileCoord[2])},TileRange.prototype.containsTileRange=function(tileRange){return this.minX<=tileRange.minX&&tileRange.maxX<=this.maxX&&this.minY<=tileRange.minY&&tileRange.maxY<=this.maxY},TileRange.prototype.containsXY=function(x,y){return this.minX<=x&&x<=this.maxX&&this.minY<=y&&y<=this.maxY},TileRange.prototype.equals=function(tileRange){return this.minX==tileRange.minX&&this.minY==tileRange.minY&&this.maxX==tileRange.maxX&&this.maxY==tileRange.maxY},TileRange.prototype.extend=function(tileRange){tileRange.minX<this.minX&&(this.minX=tileRange.minX),tileRange.maxX>this.maxX&&(this.maxX=tileRange.maxX),tileRange.minY<this.minY&&(this.minY=tileRange.minY),tileRange.maxY>this.maxY&&(this.maxY=tileRange.maxY)},TileRange.prototype.getHeight=function(){return this.maxY-this.minY+1},TileRange.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},TileRange.prototype.getWidth=function(){return this.maxX-this.minX+1},TileRange.prototype.intersects=function(tileRange){return this.minX<=tileRange.maxX&&this.maxX>=tileRange.minX&&this.minY<=tileRange.maxY&&this.maxY>=tileRange.minY};var CanvasTileLayerRenderer=function(IntermediateCanvasRenderer$$1){function CanvasTileLayerRenderer(tileLayer,opt_noContext){IntermediateCanvasRenderer$$1.call(this,tileLayer),this.context=opt_noContext?null:createCanvasContext2D(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=createEmpty(),this.tmpTileRange_=new TileRange(0,0,0,0),this.imageTransform_=create(),this.zDirection=0}return IntermediateCanvasRenderer$$1&&(CanvasTileLayerRenderer.__proto__=IntermediateCanvasRenderer$$1),CanvasTileLayerRenderer.prototype=Object.create(IntermediateCanvasRenderer$$1&&IntermediateCanvasRenderer$$1.prototype),CanvasTileLayerRenderer.prototype.constructor=CanvasTileLayerRenderer,CanvasTileLayerRenderer.prototype.isDrawableTile_=function(tile){var tileLayer=this.getLayer(),tileState=tile.getState(),useInterimTilesOnError=tileLayer.getUseInterimTilesOnError();return tileState==TileState.LOADED||tileState==TileState.EMPTY||tileState==TileState.ERROR&&!useInterimTilesOnError},CanvasTileLayerRenderer.prototype.getTile=function(z,x,y,pixelRatio,projection){var tileLayer=this.getLayer(),tile=tileLayer.getSource().getTile(z,x,y,pixelRatio,projection);return tile.getState()==TileState.ERROR&&(tileLayer.getUseInterimTilesOnError()?tileLayer.getPreload()>0&&(this.newTiles_=!0):tile.setState(TileState.LOADED)),this.isDrawableTile_(tile)||(tile=tile.getInterimTile()),tile},CanvasTileLayerRenderer.prototype.prepareFrame=function(frameState,layerState){var pixelRatio=frameState.pixelRatio,size=frameState.size,viewState=frameState.viewState,projection=viewState.projection,viewResolution=viewState.resolution,viewCenter=viewState.center,tileLayer=this.getLayer(),tileSource=tileLayer.getSource(),sourceRevision=tileSource.getRevision(),tileGrid=tileSource.getTileGridForProjection(projection),z=tileGrid.getZForResolution(viewResolution,this.zDirection),tileResolution=tileGrid.getResolution(z),oversampling=Math.round(viewResolution/tileResolution)||1,extent=frameState.extent;if(void 0!==layerState.extent&&(extent=getIntersection(extent,layerState.extent)),isEmpty$1(extent))return!1;var tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z),imageExtent=tileGrid.getTileRangeExtent(z,tileRange),tilePixelRatio=tileSource.getTilePixelRatio(pixelRatio),tilesToDrawByZ={};tilesToDrawByZ[z]={};var tile,x,y,findLoadedTiles=this.createLoadedTileFinder(tileSource,projection,tilesToDrawByZ),hints=frameState.viewHints,animatingOrInteracting=hints[ViewHint.ANIMATING]||hints[ViewHint.INTERACTING],tmpExtent=this.tmpExtent,tmpTileRange=this.tmpTileRange_;for(this.newTiles_=!1,x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y)if(!(Date.now()-frameState.time>16&&animatingOrInteracting)){if(tile=this.getTile(z,x,y,pixelRatio,projection),this.isDrawableTile_(tile)){var uid=getUid(this);if(tile.getState()==TileState.LOADED){tilesToDrawByZ[z][tile.tileCoord.toString()]=tile;var inTransition=tile.inTransition(uid);this.newTiles_||!inTransition&&-1!==this.renderedTiles.indexOf(tile)||(this.newTiles_=!0)}if(1===tile.getAlpha(uid,frameState.time))continue}var childTileRange=tileGrid.getTileCoordChildTileRange(tile.tileCoord,tmpTileRange,tmpExtent),covered=!1;childTileRange&&(covered=findLoadedTiles(z+1,childTileRange)),covered||tileGrid.forEachTileCoordParentTileRange(tile.tileCoord,findLoadedTiles,null,tmpTileRange,tmpExtent)}var renderedResolution=tileResolution*pixelRatio/tilePixelRatio*oversampling;if(!(this.renderedResolution&&Date.now()-frameState.time>16&&animatingOrInteracting)&&(this.newTiles_||!this.renderedExtent_||!containsExtent(this.renderedExtent_,extent)||this.renderedRevision!=sourceRevision||oversampling!=this.oversampling_||!animatingOrInteracting&&renderedResolution!=this.renderedResolution)){var context=this.context;if(context){var tilePixelSize=tileSource.getTilePixelSize(z,pixelRatio,projection),width=Math.round(tileRange.getWidth()*tilePixelSize[0]/oversampling),height=Math.round(tileRange.getHeight()*tilePixelSize[1]/oversampling),canvas=context.canvas;canvas.width!=width||canvas.height!=height?(this.oversampling_=oversampling,canvas.width=width,canvas.height=height):((this.renderedExtent_&&!equals$2(imageExtent,this.renderedExtent_)||this.renderedRevision!=sourceRevision)&&context.clearRect(0,0,width,height),oversampling=this.oversampling_)}this.renderedTiles.length=0;var currentScale,currentTilePixelSize,currentZ,i,ii,tileExtent,tileGutter,tilesToDraw,w,h,zs=Object.keys(tilesToDrawByZ).map(Number);for(zs.sort(function(a,b){return a===z?1:b===z?-1:a>b?1:a<b?-1:0}),i=0,ii=zs.length;i<ii;++i)for(var tileCoordKey in currentZ=zs[i],currentTilePixelSize=tileSource.getTilePixelSize(currentZ,pixelRatio,projection),currentScale=tileGrid.getResolution(currentZ)/tileResolution,tileGutter=tilePixelRatio*tileSource.getGutterForProjection(projection),tilesToDraw=tilesToDrawByZ[currentZ])tile=tilesToDraw[tileCoordKey],x=((tileExtent=tileGrid.getTileCoordExtent(tile.getTileCoord(),tmpExtent))[0]-imageExtent[0])/tileResolution*tilePixelRatio/oversampling,y=(imageExtent[3]-tileExtent[3])/tileResolution*tilePixelRatio/oversampling,w=currentTilePixelSize[0]*currentScale/oversampling,h=currentTilePixelSize[1]*currentScale/oversampling,this.drawTileImage(tile,frameState,layerState,x,y,w,h,tileGutter,z===currentZ),this.renderedTiles.push(tile);this.renderedRevision=sourceRevision,this.renderedResolution=tileResolution*pixelRatio/tilePixelRatio*oversampling,this.renderedExtent_=imageExtent}var scale=this.renderedResolution/viewResolution,transform=compose(this.imageTransform_,pixelRatio*size[0]/2,pixelRatio*size[1]/2,scale,scale,0,(this.renderedExtent_[0]-viewCenter[0])/this.renderedResolution*pixelRatio,(viewCenter[1]-this.renderedExtent_[3])/this.renderedResolution*pixelRatio);return compose(this.coordinateToCanvasPixelTransform,pixelRatio*size[0]/2-transform[4],pixelRatio*size[1]/2-transform[5],pixelRatio/viewResolution,-pixelRatio/viewResolution,0,-viewCenter[0],-viewCenter[1]),this.updateUsedTiles(frameState.usedTiles,tileSource,z,tileRange),this.manageTilePyramid(frameState,tileSource,tileGrid,pixelRatio,projection,extent,z,tileLayer.getPreload()),this.scheduleExpireCache(frameState,tileSource),this.renderedTiles.length>0},CanvasTileLayerRenderer.prototype.drawTileImage=function(tile,frameState,layerState,x,y,w,h,gutter,transition){var image=this.getTileImage(tile);if(image){var uid=getUid(this),alpha=transition?tile.getAlpha(uid,frameState.time):1,tileSource=this.getLayer().getSource();1!==alpha||tileSource.getOpaque(frameState.viewState.projection)||this.context.clearRect(x,y,w,h);var alphaChanged=alpha!==this.context.globalAlpha;alphaChanged&&(this.context.save(),this.context.globalAlpha=alpha),this.context.drawImage(image,gutter,gutter,image.width-2*gutter,image.height-2*gutter,x,y,w,h),alphaChanged&&this.context.restore(),1!==alpha?frameState.animate=!0:transition&&tile.endTransition(uid)}},CanvasTileLayerRenderer.prototype.getImage=function(){var context=this.context;return context?context.canvas:null},CanvasTileLayerRenderer.prototype.getImageTransform=function(){return this.imageTransform_},CanvasTileLayerRenderer.prototype.getTileImage=function(tile){return tile.getImage()},CanvasTileLayerRenderer}(IntermediateCanvasRenderer);CanvasTileLayerRenderer.handles=function(layer){return layer.getType()===LayerType.TILE},CanvasTileLayerRenderer.create=function(mapRenderer,layer){return new CanvasTileLayerRenderer(layer)},CanvasTileLayerRenderer.prototype.getLayer;var ReplayGroup=function(){};ReplayGroup.prototype.getReplay=function(zIndex,replayType){return abstract()},ReplayGroup.prototype.isEmpty=function(){return abstract()},ReplayGroup.prototype.addDeclutter=function(group){return abstract()};var ReplayType={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function drawTextOnPath(flatCoordinates,offset,end,stride,text,measure,startM,maxAngle){for(var data,index,previousAngle,result=[],reverse=flatCoordinates[offset]>flatCoordinates[end-stride],numChars=text.length,x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM=0,segmentLength=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)),chunk="",chunkLength=0,i=0;i<numChars;++i){index=reverse?numChars-i-1:i;var char=text.charAt(index),charLength=measure(chunk=reverse?char+chunk:chunk+char)-chunkLength;chunkLength+=charLength;for(var charM=startM+charLength/2;offset<end-stride&&segmentM+segmentLength<charM;)x1=x2,y1=y2,x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM+=segmentLength,segmentLength=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));var segmentPos=charM-segmentM,angle=Math.atan2(y2-y1,x2-x1);if(reverse&&(angle+=angle>0?-Math.PI:Math.PI),void 0!==previousAngle){var delta=angle-previousAngle;if(delta+=delta>Math.PI?-2*Math.PI:delta<-Math.PI?2*Math.PI:0,Math.abs(delta)>maxAngle)return null}var interpolate=segmentPos/segmentLength,x=lerp(x1,x2,interpolate),y=lerp(y1,y2,interpolate);previousAngle==angle?(reverse&&(data[0]=x,data[1]=y,data[2]=charLength/2),data[4]=chunk):(chunkLength=charLength,data=[x,y,charLength/2,angle,chunk=char],reverse?result.unshift(data):result.push(data),previousAngle=angle),startM+=charLength}return result}var Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH],ORDER=[ReplayType.POLYGON,ReplayType.CIRCLE,ReplayType.LINE_STRING,ReplayType.IMAGE,ReplayType.TEXT,ReplayType.DEFAULT],TEXT_ALIGN={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},tmpExtent=createEmpty(),tmpTransform$1=create(),CanvasReplay=function(VectorContext$$1){function CanvasReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){VectorContext$$1.call(this),this.declutterTree=declutterTree,this.tolerance=tolerance,this.maxExtent=maxExtent,this.overlaps=overlaps,this.pixelRatio=pixelRatio,this.maxLineWidth=0,this.resolution=resolution,this.alignFill_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=create(),this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0}return VectorContext$$1&&(CanvasReplay.__proto__=VectorContext$$1),CanvasReplay.prototype=Object.create(VectorContext$$1&&VectorContext$$1.prototype),CanvasReplay.prototype.constructor=CanvasReplay,CanvasReplay.prototype.replayTextBackground_=function(context,p1,p2,p3,p4,fillInstruction$$1,strokeInstruction$$1){context.beginPath(),context.moveTo.apply(context,p1),context.lineTo.apply(context,p2),context.lineTo.apply(context,p3),context.lineTo.apply(context,p4),context.lineTo.apply(context,p1),fillInstruction$$1&&(this.alignFill_=fillInstruction$$1[2],this.fill_(context)),strokeInstruction$$1&&(this.setStrokeStyle_(context,strokeInstruction$$1),context.stroke())},CanvasReplay.prototype.replayImage_=function(context,x,y,image,anchorX,anchorY,declutterGroup,height,opacity,originX,originY,rotation,scale,snapToPixel,width,padding,fillInstruction$$1,strokeInstruction$$1){var fillStroke=fillInstruction$$1||strokeInstruction$$1;x-=anchorX*=scale,y-=anchorY*=scale;var p1,p2,p3,p4,w=width+originX>image.width?image.width-originX:width,h=height+originY>image.height?image.height-originY:height,boxW=padding[3]+w*scale+padding[1],boxH=padding[0]+h*scale+padding[2],boxX=x-padding[3],boxY=y-padding[0];(fillStroke||0!==rotation)&&(p1=[boxX,boxY],p2=[boxX+boxW,boxY],p3=[boxX+boxW,boxY+boxH],p4=[boxX,boxY+boxH]);var transform=null;if(0!==rotation){var centerX=x+anchorX,centerY=y+anchorY;transform=compose(tmpTransform$1,centerX,centerY,1,1,rotation,-centerX,-centerY),createOrUpdateEmpty(tmpExtent),extendCoordinate(tmpExtent,apply(tmpTransform$1,p1)),extendCoordinate(tmpExtent,apply(tmpTransform$1,p2)),extendCoordinate(tmpExtent,apply(tmpTransform$1,p3)),extendCoordinate(tmpExtent,apply(tmpTransform$1,p4))}else createOrUpdate(boxX,boxY,boxX+boxW,boxY+boxH,tmpExtent);var canvas=context.canvas,strokePadding=strokeInstruction$$1?strokeInstruction$$1[2]*scale/2:0,intersects$$1=tmpExtent[0]-strokePadding<=canvas.width&&tmpExtent[2]+strokePadding>=0&&tmpExtent[1]-strokePadding<=canvas.height&&tmpExtent[3]+strokePadding>=0;if(snapToPixel&&(x=Math.round(x),y=Math.round(y)),declutterGroup){if(!intersects$$1&&1==declutterGroup[4])return;extend$1(declutterGroup,tmpExtent);var declutterArgs=intersects$$1?[context,transform?transform.slice(0):null,opacity,image,originX,originY,w,h,x,y,scale]:null;declutterArgs&&fillStroke&&declutterArgs.push(fillInstruction$$1,strokeInstruction$$1,p1,p2,p3,p4),declutterGroup.push(declutterArgs)}else intersects$$1&&(fillStroke&&this.replayTextBackground_(context,p1,p2,p3,p4,fillInstruction$$1,strokeInstruction$$1),drawImage(context,transform,opacity,image,originX,originY,w,h,x,y,scale))},CanvasReplay.prototype.applyPixelRatio=function(dashArray){var pixelRatio=this.pixelRatio;return 1==pixelRatio?dashArray:dashArray.map(function(dash){return dash*pixelRatio})},CanvasReplay.prototype.appendFlatCoordinates=function(flatCoordinates,offset,end,stride,closed,skipFirst){var myEnd=this.coordinates.length,extent=this.getBufferedMaxExtent();skipFirst&&(offset+=stride);var i,lastRel,nextRel,lastCoord=[flatCoordinates[offset],flatCoordinates[offset+1]],nextCoord=[NaN,NaN],skipped=!0;for(i=offset+stride;i<end;i+=stride)nextCoord[0]=flatCoordinates[i],nextCoord[1]=flatCoordinates[i+1],(nextRel=coordinateRelationship(extent,nextCoord))!==lastRel?(skipped&&(this.coordinates[myEnd++]=lastCoord[0],this.coordinates[myEnd++]=lastCoord[1]),this.coordinates[myEnd++]=nextCoord[0],this.coordinates[myEnd++]=nextCoord[1],skipped=!1):nextRel===Relationship.INTERSECTING?(this.coordinates[myEnd++]=nextCoord[0],this.coordinates[myEnd++]=nextCoord[1],skipped=!1):skipped=!0,lastCoord[0]=nextCoord[0],lastCoord[1]=nextCoord[1],lastRel=nextRel;return(closed&&skipped||i===offset+stride)&&(this.coordinates[myEnd++]=lastCoord[0],this.coordinates[myEnd++]=lastCoord[1]),myEnd},CanvasReplay.prototype.drawCustomCoordinates_=function(flatCoordinates,offset,ends,stride,replayEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i],replayEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1);replayEnds.push(replayEnd),offset=end}return offset},CanvasReplay.prototype.drawCustom=function(geometry,feature,renderer){this.beginGeometry(geometry,feature);var flatCoordinates,replayEnd,replayEnds,replayEndss,offset,type=geometry.getType(),stride=geometry.getStride(),replayBegin=this.coordinates.length;if(type==GeometryType.MULTI_POLYGON){flatCoordinates=(geometry=geometry).getOrientedFlatCoordinates(),replayEndss=[];var endss=geometry.getEndss();offset=0;for(var i=0,ii=endss.length;i<ii;++i){var myEnds=[];offset=this.drawCustomCoordinates_(flatCoordinates,offset,endss[i],stride,myEnds),replayEndss.push(myEnds)}this.instructions.push([Instruction.CUSTOM,replayBegin,replayEndss,geometry,renderer,inflateMultiCoordinatesArray])}else type==GeometryType.POLYGON||type==GeometryType.MULTI_LINE_STRING?(replayEnds=[],flatCoordinates=type==GeometryType.POLYGON?geometry.getOrientedFlatCoordinates():geometry.getFlatCoordinates(),offset=this.drawCustomCoordinates_(flatCoordinates,0,geometry.getEnds(),stride,replayEnds),this.instructions.push([Instruction.CUSTOM,replayBegin,replayEnds,geometry,renderer,inflateCoordinatesArray])):type==GeometryType.LINE_STRING||type==GeometryType.MULTI_POINT?(flatCoordinates=geometry.getFlatCoordinates(),replayEnd=this.appendFlatCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1),this.instructions.push([Instruction.CUSTOM,replayBegin,replayEnd,geometry,renderer,inflateCoordinates])):type==GeometryType.POINT&&(flatCoordinates=geometry.getFlatCoordinates(),this.coordinates.push(flatCoordinates[0],flatCoordinates[1]),replayEnd=this.coordinates.length,this.instructions.push([Instruction.CUSTOM,replayBegin,replayEnd,geometry,renderer]));this.endGeometry(geometry,feature)},CanvasReplay.prototype.beginGeometry=function(geometry,feature){this.beginGeometryInstruction1_=[Instruction.BEGIN_GEOMETRY,feature,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Instruction.BEGIN_GEOMETRY,feature,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},CanvasReplay.prototype.finish=function(){},CanvasReplay.prototype.fill_=function(context){if(this.alignFill_){var origin=apply(this.renderedTransform_,[0,0]),repeatSize=512*this.pixelRatio;context.translate(origin[0]%repeatSize,origin[1]%repeatSize),context.rotate(this.viewRotation_)}context.fill(),this.alignFill_&&context.setTransform.apply(context,resetTransform)},CanvasReplay.prototype.setStrokeStyle_=function(context,instruction){context.strokeStyle=instruction[1],context.lineWidth=instruction[2],context.lineCap=instruction[3],context.lineJoin=instruction[4],context.miterLimit=instruction[5],CANVAS_LINE_DASH&&(context.lineDashOffset=instruction[7],context.setLineDash(instruction[6]))},CanvasReplay.prototype.renderDeclutter_=function(declutterGroup,feature){if(declutterGroup&&declutterGroup.length>5){var groupCount=declutterGroup[4];if(1==groupCount||groupCount==declutterGroup.length-5){var box={minX:declutterGroup[0],minY:declutterGroup[1],maxX:declutterGroup[2],maxY:declutterGroup[3],value:feature};if(!this.declutterTree.collides(box)){this.declutterTree.insert(box);for(var j=5,jj=declutterGroup.length;j<jj;++j){var declutterData=declutterGroup[j];declutterData&&(declutterData.length>11&&this.replayTextBackground_(declutterData[0],declutterData[13],declutterData[14],declutterData[15],declutterData[16],declutterData[11],declutterData[12]),drawImage.apply(void 0,declutterData))}}declutterGroup.length=5,createOrUpdateEmpty(declutterGroup)}}},CanvasReplay.prototype.replay_=function(context,transform,skippedFeaturesHash,instructions,snapToPixel,featureCallback,opt_hitExtent){var pixelCoordinates;this.pixelCoordinates_&&equals(transform,this.renderedTransform_)?pixelCoordinates=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),pixelCoordinates=transform2D(this.coordinates,0,this.coordinates.length,2,transform,this.pixelCoordinates_),setFromArray(this.renderedTransform_,transform));for(var dd,anchorX,anchorY,prevX,prevY,roundX,roundY,declutterGroup,image,feature,x,y,skipFeatures=!isEmpty(skippedFeaturesHash),i=0,ii=instructions.length,d=0,pendingFill=0,pendingStroke=0,lastFillInstruction=null,lastStrokeInstruction=null,coordinateCache=this.coordinateCache_,viewRotation=this.viewRotation_,state={context:context,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:viewRotation},batchSize=this.instructions!=instructions||this.overlaps?0:200;i<ii;){var instruction=instructions[i];switch(instruction[0]){case Instruction.BEGIN_GEOMETRY:feature=instruction[1],skipFeatures&&skippedFeaturesHash[getUid(feature)]||!feature.getGeometry()?i=instruction[2]:void 0===opt_hitExtent||intersects(opt_hitExtent,feature.getGeometry().getExtent())?++i:i=instruction[2]+1;break;case Instruction.BEGIN_PATH:pendingFill>batchSize&&(this.fill_(context),pendingFill=0),pendingStroke>batchSize&&(context.stroke(),pendingStroke=0),pendingFill||pendingStroke||(context.beginPath(),prevX=prevY=NaN),++i;break;case Instruction.CIRCLE:var x1=pixelCoordinates[d=instruction[1]],y1=pixelCoordinates[d+1],dx=pixelCoordinates[d+2]-x1,dy=pixelCoordinates[d+3]-y1,r=Math.sqrt(dx*dx+dy*dy);context.moveTo(x1+r,y1),context.arc(x1,y1,r,0,2*Math.PI,!0),++i;break;case Instruction.CLOSE_PATH:context.closePath(),++i;break;case Instruction.CUSTOM:d=instruction[1],dd=instruction[2];var geometry=instruction[3],renderer=instruction[4],fn=6==instruction.length?instruction[5]:void 0;state.geometry=geometry,state.feature=feature,i in coordinateCache||(coordinateCache[i]=[]);var coords=coordinateCache[i];fn?fn(pixelCoordinates,d,dd,2,coords):(coords[0]=pixelCoordinates[d],coords[1]=pixelCoordinates[d+1],coords.length=2),renderer(coords,state),++i;break;case Instruction.DRAW_IMAGE:d=instruction[1],dd=instruction[2],image=instruction[3],anchorX=instruction[4],anchorY=instruction[5],declutterGroup=featureCallback?null:instruction[6];var height=instruction[7],opacity=instruction[8],originX=instruction[9],originY=instruction[10],rotateWithView=instruction[11],rotation=instruction[12],scale=instruction[13],width=instruction[14],padding=void 0,backgroundFill=void 0,backgroundStroke=void 0;for(instruction.length>16?(padding=instruction[15],backgroundFill=instruction[16],backgroundStroke=instruction[17]):(padding=defaultPadding,backgroundFill=backgroundStroke=!1),rotateWithView&&(rotation+=viewRotation);d<dd;d+=2)this.replayImage_(context,pixelCoordinates[d],pixelCoordinates[d+1],image,anchorX,anchorY,declutterGroup,height,opacity,originX,originY,rotation,scale,snapToPixel,width,padding,backgroundFill?lastFillInstruction:null,backgroundStroke?lastStrokeInstruction:null);this.renderDeclutter_(declutterGroup,feature),++i;break;case Instruction.DRAW_CHARS:var begin=instruction[1],end=instruction[2],baseline=instruction[3];declutterGroup=featureCallback?null:instruction[4];var overflow=instruction[5],fillKey=instruction[6],maxAngle=instruction[7],measure=instruction[8],offsetY=instruction[9],strokeKey=instruction[10],strokeWidth=instruction[11],text=instruction[12],textKey=instruction[13],textScale=instruction[14],pathLength=lineStringLength(pixelCoordinates,begin,end,2),textLength=measure(text);if(overflow||textLength<=pathLength){var textAlign=this.textStates[textKey].textAlign,parts=drawTextOnPath(pixelCoordinates,begin,end,2,text,measure,(pathLength-textLength)*TEXT_ALIGN[textAlign],maxAngle);if(parts){var c=void 0,cc=void 0,chars=void 0,label=void 0,part=void 0;if(strokeKey)for(c=0,cc=parts.length;c<cc;++c)chars=(part=parts[c])[4],label=this.getImage(chars,textKey,"",strokeKey),anchorX=part[2]+strokeWidth,anchorY=baseline*label.height+2*(.5-baseline)*strokeWidth-offsetY,this.replayImage_(context,part[0],part[1],label,anchorX,anchorY,declutterGroup,label.height,1,0,0,part[3],textScale,!1,label.width,defaultPadding,null,null);if(fillKey)for(c=0,cc=parts.length;c<cc;++c)chars=(part=parts[c])[4],label=this.getImage(chars,textKey,fillKey,""),anchorX=part[2],anchorY=baseline*label.height-offsetY,this.replayImage_(context,part[0],part[1],label,anchorX,anchorY,declutterGroup,label.height,1,0,0,part[3],textScale,!1,label.width,defaultPadding,null,null)}}this.renderDeclutter_(declutterGroup,feature),++i;break;case Instruction.END_GEOMETRY:if(void 0!==featureCallback){var result=featureCallback(feature=instruction[1]);if(result)return result}++i;break;case Instruction.FILL:batchSize?pendingFill++:this.fill_(context),++i;break;case Instruction.MOVE_TO_LINE_TO:for(d=instruction[1],dd=instruction[2],x=pixelCoordinates[d],roundY=(y=pixelCoordinates[d+1])+.5|0,(roundX=x+.5|0)===prevX&&roundY===prevY||(context.moveTo(x,y),prevX=roundX,prevY=roundY),d+=2;d<dd;d+=2)roundX=(x=pixelCoordinates[d])+.5|0,roundY=(y=pixelCoordinates[d+1])+.5|0,d!=dd-2&&roundX===prevX&&roundY===prevY||(context.lineTo(x,y),prevX=roundX,prevY=roundY);++i;break;case Instruction.SET_FILL_STYLE:lastFillInstruction=instruction,this.alignFill_=instruction[2],pendingFill&&(this.fill_(context),pendingFill=0,pendingStroke&&(context.stroke(),pendingStroke=0)),context.fillStyle=instruction[1],++i;break;case Instruction.SET_STROKE_STYLE:lastStrokeInstruction=instruction,pendingStroke&&(context.stroke(),pendingStroke=0),this.setStrokeStyle_(context,instruction),++i;break;case Instruction.STROKE:batchSize?pendingStroke++:context.stroke(),++i;break;default:++i}}pendingFill&&this.fill_(context),pendingStroke&&context.stroke()},CanvasReplay.prototype.replay=function(context,transform,viewRotation,skippedFeaturesHash,snapToPixel){this.viewRotation_=viewRotation,this.replay_(context,transform,skippedFeaturesHash,this.instructions,snapToPixel,void 0,void 0)},CanvasReplay.prototype.replayHitDetection=function(context,transform,viewRotation,skippedFeaturesHash,opt_featureCallback,opt_hitExtent){return this.viewRotation_=viewRotation,this.replay_(context,transform,skippedFeaturesHash,this.hitDetectionInstructions,!0,opt_featureCallback,opt_hitExtent)},CanvasReplay.prototype.reverseHitDetectionInstructions=function(){var i,hitDetectionInstructions=this.hitDetectionInstructions;hitDetectionInstructions.reverse();var instruction,type,n=hitDetectionInstructions.length,begin=-1;for(i=0;i<n;++i)(type=(instruction=hitDetectionInstructions[i])[0])==Instruction.END_GEOMETRY?begin=i:type==Instruction.BEGIN_GEOMETRY&&(instruction[2]=i,reverseSubArray(this.hitDetectionInstructions,begin,i),begin=-1)},CanvasReplay.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){var state=this.state;if(fillStyle){var fillStyleColor=fillStyle.getColor();state.fillStyle=asColorLike(fillStyleColor||defaultFillStyle)}else state.fillStyle=void 0;if(strokeStyle){var strokeStyleColor=strokeStyle.getColor();state.strokeStyle=asColorLike(strokeStyleColor||defaultStrokeStyle);var strokeStyleLineCap=strokeStyle.getLineCap();state.lineCap=void 0!==strokeStyleLineCap?strokeStyleLineCap:defaultLineCap;var strokeStyleLineDash=strokeStyle.getLineDash();state.lineDash=strokeStyleLineDash?strokeStyleLineDash.slice():defaultLineDash;var strokeStyleLineDashOffset=strokeStyle.getLineDashOffset();state.lineDashOffset=strokeStyleLineDashOffset||defaultLineDashOffset;var strokeStyleLineJoin=strokeStyle.getLineJoin();state.lineJoin=void 0!==strokeStyleLineJoin?strokeStyleLineJoin:defaultLineJoin;var strokeStyleWidth=strokeStyle.getWidth();state.lineWidth=void 0!==strokeStyleWidth?strokeStyleWidth:defaultLineWidth;var strokeStyleMiterLimit=strokeStyle.getMiterLimit();state.miterLimit=void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:defaultMiterLimit,state.lineWidth>this.maxLineWidth&&(this.maxLineWidth=state.lineWidth,this.bufferedMaxExtent_=null)}else state.strokeStyle=void 0,state.lineCap=void 0,state.lineDash=null,state.lineDashOffset=void 0,state.lineJoin=void 0,state.lineWidth=void 0,state.miterLimit=void 0},CanvasReplay.prototype.createFill=function(state,geometry){var fillStyle=state.fillStyle,fillInstruction$$1=[Instruction.SET_FILL_STYLE,fillStyle];return"string"!=typeof fillStyle&&fillInstruction$$1.push(!0),fillInstruction$$1},CanvasReplay.prototype.applyStroke=function(state){this.instructions.push(this.createStroke(state))},CanvasReplay.prototype.createStroke=function(state){return[Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth*this.pixelRatio,state.lineCap,state.lineJoin,state.miterLimit,this.applyPixelRatio(state.lineDash),state.lineDashOffset*this.pixelRatio]},CanvasReplay.prototype.updateFillStyle=function(state,createFill,geometry){var fillStyle=state.fillStyle;"string"==typeof fillStyle&&state.currentFillStyle==fillStyle||(void 0!==fillStyle&&this.instructions.push(createFill.call(this,state,geometry)),state.currentFillStyle=fillStyle)},CanvasReplay.prototype.updateStrokeStyle=function(state,applyStroke){var strokeStyle=state.strokeStyle,lineCap=state.lineCap,lineDash=state.lineDash,lineDashOffset=state.lineDashOffset,lineJoin=state.lineJoin,lineWidth=state.lineWidth,miterLimit=state.miterLimit;(state.currentStrokeStyle!=strokeStyle||state.currentLineCap!=lineCap||lineDash!=state.currentLineDash&&!equals(state.currentLineDash,lineDash)||state.currentLineDashOffset!=lineDashOffset||state.currentLineJoin!=lineJoin||state.currentLineWidth!=lineWidth||state.currentMiterLimit!=miterLimit)&&(void 0!==strokeStyle&&applyStroke.call(this,state),state.currentStrokeStyle=strokeStyle,state.currentLineCap=lineCap,state.currentLineDash=lineDash,state.currentLineDashOffset=lineDashOffset,state.currentLineJoin=lineJoin,state.currentLineWidth=lineWidth,state.currentMiterLimit=miterLimit)},CanvasReplay.prototype.endGeometry=function(geometry,feature){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var endGeometryInstruction=[Instruction.END_GEOMETRY,feature];this.instructions.push(endGeometryInstruction),this.hitDetectionInstructions.push(endGeometryInstruction)},CanvasReplay.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone(this.maxExtent),this.maxLineWidth>0)){var width=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,width,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},CanvasReplay}(VectorContext),CanvasImageReplay=function(CanvasReplay$$1){function CanvasImageReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){CanvasReplay$$1.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0}return CanvasReplay$$1&&(CanvasImageReplay.__proto__=CanvasReplay$$1),CanvasImageReplay.prototype=Object.create(CanvasReplay$$1&&CanvasReplay$$1.prototype),CanvasImageReplay.prototype.constructor=CanvasImageReplay,CanvasImageReplay.prototype.drawCoordinates_=function(flatCoordinates,offset,end,stride){return this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1)},CanvasImageReplay.prototype.drawPoint=function(pointGeometry,feature){if(this.image_){this.beginGeometry(pointGeometry,feature);var flatCoordinates=pointGeometry.getFlatCoordinates(),stride=pointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride);this.instructions.push([Instruction.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(pointGeometry,feature)}},CanvasImageReplay.prototype.drawMultiPoint=function(multiPointGeometry,feature){if(this.image_){this.beginGeometry(multiPointGeometry,feature);var flatCoordinates=multiPointGeometry.getFlatCoordinates(),stride=multiPointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride);this.instructions.push([Instruction.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(multiPointGeometry,feature)}},CanvasImageReplay.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0},CanvasImageReplay.prototype.setImageStyle=function(imageStyle,declutterGroup){var anchor=imageStyle.getAnchor(),size=imageStyle.getSize(),hitDetectionImage=imageStyle.getHitDetectionImage(1),image=imageStyle.getImage(1),origin=imageStyle.getOrigin();this.anchorX_=anchor[0],this.anchorY_=anchor[1],this.declutterGroup_=declutterGroup,this.hitDetectionImage_=hitDetectionImage,this.image_=image,this.height_=size[1],this.opacity_=imageStyle.getOpacity(),this.originX_=origin[0],this.originY_=origin[1],this.rotateWithView_=imageStyle.getRotateWithView(),this.rotation_=imageStyle.getRotation(),this.scale_=imageStyle.getScale(),this.width_=size[0]},CanvasImageReplay}(CanvasReplay),CanvasLineStringReplay=function(CanvasReplay$$1){function CanvasLineStringReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){CanvasReplay$$1.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree)}return CanvasReplay$$1&&(CanvasLineStringReplay.__proto__=CanvasReplay$$1),CanvasLineStringReplay.prototype=Object.create(CanvasReplay$$1&&CanvasReplay$$1.prototype),CanvasLineStringReplay.prototype.constructor=CanvasLineStringReplay,CanvasLineStringReplay.prototype.drawFlatCoordinates_=function(flatCoordinates,offset,end,stride){var myBegin=this.coordinates.length,myEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1),moveToLineToInstruction=[Instruction.MOVE_TO_LINE_TO,myBegin,myEnd];return this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),end},CanvasLineStringReplay.prototype.drawLineString=function(lineStringGeometry,feature){var state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0!==strokeStyle&&void 0!==lineWidth){this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(lineStringGeometry,feature),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset],beginPathInstruction);var flatCoordinates=lineStringGeometry.getFlatCoordinates(),stride=lineStringGeometry.getStride();this.drawFlatCoordinates_(flatCoordinates,0,flatCoordinates.length,stride),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(lineStringGeometry,feature)}},CanvasLineStringReplay.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){var state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0!==strokeStyle&&void 0!==lineWidth){this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(multiLineStringGeometry,feature),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset],beginPathInstruction);for(var ends=multiLineStringGeometry.getEnds(),flatCoordinates=multiLineStringGeometry.getFlatCoordinates(),stride=multiLineStringGeometry.getStride(),offset=0,i=0,ii=ends.length;i<ii;++i)offset=this.drawFlatCoordinates_(flatCoordinates,offset,ends[i],stride);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(multiLineStringGeometry,feature)}},CanvasLineStringReplay.prototype.finish=function(){var state=this.state;null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null},CanvasLineStringReplay.prototype.applyStroke=function(state){null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),state.lastStroke=this.coordinates.length),state.lastStroke=0,CanvasReplay$$1.prototype.applyStroke.call(this,state),this.instructions.push(beginPathInstruction)},CanvasLineStringReplay}(CanvasReplay),CanvasPolygonReplay=function(CanvasReplay$$1){function CanvasPolygonReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){CanvasReplay$$1.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree)}return CanvasReplay$$1&&(CanvasPolygonReplay.__proto__=CanvasReplay$$1),CanvasPolygonReplay.prototype=Object.create(CanvasReplay$$1&&CanvasReplay$$1.prototype),CanvasPolygonReplay.prototype.constructor=CanvasPolygonReplay,CanvasPolygonReplay.prototype.drawFlatCoordinatess_=function(flatCoordinates,offset,ends,stride){var state=this.state,fill=void 0!==state.fillStyle,stroke=null!=state.strokeStyle,numEnds=ends.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(var i=0;i<numEnds;++i){var end=ends[i],myBegin=this.coordinates.length,myEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!0,!stroke),moveToLineToInstruction=[Instruction.MOVE_TO_LINE_TO,myBegin,myEnd];this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),stroke&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),offset=end}return fill&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),stroke&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),offset},CanvasPolygonReplay.prototype.drawCircle=function(circleGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(circleGeometry),this.beginGeometry(circleGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,asString(defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var flatCoordinates=circleGeometry.getFlatCoordinates(),stride=circleGeometry.getStride(),myBegin=this.coordinates.length;this.appendFlatCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1);var circleInstruction=[Instruction.CIRCLE,myBegin];this.instructions.push(beginPathInstruction,circleInstruction),this.hitDetectionInstructions.push(beginPathInstruction,circleInstruction),this.hitDetectionInstructions.push(fillInstruction),void 0!==state.fillStyle&&this.instructions.push(fillInstruction),void 0!==state.strokeStyle&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(circleGeometry,feature)}},CanvasPolygonReplay.prototype.drawPolygon=function(polygonGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(polygonGeometry),this.beginGeometry(polygonGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,asString(defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var ends=polygonGeometry.getEnds(),flatCoordinates=polygonGeometry.getOrientedFlatCoordinates(),stride=polygonGeometry.getStride();this.drawFlatCoordinatess_(flatCoordinates,0,ends,stride),this.endGeometry(polygonGeometry,feature)}},CanvasPolygonReplay.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(multiPolygonGeometry),this.beginGeometry(multiPolygonGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,asString(defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);for(var endss=multiPolygonGeometry.getEndss(),flatCoordinates=multiPolygonGeometry.getOrientedFlatCoordinates(),stride=multiPolygonGeometry.getStride(),offset=0,i=0,ii=endss.length;i<ii;++i)offset=this.drawFlatCoordinatess_(flatCoordinates,offset,endss[i],stride);this.endGeometry(multiPolygonGeometry,feature)}},CanvasPolygonReplay.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var tolerance=this.tolerance;if(0!==tolerance)for(var coordinates=this.coordinates,i=0,ii=coordinates.length;i<ii;++i)coordinates[i]=snap(coordinates[i],tolerance)},CanvasPolygonReplay.prototype.setFillStrokeStyles_=function(geometry){var state=this.state;void 0!==state.fillStyle&&this.updateFillStyle(state,this.createFill,geometry),void 0!==state.strokeStyle&&this.updateStrokeStyle(state,this.applyStroke)},CanvasPolygonReplay}(CanvasReplay);function matchingChunk(maxAngle,flatCoordinates,offset,end,stride){var i,m12,m23,x1,y1,x12,y12,x23,y23,chunkStart=offset,chunkEnd=offset,chunkM=0,m=0,start=offset;for(i=offset;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];void 0!==x1&&(x23=x2-x1,y23=y2-y1,m23=Math.sqrt(x23*x23+y23*y23),void 0!==x12&&(m+=m12,Math.acos((x12*x23+y12*y23)/(m12*m23))>maxAngle&&(m>chunkM&&(chunkM=m,chunkStart=start,chunkEnd=i),m=0,start=i-stride)),m12=m23,x12=x23,y12=y23),x1=x2,y1=y2}return(m+=m23)>chunkM?[start,i]:[chunkStart,chunkEnd]}var TextPlacement={POINT:"point",LINE:"line"},CanvasTextReplay=function(CanvasReplay$$1){function CanvasTextReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){CanvasReplay$$1.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.widths_={},labelCache.prune()}return CanvasReplay$$1&&(CanvasTextReplay.__proto__=CanvasReplay$$1),CanvasTextReplay.prototype=Object.create(CanvasReplay$$1&&CanvasReplay$$1.prototype),CanvasTextReplay.prototype.constructor=CanvasTextReplay,CanvasTextReplay.prototype.drawText=function(geometry,feature){var fillState=this.textFillState_,strokeState=this.textStrokeState_,textState=this.textState_;if(""!==this.text_&&textState&&(fillState||strokeState)){var i,ii,begin=this.coordinates.length,geometryType=geometry.getType(),flatCoordinates=null,end=2,stride=2;if(textState.placement===TextPlacement.LINE){if(!intersects(this.getBufferedMaxExtent(),geometry.getExtent()))return;var ends;if(flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride(),geometryType==GeometryType.LINE_STRING)ends=[flatCoordinates.length];else if(geometryType==GeometryType.MULTI_LINE_STRING)ends=geometry.getEnds();else if(geometryType==GeometryType.POLYGON)ends=geometry.getEnds().slice(0,1);else if(geometryType==GeometryType.MULTI_POLYGON){var endss=geometry.getEndss();for(ends=[],i=0,ii=endss.length;i<ii;++i)ends.push(endss[i][0])}this.beginGeometry(geometry,feature);for(var flatEnd,textAlign=textState.textAlign,flatOffset=0,o=0,oo=ends.length;o<oo;++o){if(null==textAlign){var range=matchingChunk(textState.maxAngle,flatCoordinates,flatOffset,ends[o],stride);flatOffset=range[0],flatEnd=range[1]}else flatEnd=ends[o];for(i=flatOffset;i<flatEnd;i+=stride)this.coordinates.push(flatCoordinates[i],flatCoordinates[i+1]);end=this.coordinates.length,flatOffset=ends[o],this.drawChars_(begin,end,this.declutterGroup_),begin=end}this.endGeometry(geometry,feature)}else{var label=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),width=label.width/this.pixelRatio;switch(geometryType){case GeometryType.POINT:case GeometryType.MULTI_POINT:end=(flatCoordinates=geometry.getFlatCoordinates()).length;break;case GeometryType.LINE_STRING:flatCoordinates=geometry.getFlatMidpoint();break;case GeometryType.CIRCLE:flatCoordinates=geometry.getCenter();break;case GeometryType.MULTI_LINE_STRING:end=(flatCoordinates=geometry.getFlatMidpoints()).length;break;case GeometryType.POLYGON:if(flatCoordinates=geometry.getFlatInteriorPoint(),!textState.overflow&&flatCoordinates[2]/this.resolution<width)return;stride=3;break;case GeometryType.MULTI_POLYGON:var interiorPoints=geometry.getFlatInteriorPoints();for(flatCoordinates=[],i=0,ii=interiorPoints.length;i<ii;i+=3)(textState.overflow||interiorPoints[i+2]/this.resolution>=width)&&flatCoordinates.push(interiorPoints[i],interiorPoints[i+1]);if(0==(end=flatCoordinates.length))return}end=this.appendFlatCoordinates(flatCoordinates,0,end,stride,!1,!1),(textState.backgroundFill||textState.backgroundStroke)&&(this.setFillStrokeStyle(textState.backgroundFill,textState.backgroundStroke),textState.backgroundFill&&(this.updateFillStyle(this.state,this.createFill,geometry),this.hitDetectionInstructions.push(this.createFill(this.state,geometry))),textState.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(geometry,feature),this.drawTextImage_(label,begin,end),this.endGeometry(geometry,feature)}}},CanvasTextReplay.prototype.getImage=function(text,textKey,fillKey,strokeKey){var label,key=strokeKey+textKey+text+fillKey+this.pixelRatio;if(!labelCache.containsKey(key)){var strokeState=strokeKey?this.strokeStates[strokeKey]||this.textStrokeState_:null,fillState=fillKey?this.fillStates[fillKey]||this.textFillState_:null,textState=this.textStates[textKey]||this.textState_,pixelRatio=this.pixelRatio,scale=textState.scale*pixelRatio,align=TEXT_ALIGN[textState.textAlign||defaultTextAlign],strokeWidth=strokeKey&&strokeState.lineWidth?strokeState.lineWidth:0,lines=text.split("\n"),numLines=lines.length,widths=[],width=measureTextWidths(textState.font,lines,widths),lineHeight=measureTextHeight(textState.font),height=lineHeight*numLines,renderWidth=width+strokeWidth,context=createCanvasContext2D(Math.ceil(renderWidth*scale),Math.ceil((height+strokeWidth)*scale));label=context.canvas,labelCache.set(key,label),1!=scale&&context.scale(scale,scale),context.font=textState.font,strokeKey&&(context.strokeStyle=strokeState.strokeStyle,context.lineWidth=strokeWidth,context.lineCap=strokeState.lineCap,context.lineJoin=strokeState.lineJoin,context.miterLimit=strokeState.miterLimit,CANVAS_LINE_DASH&&strokeState.lineDash.length&&(context.setLineDash(strokeState.lineDash),context.lineDashOffset=strokeState.lineDashOffset)),fillKey&&(context.fillStyle=fillState.fillStyle),context.textBaseline="middle",context.textAlign="center";var i,leftRight=.5-align,x=align*label.width/scale+leftRight*strokeWidth;if(strokeKey)for(i=0;i<numLines;++i)context.strokeText(lines[i],x+leftRight*widths[i],.5*(strokeWidth+lineHeight)+i*lineHeight);if(fillKey)for(i=0;i<numLines;++i)context.fillText(lines[i],x+leftRight*widths[i],.5*(strokeWidth+lineHeight)+i*lineHeight)}return labelCache.get(key)},CanvasTextReplay.prototype.drawTextImage_=function(label,begin,end){var textState=this.textState_,strokeState=this.textStrokeState_,pixelRatio=this.pixelRatio,align=TEXT_ALIGN[textState.textAlign||defaultTextAlign],baseline=TEXT_ALIGN[textState.textBaseline],strokeWidth=strokeState&&strokeState.lineWidth?strokeState.lineWidth:0,anchorX=align*label.width/pixelRatio+2*(.5-align)*strokeWidth,anchorY=baseline*label.height/pixelRatio+2*(.5-baseline)*strokeWidth;this.instructions.push([Instruction.DRAW_IMAGE,begin,end,label,(anchorX-this.textOffsetX_)*pixelRatio,(anchorY-this.textOffsetY_)*pixelRatio,this.declutterGroup_,label.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,label.width,textState.padding==defaultPadding?defaultPadding:textState.padding.map(function(p){return p*pixelRatio}),!!textState.backgroundFill,!!textState.backgroundStroke]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,begin,end,label,(anchorX-this.textOffsetX_)*pixelRatio,(anchorY-this.textOffsetY_)*pixelRatio,this.declutterGroup_,label.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/pixelRatio,label.width,textState.padding,!!textState.backgroundFill,!!textState.backgroundStroke])},CanvasTextReplay.prototype.drawChars_=function(begin,end,declutterGroup){var strokeState=this.textStrokeState_,textState=this.textState_,fillState=this.textFillState_,strokeKey=this.strokeKey_;strokeState&&(strokeKey in this.strokeStates||(this.strokeStates[strokeKey]={strokeStyle:strokeState.strokeStyle,lineCap:strokeState.lineCap,lineDashOffset:strokeState.lineDashOffset,lineWidth:strokeState.lineWidth,lineJoin:strokeState.lineJoin,miterLimit:strokeState.miterLimit,lineDash:strokeState.lineDash}));var textKey=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:textState.font,textAlign:textState.textAlign||defaultTextAlign,scale:textState.scale});var fillKey=this.fillKey_;fillState&&(fillKey in this.fillStates||(this.fillStates[fillKey]={fillStyle:fillState.fillStyle}));var pixelRatio=this.pixelRatio,baseline=TEXT_ALIGN[textState.textBaseline],offsetY=this.textOffsetY_*pixelRatio,text=this.text_,font=textState.font,textScale=textState.scale,strokeWidth=strokeState?strokeState.lineWidth*textScale/2:0,widths=this.widths_[font];widths||(this.widths_[font]=widths={}),this.instructions.push([Instruction.DRAW_CHARS,begin,end,baseline,declutterGroup,textState.overflow,fillKey,textState.maxAngle,function(text){var width=widths[text];return width||(width=widths[text]=measureTextWidth(font,text)),width*textScale*pixelRatio},offsetY,strokeKey,strokeWidth*pixelRatio,text,textKey,1]),this.hitDetectionInstructions.push([Instruction.DRAW_CHARS,begin,end,baseline,declutterGroup,textState.overflow,fillKey,textState.maxAngle,function(text){var width=widths[text];return width||(width=widths[text]=measureTextWidth(font,text)),width*textScale},offsetY,strokeKey,strokeWidth,text,textKey,1/pixelRatio])},CanvasTextReplay.prototype.setTextStyle=function(textStyle,declutterGroup){var textState,fillState,strokeState;if(textStyle){this.declutterGroup_=declutterGroup;var textFillStyle=textStyle.getFill();textFillStyle?((fillState=this.textFillState_)||(fillState=this.textFillState_={}),fillState.fillStyle=asColorLike(textFillStyle.getColor()||defaultFillStyle)):fillState=this.textFillState_=null;var textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){(strokeState=this.textStrokeState_)||(strokeState=this.textStrokeState_={});var lineDash=textStrokeStyle.getLineDash(),lineDashOffset=textStrokeStyle.getLineDashOffset(),lineWidth=textStrokeStyle.getWidth(),miterLimit=textStrokeStyle.getMiterLimit();strokeState.lineCap=textStrokeStyle.getLineCap()||defaultLineCap,strokeState.lineDash=lineDash?lineDash.slice():defaultLineDash,strokeState.lineDashOffset=void 0===lineDashOffset?defaultLineDashOffset:lineDashOffset,strokeState.lineJoin=textStrokeStyle.getLineJoin()||defaultLineJoin,strokeState.lineWidth=void 0===lineWidth?defaultLineWidth:lineWidth,strokeState.miterLimit=void 0===miterLimit?defaultMiterLimit:miterLimit,strokeState.strokeStyle=asColorLike(textStrokeStyle.getColor()||defaultStrokeStyle)}else strokeState=this.textStrokeState_=null;textState=this.textState_;var font=textStyle.getFont()||defaultFont;checkFont(font);var textScale=textStyle.getScale();textState.overflow=textStyle.getOverflow(),textState.font=font,textState.maxAngle=textStyle.getMaxAngle(),textState.placement=textStyle.getPlacement(),textState.textAlign=textStyle.getTextAlign(),textState.textBaseline=textStyle.getTextBaseline()||defaultTextBaseline,textState.backgroundFill=textStyle.getBackgroundFill(),textState.backgroundStroke=textStyle.getBackgroundStroke(),textState.padding=textStyle.getPadding()||defaultPadding,textState.scale=void 0===textScale?1:textScale;var textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation();this.text_=textStyle.getText()||"",this.textOffsetX_=void 0===textOffsetX?0:textOffsetX,this.textOffsetY_=void 0===textOffsetY?0:textOffsetY,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0===textRotation?0:textRotation,this.strokeKey_=strokeState?("string"==typeof strokeState.strokeStyle?strokeState.strokeStyle:getUid(strokeState.strokeStyle))+strokeState.lineCap+strokeState.lineDashOffset+"|"+strokeState.lineWidth+strokeState.lineJoin+strokeState.miterLimit+"["+strokeState.lineDash.join()+"]":"",this.textKey_=textState.font+textState.scale+(textState.textAlign||"?"),this.fillKey_=fillState?"string"==typeof fillState.fillStyle?fillState.fillStyle:"|"+getUid(fillState.fillStyle):""}else this.text_=""},CanvasTextReplay}(CanvasReplay);function measureTextWidths(font,lines,widths){for(var numLines=lines.length,width=0,i=0;i<numLines;++i){var currentWidth=measureTextWidth(font,lines[i]);width=Math.max(width,currentWidth),widths.push(currentWidth)}return width}var BATCH_CONSTRUCTORS={Circle:CanvasPolygonReplay,Default:CanvasReplay,Image:CanvasImageReplay,LineString:CanvasLineStringReplay,Polygon:CanvasPolygonReplay,Text:CanvasTextReplay},CanvasReplayGroup=function(ReplayGroup$$1){function CanvasReplayGroup(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree,opt_renderBuffer){ReplayGroup$$1.call(this),this.declutterTree_=declutterTree,this.declutterGroup_=null,this.tolerance_=tolerance,this.maxExtent_=maxExtent,this.overlaps_=overlaps,this.pixelRatio_=pixelRatio,this.resolution_=resolution,this.renderBuffer_=opt_renderBuffer,this.replaysByZIndex_={},this.hitDetectionContext_=createCanvasContext2D(1,1),this.hitDetectionTransform_=create()}return ReplayGroup$$1&&(CanvasReplayGroup.__proto__=ReplayGroup$$1),CanvasReplayGroup.prototype=Object.create(ReplayGroup$$1&&ReplayGroup$$1.prototype),CanvasReplayGroup.prototype.constructor=CanvasReplayGroup,CanvasReplayGroup.prototype.addDeclutter=function(group){var declutter=null;return this.declutterTree_&&(group?(declutter=this.declutterGroup_)[4]++:(declutter=this.declutterGroup_=createEmpty()).push(1)),declutter},CanvasReplayGroup.prototype.clip=function(context,transform){var flatClipCoords=this.getClipCoords(transform);context.beginPath(),context.moveTo(flatClipCoords[0],flatClipCoords[1]),context.lineTo(flatClipCoords[2],flatClipCoords[3]),context.lineTo(flatClipCoords[4],flatClipCoords[5]),context.lineTo(flatClipCoords[6],flatClipCoords[7]),context.clip()},CanvasReplayGroup.prototype.hasReplays=function(replays){for(var zIndex in this.replaysByZIndex_)for(var candidates=this.replaysByZIndex_[zIndex],i=0,ii=replays.length;i<ii;++i)if(replays[i]in candidates)return!0;return!1},CanvasReplayGroup.prototype.finish=function(){for(var zKey in this.replaysByZIndex_){var replays=this.replaysByZIndex_[zKey];for(var replayKey in replays)replays[replayKey].finish()}},CanvasReplayGroup.prototype.forEachFeatureAtCoordinate=function(coordinate,resolution,rotation,hitTolerance,skippedFeaturesHash,callback,declutterReplays){var hitExtent,contextSize=2*(hitTolerance=Math.round(hitTolerance))+1,transform=compose(this.hitDetectionTransform_,hitTolerance+.5,hitTolerance+.5,1/resolution,-1/resolution,-rotation,-coordinate[0],-coordinate[1]),context=this.hitDetectionContext_;context.canvas.width!==contextSize||context.canvas.height!==contextSize?(context.canvas.width=contextSize,context.canvas.height=contextSize):context.clearRect(0,0,contextSize,contextSize),void 0!==this.renderBuffer_&&(extendCoordinate(hitExtent=createEmpty(),coordinate),buffer(hitExtent,resolution*(this.renderBuffer_+hitTolerance),hitExtent));var declutteredFeatures,replayType,mask=getCircleArray(hitTolerance);function featureCallback(feature){for(var imageData=context.getImageData(0,0,contextSize,contextSize).data,i=0;i<contextSize;i++)for(var j=0;j<contextSize;j++)if(mask[i][j]&&imageData[4*(j*contextSize+i)+3]>0){var result=void 0;return(!declutteredFeatures||replayType!=ReplayType.IMAGE&&replayType!=ReplayType.TEXT||-1!==declutteredFeatures.indexOf(feature))&&(result=callback(feature)),result||void context.clearRect(0,0,contextSize,contextSize)}}this.declutterTree_&&(declutteredFeatures=this.declutterTree_.all().map(function(entry){return entry.value}));var i,j,replays,replay,result,zs=Object.keys(this.replaysByZIndex_).map(Number);for(zs.sort(numberSafeCompareFunction),i=zs.length-1;i>=0;--i){var zIndexKey=zs[i].toString();for(replays=this.replaysByZIndex_[zIndexKey],j=ORDER.length-1;j>=0;--j)if(void 0!==(replay=replays[replayType=ORDER[j]]))if(!declutterReplays||replayType!=ReplayType.IMAGE&&replayType!=ReplayType.TEXT){if(result=replay.replayHitDetection(context,transform,rotation,skippedFeaturesHash,featureCallback,hitExtent))return result}else{var declutter=declutterReplays[zIndexKey];declutter?declutter.push(replay,transform.slice(0)):declutterReplays[zIndexKey]=[replay,transform.slice(0)]}}},CanvasReplayGroup.prototype.getClipCoords=function(transform){var maxExtent=this.maxExtent_,minX=maxExtent[0],minY=maxExtent[1],maxX=maxExtent[2],maxY=maxExtent[3],flatClipCoords=[minX,minY,minX,maxY,maxX,maxY,maxX,minY];return transform2D(flatClipCoords,0,8,2,transform,flatClipCoords),flatClipCoords},CanvasReplayGroup.prototype.getReplay=function(zIndex,replayType){var zIndexKey=void 0!==zIndex?zIndex.toString():"0",replays=this.replaysByZIndex_[zIndexKey];void 0===replays&&(replays={},this.replaysByZIndex_[zIndexKey]=replays);var replay=replays[replayType];void 0===replay&&(replay=new(0,BATCH_CONSTRUCTORS[replayType])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),replays[replayType]=replay);return replay},CanvasReplayGroup.prototype.getReplays=function(){return this.replaysByZIndex_},CanvasReplayGroup.prototype.isEmpty=function(){return isEmpty(this.replaysByZIndex_)},CanvasReplayGroup.prototype.replay=function(context,transform,viewRotation,skippedFeaturesHash,snapToPixel,opt_replayTypes,opt_declutterReplays){var zs=Object.keys(this.replaysByZIndex_).map(Number);zs.sort(numberSafeCompareFunction),context.save(),this.clip(context,transform);var i,ii,j,jj,replays,replay,replayTypes=opt_replayTypes||ORDER;for(i=0,ii=zs.length;i<ii;++i){var zIndexKey=zs[i].toString();for(replays=this.replaysByZIndex_[zIndexKey],j=0,jj=replayTypes.length;j<jj;++j){var replayType=replayTypes[j];if(replay=replays[replayType],void 0!==replay)if(!opt_declutterReplays||replayType!=ReplayType.IMAGE&&replayType!=ReplayType.TEXT)replay.replay(context,transform,viewRotation,skippedFeaturesHash,snapToPixel);else{var declutter=opt_declutterReplays[zIndexKey];declutter?declutter.push(replay,transform.slice(0)):opt_declutterReplays[zIndexKey]=[replay,transform.slice(0)]}}}context.restore()},CanvasReplayGroup}(ReplayGroup),circleArrayCache={0:[[!0]]};function fillCircleArrayRowToMiddle(array,x,y){var i,radius=Math.floor(array.length/2);if(x>=radius)for(i=radius;i<x;i++)array[i][y]=!0;else if(x<radius)for(i=x+1;i<radius;i++)array[i][y]=!0}function getCircleArray(radius){if(void 0!==circleArrayCache[radius])return circleArrayCache[radius];for(var arraySize=2*radius+1,arr=new Array(arraySize),i=0;i<arraySize;i++)arr[i]=new Array(arraySize);for(var x=radius,y=0,error=0;x>=y;)fillCircleArrayRowToMiddle(arr,radius+x,radius+y),fillCircleArrayRowToMiddle(arr,radius+y,radius+x),fillCircleArrayRowToMiddle(arr,radius-y,radius+x),fillCircleArrayRowToMiddle(arr,radius-x,radius+y),fillCircleArrayRowToMiddle(arr,radius-x,radius-y),fillCircleArrayRowToMiddle(arr,radius-y,radius-x),fillCircleArrayRowToMiddle(arr,radius+y,radius-x),fillCircleArrayRowToMiddle(arr,radius+x,radius-y),2*((error+=1+2*++y)-x)+1>0&&(error+=1-2*(x-=1));return circleArrayCache[radius]=arr,arr}function replayDeclutter(declutterReplays,context,rotation,snapToPixel){for(var zs=Object.keys(declutterReplays).map(Number).sort(numberSafeCompareFunction),skippedFeatureUids={},z=0,zz=zs.length;z<zz;++z)for(var replayData=declutterReplays[zs[z].toString()],i=0,ii=replayData.length;i<ii;){var replay=replayData[i++],transform=replayData[i++];replay.replay(context,transform,rotation,skippedFeatureUids,snapToPixel)}}var SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(feature1,feature2){return parseInt(getUid(feature1),10)-parseInt(getUid(feature2),10)}function getSquaredTolerance(resolution,pixelRatio){var tolerance=getTolerance(resolution,pixelRatio);return tolerance*tolerance}function getTolerance(resolution,pixelRatio){return SIMPLIFY_TOLERANCE*resolution/pixelRatio}function renderCircleGeometry(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){var circleReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.CIRCLE);circleReplay.setFillStrokeStyle(fillStyle,strokeStyle),circleReplay.drawCircle(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderFeature(replayGroup,feature,style,squaredTolerance,listener,thisArg){var loading=!1,imageStyle=style.getImage();if(imageStyle){var imageState=imageStyle.getImageState();imageState==ImageState.LOADED||imageState==ImageState.ERROR?imageStyle.unlistenImageChange(listener,thisArg):(imageState==ImageState.IDLE&&imageStyle.load(),imageState=imageStyle.getImageState(),imageStyle.listenImageChange(listener,thisArg),loading=!0)}return renderFeatureInternal(replayGroup,feature,style,squaredTolerance),loading}function renderFeatureInternal(replayGroup,feature,style,squaredTolerance){var geometry=style.getGeometryFunction()(feature);if(geometry){var simplifiedGeometry=geometry.getSimplifiedGeometry(squaredTolerance);if(style.getRenderer())renderGeometry(replayGroup,simplifiedGeometry,style,feature);else(0,GEOMETRY_RENDERERS[simplifiedGeometry.getType()])(replayGroup,simplifiedGeometry,style,feature)}}function renderGeometry(replayGroup,geometry,style,feature){if(geometry.getType()!=GeometryType.GEOMETRY_COLLECTION)replayGroup.getReplay(style.getZIndex(),ReplayType.DEFAULT).drawCustom(geometry,feature,style.getRenderer());else for(var geometries=geometry.getGeometries(),i=0,ii=geometries.length;i<ii;++i)renderGeometry(replayGroup,geometries[i],style,feature)}function renderGeometryCollectionGeometry(replayGroup,geometry,style,feature){var i,ii,geometries=geometry.getGeometriesArray();for(i=0,ii=geometries.length;i<ii;++i){(0,GEOMETRY_RENDERERS[geometries[i].getType()])(replayGroup,geometries[i],style,feature)}}function renderLineStringGeometry(replayGroup,geometry,style,feature){var strokeStyle=style.getStroke();if(strokeStyle){var lineStringReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.LINE_STRING);lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawLineString(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderMultiLineStringGeometry(replayGroup,geometry,style,feature){var strokeStyle=style.getStroke();if(strokeStyle){var lineStringReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.LINE_STRING);lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawMultiLineString(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderMultiPolygonGeometry(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(strokeStyle||fillStyle){var polygonReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.POLYGON);polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawMultiPolygon(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderPointGeometry(replayGroup,geometry,style,feature){var imageStyle=style.getImage();if(imageStyle){if(imageStyle.getImageState()!=ImageState.LOADED)return;var imageReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.IMAGE);imageReplay.setImageStyle(imageStyle,replayGroup.addDeclutter(!1)),imageReplay.drawPoint(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!!imageStyle)),textReplay.drawText(geometry,feature)}}function renderMultiPointGeometry(replayGroup,geometry,style,feature){var imageStyle=style.getImage();if(imageStyle){if(imageStyle.getImageState()!=ImageState.LOADED)return;var imageReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.IMAGE);imageReplay.setImageStyle(imageStyle,replayGroup.addDeclutter(!1)),imageReplay.drawMultiPoint(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!!imageStyle)),textReplay.drawText(geometry,feature)}}function renderPolygonGeometry(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){var polygonReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.POLYGON);polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawPolygon(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}var CanvasVectorLayerRenderer=function(CanvasLayerRenderer$$1){function CanvasVectorLayerRenderer(vectorLayer){CanvasLayerRenderer$$1.call(this,vectorLayer),this.declutterTree_=vectorLayer.getDeclutter()?rbush_1(9,void 0):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=createEmpty(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=createCanvasContext2D(),listen(labelCache,EventType.CLEAR,this.handleFontsChanged_,this)}return CanvasLayerRenderer$$1&&(CanvasVectorLayerRenderer.__proto__=CanvasLayerRenderer$$1),CanvasVectorLayerRenderer.prototype=Object.create(CanvasLayerRenderer$$1&&CanvasLayerRenderer$$1.prototype),CanvasVectorLayerRenderer.prototype.constructor=CanvasVectorLayerRenderer,CanvasVectorLayerRenderer.prototype.disposeInternal=function(){unlisten(labelCache,EventType.CLEAR,this.handleFontsChanged_,this),CanvasLayerRenderer$$1.prototype.disposeInternal.call(this)},CanvasVectorLayerRenderer.prototype.compose=function(context,frameState,layerState){var extent=frameState.extent,pixelRatio=frameState.pixelRatio,skippedFeatureUids=layerState.managed?frameState.skippedFeatureUids:{},viewState=frameState.viewState,projection=viewState.projection,rotation=viewState.rotation,projectionExtent=projection.getExtent(),vectorSource=this.getLayer().getSource(),transform=this.getTransform(frameState,0),clipExtent=layerState.extent,clipped=void 0!==clipExtent;clipped&&this.clip(context,frameState,clipExtent);var replayGroup=this.replayGroup_;if(replayGroup&&!replayGroup.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var replayContext,layer=this.getLayer(),drawOffsetX=0,drawOffsetY=0,transparentLayer=1!==layerState.opacity,hasRenderListeners=layer.hasListener(RenderEventType.RENDER);if(transparentLayer||hasRenderListeners){var drawWidth=context.canvas.width,drawHeight=context.canvas.height;if(rotation){var drawSize=Math.round(Math.sqrt(drawWidth*drawWidth+drawHeight*drawHeight));drawOffsetX=(drawSize-drawWidth)/2,drawOffsetY=(drawSize-drawHeight)/2,drawWidth=drawHeight=drawSize}this.context.canvas.width=drawWidth,this.context.canvas.height=drawHeight,replayContext=this.context}else replayContext=context;var alpha=replayContext.globalAlpha;transparentLayer||(replayContext.globalAlpha=layerState.opacity),replayContext!=context&&replayContext.translate(drawOffsetX,drawOffsetY);var viewHints=frameState.viewHints,snapToPixel=!(viewHints[ViewHint.ANIMATING]||viewHints[ViewHint.INTERACTING]),width=frameState.size[0]*pixelRatio,height=frameState.size[1]*pixelRatio;if(rotateAtOffset(replayContext,-rotation,width/2,height/2),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids,snapToPixel),vectorSource.getWrapX()&&projection.canWrapX()&&!containsExtent(projectionExtent,extent)){for(var offsetX,startX=extent[0],worldWidth=getWidth(projectionExtent),world=0;startX<projectionExtent[0];)offsetX=worldWidth*--world,transform=this.getTransform(frameState,offsetX),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids,snapToPixel),startX+=worldWidth;for(world=0,startX=extent[2];startX>projectionExtent[2];)offsetX=worldWidth*++world,transform=this.getTransform(frameState,offsetX),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids,snapToPixel),startX-=worldWidth}if(rotateAtOffset(replayContext,rotation,width/2,height/2),hasRenderListeners&&this.dispatchRenderEvent(replayContext,frameState,transform),replayContext!=context){if(transparentLayer){var mainContextAlpha=context.globalAlpha;context.globalAlpha=layerState.opacity,context.drawImage(replayContext.canvas,-drawOffsetX,-drawOffsetY),context.globalAlpha=mainContextAlpha}else context.drawImage(replayContext.canvas,-drawOffsetX,-drawOffsetY);replayContext.translate(-drawOffsetX,-drawOffsetY)}transparentLayer||(replayContext.globalAlpha=alpha)}clipped&&context.restore()},CanvasVectorLayerRenderer.prototype.composeFrame=function(frameState,layerState,context){var transform=this.getTransform(frameState,0);this.preCompose(context,frameState,transform),this.compose(context,frameState,layerState),this.postCompose(context,frameState,layerState,transform)},CanvasVectorLayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){if(this.replayGroup_){var resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation,layer=this.getLayer(),features={};return this.replayGroup_.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,{},function(feature){var key=getUid(feature);if(!(key in features))return features[key]=!0,callback.call(thisArg,feature,layer)},null)}},CanvasVectorLayerRenderer.prototype.handleFontsChanged_=function(event){var layer=this.getLayer();layer.getVisible()&&this.replayGroup_&&layer.changed()},CanvasVectorLayerRenderer.prototype.handleStyleImageChange_=function(event){this.renderIfReadyAndVisible()},CanvasVectorLayerRenderer.prototype.prepareFrame=function(frameState,layerState){var vectorLayer=this.getLayer(),vectorSource=vectorLayer.getSource(),animating=frameState.viewHints[ViewHint.ANIMATING],interacting=frameState.viewHints[ViewHint.INTERACTING],updateWhileAnimating=vectorLayer.getUpdateWhileAnimating(),updateWhileInteracting=vectorLayer.getUpdateWhileInteracting();if(!this.dirty_&&!updateWhileAnimating&&animating||!updateWhileInteracting&&interacting)return!0;var frameStateExtent=frameState.extent,viewState=frameState.viewState,projection=viewState.projection,resolution=viewState.resolution,pixelRatio=frameState.pixelRatio,vectorLayerRevision=vectorLayer.getRevision(),vectorLayerRenderBuffer=vectorLayer.getRenderBuffer(),vectorLayerRenderOrder=vectorLayer.getRenderOrder();void 0===vectorLayerRenderOrder&&(vectorLayerRenderOrder=defaultOrder);var extent=buffer(frameStateExtent,vectorLayerRenderBuffer*resolution),projectionExtent=viewState.projection.getExtent();if(vectorSource.getWrapX()&&viewState.projection.canWrapX()&&!containsExtent(projectionExtent,frameState.extent)){var worldWidth=getWidth(projectionExtent),gutter=Math.max(getWidth(extent)/2,worldWidth);extent[0]=projectionExtent[0]-gutter,extent[2]=projectionExtent[2]+gutter}if(!this.dirty_&&this.renderedResolution_==resolution&&this.renderedRevision_==vectorLayerRevision&&this.renderedRenderOrder_==vectorLayerRenderOrder&&containsExtent(this.renderedExtent_,extent))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var replayGroup=new CanvasReplayGroup(getTolerance(resolution,pixelRatio),extent,resolution,pixelRatio,vectorSource.getOverlaps(),this.declutterTree_,vectorLayer.getRenderBuffer());vectorSource.loadFeatures(extent,resolution,projection);var render=function(feature){var styles,styleFunction=feature.getStyleFunction()||vectorLayer.getStyleFunction();if(styleFunction&&(styles=styleFunction(feature,resolution)),styles){var dirty=this.renderFeature(feature,resolution,pixelRatio,styles,replayGroup);this.dirty_=this.dirty_||dirty}}.bind(this);if(vectorLayerRenderOrder){var features=[];vectorSource.forEachFeatureInExtent(extent,function(feature){features.push(feature)}),features.sort(vectorLayerRenderOrder);for(var i=0,ii=features.length;i<ii;++i)render(features[i])}else vectorSource.forEachFeatureInExtent(extent,render);return replayGroup.finish(),this.renderedResolution_=resolution,this.renderedRevision_=vectorLayerRevision,this.renderedRenderOrder_=vectorLayerRenderOrder,this.renderedExtent_=extent,this.replayGroup_=replayGroup,this.replayGroupChanged=!0,!0},CanvasVectorLayerRenderer.prototype.renderFeature=function(feature,resolution,pixelRatio,styles,replayGroup){if(!styles)return!1;var loading=!1;if(Array.isArray(styles))for(var i=0,ii=styles.length;i<ii;++i)loading=renderFeature(replayGroup,feature,styles[i],getSquaredTolerance(resolution,pixelRatio),this.handleStyleImageChange_,this)||loading;else loading=renderFeature(replayGroup,feature,styles,getSquaredTolerance(resolution,pixelRatio),this.handleStyleImageChange_,this);return loading},CanvasVectorLayerRenderer}(CanvasLayerRenderer);CanvasVectorLayerRenderer.handles=function(layer){return layer.getType()===LayerType.VECTOR},CanvasVectorLayerRenderer.create=function(mapRenderer,layer){return new CanvasVectorLayerRenderer(layer)};var VectorTileRenderType={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"},IMAGE_REPLAYS={image:[ReplayType.POLYGON,ReplayType.CIRCLE,ReplayType.LINE_STRING,ReplayType.IMAGE,ReplayType.TEXT],hybrid:[ReplayType.POLYGON,ReplayType.LINE_STRING]},VECTOR_REPLAYS={image:[ReplayType.DEFAULT],hybrid:[ReplayType.IMAGE,ReplayType.TEXT,ReplayType.DEFAULT],vector:ORDER},CanvasVectorTileLayerRenderer=function(CanvasTileLayerRenderer$$1){function CanvasVectorTileLayerRenderer(layer){CanvasTileLayerRenderer$$1.call(this,layer,!0),this.declutterTree_=layer.getDeclutter()?rbush_1(9,void 0):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=create();var renderMode=layer.getRenderMode();this.zDirection=renderMode===VectorTileRenderType.VECTOR?1:0,renderMode!==VectorTileRenderType.VECTOR&&(this.context=createCanvasContext2D()),listen(labelCache,EventType.CLEAR,this.handleFontsChanged_,this)}return CanvasTileLayerRenderer$$1&&(CanvasVectorTileLayerRenderer.__proto__=CanvasTileLayerRenderer$$1),CanvasVectorTileLayerRenderer.prototype=Object.create(CanvasTileLayerRenderer$$1&&CanvasTileLayerRenderer$$1.prototype),CanvasVectorTileLayerRenderer.prototype.constructor=CanvasVectorTileLayerRenderer,CanvasVectorTileLayerRenderer.prototype.disposeInternal=function(){unlisten(labelCache,EventType.CLEAR,this.handleFontsChanged_,this),CanvasTileLayerRenderer$$1.prototype.disposeInternal.call(this)},CanvasVectorTileLayerRenderer.prototype.getTile=function(z,x,y,pixelRatio,projection){var tile=CanvasTileLayerRenderer$$1.prototype.getTile.call(this,z,x,y,pixelRatio,projection);return tile.getState()===TileState.LOADED&&(this.createReplayGroup_(tile,pixelRatio,projection),this.context&&this.renderTileImage_(tile,pixelRatio,projection)),tile},CanvasVectorTileLayerRenderer.prototype.getTileImage=function(tile){var tileLayer=this.getLayer();return tile.getImage(tileLayer)},CanvasVectorTileLayerRenderer.prototype.prepareFrame=function(frameState,layerState){var layerRevision=this.getLayer().getRevision();return this.renderedLayerRevision_!=layerRevision&&(this.renderedTiles.length=0),this.renderedLayerRevision_=layerRevision,CanvasTileLayerRenderer$$1.prototype.prepareFrame.call(this,frameState,layerState)},CanvasVectorTileLayerRenderer.prototype.createReplayGroup_=function(tile,pixelRatio,projection){var this$1=this,layer=this.getLayer(),revision=layer.getRevision(),renderOrder=layer.getRenderOrder()||null,replayState=tile.getReplayState(layer);if(replayState.dirty||replayState.renderedRevision!=revision||replayState.renderedRenderOrder!=renderOrder){for(var source=layer.getSource(),sourceTileGrid=source.getTileGrid(),resolution=source.getTileGridForProjection(projection).getResolution(tile.tileCoord[0]),tileExtent=tile.extent,loop=function(t,tt){var sourceTile=tile.getTile(tile.tileKeys[t]);if(sourceTile.getState()==TileState.LOADED){var sourceTileCoord=sourceTile.tileCoord,sourceTileExtent=sourceTileGrid.getTileCoordExtent(sourceTileCoord),sharedExtent=getIntersection(tileExtent,sourceTileExtent),bufferedExtent=equals$2(sourceTileExtent,sharedExtent)?null:buffer(sharedExtent,layer.getRenderBuffer()*resolution,this$1.tmpExtent),tileProjection=sourceTile.getProjection(),reproject=!1;equivalent(projection,tileProjection)||(reproject=!0,sourceTile.setProjection(projection)),replayState.dirty=!1;var replayGroup=new CanvasReplayGroup(0,sharedExtent,resolution,pixelRatio,source.getOverlaps(),this$1.declutterTree_,layer.getRenderBuffer()),squaredTolerance=getSquaredTolerance(resolution,pixelRatio),render=function(feature){var styles,styleFunction=feature.getStyleFunction()||layer.getStyleFunction();if(styleFunction&&(styles=styleFunction(feature,resolution)),styles){var dirty=this.renderFeature(feature,squaredTolerance,styles,replayGroup);this.dirty_=this.dirty_||dirty,replayState.dirty=replayState.dirty||dirty}},features=sourceTile.getFeatures();renderOrder&&renderOrder!==replayState.renderedRenderOrder&&features.sort(renderOrder);for(var i=0,ii=features.length;i<ii;++i){var feature=features[i];reproject&&(tileProjection.getUnits()==Units.TILE_PIXELS&&(tileProjection.setWorldExtent(sourceTileExtent),tileProjection.setExtent(sourceTile.getExtent())),feature.getGeometry().transform(tileProjection,projection)),bufferedExtent&&!intersects(bufferedExtent,feature.getGeometry().getExtent())||render.call(this$1,feature)}replayGroup.finish(),sourceTile.setReplayGroup(layer,tile.tileCoord.toString(),replayGroup)}},t=0,tt=tile.tileKeys.length;t<tt;++t)loop(t);replayState.renderedRevision=revision,replayState.renderedRenderOrder=renderOrder}},CanvasVectorTileLayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){var resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation;hitTolerance=null==hitTolerance?0:hitTolerance;var bufferedExtent,found,i,ii,layer=this.getLayer(),features={},renderedTiles=this.renderedTiles;for(i=0,ii=renderedTiles.length;i<ii;++i){var tile=renderedTiles[i];if(containsCoordinate(bufferedExtent=buffer(tile.extent,hitTolerance*resolution,bufferedExtent),coordinate))for(var t=0,tt=tile.tileKeys.length;t<tt;++t){var sourceTile=tile.getTile(tile.tileKeys[t]);if(sourceTile.getState()==TileState.LOADED){var replayGroup=sourceTile.getReplayGroup(layer,tile.tileCoord.toString());found=found||replayGroup.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,{},function(feature){var key=getUid(feature);if(!(key in features))return features[key]=!0,callback.call(thisArg,feature,layer)},null)}}}return found},CanvasVectorTileLayerRenderer.prototype.getReplayTransform_=function(tile,frameState){var tileGrid=this.getLayer().getSource().getTileGrid(),tileCoord=tile.tileCoord,tileResolution=tileGrid.getResolution(tileCoord[0]),viewState=frameState.viewState,pixelRatio=frameState.pixelRatio,renderResolution=viewState.resolution/pixelRatio,tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent),center=viewState.center,origin=getTopLeft(tileExtent),size=frameState.size,offsetX=Math.round(pixelRatio*size[0]/2),offsetY=Math.round(pixelRatio*size[1]/2);return compose(this.tmpTransform_,offsetX,offsetY,tileResolution/renderResolution,tileResolution/renderResolution,viewState.rotation,(origin[0]-center[0])/tileResolution,(center[1]-origin[1])/tileResolution)},CanvasVectorTileLayerRenderer.prototype.handleFontsChanged_=function(event){var layer=this.getLayer();layer.getVisible()&&void 0!==this.renderedLayerRevision_&&layer.changed()},CanvasVectorTileLayerRenderer.prototype.handleStyleImageChange_=function(event){this.renderIfReadyAndVisible()},CanvasVectorTileLayerRenderer.prototype.postCompose=function(context,frameState,layerState){var layer=this.getLayer(),renderMode=layer.getRenderMode();if(renderMode!=VectorTileRenderType.IMAGE){var offsetX,offsetY,declutterReplays=layer.getDeclutter()?{}:null,source=layer.getSource(),replayTypes=VECTOR_REPLAYS[renderMode],pixelRatio=frameState.pixelRatio,rotation=frameState.viewState.rotation,size=frameState.size;rotation&&rotateAtOffset(context,-rotation,offsetX=Math.round(pixelRatio*size[0]/2),offsetY=Math.round(pixelRatio*size[1]/2)),declutterReplays&&this.declutterTree_.clear();for(var viewHints=frameState.viewHints,snapToPixel=!(viewHints[ViewHint.ANIMATING]||viewHints[ViewHint.INTERACTING]),tiles=this.renderedTiles,tileGrid=source.getTileGridForProjection(frameState.viewState.projection),clips=[],zs=[],i=tiles.length-1;i>=0;--i){var tile=tiles[i];if(tile.getState()!=TileState.ABORT)for(var tileCoord=tile.tileCoord,worldOffset=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent)[0]-tile.extent[0],transform$$1=void 0,t=0,tt=tile.tileKeys.length;t<tt;++t){var sourceTile=tile.getTile(tile.tileKeys[t]);if(sourceTile.getState()==TileState.LOADED){var replayGroup=sourceTile.getReplayGroup(layer,tileCoord.toString());if(replayGroup&&replayGroup.hasReplays(replayTypes)){transform$$1||(transform$$1=this.getTransform(frameState,worldOffset));var currentZ=sourceTile.tileCoord[0],currentClip=replayGroup.getClipCoords(transform$$1);context.save(),context.globalAlpha=layerState.opacity;for(var j=0,jj=clips.length;j<jj;++j){var clip=clips[j];currentZ<zs[j]&&(context.beginPath(),context.moveTo(currentClip[0],currentClip[1]),context.lineTo(currentClip[2],currentClip[3]),context.lineTo(currentClip[4],currentClip[5]),context.lineTo(currentClip[6],currentClip[7]),context.moveTo(clip[6],clip[7]),context.lineTo(clip[4],clip[5]),context.lineTo(clip[2],clip[3]),context.lineTo(clip[0],clip[1]),context.clip())}replayGroup.replay(context,transform$$1,rotation,{},snapToPixel,replayTypes,declutterReplays),context.restore(),clips.push(currentClip),zs.push(currentZ)}}}}declutterReplays&&replayDeclutter(declutterReplays,context,rotation,snapToPixel),rotation&&rotateAtOffset(context,rotation,offsetX,offsetY)}CanvasTileLayerRenderer$$1.prototype.postCompose.call(this,context,frameState,layerState)},CanvasVectorTileLayerRenderer.prototype.renderFeature=function(feature,squaredTolerance,styles,replayGroup){if(!styles)return!1;var loading=!1;if(Array.isArray(styles))for(var i=0,ii=styles.length;i<ii;++i)loading=renderFeature(replayGroup,feature,styles[i],squaredTolerance,this.handleStyleImageChange_,this)||loading;else loading=renderFeature(replayGroup,feature,styles,squaredTolerance,this.handleStyleImageChange_,this);return loading},CanvasVectorTileLayerRenderer.prototype.renderTileImage_=function(tile,pixelRatio,projection){var layer=this.getLayer(),replayState=tile.getReplayState(layer),revision=layer.getRevision(),replays=IMAGE_REPLAYS[layer.getRenderMode()];if(replays&&replayState.renderedTileRevision!==revision){replayState.renderedTileRevision=revision;var tileCoord=tile.wrappedTileCoord,z=tileCoord[0],source=layer.getSource(),tileGrid=source.getTileGridForProjection(projection),resolution=tileGrid.getResolution(z),context=tile.getContext(layer),size=source.getTilePixelSize(z,pixelRatio,projection);context.canvas.width=size[0],context.canvas.height=size[1];for(var tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent),i=0,ii=tile.tileKeys.length;i<ii;++i){var sourceTile=tile.getTile(tile.tileKeys[i]);if(sourceTile.getState()==TileState.LOADED){var pixelScale=pixelRatio/resolution,transform$$1=reset(this.tmpTransform_);scale$2(transform$$1,pixelScale,-pixelScale),translate$1(transform$$1,-tileExtent[0],-tileExtent[3]),sourceTile.getReplayGroup(layer,tile.tileCoord.toString()).replay(context,transform$$1,0,{},!0,replays)}}}},CanvasVectorTileLayerRenderer}(CanvasTileLayerRenderer);CanvasVectorTileLayerRenderer.handles=function(layer){return layer.getType()===LayerType.VECTOR_TILE},CanvasVectorTileLayerRenderer.create=function(mapRenderer,layer){return new CanvasVectorTileLayerRenderer(layer)};var Map=function(PluggableMap$$1){function Map(options){(options=assign({},options)).controls||(options.controls=defaults()),options.interactions||(options.interactions=defaults$1()),PluggableMap$$1.call(this,options)}return PluggableMap$$1&&(Map.__proto__=PluggableMap$$1),Map.prototype=Object.create(PluggableMap$$1&&PluggableMap$$1.prototype),Map.prototype.constructor=Map,Map.prototype.createRenderer=function(){var renderer=new CanvasMapRenderer(this);return renderer.registerLayerRenderers([CanvasImageLayerRenderer,CanvasTileLayerRenderer,CanvasVectorLayerRenderer,CanvasVectorTileLayerRenderer]),renderer},Map}(PluggableMap),FeatureFormat=function(){this.dataProjection=null,this.defaultFeatureProjection=null};function transformWithOptions(geometry,write,opt_options){var transformed,featureProjection=opt_options?get$2(opt_options.featureProjection):null,dataProjection=opt_options?get$2(opt_options.dataProjection):null;if(transformed=featureProjection&&dataProjection&&!equivalent(featureProjection,dataProjection)?Array.isArray(geometry)?transformExtent(geometry,dataProjection,featureProjection):(write?geometry.clone():geometry).transform(write?featureProjection:dataProjection,write?dataProjection:featureProjection):geometry,write&&opt_options&&void 0!==opt_options.decimals&&!Array.isArray(transformed)){var power=Math.pow(10,opt_options.decimals);transformed===geometry&&(transformed=geometry.clone()),transformed.applyTransform(function(coordinates){for(var i=0,ii=coordinates.length;i<ii;++i)coordinates[i]=Math.round(coordinates[i]*power)/power;return coordinates})}return transformed}FeatureFormat.prototype.getReadOptions=function(source,opt_options){var options;return opt_options&&(options={dataProjection:opt_options.dataProjection?opt_options.dataProjection:this.readProjection(source),featureProjection:opt_options.featureProjection}),this.adaptOptions(options)},FeatureFormat.prototype.adaptOptions=function(options){return assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},options)},FeatureFormat.prototype.getLastExtent=function(){return null},FeatureFormat.prototype.getType=function(){return abstract()},FeatureFormat.prototype.readFeature=function(source,opt_options){return abstract()},FeatureFormat.prototype.readFeatures=function(source,opt_options){return abstract()},FeatureFormat.prototype.readGeometry=function(source,opt_options){return abstract()},FeatureFormat.prototype.readProjection=function(source){return abstract()},FeatureFormat.prototype.writeFeature=function(feature,opt_options){return abstract()},FeatureFormat.prototype.writeFeatures=function(features,opt_options){return abstract()},FeatureFormat.prototype.writeGeometry=function(geometry,opt_options){return abstract()};var JSONFeature=function(FeatureFormat$$1){function JSONFeature(){FeatureFormat$$1.call(this)}return FeatureFormat$$1&&(JSONFeature.__proto__=FeatureFormat$$1),JSONFeature.prototype=Object.create(FeatureFormat$$1&&FeatureFormat$$1.prototype),JSONFeature.prototype.constructor=JSONFeature,JSONFeature.prototype.getType=function(){return FormatType.JSON},JSONFeature.prototype.readFeature=function(source,opt_options){return this.readFeatureFromObject(getObject(source),this.getReadOptions(source,opt_options))},JSONFeature.prototype.readFeatures=function(source,opt_options){return this.readFeaturesFromObject(getObject(source),this.getReadOptions(source,opt_options))},JSONFeature.prototype.readFeatureFromObject=function(object,opt_options){return abstract()},JSONFeature.prototype.readFeaturesFromObject=function(object,opt_options){return abstract()},JSONFeature.prototype.readGeometry=function(source,opt_options){return this.readGeometryFromObject(getObject(source),this.getReadOptions(source,opt_options))},JSONFeature.prototype.readGeometryFromObject=function(object,opt_options){return abstract()},JSONFeature.prototype.readProjection=function(source){return this.readProjectionFromObject(getObject(source))},JSONFeature.prototype.readProjectionFromObject=function(object){return abstract()},JSONFeature.prototype.writeFeature=function(feature,opt_options){return JSON.stringify(this.writeFeatureObject(feature,opt_options))},JSONFeature.prototype.writeFeatureObject=function(feature,opt_options){return abstract()},JSONFeature.prototype.writeFeatures=function(features,opt_options){return JSON.stringify(this.writeFeaturesObject(features,opt_options))},JSONFeature.prototype.writeFeaturesObject=function(features,opt_options){return abstract()},JSONFeature.prototype.writeGeometry=function(geometry,opt_options){return JSON.stringify(this.writeGeometryObject(geometry,opt_options))},JSONFeature.prototype.writeGeometryObject=function(geometry,opt_options){return abstract()},JSONFeature}(FeatureFormat);function getObject(source){if("string"==typeof source){var object=JSON.parse(source);return object||null}return null!==source?source:null}var GeometryCollection=function(Geometry$$1){function GeometryCollection(opt_geometries){Geometry$$1.call(this),this.geometries_=opt_geometries||null,this.listenGeometriesChange_()}return Geometry$$1&&(GeometryCollection.__proto__=Geometry$$1),GeometryCollection.prototype=Object.create(Geometry$$1&&Geometry$$1.prototype),GeometryCollection.prototype.constructor=GeometryCollection,GeometryCollection.prototype.unlistenGeometriesChange_=function(){if(this.geometries_)for(var i=0,ii=this.geometries_.length;i<ii;++i)unlisten(this.geometries_[i],EventType.CHANGE,this.changed,this)},GeometryCollection.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var i=0,ii=this.geometries_.length;i<ii;++i)listen(this.geometries_[i],EventType.CHANGE,this.changed,this)},GeometryCollection.prototype.clone=function(){var geometryCollection=new GeometryCollection(null);return geometryCollection.setGeometries(this.geometries_),geometryCollection},GeometryCollection.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){if(minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y))return minSquaredDistance;for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)minSquaredDistance=geometries[i].closestPointXY(x,y,closestPoint,minSquaredDistance);return minSquaredDistance},GeometryCollection.prototype.containsXY=function(x,y){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)if(geometries[i].containsXY(x,y))return!0;return!1},GeometryCollection.prototype.computeExtent=function(extent){createOrUpdateEmpty(extent);for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)extend$1(extent,geometries[i].getExtent());return extent},GeometryCollection.prototype.getGeometries=function(){return cloneGeometries(this.geometries_)},GeometryCollection.prototype.getGeometriesArray=function(){return this.geometries_},GeometryCollection.prototype.getSimplifiedGeometry=function(squaredTolerance){if(this.simplifiedGeometryRevision!=this.getRevision()&&(clear(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),squaredTolerance<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&squaredTolerance<this.simplifiedGeometryMaxMinSquaredTolerance)return this;var key=squaredTolerance.toString();if(this.simplifiedGeometryCache.hasOwnProperty(key))return this.simplifiedGeometryCache[key];for(var simplifiedGeometries=[],geometries=this.geometries_,simplified=!1,i=0,ii=geometries.length;i<ii;++i){var geometry=geometries[i],simplifiedGeometry=geometry.getSimplifiedGeometry(squaredTolerance);simplifiedGeometries.push(simplifiedGeometry),simplifiedGeometry!==geometry&&(simplified=!0)}if(simplified){var simplifiedGeometryCollection=new GeometryCollection(null);return simplifiedGeometryCollection.setGeometriesArray(simplifiedGeometries),this.simplifiedGeometryCache[key]=simplifiedGeometryCollection,simplifiedGeometryCollection}return this.simplifiedGeometryMaxMinSquaredTolerance=squaredTolerance,this},GeometryCollection.prototype.getType=function(){return GeometryType.GEOMETRY_COLLECTION},GeometryCollection.prototype.intersectsExtent=function(extent){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)if(geometries[i].intersectsExtent(extent))return!0;return!1},GeometryCollection.prototype.isEmpty=function(){return 0===this.geometries_.length},GeometryCollection.prototype.rotate=function(angle,anchor){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)geometries[i].rotate(angle,anchor);this.changed()},GeometryCollection.prototype.scale=function(sx,opt_sy,opt_anchor){var anchor=opt_anchor;anchor||(anchor=getCenter(this.getExtent()));for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)geometries[i].scale(sx,opt_sy,anchor);this.changed()},GeometryCollection.prototype.setGeometries=function(geometries){this.setGeometriesArray(cloneGeometries(geometries))},GeometryCollection.prototype.setGeometriesArray=function(geometries){this.unlistenGeometriesChange_(),this.geometries_=geometries,this.listenGeometriesChange_(),this.changed()},GeometryCollection.prototype.applyTransform=function(transformFn){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)geometries[i].applyTransform(transformFn);this.changed()},GeometryCollection.prototype.translate=function(deltaX,deltaY){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)geometries[i].translate(deltaX,deltaY);this.changed()},GeometryCollection.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),Geometry$$1.prototype.disposeInternal.call(this)},GeometryCollection}(Geometry);function cloneGeometries(geometries){for(var clonedGeometries=[],i=0,ii=geometries.length;i<ii;++i)clonedGeometries.push(geometries[i].clone());return clonedGeometries}var GeoJSON=function(JSONFeature$$1){function GeoJSON(opt_options){var options=opt_options||{};JSONFeature$$1.call(this),this.dataProjection=get$2(options.dataProjection?options.dataProjection:"EPSG:4326"),options.featureProjection&&(this.defaultFeatureProjection=get$2(options.featureProjection)),this.geometryName_=options.geometryName,this.extractGeometryName_=options.extractGeometryName}return JSONFeature$$1&&(GeoJSON.__proto__=JSONFeature$$1),GeoJSON.prototype=Object.create(JSONFeature$$1&&JSONFeature$$1.prototype),GeoJSON.prototype.constructor=GeoJSON,GeoJSON.prototype.readFeatureFromObject=function(object,opt_options){var geoJSONFeature=null,geometry=readGeometry((geoJSONFeature="Feature"===object.type?object:{type:"Feature",geometry:object,properties:null}).geometry,opt_options),feature=new Feature;return this.geometryName_?feature.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in geoJSONFeature!==void 0&&feature.setGeometryName(geoJSONFeature.geometry_name),feature.setGeometry(geometry),"id"in geoJSONFeature&&feature.setId(geoJSONFeature.id),geoJSONFeature.properties&&feature.setProperties(geoJSONFeature.properties),feature},GeoJSON.prototype.readFeaturesFromObject=function(object,opt_options){var features=null;if("FeatureCollection"===object.type){features=[];for(var geoJSONFeatures=object.features,i=0,ii=geoJSONFeatures.length;i<ii;++i)features.push(this.readFeatureFromObject(geoJSONFeatures[i],opt_options))}else features=[this.readFeatureFromObject(object,opt_options)];return features},GeoJSON.prototype.readGeometryFromObject=function(object,opt_options){return readGeometry(object,opt_options)},GeoJSON.prototype.readProjectionFromObject=function(object){var projection,crs=object.crs;return crs?"name"==crs.type?projection=get$2(crs.properties.name):assert(!1,36):projection=this.dataProjection,projection},GeoJSON.prototype.writeFeatureObject=function(feature,opt_options){opt_options=this.adaptOptions(opt_options);var object={type:"Feature",geometry:null,properties:null},id=feature.getId();void 0!==id&&(object.id=id);var geometry=feature.getGeometry();geometry&&(object.geometry=writeGeometry(geometry,opt_options));var properties=feature.getProperties();return delete properties[feature.getGeometryName()],isEmpty(properties)||(object.properties=properties),object},GeoJSON.prototype.writeFeaturesObject=function(features,opt_options){opt_options=this.adaptOptions(opt_options);for(var objects=[],i=0,ii=features.length;i<ii;++i)objects.push(this.writeFeatureObject(features[i],opt_options));return{type:"FeatureCollection",features:objects}},GeoJSON.prototype.writeGeometryObject=function(geometry,opt_options){return writeGeometry(geometry,this.adaptOptions(opt_options))},GeoJSON}(JSONFeature);function readGeometry(object,opt_options){if(!object)return null;var geometry;switch(object.type){case GeometryType.POINT:geometry=readPointGeometry(object);break;case GeometryType.LINE_STRING:geometry=readLineStringGeometry(object);break;case GeometryType.POLYGON:geometry=readPolygonGeometry(object);break;case GeometryType.MULTI_POINT:geometry=readMultiPointGeometry(object);break;case GeometryType.MULTI_LINE_STRING:geometry=readMultiLineStringGeometry(object);break;case GeometryType.MULTI_POLYGON:geometry=readMultiPolygonGeometry(object);break;case GeometryType.GEOMETRY_COLLECTION:geometry=readGeometryCollectionGeometry(object);break;default:throw new Error("Unsupported GeoJSON type: "+object.type)}return transformWithOptions(geometry,!1,opt_options)}function readGeometryCollectionGeometry(object,opt_options){var geometries=object.geometries.map(function(geometry){return readGeometry(geometry,opt_options)});return new GeometryCollection(geometries)}function readPointGeometry(object){return new Point(object.coordinates)}function readLineStringGeometry(object){return new LineString(object.coordinates)}function readMultiLineStringGeometry(object){return new MultiLineString(object.coordinates)}function readMultiPointGeometry(object){return new MultiPoint(object.coordinates)}function readMultiPolygonGeometry(object){return new MultiPolygon(object.coordinates)}function readPolygonGeometry(object){return new Polygon(object.coordinates)}function writeGeometry(geometry,opt_options){var geoJSON,type=(geometry=transformWithOptions(geometry,!0,opt_options)).getType();switch(type){case GeometryType.POINT:geoJSON=writePointGeometry(geometry,opt_options);break;case GeometryType.LINE_STRING:geoJSON=writeLineStringGeometry(geometry,opt_options);break;case GeometryType.POLYGON:geoJSON=writePolygonGeometry(geometry,opt_options);break;case GeometryType.MULTI_POINT:geoJSON=writeMultiPointGeometry(geometry,opt_options);break;case GeometryType.MULTI_LINE_STRING:geoJSON=writeMultiLineStringGeometry(geometry,opt_options);break;case GeometryType.MULTI_POLYGON:geoJSON=writeMultiPolygonGeometry(geometry,opt_options);break;case GeometryType.GEOMETRY_COLLECTION:geoJSON=writeGeometryCollectionGeometry(geometry,opt_options);break;case GeometryType.CIRCLE:geoJSON={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+type)}return geoJSON}function writeGeometryCollectionGeometry(geometry,opt_options){return{type:"GeometryCollection",geometries:geometry.getGeometriesArray().map(function(geometry){var options=assign({},opt_options);return delete options.featureProjection,writeGeometry(geometry,options)})}}function writeLineStringGeometry(geometry,opt_options){return{type:"LineString",coordinates:geometry.getCoordinates()}}function writeMultiLineStringGeometry(geometry,opt_options){return{type:"MultiLineString",coordinates:geometry.getCoordinates()}}function writeMultiPointGeometry(geometry,opt_options){return{type:"MultiPoint",coordinates:geometry.getCoordinates()}}function writeMultiPolygonGeometry(geometry,opt_options){var right;return opt_options&&(right=opt_options.rightHanded),{type:"MultiPolygon",coordinates:geometry.getCoordinates(right)}}function writePointGeometry(geometry,opt_options){return{type:"Point",coordinates:geometry.getCoordinates()}}function writePolygonGeometry(geometry,opt_options){var right;return opt_options&&(right=opt_options.rightHanded),{type:"Polygon",coordinates:geometry.getCoordinates(right)}}var IconAnchorUnits={FRACTION:"fraction",PIXELS:"pixels"},IconImage=function(EventTarget){function IconImage(image,src,size,crossOrigin,imageState,color){EventTarget.call(this),this.hitDetectionImage_=null,this.image_=image||new Image,null!==crossOrigin&&(this.image_.crossOrigin=crossOrigin),this.canvas_=color?document.createElement("canvas"):null,this.color_=color,this.imageListenerKeys_=null,this.imageState_=imageState,this.size_=size,this.src_=src,this.tainted_}return EventTarget&&(IconImage.__proto__=EventTarget),IconImage.prototype=Object.create(EventTarget&&EventTarget.prototype),IconImage.prototype.constructor=IconImage,IconImage.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===ImageState.LOADED){this.tainted_=!1;var context=createCanvasContext2D(1,1);try{context.drawImage(this.image_,0,0),context.getImageData(0,0,1,1)}catch(e){this.tainted_=!0}}return!0===this.tainted_},IconImage.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(EventType.CHANGE)},IconImage.prototype.handleImageError_=function(){this.imageState_=ImageState.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},IconImage.prototype.handleImageLoad_=function(){this.imageState_=ImageState.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.replaceColor_(),this.dispatchChangeEvent_()},IconImage.prototype.getImage=function(pixelRatio){return this.canvas_?this.canvas_:this.image_},IconImage.prototype.getImageState=function(){return this.imageState_},IconImage.prototype.getHitDetectionImage=function(pixelRatio){if(!this.hitDetectionImage_)if(this.isTainted_()){var width=this.size_[0],height=this.size_[1],context=createCanvasContext2D(width,height);context.fillRect(0,0,width,height),this.hitDetectionImage_=context.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},IconImage.prototype.getSize=function(){return this.size_},IconImage.prototype.getSrc=function(){return this.src_},IconImage.prototype.load=function(){if(this.imageState_==ImageState.IDLE){this.imageState_=ImageState.LOADING,this.imageListenerKeys_=[listenOnce(this.image_,EventType.ERROR,this.handleImageError_,this),listenOnce(this.image_,EventType.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(e){this.handleImageError_()}}},IconImage.prototype.replaceColor_=function(){if(this.color_&&!this.isTainted_()){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;var ctx=this.canvas_.getContext("2d");ctx.drawImage(this.image_,0,0);for(var imgData=ctx.getImageData(0,0,this.image_.width,this.image_.height),data=imgData.data,r=this.color_[0]/255,g=this.color_[1]/255,b=this.color_[2]/255,i=0,ii=data.length;i<ii;i+=4)data[i]*=r,data[i+1]*=g,data[i+2]*=b;ctx.putImageData(imgData,0,0)}},IconImage.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(unlistenByKey),this.imageListenerKeys_=null},IconImage}(Target);function get$3(image,src,size,crossOrigin,imageState,color){var iconImage=shared.get(src,crossOrigin,color);return iconImage||(iconImage=new IconImage(image,src,size,crossOrigin,imageState,color),shared.set(src,crossOrigin,color,iconImage)),iconImage}var IconOrigin={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Icon=function(ImageStyle$$1){function Icon(opt_options){var options=opt_options||{},opacity=void 0!==options.opacity?options.opacity:1,rotation=void 0!==options.rotation?options.rotation:0,scale=void 0!==options.scale?options.scale:1,rotateWithView=void 0!==options.rotateWithView&&options.rotateWithView;ImageStyle$$1.call(this,{opacity:opacity,rotation:rotation,scale:scale,rotateWithView:rotateWithView}),this.anchor_=void 0!==options.anchor?options.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==options.anchorOrigin?options.anchorOrigin:IconOrigin.TOP_LEFT,this.anchorXUnits_=void 0!==options.anchorXUnits?options.anchorXUnits:IconAnchorUnits.FRACTION,this.anchorYUnits_=void 0!==options.anchorYUnits?options.anchorYUnits:IconAnchorUnits.FRACTION,this.crossOrigin_=void 0!==options.crossOrigin?options.crossOrigin:null;var image=void 0!==options.img?options.img:null,imgSize=void 0!==options.imgSize?options.imgSize:null,src=options.src;assert(!(void 0!==src&&image),4),assert(!image||image&&imgSize,5),void 0!==src&&0!==src.length||!image||(src=image.src||getUid(image)),assert(void 0!==src&&src.length>0,6);var imageState=void 0!==options.src?ImageState.IDLE:ImageState.LOADED;this.color_=void 0!==options.color?asArray(options.color):null,this.iconImage_=get$3(image,src,imgSize,this.crossOrigin_,imageState,this.color_),this.offset_=void 0!==options.offset?options.offset:[0,0],this.offsetOrigin_=void 0!==options.offsetOrigin?options.offsetOrigin:IconOrigin.TOP_LEFT,this.origin_=null,this.size_=void 0!==options.size?options.size:null}return ImageStyle$$1&&(Icon.__proto__=ImageStyle$$1),Icon.prototype=Object.create(ImageStyle$$1&&ImageStyle$$1.prototype),Icon.prototype.constructor=Icon,Icon.prototype.clone=function(){return new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},Icon.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var anchor=this.anchor_,size=this.getSize();if(this.anchorXUnits_==IconAnchorUnits.FRACTION||this.anchorYUnits_==IconAnchorUnits.FRACTION){if(!size)return null;anchor=this.anchor_.slice(),this.anchorXUnits_==IconAnchorUnits.FRACTION&&(anchor[0]*=size[0]),this.anchorYUnits_==IconAnchorUnits.FRACTION&&(anchor[1]*=size[1])}if(this.anchorOrigin_!=IconOrigin.TOP_LEFT){if(!size)return null;anchor===this.anchor_&&(anchor=this.anchor_.slice()),this.anchorOrigin_!=IconOrigin.TOP_RIGHT&&this.anchorOrigin_!=IconOrigin.BOTTOM_RIGHT||(anchor[0]=-anchor[0]+size[0]),this.anchorOrigin_!=IconOrigin.BOTTOM_LEFT&&this.anchorOrigin_!=IconOrigin.BOTTOM_RIGHT||(anchor[1]=-anchor[1]+size[1])}return this.normalizedAnchor_=anchor,this.normalizedAnchor_},Icon.prototype.setAnchor=function(anchor){this.anchor_=anchor,this.normalizedAnchor_=null},Icon.prototype.getColor=function(){return this.color_},Icon.prototype.getImage=function(pixelRatio){return this.iconImage_.getImage(pixelRatio)},Icon.prototype.getImageSize=function(){return this.iconImage_.getSize()},Icon.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},Icon.prototype.getImageState=function(){return this.iconImage_.getImageState()},Icon.prototype.getHitDetectionImage=function(pixelRatio){return this.iconImage_.getHitDetectionImage(pixelRatio)},Icon.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var offset=this.offset_;if(this.offsetOrigin_!=IconOrigin.TOP_LEFT){var size=this.getSize(),iconImageSize=this.iconImage_.getSize();if(!size||!iconImageSize)return null;offset=offset.slice(),this.offsetOrigin_!=IconOrigin.TOP_RIGHT&&this.offsetOrigin_!=IconOrigin.BOTTOM_RIGHT||(offset[0]=iconImageSize[0]-size[0]-offset[0]),this.offsetOrigin_!=IconOrigin.BOTTOM_LEFT&&this.offsetOrigin_!=IconOrigin.BOTTOM_RIGHT||(offset[1]=iconImageSize[1]-size[1]-offset[1])}return this.origin_=offset,this.origin_},Icon.prototype.getSrc=function(){return this.iconImage_.getSrc()},Icon.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},Icon.prototype.listenImageChange=function(listener,thisArg){return listen(this.iconImage_,EventType.CHANGE,listener,thisArg)},Icon.prototype.load=function(){this.iconImage_.load()},Icon.prototype.unlistenImageChange=function(listener,thisArg){unlisten(this.iconImage_,EventType.CHANGE,listener,thisArg)},Icon}(ImageStyle),Property$3={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},DEFAULT_GRADIENT=["#00f","#0ff","#0f0","#ff0","#f00"],Heatmap=function(VectorLayer$$1){function Heatmap(opt_options){var options=opt_options||{},baseOptions=assign({},options);delete baseOptions.gradient,delete baseOptions.radius,delete baseOptions.blur,delete baseOptions.shadow,delete baseOptions.weight,VectorLayer$$1.call(this,baseOptions),this.gradient_=null,this.shadow_=void 0!==options.shadow?options.shadow:250,this.circleImage_=void 0,this.styleCache_=null,listen(this,getChangeEventType(Property$3.GRADIENT),this.handleGradientChanged_,this),this.setGradient(options.gradient?options.gradient:DEFAULT_GRADIENT),this.setBlur(void 0!==options.blur?options.blur:15),this.setRadius(void 0!==options.radius?options.radius:8),listen(this,getChangeEventType(Property$3.BLUR),this.handleStyleChanged_,this),listen(this,getChangeEventType(Property$3.RADIUS),this.handleStyleChanged_,this),this.handleStyleChanged_();var weightFunction,weight=options.weight?options.weight:"weight";weightFunction="string"==typeof weight?function(feature){return feature.get(weight)}:weight,this.setStyle(function(feature,resolution){var weight=weightFunction(feature),opacity=void 0!==weight?clamp(weight,0,1):1,index=255*opacity|0,style=this.styleCache_[index];return style||(style=[new Style({image:new Icon({opacity:opacity,src:this.circleImage_})})],this.styleCache_[index]=style),style}.bind(this)),this.setRenderOrder(null),listen(this,RenderEventType.RENDER,this.handleRender_,this)}return VectorLayer$$1&&(Heatmap.__proto__=VectorLayer$$1),Heatmap.prototype=Object.create(VectorLayer$$1&&VectorLayer$$1.prototype),Heatmap.prototype.constructor=Heatmap,Heatmap.prototype.createCircle_=function(){var radius=this.getRadius(),blur=this.getBlur(),halfSize=radius+blur+1,size=2*halfSize,context=createCanvasContext2D(size,size);context.shadowOffsetX=context.shadowOffsetY=this.shadow_,context.shadowBlur=blur,context.shadowColor="#000",context.beginPath();var center=halfSize-this.shadow_;return context.arc(center,center,radius,0,2*Math.PI,!0),context.fill(),context.canvas.toDataURL()},Heatmap.prototype.getBlur=function(){return this.get(Property$3.BLUR)},Heatmap.prototype.getGradient=function(){return this.get(Property$3.GRADIENT)},Heatmap.prototype.getRadius=function(){return this.get(Property$3.RADIUS)},Heatmap.prototype.handleGradientChanged_=function(){this.gradient_=createGradient(this.getGradient())},Heatmap.prototype.handleStyleChanged_=function(){this.circleImage_=this.createCircle_(),this.styleCache_=new Array(256),this.changed()},Heatmap.prototype.handleRender_=function(event){for(var context=event.context,canvas=context.canvas,image=context.getImageData(0,0,canvas.width,canvas.height),view8=image.data,i=0,ii=view8.length;i<ii;i+=4){var alpha=4*view8[i+3];alpha&&(view8[i]=this.gradient_[alpha],view8[i+1]=this.gradient_[alpha+1],view8[i+2]=this.gradient_[alpha+2])}context.putImageData(image,0,0)},Heatmap.prototype.setBlur=function(blur){this.set(Property$3.BLUR,blur)},Heatmap.prototype.setGradient=function(colors){this.set(Property$3.GRADIENT,colors)},Heatmap.prototype.setRadius=function(radius){this.set(Property$3.RADIUS,radius)},Heatmap}(VectorLayer);function createGradient(colors){for(var context=createCanvasContext2D(1,256),gradient=context.createLinearGradient(0,0,1,256),step=1/(colors.length-1),i=0,ii=colors.length;i<ii;++i)gradient.addColorStop(i*step,colors[i]);return context.fillStyle=gradient,context.fillRect(0,0,1,256),context.getImageData(0,0,1,256).data}var ImageLayer=function(Layer$$1){function ImageLayer(opt_options){var options=opt_options||{};Layer$$1.call(this,options),this.type=LayerType.IMAGE}return Layer$$1&&(ImageLayer.__proto__=Layer$$1),ImageLayer.prototype=Object.create(Layer$$1&&Layer$$1.prototype),ImageLayer.prototype.constructor=ImageLayer,ImageLayer}(Layer);ImageLayer.prototype.getSource;var TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},TileLayer=function(Layer$$1){function TileLayer(opt_options){var options=opt_options||{},baseOptions=assign({},options);delete baseOptions.preload,delete baseOptions.useInterimTilesOnError,Layer$$1.call(this,baseOptions),this.setPreload(void 0!==options.preload?options.preload:0),this.setUseInterimTilesOnError(void 0===options.useInterimTilesOnError||options.useInterimTilesOnError),this.type=LayerType.TILE}return Layer$$1&&(TileLayer.__proto__=Layer$$1),TileLayer.prototype=Object.create(Layer$$1&&Layer$$1.prototype),TileLayer.prototype.constructor=TileLayer,TileLayer.prototype.getPreload=function(){return this.get(TileProperty.PRELOAD)},TileLayer.prototype.setPreload=function(preload){this.set(TileProperty.PRELOAD,preload)},TileLayer.prototype.getUseInterimTilesOnError=function(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)},TileLayer.prototype.setUseInterimTilesOnError=function(useInterimTilesOnError){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,useInterimTilesOnError)},TileLayer}(Layer);TileLayer.prototype.getSource;var VectorTileLayer=function(VectorLayer$$1){function VectorTileLayer(opt_options){var options=opt_options||{},renderMode=options.renderMode||VectorTileRenderType.HYBRID;assert(null==renderMode||renderMode==VectorTileRenderType.IMAGE||renderMode==VectorTileRenderType.HYBRID||renderMode==VectorTileRenderType.VECTOR,28),options.declutter&&renderMode==VectorTileRenderType.IMAGE&&(renderMode=VectorTileRenderType.HYBRID),options.renderMode=renderMode;var baseOptions=assign({},options);delete baseOptions.preload,delete baseOptions.useInterimTilesOnError,VectorLayer$$1.call(this,baseOptions),this.setPreload(options.preload?options.preload:0),this.setUseInterimTilesOnError(void 0===options.useInterimTilesOnError||options.useInterimTilesOnError),this.type=LayerType.VECTOR_TILE}return VectorLayer$$1&&(VectorTileLayer.__proto__=VectorLayer$$1),VectorTileLayer.prototype=Object.create(VectorLayer$$1&&VectorLayer$$1.prototype),VectorTileLayer.prototype.constructor=VectorTileLayer,VectorTileLayer.prototype.getPreload=function(){return this.get(TileProperty.PRELOAD)},VectorTileLayer.prototype.getUseInterimTilesOnError=function(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)},VectorTileLayer.prototype.setPreload=function(preload){this.set(TileProperty.PRELOAD,preload)},VectorTileLayer.prototype.setUseInterimTilesOnError=function(useInterimTilesOnError){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,useInterimTilesOnError)},VectorTileLayer}(VectorLayer);VectorTileLayer.prototype.getSource;var ImageWrapper=function(ImageBase$$1){function ImageWrapper(extent,resolution,pixelRatio,src,crossOrigin,imageLoadFunction){ImageBase$$1.call(this,extent,resolution,pixelRatio,ImageState.IDLE),this.src_=src,this.image_=new Image,null!==crossOrigin&&(this.image_.crossOrigin=crossOrigin),this.imageListenerKeys_=null,this.state=ImageState.IDLE,this.imageLoadFunction_=imageLoadFunction}return ImageBase$$1&&(ImageWrapper.__proto__=ImageBase$$1),ImageWrapper.prototype=Object.create(ImageBase$$1&&ImageBase$$1.prototype),ImageWrapper.prototype.constructor=ImageWrapper,ImageWrapper.prototype.getImage=function(){return this.image_},ImageWrapper.prototype.handleImageError_=function(){this.state=ImageState.ERROR,this.unlistenImage_(),this.changed()},ImageWrapper.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=getHeight(this.extent)/this.image_.height),this.state=ImageState.LOADED,this.unlistenImage_(),this.changed()},ImageWrapper.prototype.load=function(){this.state!=ImageState.IDLE&&this.state!=ImageState.ERROR||(this.state=ImageState.LOADING,this.changed(),this.imageListenerKeys_=[listenOnce(this.image_,EventType.ERROR,this.handleImageError_,this),listenOnce(this.image_,EventType.LOAD,this.handleImageLoad_,this)],this.imageLoadFunction_(this,this.src_))},ImageWrapper.prototype.setImage=function(image){this.image_=image},ImageWrapper.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(unlistenByKey),this.imageListenerKeys_=null},ImageWrapper}(ImageBase);function calculateSourceResolution(sourceProj,targetProj,targetCenter,targetResolution){var sourceCenter=transform(targetCenter,targetProj,sourceProj),sourceResolution=getPointResolution(targetProj,targetResolution,targetCenter),targetMetersPerUnit=targetProj.getMetersPerUnit();void 0!==targetMetersPerUnit&&(sourceResolution*=targetMetersPerUnit);var sourceMetersPerUnit=sourceProj.getMetersPerUnit();void 0!==sourceMetersPerUnit&&(sourceResolution/=sourceMetersPerUnit);var sourceExtent=sourceProj.getExtent();if(!sourceExtent||containsCoordinate(sourceExtent,sourceCenter)){var compensationFactor=getPointResolution(sourceProj,sourceResolution,sourceCenter)/sourceResolution;isFinite(compensationFactor)&&compensationFactor>0&&(sourceResolution/=compensationFactor)}return sourceResolution}function enlargeClipPoint(centroidX,centroidY,x,y){var dX=x-centroidX,dY=y-centroidY,distance=Math.sqrt(dX*dX+dY*dY);return[Math.round(x+dX/distance),Math.round(y+dY/distance)]}function render$2(width,height,pixelRatio,sourceResolution,sourceExtent,targetResolution,targetExtent,triangulation,sources,gutter,opt_renderEdges){var context=createCanvasContext2D(Math.round(pixelRatio*width),Math.round(pixelRatio*height));if(0===sources.length)return context.canvas;context.scale(pixelRatio,pixelRatio);var sourceDataExtent=createEmpty();sources.forEach(function(src,i,arr){extend$1(sourceDataExtent,src.extent)});var canvasWidthInUnits=getWidth(sourceDataExtent),canvasHeightInUnits=getHeight(sourceDataExtent),stitchContext=createCanvasContext2D(Math.round(pixelRatio*canvasWidthInUnits/sourceResolution),Math.round(pixelRatio*canvasHeightInUnits/sourceResolution)),stitchScale=pixelRatio/sourceResolution;sources.forEach(function(src,i,arr){var xPos=src.extent[0]-sourceDataExtent[0],yPos=-(src.extent[3]-sourceDataExtent[3]),srcWidth=getWidth(src.extent),srcHeight=getHeight(src.extent);stitchContext.drawImage(src.image,gutter,gutter,src.image.width-2*gutter,src.image.height-2*gutter,xPos*stitchScale,yPos*stitchScale,srcWidth*stitchScale,srcHeight*stitchScale)});var targetTopLeft=getTopLeft(targetExtent);return triangulation.getTriangles().forEach(function(triangle,i,arr){var source=triangle.source,target=triangle.target,x0=source[0][0],y0=source[0][1],x1=source[1][0],y1=source[1][1],x2=source[2][0],y2=source[2][1],u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution,sourceNumericalShiftX=x0,sourceNumericalShiftY=y0;x0=0,y0=0;var affineCoefs=solveLinearSystem([[x1-=sourceNumericalShiftX,y1-=sourceNumericalShiftY,0,0,u1-u0],[x2-=sourceNumericalShiftX,y2-=sourceNumericalShiftY,0,0,u2-u0],[0,0,x1,y1,v1-v0],[0,0,x2,y2,v2-v0]]);if(affineCoefs){context.save(),context.beginPath();var centroidX=(u0+u1+u2)/3,centroidY=(v0+v1+v2)/3,p0=enlargeClipPoint(centroidX,centroidY,u0,v0),p1=enlargeClipPoint(centroidX,centroidY,u1,v1),p2=enlargeClipPoint(centroidX,centroidY,u2,v2);context.moveTo(p1[0],p1[1]),context.lineTo(p0[0],p0[1]),context.lineTo(p2[0],p2[1]),context.clip(),context.transform(affineCoefs[0],affineCoefs[2],affineCoefs[1],affineCoefs[3],u0,v0),context.translate(sourceDataExtent[0]-sourceNumericalShiftX,sourceDataExtent[3]-sourceNumericalShiftY),context.scale(sourceResolution/pixelRatio,-sourceResolution/pixelRatio),context.drawImage(stitchContext.canvas,0,0),context.restore()}}),opt_renderEdges&&(context.save(),context.strokeStyle="black",context.lineWidth=1,triangulation.getTriangles().forEach(function(triangle,i,arr){var target=triangle.target,u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution;context.beginPath(),context.moveTo(u1,v1),context.lineTo(u0,v0),context.lineTo(u2,v2),context.closePath(),context.stroke()}),context.restore()),context.canvas}var MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25,Triangulation=function(sourceProj,targetProj,targetExtent,maxSourceExtent,errorThreshold){this.sourceProj_=sourceProj,this.targetProj_=targetProj;var transformInvCache={},transformInv=getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(c){var key=c[0]+"/"+c[1];return transformInvCache[key]||(transformInvCache[key]=transformInv(c)),transformInvCache[key]},this.maxSourceExtent_=maxSourceExtent,this.errorThresholdSquared_=errorThreshold*errorThreshold,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!maxSourceExtent&&!!this.sourceProj_.getExtent()&&getWidth(maxSourceExtent)==getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;var destinationTopLeft=getTopLeft(targetExtent),destinationTopRight=getTopRight(targetExtent),destinationBottomRight=getBottomRight(targetExtent),destinationBottomLeft=getBottomLeft(targetExtent),sourceTopLeft=this.transformInv_(destinationTopLeft),sourceTopRight=this.transformInv_(destinationTopRight),sourceBottomRight=this.transformInv_(destinationBottomRight),sourceBottomLeft=this.transformInv_(destinationBottomLeft);if(this.addQuad_(destinationTopLeft,destinationTopRight,destinationBottomRight,destinationBottomLeft,sourceTopLeft,sourceTopRight,sourceBottomRight,sourceBottomLeft,MAX_SUBDIVISION),this.wrapsXInSource_){var leftBound=1/0;this.triangles_.forEach(function(triangle,i,arr){leftBound=Math.min(leftBound,triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])}),this.triangles_.forEach(function(triangle){if(Math.max(triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])-leftBound>this.sourceWorldWidth_/2){var newTriangle=[[triangle.source[0][0],triangle.source[0][1]],[triangle.source[1][0],triangle.source[1][1]],[triangle.source[2][0],triangle.source[2][1]]];newTriangle[0][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[0][0]-=this.sourceWorldWidth_),newTriangle[1][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[1][0]-=this.sourceWorldWidth_),newTriangle[2][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[2][0]-=this.sourceWorldWidth_);var minX=Math.min(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0]);Math.max(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0])-minX<this.sourceWorldWidth_/2&&(triangle.source=newTriangle)}}.bind(this))}transformInvCache={}};Triangulation.prototype.addTriangle_=function(a,b,c,aSrc,bSrc,cSrc){this.triangles_.push({source:[aSrc,bSrc,cSrc],target:[a,b,c]})},Triangulation.prototype.addQuad_=function(a,b,c,d,aSrc,bSrc,cSrc,dSrc,maxSubdivision){var sourceQuadExtent=boundingExtent([aSrc,bSrc,cSrc,dSrc]),sourceCoverageX=this.sourceWorldWidth_?getWidth(sourceQuadExtent)/this.sourceWorldWidth_:null,sourceWorldWidth=this.sourceWorldWidth_,wrapsX=this.sourceProj_.canWrapX()&&sourceCoverageX>.5&&sourceCoverageX<1,needsSubdivision=!1;if(maxSubdivision>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)needsSubdivision=getWidth(boundingExtent([a,b,c,d]))/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||needsSubdivision;!wrapsX&&this.sourceProj_.isGlobal()&&sourceCoverageX&&(needsSubdivision=sourceCoverageX>MAX_TRIANGLE_WIDTH||needsSubdivision)}if(needsSubdivision||!this.maxSourceExtent_||intersects(sourceQuadExtent,this.maxSourceExtent_)){if(!(needsSubdivision||isFinite(aSrc[0])&&isFinite(aSrc[1])&&isFinite(bSrc[0])&&isFinite(bSrc[1])&&isFinite(cSrc[0])&&isFinite(cSrc[1])&&isFinite(dSrc[0])&&isFinite(dSrc[1]))){if(!(maxSubdivision>0))return;needsSubdivision=!0}if(maxSubdivision>0){if(!needsSubdivision){var dx,center=[(a[0]+c[0])/2,(a[1]+c[1])/2],centerSrc=this.transformInv_(center);if(wrapsX)dx=(modulo(aSrc[0],sourceWorldWidth)+modulo(cSrc[0],sourceWorldWidth))/2-modulo(centerSrc[0],sourceWorldWidth);else dx=(aSrc[0]+cSrc[0])/2-centerSrc[0];var dy=(aSrc[1]+cSrc[1])/2-centerSrc[1];needsSubdivision=dx*dx+dy*dy>this.errorThresholdSquared_}if(needsSubdivision){if(Math.abs(a[0]-c[0])<=Math.abs(a[1]-c[1])){var bc=[(b[0]+c[0])/2,(b[1]+c[1])/2],bcSrc=this.transformInv_(bc),da=[(d[0]+a[0])/2,(d[1]+a[1])/2],daSrc=this.transformInv_(da);this.addQuad_(a,b,bc,da,aSrc,bSrc,bcSrc,daSrc,maxSubdivision-1),this.addQuad_(da,bc,c,d,daSrc,bcSrc,cSrc,dSrc,maxSubdivision-1)}else{var ab=[(a[0]+b[0])/2,(a[1]+b[1])/2],abSrc=this.transformInv_(ab),cd=[(c[0]+d[0])/2,(c[1]+d[1])/2],cdSrc=this.transformInv_(cd);this.addQuad_(a,ab,cd,d,aSrc,abSrc,cdSrc,dSrc,maxSubdivision-1),this.addQuad_(ab,b,c,cd,abSrc,bSrc,cSrc,cdSrc,maxSubdivision-1)}return}}if(wrapsX){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(a,c,d,aSrc,cSrc,dSrc),this.addTriangle_(a,b,c,aSrc,bSrc,cSrc)}},Triangulation.prototype.calculateSourceExtent=function(){var extent=createEmpty();return this.triangles_.forEach(function(triangle,i,arr){var src=triangle.source;extendCoordinate(extent,src[0]),extendCoordinate(extent,src[1]),extendCoordinate(extent,src[2])}),extent},Triangulation.prototype.getTriangles=function(){return this.triangles_};var ReprojImage=function(ImageBase$$1){function ReprojImage(sourceProj,targetProj,targetExtent,targetResolution,pixelRatio,getImageFunction){var maxSourceExtent=sourceProj.getExtent(),maxTargetExtent=targetProj.getExtent(),limitedTargetExtent=maxTargetExtent?getIntersection(targetExtent,maxTargetExtent):targetExtent,sourceResolution=calculateSourceResolution(sourceProj,targetProj,getCenter(limitedTargetExtent),targetResolution),triangulation=new Triangulation(sourceProj,targetProj,limitedTargetExtent,maxSourceExtent,sourceResolution*ERROR_THRESHOLD),sourceImage=getImageFunction(triangulation.calculateSourceExtent(),sourceResolution,pixelRatio),state=ImageState.LOADED;sourceImage&&(state=ImageState.IDLE);var sourcePixelRatio=sourceImage?sourceImage.getPixelRatio():1;ImageBase$$1.call(this,targetExtent,targetResolution,sourcePixelRatio,state),this.targetProj_=targetProj,this.maxSourceExtent_=maxSourceExtent,this.triangulation_=triangulation,this.targetResolution_=targetResolution,this.targetExtent_=targetExtent,this.sourceImage_=sourceImage,this.sourcePixelRatio_=sourcePixelRatio,this.canvas_=null,this.sourceListenerKey_=null}return ImageBase$$1&&(ReprojImage.__proto__=ImageBase$$1),ReprojImage.prototype=Object.create(ImageBase$$1&&ImageBase$$1.prototype),ReprojImage.prototype.constructor=ReprojImage,ReprojImage.prototype.disposeInternal=function(){this.state==ImageState.LOADING&&this.unlistenSource_(),ImageBase$$1.prototype.disposeInternal.call(this)},ReprojImage.prototype.getImage=function(){return this.canvas_},ReprojImage.prototype.getProjection=function(){return this.targetProj_},ReprojImage.prototype.reproject_=function(){var sourceState=this.sourceImage_.getState();if(sourceState==ImageState.LOADED){var width=getWidth(this.targetExtent_)/this.targetResolution_,height=getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=render$2(width,height,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=sourceState,this.changed()},ReprojImage.prototype.load=function(){if(this.state==ImageState.IDLE){this.state=ImageState.LOADING,this.changed();var sourceState=this.sourceImage_.getState();sourceState==ImageState.LOADED||sourceState==ImageState.ERROR?this.reproject_():(this.sourceListenerKey_=listen(this.sourceImage_,EventType.CHANGE,function(e){var sourceState=this.sourceImage_.getState();sourceState!=ImageState.LOADED&&sourceState!=ImageState.ERROR||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},ReprojImage.prototype.unlistenSource_=function(){unlistenByKey(this.sourceListenerKey_),this.sourceListenerKey_=null},ReprojImage}(ImageBase),ImageSourceEventType={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"},ImageSourceEvent=function(Event$$1){function ImageSourceEvent(type,image){Event$$1.call(this,type),this.image=image}return Event$$1&&(ImageSourceEvent.__proto__=Event$$1),ImageSourceEvent.prototype=Object.create(Event$$1&&Event$$1.prototype),ImageSourceEvent.prototype.constructor=ImageSourceEvent,ImageSourceEvent}(Event),ImageSource=function(Source$$1){function ImageSource(options){Source$$1.call(this,{attributions:options.attributions,projection:options.projection,state:options.state}),this.resolutions_=void 0!==options.resolutions?options.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}return Source$$1&&(ImageSource.__proto__=Source$$1),ImageSource.prototype=Object.create(Source$$1&&Source$$1.prototype),ImageSource.prototype.constructor=ImageSource,ImageSource.prototype.getResolutions=function(){return this.resolutions_},ImageSource.prototype.findNearestResolution=function(resolution){if(this.resolutions_){var idx=linearFindNearest(this.resolutions_,resolution,0);resolution=this.resolutions_[idx]}return resolution},ImageSource.prototype.getImage=function(extent,resolution,pixelRatio,projection){var sourceProjection=this.getProjection();if(sourceProjection&&projection&&!equivalent(sourceProjection,projection)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&equivalent(this.reprojectedImage_.getProjection(),projection)&&this.reprojectedImage_.getResolution()==resolution&&equals$2(this.reprojectedImage_.getExtent(),extent))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new ReprojImage(sourceProjection,projection,extent,resolution,pixelRatio,function(extent,resolution,pixelRatio){return this.getImageInternal(extent,resolution,pixelRatio,sourceProjection)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return sourceProjection&&(projection=sourceProjection),this.getImageInternal(extent,resolution,pixelRatio,projection)},ImageSource.prototype.getImageInternal=function(extent,resolution,pixelRatio,projection){return abstract()},ImageSource.prototype.handleImageChange=function(event){var image=event.target;switch(image.getState()){case ImageState.LOADING:this.loading=!0,this.dispatchEvent(new ImageSourceEvent(ImageSourceEventType.IMAGELOADSTART,image));break;case ImageState.LOADED:this.loading=!1,this.dispatchEvent(new ImageSourceEvent(ImageSourceEventType.IMAGELOADEND,image));break;case ImageState.ERROR:this.loading=!1,this.dispatchEvent(new ImageSourceEvent(ImageSourceEventType.IMAGELOADERROR,image))}},ImageSource}(Source);function defaultImageLoadFunction(image,src){image.getImage().src=src}var Static=function(ImageSource$$1){function Static(options){var crossOrigin=void 0!==options.crossOrigin?options.crossOrigin:null,imageLoadFunction=void 0!==options.imageLoadFunction?options.imageLoadFunction:defaultImageLoadFunction;ImageSource$$1.call(this,{attributions:options.attributions,projection:get$2(options.projection)}),this.url_=options.url,this.imageExtent_=options.imageExtent,this.image_=new ImageWrapper(this.imageExtent_,void 0,1,this.url_,crossOrigin,imageLoadFunction),this.imageSize_=options.imageSize?options.imageSize:null,listen(this.image_,EventType.CHANGE,this.handleImageChange,this)}return ImageSource$$1&&(Static.__proto__=ImageSource$$1),Static.prototype=Object.create(ImageSource$$1&&ImageSource$$1.prototype),Static.prototype.constructor=Static,Static.prototype.getImageExtent=function(){return this.imageExtent_},Static.prototype.getImageInternal=function(extent,resolution,pixelRatio,projection){return intersects(extent,this.image_.getExtent())?this.image_:null},Static.prototype.getUrl=function(){return this.url_},Static.prototype.handleImageChange=function(evt){if(this.image_.getState()==ImageState.LOADED){var imageWidth,imageHeight,imageExtent=this.image_.getExtent(),image=this.image_.getImage();this.imageSize_?(imageWidth=this.imageSize_[0],imageHeight=this.imageSize_[1]):(imageWidth=image.width,imageHeight=image.height);var resolution=getHeight(imageExtent)/imageHeight,targetWidth=Math.ceil(getWidth(imageExtent)/resolution);if(targetWidth!=imageWidth){var context=createCanvasContext2D(targetWidth,imageHeight),canvas=context.canvas;context.drawImage(image,0,0,imageWidth,imageHeight,0,0,canvas.width,canvas.height),this.image_.setImage(canvas)}}ImageSource$$1.prototype.handleImageChange.call(this,evt)},Static}(ImageSource);export{Map,View,Draw,Fill,GeoJSON,getCenter,Feature,Heatmap as HeatmapLayer,ImageLayer,Point,Projection,Static,Stroke,Style,VectorLayer,VectorSource};