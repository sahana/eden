OpenLayers.Control.SelectFeatureDouble=OpenLayers.Class(OpenLayers.Control.SelectFeature,{initialize:function(a,b){OpenLayers.Control.SelectFeature.prototype.initialize.apply(this,[a,b]);this.handlers={feature:new OpenLayers.Handler.FeatureDoubleClick(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes,stopDouble:!0})}},CLASS_NAME:"OpenLayers.Control.SelectFeatureDouble"});
OpenLayers.Handler.FeatureDoubleClick=OpenLayers.Class(OpenLayers.Handler.Feature,{delay:300,single:!0,"double":!0,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touchstart:function(a){this.touch||(this.unregisterMouseListeners(),this.touch=!0);this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return!0},touchmove:function(a){this.last=this.getEventInfo(a);return!0},touchend:function(a){this.down&&(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),
this.down=null);return!0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(a){this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return!0},mouseup:function(a){var b=!0;this.checkModifiers(a)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a)&&(b=this.rightclick(a));return b},click:function(a){this.last||(this.last=this.getEventInfo(a));this.handleSingle(a);
return!this.stopSingle},dblclick:function(a){this.handleDouble(a);return!this.stopDouble},handleDouble:function(a){this.passesDblclickTolerance(a)&&(this["double"]&&this.handle(a),this.clearTimer())},handleSingle:function(a){this.passesTolerance(a)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.stop(a),this.handleDouble(a)),(!this.last.touches||2!==this.last.touches.length)&&this.clearTimer()):(this.first=this.getEventInfo(a),this.queuePotentialClick(this.single?
OpenLayers.Util.extend({},a):null)))},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)},passesTolerance:function(a){var b=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(b=this.pixelTolerance>=this.down.xy.distanceTo(a.xy))&&this.touch&&this.down.touches.length===this.last.touches.length)for(var a=0,c=this.down.touches.length;a<c;++a)if(this.getTouchDistance(this.down.touches[a],this.last.touches[a])>this.pixelTolerance){b=
!1;break}return b},getTouchDistance:function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,2))},passesDblclickTolerance:function(){var a=!0;this.down&&this.first&&(a=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return a},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(a){this.timerId=
null;a&&this.handle(a)},getEventInfo:function(a){var b;if(a.touches){var c=a.touches.length;b=Array(c);for(var e,d=0;d<c;d++)e=a.touches[d],b[d]={clientX:e.clientX,clientY:e.clientY}}return{xy:a.xy,touches:b}},CLASS_NAME:"OpenLayers.Handler.FeatureDoubleClick"});
OpenLayers.Popup.FramedCloudLocation=OpenLayers.Class(OpenLayers.Popup.FramedCloud,{imageSize:new OpenLayers.Size(12,24),maxSize:new OpenLayers.Size(300,300),fixedRelativePosition:!0,relativePosition:"tl",positionBlocks:{tl:{offset:new OpenLayers.Pixel(0,0),padding:new OpenLayers.Bounds(5,0,0,145),blocks:[{size:new OpenLayers.Size(12,24),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,0)}]}},initialize:function(a,b,c,e,d,f,g){this.imageSrc=S3.Ap.concat("/static/themes/Vulnerability/img/mapWindowCornerPng8.png");
OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloudLocation"});
OpenLayers.Popup.FramedCloudVolunteer=OpenLayers.Class(OpenLayers.Popup.FramedCloud,{imageSize:new OpenLayers.Size(12,12),maxSize:new OpenLayers.Size(200,200),fixedRelativePosition:!0,relativePosition:"tr",positionBlocks:{tr:{offset:new OpenLayers.Pixel(0,0),padding:new OpenLayers.Bounds(0,12,0,0),blocks:[{size:new OpenLayers.Size(12,12),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,0)}]}},initialize:function(a,b,c,e,d,f,g){this.imageSrc=S3.Ap.concat("/static/themes/Vulnerability/img/mapPopupStemVolunteer.png");
OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloudVolunteer"});
OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:4,zoomStopHeight:9,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!1,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,
arguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar());this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];this._addButton("zoomin","zoomin.png",a,{w:18,h:17});centered=this._addZoomBar(a.add(0,17));this._addButton("zoomout","zoomout.png",centered,{w:18,h:18});return this.div},_addButton:function(a,b,c,e){b=
S3.Ap.concat("/static/themes/Vulnerability/img/gis/"+b);c=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,c,e,b,"absolute");c.style.cursor="pointer";this.div.appendChild(c);c.action=a;c.className="olButton";this.buttons.push(c);return c},_addZoomBar:function(a){var b=S3.Ap.concat("/static/themes/Vulnerability/img/gis/slider.png"),c=this.id+"_"+this.map.id,e=this.map.getMinZoom(),d=this.map.getNumZoomLevels()-1-this.map.getZoom(),d=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,d*this.zoomStopHeight),
{w:18,h:10},b,"absolute");d.style.cursor="move";this.slider=d;this.sliderEvents=new OpenLayers.Events(this,d,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var f={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-e)},b=S3.Ap.concat("/static/themes/Vulnerability/img/gis/bar.png"),c=null;OpenLayers.Util.alphaHack()?(c=this.id+
"_"+this.map.id,c=OpenLayers.Util.createAlphaImageDiv(c,a.add(6,0),{w:f.w,h:this.zoomStopHeight},b,"absolute",null,"crop"),c.style.height=f.h+"px"):c=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a.add(6,0),f,b);c.style.cursor="pointer";c.className="olButton";this.zoombarDiv=c;this.div.appendChild(c);this.startTop=parseInt(c.style.top);this.div.appendChild(d);this.map.events.register("zoomend",this,this.moveZoomBar);return a=a.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-
e))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(a){switch(a.buttonElement.action){case "zoomin":this.map.zoomIn();break;
case "zoomout":this.map.zoomOut();break;case "zoombarDiv":a=a.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom)a=Math.floor(a);a=this.map.getNumZoomLevels()-1-a;a=Math.min(Math.max(a,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(a)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},zoomBarDown:function(a){if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,
mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a)},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);0<a.clientY-c[1]&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2&&(this.slider.style.top=parseInt(this.slider.style.top)-b+"px",this.mouseDragStart=a.xy.clone());this.deltaY=
this.zoomStart.y-a.xy.y;OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||"touchend"===a.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)):(b+=this.deltaY/this.zoomStopHeight,
b=Math.max(Math.round(b),0));this.map.zoomTo(b);this.zoomStart=this.mouseDragStart=null;this.deltaY=0;OpenLayers.Event.stop(a)}},moveZoomBar:function(){this.slider.style.top=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});
