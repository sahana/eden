(function(c){"function"===typeof define&&define.amd?define("jquery load-image load-image-meta load-image-scale load-image-exif canvas-to-blob ./jquery.fileupload-process".split(" "),c):"object"===typeof exports?c(require("jquery"),require("blueimp-load-image/js/load-image"),require("blueimp-load-image/js/load-image-meta"),require("blueimp-load-image/js/load-image-scale"),require("blueimp-load-image/js/load-image-exif"),require("blueimp-canvas-to-blob"),require("./jquery.fileupload-process")):c(window.jQuery,
window.loadImage)})(function(c,g){c.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},
{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"});c.widget("blueimp.fileupload",
c.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1E7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(a,b){if(b.disabled)return a;var f=this,d=a.files[a.index],e=c.Deferred();return"number"===c.type(b.maxFileSize)&&d.size>b.maxFileSize||b.fileTypes&&
!b.fileTypes.test(d.type)||!g(d,function(b){b.src&&(a.img=b);e.resolveWith(f,[a])},b)?a:e.promise()},resizeImage:function(a,b){if(b.disabled||!a.canvas&&!a.img)return a;b=c.extend({canvas:!0},b);var f=this,d=c.Deferred(),e=b.canvas&&a.canvas||a.img,h=function(c){c&&(c.width!==e.width||c.height!==e.height||b.forceResize)&&(a[c.getContext?"canvas":"img"]=c);a.preview=c;d.resolveWith(f,[a])},k;if(a.exif){!0===b.orientation&&(b.orientation=a.exif.get("Orientation"));if(b.thumbnail&&(k=a.exif.get("Thumbnail")))return g(k,
h,b),d.promise();a.orientation?delete b.orientation:a.orientation=b.orientation}return e?(h(g.scale(e,b)),d.promise()):a},saveImage:function(a,b){if(!a.canvas||b.disabled)return a;var f=this,d=a.files[a.index],e=c.Deferred();if(a.canvas.toBlob)a.canvas.toBlob(function(b){b.name||(d.type===b.type?b.name=d.name:d.name&&(b.name=d.name.replace(/\.\w+$/,"."+b.type.substr(6))));d.type!==b.type&&delete a.imageHead;a.files[a.index]=b;e.resolveWith(f,[a])},b.type||d.type,b.quality);else return a;return e.promise()},
loadImageMetaData:function(a,b){if(b.disabled)return a;var f=this,d=c.Deferred();g.parseMetaData(a.files[a.index],function(b){c.extend(a,b);d.resolveWith(f,[a])},b);return d.promise()},saveImageMetaData:function(a,b){if(!(a.imageHead&&a.canvas&&a.canvas.toBlob)||b.disabled)return a;b=a.files[a.index];var c=new Blob([a.imageHead,this._blobSlice.call(b,20)],{type:b.type});c.name=b.name;a.files[a.index]=c;return a},setImage:function(a,b){a.preview&&!b.disabled&&(a.files[a.index][b.name||"preview"]=a.preview);
return a},deleteImageReferences:function(a,b){b.disabled||(delete a.img,delete a.canvas,delete a.preview,delete a.imageHead);return a}}})});
