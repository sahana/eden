OpenLayers.Layer.cdauth={};
OpenLayers.Layer.cdauth.CoordinateGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{maxHorizontalLines:6,maxVerticalLines:null,styleMapNormal:{stroke:!0,stokeWidth:1,strokeColor:"black",strokeOpacity:0.2},styleMapHighlight:{stroke:!0,stokeWidth:2,strokeColor:"black",strokeOpacity:0.5},labelStyleMapNormal:{fontColor:"#777",fontSize:"10px"},labelStyleMapHighlight:{fontColor:"#666",fontSize:"10px",fontWeight:"bold"},horizontalLines:{},verticalLines:{},degreeLabels:[],initialize:function(b,f){if("undefined"==
typeof b||null==b)b=OpenLayers.i18n("Coordinate grid");f=OpenLayers.Util.extend(f,{projection:new OpenLayers.Projection("EPSG:4326")});OpenLayers.Layer.Vector.prototype.initialize.apply(this,[b,f])},setMap:function(){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.drawGrid);this.map.events.register("mapResize",this,this.drawGrid);this.events.register("visibilitychanged",this,this.drawGrid)},drawGrid:function(){if(this.map&&this.map.getExtent()&&
this.getVisibility()){var b=this.map.getExtent().transform(this.map.getProjectionObject(),this.projection),f=this.map.maxExtent.clone().transform(this.map.getProjectionObject(),this.projection),g=[],h=[];this.destroyFeatures(this.degreeLabels);this.degreeLabels=[];var c=Math.pow(10,Math.ceil(Math.log((b.top-b.bottom)/this.maxHorizontalLines)/Math.LN10));5*(b.top-b.bottom)/c<=this.maxHorizontalLines?c/=5:2*(b.top-b.bottom)/c<=this.maxHorizontalLines&&(c/=2);for(var e in this.horizontalLines){var a=
e/c,d=0==a%5,k=this.horizontalLines[e].style==this.styleMapHighlight;if(Math.floor(a)!=a||d!=k)h.push(this.horizontalLines[e]),delete this.horizontalLines[e]}for(a=Math.ceil(b.bottom/c)*c;a<b.top;a+=c)-90>a||90<a||(d=0==a/c%5,this.degreeLabels.push(new OpenLayers.Feature.Vector((new OpenLayers.Geometry.Point(b.left,a)).transform(this.projection,this.map.getProjectionObject()),null,OpenLayers.Util.extend({label:Math.round(1E8*a)/1E8+"\ufffd",labelAlign:"lm"},d?this.labelStyleMapHighlight:this.labelStyleMapNormal))),
this.degreeLabels.push(new OpenLayers.Feature.Vector((new OpenLayers.Geometry.Point(b.right,a)).transform(this.projection,this.map.getProjectionObject()),null,OpenLayers.Util.extend({label:Math.round(1E8*a)/1E8+"\ufffd",labelAlign:"rm"},d?this.labelStyleMapHighlight:this.labelStyleMapNormal))),this.horizontalLines[a]||(this.horizontalLines[a]=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([(new OpenLayers.Geometry.Point(f.left,a)).transform(this.projection,this.map.getProjectionObject()),
(new OpenLayers.Geometry.Point(f.right,a)).transform(this.projection,this.map.getProjectionObject())]),null,d?this.styleMapHighlight:this.styleMapNormal),g.push(this.horizontalLines[a])));d=null!=this.maxVerticalLines?this.maxVerticalLines:Math.round(this.maxHorizontalLines*this.map.size.w/this.map.size.h);c=Math.pow(10,Math.ceil(Math.log((b.right-b.left)/d)/Math.LN10));5*(b.right-b.left)/c<=d?c/=5:2*(b.right-b.left)/c<=d&&(c/=2);for(e in this.verticalLines)if(a=e/c,d=0==a%5,k=this.verticalLines[e].style==
this.styleMapHighlight,Math.floor(a)!=a||d!=k)h.push(this.verticalLines[e]),delete this.verticalLines[e];for(a=Math.ceil(b.left/c)*c;a<b.right;a+=c)-180>=a||180<a||(d=0==a/c%5,this.degreeLabels.push(new OpenLayers.Feature.Vector((new OpenLayers.Geometry.Point(a,b.top)).transform(this.projection,this.map.getProjectionObject()),null,OpenLayers.Util.extend({label:Math.round(1E8*a)/1E8+"\ufffd",labelAlign:"ct"},d?this.labelStyleMapHighlight:this.labelStyleMapNormal))),this.degreeLabels.push(new OpenLayers.Feature.Vector((new OpenLayers.Geometry.Point(a,
b.bottom)).transform(this.projection,this.map.getProjectionObject()),null,OpenLayers.Util.extend({label:Math.round(1E8*a)/1E8+"\ufffd",labelAlign:"cb"},d?this.labelStyleMapHighlight:this.labelStyleMapNormal))),this.verticalLines[a]||(this.verticalLines[a]=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([(new OpenLayers.Geometry.Point(a,f.top)).transform(this.projection,this.map.getProjectionObject()),(new OpenLayers.Geometry.Point(a,f.bottom)).transform(this.projection,this.map.getProjectionObject())]),
null,d?this.styleMapHighlight:this.styleMapNormal),g.push(this.verticalLines[a])));this.destroyFeatures(h);this.addFeatures(g);this.addFeatures(this.degreeLabels)}}});
