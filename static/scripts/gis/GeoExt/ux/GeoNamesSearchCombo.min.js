Ext.namespace("GeoExt.ux");
GeoExt.ux.GeoNamesSearchCombo=Ext.extend(Ext.form.ComboBox,{map:null,width:350,listWidth:350,loadingText:"Search in Geonames...",emptyText:"Search location in Geonames",zoom:8,minChars:1,queryDelay:50,maxRows:"20",tpl:'<tpl for="."><div class="x-combo-list-item"><h1>{name}<br></h1>{fcodeName} - {countryName}</div></tpl>',lang:"en",countryString:"",continentCode:"",adminCode1:"",adminCode2:"",adminCode3:"",featureClassString:"",featureCodeString:"",tag:"",charset:"UTF8",hideTrigger:!0,displayField:"name",
forceSelection:!0,queryParam:"name_startsWith",url:"http://ws.geonames.org/searchJSON?",initComponent:function(){GeoExt.ux.GeoNamesSearchCombo.superclass.initComponent.apply(this,arguments);var a="";0<this.countryString.length&&(a+=this.countryString);0<this.featureClassString.length&&(a+=this.featureClassString);0<this.featureCodeString.length&&(a+=this.featureCodeString);this.store=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:this.url+a,method:"GET"}),baseParams:{maxRows:this.maxRows,
lang:this.lang,continentCode:this.continentCode,adminCode1:this.adminCode1,adminCode2:this.adminCode2,adminCode3:this.adminCode3,tag:this.tag,charset:this.charset},reader:new Ext.data.JsonReader({idProperty:"geonameId",root:"geonames",totalProperty:"totalResultsCount",fields:[{name:"geonameId"},{name:"countryName"},{name:"lng"},{name:"lat"},{name:"name"},{name:"fcodeName"},{name:"adminCode1"},{name:"fclName"},{name:"countryCode"},{name:"fcl"},{name:"fcode"},{name:"population"},{name:"adminName1"}]})});
if(0<this.zoom)this.on("select",function(a,b,c){a=new OpenLayers.LonLat(b.data.lng,b.data.lat);a.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());b=0===b.data.fcode.lastIndexOf("PCL",0)?5:"ADM1"==b.data.fcode?7:"ADM2"==b.data.fcode?9:"ADM3"==b.data.fcode?10:"ADM4"==b.data.fcode?11:12;this.map.setCenter(a,b)},this)}});Ext.reg("gxux_geonamessearchcombo",GeoExt.ux.GeoNamesSearchCombo);
