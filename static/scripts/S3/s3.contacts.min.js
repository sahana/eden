$(document).ready(function(){var e=S3.pr_contacts_person_id,h=S3.pr_contacts_controller,d=S3.pr_contacts_access;$("#contact-add").click(function(){$("#contact-add_throbber").removeClass("hide").show();var b=$(this);$("#popup").remove();var c=S3.Ap.concat("/pr/contact/create.iframe?person="+e);d&&(c+="&access="+d);$.get(c,function(a){b.hide();b.after("<div></div>");b.next().html(a);a=S3.Ap.concat("/pr/contact/create?person="+e+"&controller="+h);d&&(a+="&access="+d);$("#popup").find("form").attr("action",
a);$("#contact-add_throbber").hide();$("#popup form").show()})});$(".contact").each(function(){var b=$(this),c=b.attr("id").match(/\d+/);b.find("a.delete-btn-ajax").click(function(a){confirm(i18n.delete_confirmation)&&($.post(S3.Ap.concat("/pr/contact/"+c[0]+"/delete")),b.addClass("hide"))});b.find("a.editBtn").click(function(a){a=b.find("span");var d=a.html(),e=$("<div>").addClass("form-container"),f=$("<form>");e.append(f);var g=$('<input id="pr_contact_value" size=62>');g.val(d);f.append(g);d=
$('<input type="submit" class="fright">');d.val("Save");f.append(d);a.replaceWith(e);b.addClass("edit");f.submit(function(a){a.preventDefault();$("#pr_contact_value_error").remove();b.removeClass("edit").addClass("saving");f.append($('<img class="pr_contact_throbber inline-throbber fright">'));f.find("input[type=submit]").addClass("hide");$.post(S3.Ap.concat("/pr/contact/"+c[0]+".s3json"),'{"$_pr_contact":'+JSON.stringify({value:g.val()})+"}",function(a){if("failed"==a.status){try{error_message=a.tree.$_pr_contact[0].value["@error"]}catch(c){error_message=
a.message}$("#pr_contact_value").after($('<div id="pr_contact_value_error" class="error">'+error_message+"</div>").css({display:"none"}).slideDown("slow").click(function(){$(this).fadeOut("slow");return!1}));b.removeClass("saving").addClass("edit");f.find("input[type=submit]").removeClass("hide");$(".pr_contact_throbber").remove()}else b.removeClass("saving"),a=g.val(),e.replaceWith($("<span>").html(a))},"json")})})});$("#emergency-add").click(function(){$("#emergency-add_throbber").removeClass("hide").show();
var b=$(this);$(".iframe-container").remove();$(".emergency").show();var c=S3.Ap.concat("/pr/contact_emergency/create.iframe");d&&(c+="&access="+d);$.get(c,function(a){b.hide();b.after('<div class="iframe-container"></div>');b.next().html(a);a=S3.Ap.concat("/pr/contact_emergency/create?person="+e+"&controller="+h);d&&(a+="&access="+d);$("#emergency-add_throbber").hide();$(".iframe-container form").attr("action",a).show()})});$(".emergency").each(function(){var b=$(this),c=b.attr("id").match(/\d+/);
b.find("a.delete-btn-ajax").click(function(a){confirm(i18n.delete_confirmation)&&($.post(S3.Ap.concat("/pr/contact_emergency/"+c+"/delete")),b.addClass("hide"))});b.find("a.editBtn").click(function(){$("#emergency-add_throbber").removeClass("hide").show();var a=S3.Ap.concat("/pr/contact_emergency/"+c+".iframe/update");$.get(a,function(a){$(".iframe-container").remove();$(".emergency").show();$("#emergency-add").show();b.hide();b.after('<div class="iframe-container"></div>');b.next().html(a);$("#emergency-add_throbber").hide();
a=S3.Ap.concat("/pr/contact_emergency/"+c+"/update?person="+e+"&controller="+h);$(".iframe-container form").attr("action",a).show()})})})});
