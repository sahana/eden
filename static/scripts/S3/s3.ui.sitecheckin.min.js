/*
 2016-2020 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,f,e){a instanceof String&&(a=String(a));for(var b=a.length,c=0;c<b;c++){var d=a[c];if(f.call(e,d,c,a))return{i:c,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,e){if(a==Array.prototype||a==Object.prototype)return a;a[f]=e.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<a.length;++f){var e=a[f];if(e&&e.Math==Math)return e}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,f){var e=$jscomp.propertyToPolyfillSymbol[f];if(null==e)return a[f];e=a[e];return void 0!==e?e:a[f]};
$jscomp.polyfill=function(a,f,e,b){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,f,e,b):$jscomp.polyfillUnisolated(a,f,e,b))};$jscomp.polyfillUnisolated=function(a,f,e,b){e=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var c=a[b];if(!(c in e))return;e=e[c]}a=a[a.length-1];b=e[a];f=f(b);f!=b&&null!=f&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(a,f,e,b){var c=a.split(".");a=1===c.length;b=c[0];b=!a&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var d=0;d<c.length-1;d++){var g=c[d];if(!(g in b))return;b=b[g]}c=c[c.length-1];e=$jscomp.IS_SYMBOL_NATIVE&&"es6"===e?b[c]:null;f=f(e);null!=f&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:f}):f!==e&&(void 0===$jscomp.propertyToPolyfillSymbol[c]&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):
$jscomp.POLYFILL_PREFIX+c),c=$jscomp.propertyToPolyfillSymbol[c],$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:f})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(f,e){return $jscomp.findInternal(this,f,e).v}},"es6","es3");
(function(a,f){var e=0;a.widget("s3.siteCheckIn",{options:{tableName:"site_check_in",ajaxURL:"",noPictureAvailable:"No picture available",statusCheckedIn:"checked-in",statusCheckedOut:"checked-out",statusNone:"-",statusLabel:"Status"},_create:function(){a(this.element);this.id=e;e+=1;this.eventNamespace=".siteCheckIn"},_init:function(){this.idPrefix="#"+this.options.tableName;this.personData=a(this.element).find("input[type=hidden][name=data]");this.refresh()},_destroy:function(){a.Widget.prototype.destroy.call(this)},
refresh:function(){this._unbindEvents();var b=this.personData.val();b&&"null"!=b&&this._showPersonData(JSON.parse(b));this._bindEvents()},_checkID:function(){var b=this.idPrefix,c=a(b+"_label"),d=c.val().trim();c.val(d);if(d){this._clearForm(!1,!0);b=a(b+"_person__row .controls").empty();var g=a('<div class="inline-throbber">').insertAfter(b);a("#submit_record__row").find(".button").prop("disabled",!0);var h=this;a.ajaxS3({url:this.options.ajaxURL,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",
data:JSON.stringify({m:"check",l:d}),success:function(k){g.remove();a("#submit_record__row").find(".button").prop("disabled",!1);k.e?a('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+k.e+"</div></div>").hide().insertAfter(c).slideDown():(h._showPersonData(k),(k=k.m)&&S3.showAlert(k[0],k[1]))},error:function(){g.remove();a("#submit_record__row").find(".button").prop("disabled",!1);h._clearForm(!0,!1)}})}},_register:function(b){var c=this.idPrefix,d=a(c+"_label"),
g=d.val().trim();d.val(g);if(g){this._clearAlert();c=a(c+"_person__row .controls");var h=a('<div class="inline-throbber">').insertAfter(c);a("#submit_record__row").find(".button").prop("disabled",!0);var k=!!a.trim(c.html()).length,m=this;a.ajaxS3({url:this.options.ajaxURL,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({m:b,l:g}),success:function(l){h.remove();a("#submit_record__row").find(".button").prop("disabled",!1);l.e?a('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+
l.e+"</div></div>").hide().insertAfter(d).slideDown():(l.a&&!k?m._showPersonData(l):m._clearForm(),(l=l.m)&&S3.showAlert(l[0],l[1]))},error:function(){h.remove();a("#submit_record__row").find(".button").prop("disabled",!1);m._clearForm(!0,!1)}})}},_showPersonData:function(b){var c=this.idPrefix,d=a(c+"_person__row .controls"),g=a(c+"_status__row .controls");c=a(c+"_info__row .controls");d.html(b.d).removeClass("hide").show();this._showProfilePicture(b.p);d=this._statusMsg(b.s);g.append(d).removeClass("hide").show();
b.i?1==b.s&&this._toggleAction("check-in-btn","off"):this._toggleAction("check-in-btn","deny");b.o?2==b.s&&this._toggleAction("check-out-btn","off"):this._toggleAction("check-out-btn","deny");b.a&&c.html(b.a).removeClass("hide").show()},_statusMsg:function(b){var c=this.options,d=a('<div class="check-in-status">');a('<span class="status-label">'+c.statusLabel+": </span>").appendTo(d);var g=a('<span class="status-message">').appendTo(d);switch(b){case 1:g.html(c.statusCheckedIn);break;case 2:g.html(c.statusCheckedOut);
break;default:g.html(c.statusNone)}return d},_clearForm:function(b,c){var d=this.idPrefix;a(".inline-throbber").remove();b||this._clearAlert();c||a(d+"_label").val("").focus();a(d+"_person__row .controls").hide().empty();a(d+"_status__row .controls").hide().empty();a(d+"_info__row .controls").hide().empty();this._hideProfilePicture();this._toggleAction("check-in-btn","on");this._toggleAction("check-out-btn","on")},_clearAlert:function(){a(".alert-error, .alert-warning, .alert-info, .alert-success").fadeOut("fast").remove();
a(".error_wrapper").fadeOut("fast").remove()},_showProfilePicture:function(b){var c=a("#profile-picture").empty();c=a('<div class="panel">').hide().appendTo(c);b=b?a("<img>").attr("src",b):a("<p>").text(this.options.noPictureAvailable);c.append(b).show()},_hideProfilePicture:function(){a("#profile-picture").empty()},_toggleAction:function(b,c){var d=a("input."+b),g=d.val();if(d.length)switch(d.siblings(".disabled-"+b).remove(),c){case "off":d.prop("disabled",!0).show();break;case "deny":b=a('<a class="tiny alert button disabled-'+
b+'" disabled="disabled"><i class="fa fa-ban"></i>'+g+"</a>");d.prop("disabled",!0).hide().after(b);break;default:d.siblings(".disabled-"+b).remove(),d.prop("disabled",!1).show()}},_bindEvents:function(){var b=this,c=a(this.element),d=this.eventNamespace,g=this.idPrefix;c.find(".check-btn").bind("click"+d,function(h){h.preventDefault();b._checkID()});c.find(".check-in-btn").unbind(d).bind("click"+d,function(h){h.preventDefault();b._register("check-in")});c.find(".check-out-btn").unbind(d).bind("click"+
d,function(h){h.preventDefault();b._register("check-out")});c.find("a.cancel-action, .clear-btn").bind("click"+d,function(h){h.preventDefault();b._clearForm()});c=a(g+"_label");c.bind("input"+d,function(h){b._clearForm(!1,!0)});c.bind("keyup"+d,function(h){switch(h.which){case 27:b._clearForm()}});return!0},_unbindEvents:function(){var b=a(this.element),c=this.eventNamespace;a(this.idPrefix+"_label").unbind(c);b.find(".check-btn").unbind(c);b.find(".check-in-btn").unbind(c);b.find(".check-out-btn").unbind(c);
b.find("a.cancel-action, .clear-btn").unbind(c);return!0}})})(jQuery);
