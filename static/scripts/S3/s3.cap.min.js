var $jscomp={scope:{},findInternal:function(a,g,b){a instanceof String&&(a=String(a));for(var e=a.length,h=0;h<e;h++){var p=a[h];if(g.call(b,p,h,a))return{i:h,v:p}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[g]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,g,b,e){if(g){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var h=a[e];h in b||(b[h]={});b=b[h]}a=a[a.length-1];e=b[a];g=g(e);g!=e&&null!=g&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
(function(a,g){function b(a){a=a.find("[name=_formname]").val();if("undefined"!=typeof a){if("cap_alert"==a.substring(0,9))return"cap_alert";if("cap_info"==a.substring(0,8))return"cap_info"}return""}function e(){return 0<a(".cap_info_template_form").length}function h(a){return"cap_alert"==a?["codes","note","incidents"]:"cap_info"==a?"category event response_type urgency severity certainty audience event_code effective onset expires sender_name headline description instruction contact web parameter".split(" "):[]}
function p(d){function g(f,g){var c=b(d),e=h(c),n,l={};"undefined"==typeof g&&(g=!1);f?"cap_alert"==c?(n=f.$_cap_alert&&f.$_cap_alert[0]||{},l=a.parseJSON(n.template_settings)||{},a(".cap_alert_form").addClass("template_loaded")):"cap_info"==c&&(n=f.$_cap_info&&f.$_cap_info[0]||{},l={}):(n={},l={});a.each(e,function(f,b){try{var c=d.find("[name="+b+"]"),e=l.locked&&l.locked[b];switch(typeof n[b]){case "string":"restriction"==b?(c.val(n[b]||""),""!=c.val()&&k.show()):(m.show(),k.hide());case "undefined":if(c.is(":text")||
c.is("textarea")||c.is("select"))(g||e)&&c.val(n[b]||""),e?c.prop("disabled",!0).attr("title","This field is locked by the template"):c.prop("disabled",!1).attr("title","");break;case "object":var h=["scope","addresses","codes"];for(f=0;f<h.length;f++)b==h[f]&&c.val(n[b]["@value"]||"");"incidents"==b&&(g||e)&&(c.val(n[b]["@value"]||""),a("select#cap_alert_incidents").multiselect("refresh"))}}catch(q){s3_debug("ERROR",q)}})}function l(b,d,c){if(b){"undefined"==typeof c&&(c="template");var f=new RegExp(".*\\"+
S3.Ap+"\\/"),f=(new String(self.location)).replace(f,"").split("?")[0].split("/")[0];b=[S3.Ap,f,c,b].join("/")+".s3json";a.ajax({url:b,type:"GET",dataType:"json",success:function(a){g(a,d)},error:function(a){alert("There was an unexpected error loading template data")}})}}var k=a("#cap_alert_restriction__row, #cap_alert_restriction__row1"),m=a("#cap_alert_addresses__row, #cap_alert_addresses__row1");"Restricted"==a("#cap_alert_scope").val()?(k.show(),m.hide()):("Public"==a("#cap_alert_scope").val()||
"Private"==a("#cap_alert_scope").val()?m.show():m.hide(),k.hide());a("#cap_alert_scope").change(function(){switch(a(this).val()){case "Public":k.hide();a("#cap_alert_restriction").val()&&a("#cap_alert_restriction").val("");m.show();break;case "Restricted":m.hide();a("#cap_alert_addresses").val()&&a("#cap_alert_addresses").val("");k.show();break;case "Private":k.hide();a("#cap_alert_restriction").val()&&a("#cap_alert_restriction").val("");m.show();break;case "":m.hide(),k.hide()}});a("#cap_info_priority").change(function(){if(a(this).val()){var b=
S3.cap_priorities,k=b.length;"Undefined"==a(this).find("option:selected").text()&&(a(this).css("border","2px solid gray"),d.find("[name=urgency]").val(""),d.find("[name=severity]").val(""),d.find("[name=certainty]").val(""));for(var c=0;c<k;c++)b[c][0]==a(this).find("option:selected").text()&&(d.find("[name=urgency]").val(b[c][1]),d.find("[name=severity]").val(b[c][2]),d.find("[name=certainty]").val(b[c][3]),a(this).css("border","2px solid #"+b[c][4]))}else a(this).css("border","1px solid gray")});
d.find("[name=template_id]").change(function(){l(a(this).val(),!0)});"cap_alert"!=b(d)||0<a(".cap_template_form").length||l(d.find("[name=template_id]").val());"cap_info"!=b(d)||e()||l(d.find("[name=template_info_id]").val(),!1,"info");window.apply_temp=l}function r(d){function e(){try{return a.parseJSON(d.find("[name=template_settings]").val())||{}}catch(k){return s3_debug("Error occured parsing: ",d.find("[name=template_settings]").val()),{}}}function l(b,m){var f="can_edit-"+b,k=a('<label for="'+
f+'">'+(i18n.cap_locked||"Locked")+"</label>"),f=a('<input type="checkbox" name="'+f+'"/>');f.change(function(){var c=e();c.locked=c.locked||{};c.locked[b]=a(this).is(":checked");d.find("[name=template_settings]").val(g.stringify(c))});var c=e();c.locked&&c.locked[b]&&f.prop("checked","checked");m.append(k);m.append(f)}d.find("[name=is_template]").prop("checked","checked");tablename=b(d);fields=h(tablename);d.find("tr").each(function(){var b=a(this),d=b.attr("id");d&&d.match("__row$")&&(d=d.replace(tablename+
"_","").replace("__row",""),b=b.find("td.w2p_fc")||b.find("td").eq(1),0<=fields.indexOf(d)&&l(d,b))})}var u=function(){a(".cap-clone-update").unbind(".cap").bind("click.cap",function(){t(a(this).attr("data"))})},t=function(b){var d=b.split("/")[0];(b=b.split("/").pop())&&a.ajax({url:S3.Ap.concat("/cap/alert/")+b+"/clone?msg_type="+d,success:function(a){window.location.href=S3.Ap.concat("/cap/alert/")+a.message},error:function(a,b,d){console.log("UNAUTHORIZED"==d?i18n.gis_requires_login:a.responseText)},
type:"POST",dataType:"json"})};window.fields=h;a(document).ready(function(){a("form").each(function(){""!==b(a(this))&&(p(a(this)),(0<a(".cap_template_form").length||e())&&r(a(this)))});u()})})(jQuery,JSON,void 0);
