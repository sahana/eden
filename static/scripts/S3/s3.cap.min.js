(function(b,p){function k(a){a=a.find("[name=_formname]").val();if("undefined"!=typeof a){if("cap_alert"==a.substring(0,9))return"cap_alert";if("cap_info"==a.substring(0,8))return"cap_info"}return""}function n(){return 0<b(".cap_info_template_form").length}function m(a){return"cap_alert"==a?"sender sent status msg_type source scope restriction addresses codes note reference incidents".split(" "):"cap_info"==a?"category event response_type urgency severity certainty audience event_code effective onset expires sender_name headline description instruction contact web parameter".split(" "):
[]}function q(a){function l(e,f){var c=k(a),d=m(c),h,g={};"undefined"==typeof f&&(f=!1);e?"cap_alert"==c?(h=e.$_cap_alert&&e.$_cap_alert[0]||{},g=b.parseJSON(h.template_settings)||{},b(".cap_alert_form").addClass("template_loaded")):"cap_info"==c&&(h=e.$_cap_info&&e.$_cap_info[0]||{},g=b.parseJSON(h.template_settings)||{}):(h={},g={});b.each(d,function(e,b){try{var c=a.find("[name="+b+"]"),d=g.locked&&g.locked[b];switch(typeof h[b]){case "string":case "undefined":if(c.is(":text")||c.is("textarea")||
c.is("select"))(f||d)&&c.val(h[b]||""),d?c.prop("disabled",!0).attr("title","This field is locked by the template"):c.prop("disabled",!1).attr("title","")}}catch(r){s3_debug("ERROR",r)}})}function g(a,f,c){if(a){"undefined"==typeof c&&(c="template");var d=new RegExp(".*\\"+S3.Ap+"\\/"),d=(new String(self.location)).replace(d,"").split("?")[0].split("/")[0];a=[S3.Ap,d,c,a].join("/")+".s3json";b.ajax({url:a,type:"GET",dataType:"json",success:function(a){l(a,f)},error:function(a){alert("There was an unexpected error loading template data")}})}}
var f=b("#cap_alert_restriction__row, #cap_alert_restriction__row1"),d=b("#cap_alert_addresses__row, #cap_alert_addresses__row1");f.hide();b("#cap_alert_scope").change(function(){switch(b(this).val()){case "Public":f.hide();d.show();break;case "Restricted":f.show();d.hide();break;case "Private":f.hide(),d.show()}});b("#cap_info_priority").change(function(){var e=S3.cap_priorities,d=e.length;"Undefined"==b(this).val()&&(b(this).css("border","2px solid gray"),a.find("[name=urgency]").val(""),a.find("[name=severity]").val(""),
a.find("[name=certainty]").val(""));for(var c=0;c<d;c++)e[c][0]==b(this).val()&&(a.find("[name=urgency]").val(e[c][1]),a.find("[name=severity]").val(e[c][2]),a.find("[name=certainty]").val(e[c][3]),b(this).css("border","2px solid "+e[c][4]))});a.find("[name=urgency],[name=severity],[name=certainty]").change(function(){for(var b=S3.cap_priorities,d=b.length,c=0;c<d;c++)if(a.find("[name=urgency]").val()==b[c][1]&&a.find("[name=severity]").val()==b[c][2]&&a.find("[name=certainty]").val()==b[c][3]){a.find("[name=priority]").val(b[c][0]).css("border",
"2px solid "+b[c][4]);return}a.find("[name=priority]").val("Undefined").css("border","2px solid gray")});a.find("[name=template_id]").change(function(){g(b(this).val(),!0)});"cap_alert"!=k(a)||0<b(".cap_template_form").length||g(a.find("[name=template_id]").val());"cap_info"!=k(a)||n()||g(a.find("[name=template_info_id]").val(),!1,"info");window.apply_temp=g}function s(a){function l(){try{return b.parseJSON(a.find("[name=template_settings]").val())||{}}catch(f){return s3_debug("Error occured parsing: ",
a.find("[name=template_settings]").val()),{}}}function g(f,d){var e="can_edit-"+f,g=b('<label for="'+e+'">'+(i18n.cap_locked||"Locked")+"</label>"),e=b('<input type="checkbox" name="'+e+'"/>');e.change(function(){var c=l();c.locked=c.locked||{};c.locked[f]=b(this).is(":checked");a.find("[name=template_settings]").val(p.stringify(c))});var c=l();c.locked&&c.locked[f]&&e.attr("checked","checked");d.append(g);d.append(e)}a.find("[name=is_template]").attr("checked","checked");tablename=k(a);fields=m(tablename);
a.find("tr").each(function(){var a=b(this),d=a.attr("id");d&&d.match("__row$")&&(d=d.replace(tablename+"_","").replace("__row",""),a=a.find("td.w2p_fc")||a.find("td").eq(1),0<=fields.indexOf(d)&&g(d,a))})}window.fields=m;b(document).ready(function(){b("form").each(function(){""!==k(b(this))&&(q(b(this)),(0<b(".cap_template_form").length||n())&&s(b(this)))})})})(jQuery,JSON,void 0);
