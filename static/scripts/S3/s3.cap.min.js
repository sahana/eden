!function(e,t){function n(e){var t=e.find("[name=_formname]").val(),n="cap_alert",a="cap_info";if("undefined"!=typeof t){if(t.substring(0,n.length)==n)return n;if(t.substring(0,a.length)==a)return a}return""}function a(){return e(".cap_template_form").length>0}function i(){return e(".cap_info_template_form").length>0}function r(e){return"cap_alert"==e?"sender,sent,status,msg_type,source,scope,restriction,addresses,codes,note,reference,incidents".split(","):"cap_info"==e?"category,event,response_type,urgency,severity,certainty,audience,event_code,effective,onset,expires,sender_name,headline,description,instruction,contact,web,parameter".split(","):[]}function c(t){function c(a,i){var c,s=n(t),d=r(s),o={};"undefined"==typeof i&&(i=!1),a?"cap_alert"==s?(c=a.$_cap_alert&&a.$_cap_alert[0]||{},o=e.parseJSON(c.template_settings)||{},e(".cap_alert_form").addClass("template_loaded")):"cap_info"==s&&(c=a.$_cap_info&&a.$_cap_info[0]||{},o=e.parseJSON(c.template_settings)||{}):(c={},o={}),e.each(d,function(n,a){try{var r=t.find("[name="+a+"]"),s=o.locked&&o.locked[a];switch(typeof c[a]){case"string":case"undefined":(r.is(":text")||r.is("textarea")||r.is("select"))&&((i||s)&&r.val(c[a]||""),s?r.prop("disabled",!0).attr("title","This field is locked by the template"):r.prop("disabled",!1).attr("title",""));break;case"object":if("incidents"!=a)break;(i||s)&&(r.val(c[a]["@value"]||""),e("select#cap_alert_incidents").multiselect("refresh"))}}catch(d){s3_debug("ERROR",d)}})}function s(t,n,a){if(t){"undefined"==typeof a&&(a="template");var i=new RegExp(".*\\"+S3.Ap+"\\/"),r=new String(self.location),s=r.replace(i,"").split("?")[0].split("/")[0],d=[S3.Ap,s,a,t].join("/")+".s3json";e.ajax({url:d,type:"GET",dataType:"json",success:function(e){c(e,n)},error:function(){alert("There was an unexpected error loading template data")}})}}var d=e("#cap_alert_restriction__row, #cap_alert_restriction__row1"),o=e("#cap_alert_addresses__row, #cap_alert_addresses__row1");d.hide(),e("#cap_alert_scope").change(function(){var t=e(this).val();switch(t){case"Public":d.hide(),o.show();break;case"Restricted":d.show(),o.hide();break;case"Private":d.hide(),o.show()}}),e("#cap_info_priority").change(function(){var n=S3.cap_priorities,a=n.length;"Undefined"==e(this).find("option:selected").text()&&(e(this).css("border","2px solid gray"),t.find("[name=urgency]").val(""),t.find("[name=severity]").val(""),t.find("[name=certainty]").val(""));for(var i=0;a>i;i++)n[i][0]==e(this).find("option:selected").text()&&(t.find("[name=urgency]").val(n[i][1]),t.find("[name=severity]").val(n[i][2]),t.find("[name=certainty]").val(n[i][3]),e(this).css("border","2px solid "+n[i][4]))}),t.find("[name=urgency],[name=severity],[name=certainty]").change(function(){for(var n=S3.cap_priorities,a=n.length,i=0;a>i;i++)if(t.find("[name=urgency]").val()==n[i][1]&&t.find("[name=severity]").val()==n[i][2]&&t.find("[name=certainty]").val()==n[i][3])return void e("#cap_info_priority option").each(function(){e(this).text()==n[i][0]&&(e(this).attr("selected","selected"),t.find("[name=priority]").css("border","2px solid "+n[i][4]))});t.find("[name=priority]").val("Undefined").css("border","2px solid gray")}),t.find("[name=template_id]").change(function(){s(e(this).val(),!0)}),"cap_alert"!=n(t)||a()||s(t.find("[name=template_id]").val()),"cap_info"!=n(t)||i()||s(t.find("[name=template_info_id]").val(),!1,"info"),window.apply_temp=s}function s(a){function i(){try{var t=e.parseJSON(a.find("[name=template_settings]").val());return t||{}}catch(n){return s3_debug("Error occured parsing: ",a.find("[name=template_settings]").val()),{}}}function c(e){a.find("[name=template_settings]").val(t.stringify(e))}function s(t,n){var a="can_edit-"+t,r=e('<label for="'+a+'">'+(i18n.cap_locked||"Locked")+"</label>"),s=e('<input type="checkbox" name="'+a+'"/>');s.change(function(){var n=i();n.locked=n.locked||{},n.locked[t]=e(this).is(":checked"),c(n)});var d=i();d.locked&&d.locked[t]&&s.attr("checked","checked"),n.append(r),n.append(s)}a.find("[name=is_template]").attr("checked","checked"),tablename=n(a),fields=r(tablename),a.find("tr").each(function(){var t=e(this),n=t.attr("id");if(n&&n.match("__row$")){var a=n.replace(tablename+"_","").replace("__row",""),i=t.find("td.w2p_fc")||t.find("td").eq(1);fields.indexOf(a)>=0&&s(a,i)}})}window.fields=r,e(document).ready(function(){e("form").each(function(){""!==n(e(this))&&(c(e(this)),(a()||i())&&s(e(this)))})})}(jQuery,JSON,void 0);