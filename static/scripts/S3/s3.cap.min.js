(function(d,q){function k(a){a=a.find("[name=_formname]").val();if("undefined"!=typeof a){if("cap_alert"==a.substring(0,9))return"cap_alert";if("cap_info"==a.substring(0,8))return"cap_info"}return""}function p(){return 0<d(".cap_info_template_form").length}function m(a){return"cap_alert"==a?"sender sent status msg_type source scope restriction addresses codes note reference incidents".split(" "):"cap_info"==a?"category event response_type urgency severity certainty audience event_code effective onset expires sender_name headline description instruction contact web parameter".split(" "):
[]}function r(a){function l(e,f){var c=k(a),b=m(c),h,g={};"undefined"==typeof f&&(f=!1);e?"cap_alert"==c?(h=e.$_cap_alert&&e.$_cap_alert[0]||{},g=d.parseJSON(h.template_settings)||{},d(".cap_alert_form").addClass("template_loaded")):"cap_info"==c&&(h=e.$_cap_info&&e.$_cap_info[0]||{},g=d.parseJSON(h.template_settings)||{}):(h={},g={});d.each(b,function(e,c){try{var b=a.find("[name="+c+"]"),n=g.locked&&g.locked[c];switch(typeof h[c]){case "string":case "undefined":if(b.is(":text")||b.is("textarea")||
b.is("select"))(f||n)&&b.val(h[c]||""),n?b.prop("disabled",!0).attr("title","This field is locked by the template"):b.prop("disabled",!1).attr("title","");break;case "object":"incidents"==c&&(f||n)&&(b.val(h[c]["@value"]||""),d("select#cap_alert_incidents").multiselect("refresh"))}}catch(k){s3_debug("ERROR",k)}})}function g(a,b,c){if(a){"undefined"==typeof c&&(c="template");var f=new RegExp(".*\\"+S3.Ap+"\\/"),f=(new String(self.location)).replace(f,"").split("?")[0].split("/")[0];a=[S3.Ap,f,c,a].join("/")+
".s3json";d.ajax({url:a,type:"GET",dataType:"json",success:function(a){l(a,b)},error:function(a){alert("There was an unexpected error loading template data")}})}}var f=d("#cap_alert_restriction__row, #cap_alert_restriction__row1"),b=d("#cap_alert_addresses__row, #cap_alert_addresses__row1");f.hide();d("#cap_alert_scope").change(function(){switch(d(this).val()){case "Public":f.hide();b.show();break;case "Restricted":f.show();b.hide();break;case "Private":f.hide(),b.show()}});d("#cap_info_priority").change(function(){var e=
S3.cap_priorities,b=e.length;"Undefined"==d(this).find("option:selected").text()&&(d(this).css("border","2px solid gray"),a.find("[name=urgency]").val(""),a.find("[name=severity]").val(""),a.find("[name=certainty]").val(""));for(var c=0;c<b;c++)e[c][0]==d(this).find("option:selected").text()&&(a.find("[name=urgency]").val(e[c][1]),a.find("[name=severity]").val(e[c][2]),a.find("[name=certainty]").val(e[c][3]),d(this).css("border","2px solid "+e[c][4]))});a.find("[name=urgency],[name=severity],[name=certainty]").change(function(){for(var b=
S3.cap_priorities,f=b.length,c=0;c<f;c++)if(a.find("[name=urgency]").val()==b[c][1]&&a.find("[name=severity]").val()==b[c][2]&&a.find("[name=certainty]").val()==b[c][3]){d("#cap_info_priority option").each(function(){d(this).text()==b[c][0]&&(d(this).attr("selected","selected"),a.find("[name=priority]").css("border","2px solid "+b[c][4]))});return}a.find("[name=priority]").val("Undefined").css("border","2px solid gray")});a.find("[name=template_id]").change(function(){g(d(this).val(),!0)});"cap_alert"!=
k(a)||0<d(".cap_template_form").length||g(a.find("[name=template_id]").val());"cap_info"!=k(a)||p()||g(a.find("[name=template_info_id]").val(),!1,"info");window.apply_temp=g}function t(a){function l(){try{return d.parseJSON(a.find("[name=template_settings]").val())||{}}catch(f){return s3_debug("Error occured parsing: ",a.find("[name=template_settings]").val()),{}}}function g(f,b){var e="can_edit-"+f,g=d('<label for="'+e+'">'+(i18n.cap_locked||"Locked")+"</label>"),e=d('<input type="checkbox" name="'+
e+'"/>');e.change(function(){var b=l();b.locked=b.locked||{};b.locked[f]=d(this).is(":checked");a.find("[name=template_settings]").val(q.stringify(b))});var c=l();c.locked&&c.locked[f]&&e.attr("checked","checked");b.append(g);b.append(e)}a.find("[name=is_template]").attr("checked","checked");tablename=k(a);fields=m(tablename);a.find("tr").each(function(){var a=d(this),b=a.attr("id");b&&b.match("__row$")&&(b=b.replace(tablename+"_","").replace("__row",""),a=a.find("td.w2p_fc")||a.find("td").eq(1),
0<=fields.indexOf(b)&&g(b,a))})}window.fields=m;d(document).ready(function(){d("form").each(function(){""!==k(d(this))&&(r(d(this)),(0<d(".cap_template_form").length||p())&&t(d(this)))})})})(jQuery,JSON,void 0);
