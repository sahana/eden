(function(d,p){function k(b){b=b.find("[name=_formname]").val();if("undefined"!=typeof b){if("cap_alert"==b.substring(0,9))return"cap_alert";if("cap_info"==b.substring(0,8))return"cap_info"}return""}function n(){return 0<d(".cap_info_template_form").length}function m(b){return"cap_alert"==b?"sender sent status msg_type source scope restriction addresses codes note reference incidents".split(" "):"cap_info"==b?"category event response_type urgency severity certainty audience event_code effective onset expires sender_name headline description instruction contact web parameter".split(" "):
[]}function q(b){function l(a,e){var c=k(b),f=m(c),h,g={};"undefined"==typeof e&&(e=!1);a?"cap_alert"==c?(h=a.$_cap_alert&&a.$_cap_alert[0]||{},g=d.parseJSON(h.template_settings)||{},d(".cap_alert_form").addClass("template_loaded")):"cap_info"==c&&(h=a.$_cap_info&&a.$_cap_info[0]||{},g=d.parseJSON(h.template_settings)||{}):(h={},g={});d.each(f,function(d,a){try{var c=b.find("[name="+a+"]"),f=g.locked&&g.locked[a];switch(typeof h[a]){case "string":case "undefined":if(c.is(":text")||c.is("textarea")||
c.is("select"))(e||f)&&c.val(h[a]||""),f?c.prop("disabled",!0).attr("title","This field is locked by the template"):c.prop("disabled",!1).attr("title","")}}catch(r){s3_debug("ERROR",r)}})}function g(a,b,c){if(a){"undefined"==typeof c&&(c="template");var e=new RegExp(".*\\"+S3.Ap+"\\/"),e=(new String(self.location)).replace(e,"").split("?")[0].split("/")[0];a=[S3.Ap,e,c,a].join("/")+".s3json";d.ajax({url:a,type:"GET",dataType:"json",success:function(a){l(a,b)},error:function(a){alert("There was an unexpected error loading template data")}})}}
var e=d("#cap_alert_restriction__row, #cap_alert_restriction__row1"),f=d("#cap_alert_addresses__row, #cap_alert_addresses__row1");e.hide();d("#cap_alert_scope").change(function(){switch(d(this).val()){case "Public":e.hide();f.show();break;case "Restricted":e.show();f.hide();break;case "Private":e.hide(),f.show()}});d("#cap_info_priority").change(function(){var a=S3.cap_priorities,e=a.length;"Undefined"==d(this).find("option:selected").text()&&(d(this).css("border","2px solid gray"),b.find("[name=urgency]").val(""),
b.find("[name=severity]").val(""),b.find("[name=certainty]").val(""));for(var c=0;c<e;c++)a[c][0]==d(this).find("option:selected").text()&&(b.find("[name=urgency]").val(a[c][1]),b.find("[name=severity]").val(a[c][2]),b.find("[name=certainty]").val(a[c][3]),d(this).css("border","2px solid "+a[c][4]))});b.find("[name=urgency],[name=severity],[name=certainty]").change(function(){for(var a=S3.cap_priorities,e=a.length,c=0;c<e;c++)if(b.find("[name=urgency]").val()==a[c][1]&&b.find("[name=severity]").val()==
a[c][2]&&b.find("[name=certainty]").val()==a[c][3]){d("#cap_info_priority option").each(function(){d(this).text()==a[c][0]&&(d(this).attr("selected","selected"),b.find("[name=priority]").css("border","2px solid "+a[c][4]))});return}b.find("[name=priority]").val("Undefined").css("border","2px solid gray")});b.find("[name=template_id]").change(function(){g(d(this).val(),!0)});"cap_alert"!=k(b)||0<d(".cap_template_form").length||g(b.find("[name=template_id]").val());"cap_info"!=k(b)||n()||g(b.find("[name=template_info_id]").val(),
!1,"info");window.apply_temp=g}function t(b){function l(){try{return d.parseJSON(b.find("[name=template_settings]").val())||{}}catch(e){return s3_debug("Error occured parsing: ",b.find("[name=template_settings]").val()),{}}}function g(e,f){var a="can_edit-"+e,g=d('<label for="'+a+'">'+(i18n.cap_locked||"Locked")+"</label>"),a=d('<input type="checkbox" name="'+a+'"/>');a.change(function(){var a=l();a.locked=a.locked||{};a.locked[e]=d(this).is(":checked");b.find("[name=template_settings]").val(p.stringify(a))});
var c=l();c.locked&&c.locked[e]&&a.attr("checked","checked");f.append(g);f.append(a)}b.find("[name=is_template]").attr("checked","checked");tablename=k(b);fields=m(tablename);b.find("tr").each(function(){var b=d(this),f=b.attr("id");f&&f.match("__row$")&&(f=f.replace(tablename+"_","").replace("__row",""),b=b.find("td.w2p_fc")||b.find("td").eq(1),0<=fields.indexOf(f)&&g(f,b))})}window.fields=m;d(document).ready(function(){d("form").each(function(){""!==k(d(this))&&(q(d(this)),(0<d(".cap_template_form").length||
n())&&t(d(this)))})})})(jQuery,JSON,void 0);
