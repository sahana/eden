(function(a,q){function l(a){a=a.find("[name=_formname]").val();if("undefined"!=typeof a){if("cap_alert"==a.substring(0,9))return"cap_alert";if("cap_info"==a.substring(0,8))return"cap_info"}return""}function p(){return 0<a(".cap_info_template_form").length}function n(a){return"cap_alert"==a?"sender sent status msg_type source scope restriction addresses codes note reference incidents".split(" "):"cap_info"==a?"category event response_type urgency severity certainty audience event_code effective onset expires sender_name headline description instruction contact web parameter".split(" "):
[]}function r(d){function m(c,e){var b=l(d),f=n(b),k,g={};"undefined"==typeof e&&(e=!1);c?"cap_alert"==b?(k=c.$_cap_alert&&c.$_cap_alert[0]||{},g=a.parseJSON(k.template_settings)||{},a(".cap_alert_form").addClass("template_loaded")):"cap_info"==b&&(k=c.$_cap_info&&c.$_cap_info[0]||{},g=a.parseJSON(k.template_settings)||{}):(k={},g={});a.each(f,function(c,b){try{var f=d.find("[name="+b+"]"),l=g.locked&&g.locked[b];switch(typeof k[b]){case "string":"restriction"==b&&(f.val(k[b]||""),""!=f.val()&&h.show());
case "undefined":if(f.is(":text")||f.is("textarea")||f.is("select"))(e||l)&&f.val(k[b]||""),l?f.prop("disabled",!0).attr("title","This field is locked by the template"):f.prop("disabled",!1).attr("title","");break;case "object":var m=["scope","addresses","codes"];for(c=0;c<m.length;c++)b==m[c]&&f.val(k[b]["@value"]||"");"incidents"==b&&(e||l)&&(f.val(k[b]["@value"]||""),a("select#cap_alert_incidents").multiselect("refresh"))}}catch(n){s3_debug("ERROR",n)}})}function g(c,d,b){if(c){"undefined"==typeof b&&
(b="template");var f=new RegExp(".*\\"+S3.Ap+"\\/"),f=(new String(self.location)).replace(f,"").split("?")[0].split("/")[0];c=[S3.Ap,f,b,c].join("/")+".s3json";a.ajax({url:c,type:"GET",dataType:"json",success:function(a){m(a,d)},error:function(a){alert("There was an unexpected error loading template data")}})}}var h=a("#cap_alert_restriction__row, #cap_alert_restriction__row1"),e=a("#cap_alert_addresses__row, #cap_alert_addresses__row1");"Restricted"==a("#cap_alert_scope").val()?h.show():h.hide();
a("#cap_alert_scope").change(function(){switch(a(this).val()){case "Public":h.hide();a("#cap_alert_restriction").val()&&a("#cap_alert_restriction").val("");e.show();break;case "Restricted":h.show();e.hide();break;case "Private":h.hide(),a("#cap_alert_restriction").val()&&a("#cap_alert_restriction").val(""),e.show()}});a("#cap_info_priority").change(function(){var c=S3.cap_priorities,e=c.length;"Undefined"==a(this).find("option:selected").text()&&(a(this).css("border","2px solid gray"),d.find("[name=urgency]").val(""),
d.find("[name=severity]").val(""),d.find("[name=certainty]").val(""));for(var b=0;b<e;b++)c[b][0]==a(this).find("option:selected").text()&&(d.find("[name=urgency]").val(c[b][1]),d.find("[name=severity]").val(c[b][2]),d.find("[name=certainty]").val(c[b][3]),a(this).css("border","2px solid #"+c[b][4]))});d.find("[name=urgency],[name=severity],[name=certainty]").change(function(){for(var c=S3.cap_priorities,e=c.length,b=0;b<e;b++)if(d.find("[name=urgency]").val()==c[b][1]&&d.find("[name=severity]").val()==
c[b][2]&&d.find("[name=certainty]").val()==c[b][3]){a("#cap_info_priority option").each(function(){a(this).text()==c[b][0]&&(a(this).attr("selected","selected"),d.find("[name=priority]").css("border","2px solid #"+c[b][4]))});return}d.find("[name=priority]").val("Undefined").css("border","2px solid gray")});d.find("[name=template_id]").change(function(){g(a(this).val(),!0)});"cap_alert"!=l(d)||0<a(".cap_template_form").length||g(d.find("[name=template_id]").val());"cap_info"!=l(d)||p()||g(d.find("[name=template_info_id]").val(),
!1,"info");window.apply_temp=g}function t(d){function m(){try{return a.parseJSON(d.find("[name=template_settings]").val())||{}}catch(h){return s3_debug("Error occured parsing: ",d.find("[name=template_settings]").val()),{}}}function g(h,e){var c="can_edit-"+h,g=a('<label for="'+c+'">'+(i18n.cap_locked||"Locked")+"</label>"),c=a('<input type="checkbox" name="'+c+'"/>');c.change(function(){var b=m();b.locked=b.locked||{};b.locked[h]=a(this).is(":checked");d.find("[name=template_settings]").val(q.stringify(b))});
var b=m();b.locked&&b.locked[h]&&c.attr("checked","checked");e.append(g);e.append(c)}d.find("[name=is_template]").attr("checked","checked");tablename=l(d);fields=n(tablename);d.find("tr").each(function(){var d=a(this),e=d.attr("id");e&&e.match("__row$")&&(e=e.replace(tablename+"_","").replace("__row",""),d=d.find("td.w2p_fc")||d.find("td").eq(1),0<=fields.indexOf(e)&&g(e,d))})}window.fields=n;a(document).ready(function(){a("form").each(function(){""!==l(a(this))&&(r(a(this)),(0<a(".cap_template_form").length||
p())&&t(a(this)))})})})(jQuery,JSON,void 0);
