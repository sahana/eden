/*
 2015-2020 (c) Sahana Software Foundation
 @license MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,h,g){a instanceof String&&(a=String(a));for(var b=a.length,c=0;c<b;c++){var f=a[c];if(h.call(g,f,c,a))return{i:c,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,h,g){if(a==Array.prototype||a==Object.prototype)return a;a[h]=g.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var h=0;h<a.length;++h){var g=a[h];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,h){var g=$jscomp.propertyToPolyfillSymbol[h];if(null==g)return a[h];g=a[g];return void 0!==g?g:a[h]};
$jscomp.polyfill=function(a,h,g,b){h&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,h,g,b):$jscomp.polyfillUnisolated(a,h,g,b))};$jscomp.polyfillUnisolated=function(a,h,g,b){g=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var c=a[b];if(!(c in g))return;g=g[c]}a=a[a.length-1];b=g[a];h=h(b);h!=b&&null!=h&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:h})};
$jscomp.polyfillIsolated=function(a,h,g,b){var c=a.split(".");a=1===c.length;b=c[0];b=!a&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<c.length-1;f++){var d=c[f];if(!(d in b))return;b=b[d]}c=c[c.length-1];g=$jscomp.IS_SYMBOL_NATIVE&&"es6"===g?b[c]:null;h=h(g);null!=h&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:h}):h!==g&&(void 0===$jscomp.propertyToPolyfillSymbol[c]&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):
$jscomp.POLYFILL_PREFIX+c),c=$jscomp.propertyToPolyfillSymbol[c],$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:h})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(h,g){return $jscomp.findInternal(this,h,g).v}},"es6","es3");
(function(a,h){var g=0;a.widget("s3.personcontacts",{options:{access:1,controller:"pr",personID:null,cancelButtonText:"Cancel",placeholderText:"Click to edit"},_create:function(){this.id=g;g+=1;this.eventNamespace=".personcontacts"},_init:function(){this.refresh()},_destroy:function(){a.Widget.prototype.destroy.call(this)},refresh:function(){this._unbindEvents();this._bindEvents()},_addContact:function(b){var c=a(b);a(".iframe-container").remove();this._showAll();c.hide().siblings(".throbber").removeClass("hide").show();
var f=this.options,d=f.access,e=f.personID,n=f.controller;c=S3.Ap.concat("/pr/contact/create.iframe?person="+e);d&&(c+="&access="+d);a.get(c,function(l){var m=a('<div class="iframe-container">').hide().html(l);l=S3.Ap.concat("/pr/contact/create?person="+e+"&controller="+n);d&&(l+="&access="+d);var k=m.find("form").attr("action",l);l=a('<a class="cancel action-lnk">'+f.cancelButtonText+"</a>").bind("click",function(){k.slideUp("mediun",function(){m.remove()});a(b).show()});k.find('input[type="submit"]').after(l);
m.find("#popup").show();k.show();m.insertAfter(b).slideDown("medium",function(){a(b).siblings(".throbber").hide()})})},_addEmergencyContact:function(b){var c=a(b);a(".iframe-container").remove();this._showAll();c.hide().siblings(".throbber").removeClass("hide").show();var f=this.options,d=f.access,e=f.personID,n=f.controller;c=S3.Ap.concat("/pr/contact_emergency/create.iframe?person_id="+e);d&&(c+="&access="+d);a.get(c,function(l){var m=a('<div class="iframe-container">').hide().html(l);l=S3.Ap.concat("/pr/contact_emergency/create?person="+
e+"&controller="+n);d&&(l+="&access="+d);var k=m.find("form").attr("action",l);l=a('<a class="cancel action-lnk">'+f.cancelButtonText+"</a>").bind("click",function(){k.slideUp("mediun",function(){m.remove()});a(b).show()});k.find('input[type="submit"]').after(l);m.find("#popup").show();k.show();m.insertAfter(b).slideDown("medium",function(){a(b).siblings(".throbber").hide()})})},_editContact:function(b){var c=a(b),f=this.options,d=this;a(".iframe-container").remove();this._showAll();c.find(".pr-contact-actions").children().toggle();
var e=f.personID,n=f.controller,l=c.data("id"),m=f.access;b=S3.Ap.concat("/pr/contact/"+l+".iframe/update?person="+e);a.get(b,function(k){var p=a('<div class="iframe-container">').hide().html(k);k=S3.Ap.concat("/pr/contact/"+l+"/update?person="+e+"&controller="+n);m&&(k+="&access="+m);var q=p.find("form").attr("action",k);k=a('<a class="cancel action-lnk">'+f.cancelButtonText+"</a>").bind("click",function(){q.slideUp("mediun",function(){p.remove()});d._showAll()});q.find('input[type="submit"]').after(k);
c.after(p).hide();p.find("#popup").show();q.show();p.slideDown("medium")})},_editEmergencyContact:function(b){var c=a(b),f=this.options,d=this;a(".iframe-container").remove();this._showAll();c.find(".pr-contact-actions").children().toggle();var e=f.personID,n=f.controller,l=c.data("id"),m=f.access;b=S3.Ap.concat("/pr/contact_emergency/"+l+".iframe/update?person="+e);a.get(b,function(k){var p=a('<div class="iframe-container">').hide().html(k);k=S3.Ap.concat("/pr/contact_emergency/"+l+"/update?person="+
e+"&controller="+n);m&&(k+="&access="+m);var q=p.find("form").attr("action",k);k=a('<a class="cancel action-lnk">'+f.cancelButtonText+"</a>").bind("click",function(){q.slideUp("mediun",function(){p.remove()});d._showAll()});q.find('input[type="submit"]').after(k);c.after(p).hide();p.find("#popup").show();q.show();p.slideDown("medium")})},_deleteContact:function(b){if(confirm(i18n.delete_confirmation)){var c=b.data("id");a.post(S3.Ap.concat("/pr/contact/"+c+"/delete.json"));b.hide()}},_deleteEmergencyContact:function(b){if(confirm(i18n.delete_confirmation)){var c=
b.data("id");a.post(S3.Ap.concat("/pr/contact_emergency/"+c+"/delete.json"));b.remove()}},_inlineUpdateContact:function(b,c){b=a(b);var f=b.data("id");c.value||(c.value=b.data("value"));b=S3.Ap.concat("/pr/contact/"+f+".s3json");var d=!1;a.ajaxS3({type:"POST",url:b,data:JSON.stringify({$_pr_contact:c}),dataType:"JSON",async:!1,success:function(e){"success"==e.status&&(d=!0)}});return d},_inlineUpdateEmergencyContact:function(b,c){b=a(b).data("id");b=S3.Ap.concat("/pr/contact_emergency/"+b+".s3json");
var f=!1;a.ajaxS3({type:"POST",url:b,data:JSON.stringify({$_pr_contact_emergency:c}),dataType:"JSON",async:!1,success:function(d){"success"==d.status&&(f=!0)}});return f},_showAll:function(){var b=a(this.element);b.find(".pr-contact, .pr-emergency-contact").each(function(){var c=a(this);c.find(".pr-contact-actions a").show();c.find(".throbber, .inline-throbber").hide();c.show()});b.find(".contact-add-btn").show()},_bindEvents:function(){var b=this,c=a(this.element),f=this.eventNamespace;c.find(".pr-contacts .contact-add-btn").bind("click"+
f,function(){b._addContact(this);return!1});c.find(".pr-emergency-contacts .contact-add-btn").bind("click"+f,function(){b._addEmergencyContact(this);return!1});c.delegate(".pr-contacts .edit-btn","click"+f,function(){b._editContact(a(this).closest(".pr-contact"));return!1}).delegate(".pr-emergency-contacts .edit-btn","click"+f,function(){b._editEmergencyContact(a(this).closest(".pr-emergency-contact"));return!1}).delegate(".pr-contacts .delete-btn-ajax","click"+f,function(){b._deleteContact(a(this).closest(".pr-contact"));
return!1}).delegate(".pr-emergency-contacts .delete-btn-ajax","click"+f,function(){b._deleteEmergencyContact(a(this).closest(".pr-emergency-contact"));return!1});f={style:"display: inline",cssclass:"pr-contacts-editable",indicator:'<div class="throbber">',placeholder:this.options.placeholderText};c.find(".pr-contact-value").editable(function(d){var e=a(this).closest(".pr-contact");return b._inlineUpdateContact(e,{value:d})?(e.data("value",d),d):e.data("value")},f);c.find(".pr-contact-description").editable(function(d){var e=
a(this).closest(".pr-contact");return b._inlineUpdateContact(e,{contact_description:d})?(e.data("description",d),d):e.data("description")},f);c.find(".pr-contact-comments").editable(function(d){var e=a(this).closest(".pr-contact");return b._inlineUpdateContact(e,{comments:d})?(e.data("comments",d),d):e.data("comments")},f);c.find(".pr-emergency-name").editable(function(d){var e=a(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(e,{name:d})?(e.data("name",d),d):e.data("name")},
f);c.find(".pr-emergency-relationship").editable(function(d){var e=a(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(e,{relationship:d})?(e.data("relationship",d),d):e.data("relationship")},f);c.find(".pr-emergency-phone").editable(function(d){var e=a(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(e,{phone:d})?(e.data("phone",d),d):e.data("phone")},f);c.find(".pr-emergency-address").editable(function(d){var e=a(this).closest(".pr-emergency-contact");
return b._inlineUpdateEmergencyContact(e,{address:d})?(e.data("address",d),d):e.data("address")},f);c.find(".pr-emergency-comments").editable(function(d){var e=a(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(e,{comments:d})?(e.data("comments",d),d):e.data("comments")},f);c.find(".pr-contact-priority").editable(function(d){var e=a(this).closest(".pr-contact");return b._inlineUpdateContact(e,{priority:d})?(e.data("priority",d),d):e.data("priority")},{style:"display: inline-block;",
cssclass:"pr-contacts-editable",data:function(d){for(var e="{",n=1;10>n;n++)e+='"'+n+'":"'+n+'",';return e+('"selected":"'+d+'"}')},type:"select",submit:"ok"});return!0},_unbindEvents:function(){var b=a(this.element),c=this.eventNamespace;b.undelegate(c);b.find(".pr-contact-add, .pr-emergency-add, .pr-contact-form").unbind(c);return!0}})})(jQuery);
