/*
 2015-2016 (c) Sahana Software Foundation
 @license MIT
*/
var $jscomp={scope:{},findInternal:function(b,g,f){b instanceof String&&(b=String(b));for(var c=b.length,a=0;a<c;a++){var d=b[a];if(g.call(f,d,a,b))return{i:a,v:d}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,g,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[g]=f.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,g,f,c){if(g){f=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var a=b[c];a in f||(f[a]={});f=f[a]}b=b[b.length-1];c=f[b];g=g(c);g!=c&&null!=g&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,f){return $jscomp.findInternal(this,b,f).v}},"es6-impl","es3");
(function(b,g){var f=0;b.widget("s3.personcontacts",{options:{access:1,controller:"pr",personID:null,cancelButtonText:"Cancel"},_create:function(){this.id=f;f+=1;this.eventNamespace=".personcontacts"},_init:function(){this.refresh()},_destroy:function(){b.Widget.prototype.destroy.call(this)},refresh:function(){this._unbindEvents();this._bindEvents()},_addContact:function(c){var a=b(c);b(".iframe-container").remove();this._showAll();a.hide().siblings(".throbber").removeClass("hide").show();var d=this.options,
e=d.access,h=d.personID,l=d.controller,a=S3.Ap.concat("/pr/contact/create.iframe?person="+h);e&&(a+="&access="+e);b.get(a,function(a){var f=b('<div class="iframe-container">').hide().html(a);a=S3.Ap.concat("/pr/contact/create?person="+h+"&controller="+l);e&&(a+="&access="+e);var k=f.find("form").attr("action",a);a=b('<a class="cancel action-lnk">'+d.cancelButtonText+"</a>").bind("click",function(){k.slideUp("mediun",function(){f.remove()});b(c).show()});k.find('input[type="submit"]').after(a);k.show();
f.insertAfter(c).slideDown("medium",function(){b(c).siblings(".throbber").hide()})})},_addEmergencyContact:function(c){var a=b(c);b(".iframe-container").remove();this._showAll();a.hide().siblings(".throbber").removeClass("hide").show();var d=this.options,e=d.access,h=d.personID,l=d.controller,a=S3.Ap.concat("/pr/contact_emergency/create.iframe?person_id="+h);e&&(a+="&access="+e);b.get(a,function(a){var f=b('<div class="iframe-container">').hide().html(a);a=S3.Ap.concat("/pr/contact_emergency/create?person="+
h+"&controller="+l);e&&(a+="&access="+e);var k=f.find("form").attr("action",a);a=b('<a class="cancel action-lnk">'+d.cancelButtonText+"</a>").bind("click",function(){k.slideUp("mediun",function(){f.remove()});b(c).show()});k.find('input[type="submit"]').after(a);k.show();f.insertAfter(c).slideDown("medium",function(){b(c).siblings(".throbber").hide()})})},_editContact:function(c){var a=b(c),d=this.options,e=this;b(".iframe-container").remove();this._showAll();a.find(".pr-contact-actions").children().toggle();
var f=d.personID,l=d.controller,g=a.data("id"),m=d.access;c=S3.Ap.concat("/pr/contact/"+g+".iframe/update?person="+f);b.get(c,function(c){var h=b('<div class="iframe-container">').hide().html(c);c=S3.Ap.concat("/pr/contact/"+g+"/update?person="+f+"&controller="+l);m&&(c+="&access="+m);var k=h.find("form").attr("action",c);c=b('<a class="cancel action-lnk">'+d.cancelButtonText+"</a>").bind("click",function(){k.slideUp("mediun",function(){h.remove()});e._showAll()});k.find('input[type="submit"]').after(c);
a.after(h).hide();k.show();h.slideDown("medium")})},_editEmergencyContact:function(c){var a=b(c),d=this.options,e=this;b(".iframe-container").remove();this._showAll();a.find(".pr-contact-actions").children().toggle();var f=d.personID,l=d.controller,g=a.data("id"),m=d.access;c=S3.Ap.concat("/pr/contact_emergency/"+g+".iframe/update?person="+f);b.get(c,function(c){var h=b('<div class="iframe-container">').hide().html(c);c=S3.Ap.concat("/pr/contact_emergency/"+g+"/update?person="+f+"&controller="+l);
m&&(c+="&access="+m);var k=h.find("form").attr("action",c);c=b('<a class="cancel action-lnk">'+d.cancelButtonText+"</a>").bind("click",function(){k.slideUp("mediun",function(){h.remove()});e._showAll()});k.find('input[type="submit"]').after(c);a.after(h).hide();k.show();h.slideDown("medium")})},_deleteContact:function(c){if(confirm(i18n.delete_confirmation)){var a=c.data("id");b.post(S3.Ap.concat("/pr/contact/"+a+"/delete.json"));c.hide()}},_deleteEmergencyContact:function(c){if(confirm(i18n.delete_confirmation)){var a=
c.data("id");b.post(S3.Ap.concat("/pr/contact_emergency/"+a+"/delete.json"));c.remove()}},_inlineUpdateContact:function(c,a){var d=b(c),e=d.data("id");a.value||(a.value=d.data("value"));var d=S3.Ap.concat("/pr/contact/"+e+".s3json"),f=!1;b.ajaxS3({type:"POST",url:d,data:JSON.stringify({$_pr_contact:a}),dataType:"JSON",async:!1,success:function(b){"success"==b.status&&(f=!0)}});return f},_inlineUpdateEmergencyContact:function(c,a){var d=b(c).data("id"),d=S3.Ap.concat("/pr/contact_emergency/"+d+".s3json"),
e=!1;b.ajaxS3({type:"POST",url:d,data:JSON.stringify({$_pr_contact_emergency:a}),dataType:"JSON",async:!1,success:function(b){"success"==b.status&&(e=!0)}});return e},_showAll:function(){var c=b(this.element);c.find(".pr-contact, .pr-emergency-contact").each(function(){var c=b(this);c.find(".pr-contact-actions a").show();c.find(".throbber, .inline-throbber").hide();c.show()});c.find(".contact-add-btn").show()},_bindEvents:function(){var c=this,a=b(this.element),d=this.eventNamespace;a.find(".pr-contacts .contact-add-btn").bind("click"+
d,function(){c._addContact(this);return!1});a.find(".pr-emergency-contacts .contact-add-btn").bind("click"+d,function(){c._addEmergencyContact(this);return!1});a.delegate(".pr-contacts .edit-btn","click"+d,function(){c._editContact(b(this).closest(".pr-contact"));return!1}).delegate(".pr-emergency-contacts .edit-btn","click"+d,function(){c._editEmergencyContact(b(this).closest(".pr-emergency-contact"));return!1}).delegate(".pr-contacts .delete-btn-ajax","click"+d,function(){c._deleteContact(b(this).closest(".pr-contact"));
return!1}).delegate(".pr-emergency-contacts .delete-btn-ajax","click"+d,function(){c._deleteEmergencyContact(b(this).closest(".pr-emergency-contact"));return!1});d={style:"display: inline",indicator:'<div class="throbber">'};a.find(".pr-contact-value").editable(function(a,d){var e=b(this).closest(".pr-contact");return c._inlineUpdateContact(e,{value:a})?(e.data("value",a),a):e.data("value")},d);a.find(".pr-contact-description").editable(function(a,d){var e=b(this).closest(".pr-contact");return c._inlineUpdateContact(e,
{contact_description:a})?(e.data("description",a),a):e.data("description")},d);a.find(".pr-contact-comments").editable(function(a,d){var e=b(this).closest(".pr-contact");return c._inlineUpdateContact(e,{comments:a})?(e.data("comments",a),a):e.data("comments")},d);a.find(".pr-emergency-name").editable(function(a,d){var e=b(this).closest(".pr-emergency-contact");return c._inlineUpdateEmergencyContact(e,{name:a})?(e.data("name",a),a):e.data("name")},d);a.find(".pr-emergency-relationship").editable(function(a,
d){var e=b(this).closest(".pr-emergency-contact");return c._inlineUpdateEmergencyContact(e,{relationship:a})?(e.data("relationship",a),a):e.data("relationship")},d);a.find(".pr-emergency-phone").editable(function(a,d){var e=b(this).closest(".pr-emergency-contact");return c._inlineUpdateEmergencyContact(e,{phone:a})?(e.data("phone",a),a):e.data("phone")},d);a.find(".pr-emergency-address").editable(function(a,d){var e=b(this).closest(".pr-emergency-contact");return c._inlineUpdateEmergencyContact(e,
{address:a})?(e.data("address",a),a):e.data("address")},d);a.find(".pr-emergency-comments").editable(function(a,d){var e=b(this).closest(".pr-emergency-contact");return c._inlineUpdateEmergencyContact(e,{comments:a})?(e.data("comments",a),a):e.data("comments")},d);a.find(".pr-contact-priority").editable(function(a,d){var e=b(this).closest(".pr-contact");return c._inlineUpdateContact(e,{priority:a})?(e.data("priority",a),a):e.data("priority")},{style:"display: inline-block;",data:function(a,b){for(var c=
"{",d=1;10>d;d++)c+='"'+d+'":"'+d+'",';return c+('"selected":"'+a+'"}')},type:"select",submit:"ok"});return!0},_unbindEvents:function(){var c=b(this.element),a=this.eventNamespace;c.undelegate(a);c.find(".pr-contact-add, .pr-emergency-add, .pr-contact-form").unbind(a);return!0}})})(jQuery);
