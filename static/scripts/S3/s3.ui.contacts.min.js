/*
 2015-2019 (c) Sahana Software Foundation
 @license MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,h,f){c instanceof String&&(c=String(c));for(var b=c.length,a=0;a<b;a++){var e=c[a];if(h.call(f,e,a,c))return{i:a,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,h,f){c!=Array.prototype&&c!=Object.prototype&&(c[h]=f.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,h,f,b){if(h){f=$jscomp.global;c=c.split(".");for(b=0;b<c.length-1;b++){var a=c[b];a in f||(f[a]={});f=f[a]}c=c[c.length-1];b=f[c];h=h(b);h!=b&&null!=h&&$jscomp.defineProperty(f,c,{configurable:!0,writable:!0,value:h})}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,f){return $jscomp.findInternal(this,c,f).v}},"es6","es3");
(function(c,h){var f=0;c.widget("s3.personcontacts",{options:{access:1,controller:"pr",personID:null,cancelButtonText:"Cancel"},_create:function(){this.id=f;f+=1;this.eventNamespace=".personcontacts"},_init:function(){this.refresh()},_destroy:function(){c.Widget.prototype.destroy.call(this)},refresh:function(){this._unbindEvents();this._bindEvents()},_addContact:function(b){var a=c(b);c(".iframe-container").remove();this._showAll();a.hide().siblings(".throbber").removeClass("hide").show();var e=this.options,
d=e.access,l=e.personID,f=e.controller;a=S3.Ap.concat("/pr/contact/create.iframe?person="+l);d&&(a+="&access="+d);c.get(a,function(a){var k=c('<div class="iframe-container">').hide().html(a);a=S3.Ap.concat("/pr/contact/create?person="+l+"&controller="+f);d&&(a+="&access="+d);var g=k.find("form").attr("action",a);a=c('<a class="cancel action-lnk">'+e.cancelButtonText+"</a>").bind("click",function(){g.slideUp("mediun",function(){k.remove()});c(b).show()});g.find('input[type="submit"]').after(a);k.find("#popup").show();
g.show();k.insertAfter(b).slideDown("medium",function(){c(b).siblings(".throbber").hide()})})},_addEmergencyContact:function(b){var a=c(b);c(".iframe-container").remove();this._showAll();a.hide().siblings(".throbber").removeClass("hide").show();var e=this.options,d=e.access,l=e.personID,f=e.controller;a=S3.Ap.concat("/pr/contact_emergency/create.iframe?person_id="+l);d&&(a+="&access="+d);c.get(a,function(a){var k=c('<div class="iframe-container">').hide().html(a);a=S3.Ap.concat("/pr/contact_emergency/create?person="+
l+"&controller="+f);d&&(a+="&access="+d);var g=k.find("form").attr("action",a);a=c('<a class="cancel action-lnk">'+e.cancelButtonText+"</a>").bind("click",function(){g.slideUp("mediun",function(){k.remove()});c(b).show()});g.find('input[type="submit"]').after(a);k.find("#popup").show();g.show();k.insertAfter(b).slideDown("medium",function(){c(b).siblings(".throbber").hide()})})},_editContact:function(b){var a=c(b),e=this.options,d=this;c(".iframe-container").remove();this._showAll();a.find(".pr-contact-actions").children().toggle();
var l=e.personID,f=e.controller,h=a.data("id"),k=e.access;b=S3.Ap.concat("/pr/contact/"+h+".iframe/update?person="+l);c.get(b,function(b){var g=c('<div class="iframe-container">').hide().html(b);b=S3.Ap.concat("/pr/contact/"+h+"/update?person="+l+"&controller="+f);k&&(b+="&access="+k);var m=g.find("form").attr("action",b);b=c('<a class="cancel action-lnk">'+e.cancelButtonText+"</a>").bind("click",function(){m.slideUp("mediun",function(){g.remove()});d._showAll()});m.find('input[type="submit"]').after(b);
a.after(g).hide();g.find("#popup").show();m.show();g.slideDown("medium")})},_editEmergencyContact:function(b){var a=c(b),e=this.options,d=this;c(".iframe-container").remove();this._showAll();a.find(".pr-contact-actions").children().toggle();var l=e.personID,f=e.controller,h=a.data("id"),k=e.access;b=S3.Ap.concat("/pr/contact_emergency/"+h+".iframe/update?person="+l);c.get(b,function(b){var g=c('<div class="iframe-container">').hide().html(b);b=S3.Ap.concat("/pr/contact_emergency/"+h+"/update?person="+
l+"&controller="+f);k&&(b+="&access="+k);var m=g.find("form").attr("action",b);b=c('<a class="cancel action-lnk">'+e.cancelButtonText+"</a>").bind("click",function(){m.slideUp("mediun",function(){g.remove()});d._showAll()});m.find('input[type="submit"]').after(b);a.after(g).hide();g.find("#popup").show();m.show();g.slideDown("medium")})},_deleteContact:function(b){if(confirm(i18n.delete_confirmation)){var a=b.data("id");c.post(S3.Ap.concat("/pr/contact/"+a+"/delete.json"));b.hide()}},_deleteEmergencyContact:function(b){if(confirm(i18n.delete_confirmation)){var a=
b.data("id");c.post(S3.Ap.concat("/pr/contact_emergency/"+a+"/delete.json"));b.remove()}},_inlineUpdateContact:function(b,a){b=c(b);var e=b.data("id");a.value||(a.value=b.data("value"));b=S3.Ap.concat("/pr/contact/"+e+".s3json");var d=!1;c.ajaxS3({type:"POST",url:b,data:JSON.stringify({$_pr_contact:a}),dataType:"JSON",async:!1,success:function(b){"success"==b.status&&(d=!0)}});return d},_inlineUpdateEmergencyContact:function(b,a){b=c(b).data("id");b=S3.Ap.concat("/pr/contact_emergency/"+b+".s3json");
var e=!1;c.ajaxS3({type:"POST",url:b,data:JSON.stringify({$_pr_contact_emergency:a}),dataType:"JSON",async:!1,success:function(b){"success"==b.status&&(e=!0)}});return e},_showAll:function(){var b=c(this.element);b.find(".pr-contact, .pr-emergency-contact").each(function(){var b=c(this);b.find(".pr-contact-actions a").show();b.find(".throbber, .inline-throbber").hide();b.show()});b.find(".contact-add-btn").show()},_bindEvents:function(){var b=this,a=c(this.element),e=this.eventNamespace;a.find(".pr-contacts .contact-add-btn").bind("click"+
e,function(){b._addContact(this);return!1});a.find(".pr-emergency-contacts .contact-add-btn").bind("click"+e,function(){b._addEmergencyContact(this);return!1});a.delegate(".pr-contacts .edit-btn","click"+e,function(){b._editContact(c(this).closest(".pr-contact"));return!1}).delegate(".pr-emergency-contacts .edit-btn","click"+e,function(){b._editEmergencyContact(c(this).closest(".pr-emergency-contact"));return!1}).delegate(".pr-contacts .delete-btn-ajax","click"+e,function(){b._deleteContact(c(this).closest(".pr-contact"));
return!1}).delegate(".pr-emergency-contacts .delete-btn-ajax","click"+e,function(){b._deleteEmergencyContact(c(this).closest(".pr-emergency-contact"));return!1});e={style:"display: inline",indicator:'<div class="throbber">'};a.find(".pr-contact-value").editable(function(a){var d=c(this).closest(".pr-contact");return b._inlineUpdateContact(d,{value:a})?(d.data("value",a),a):d.data("value")},e);a.find(".pr-contact-description").editable(function(a){var d=c(this).closest(".pr-contact");return b._inlineUpdateContact(d,
{contact_description:a})?(d.data("description",a),a):d.data("description")},e);a.find(".pr-contact-comments").editable(function(a){var d=c(this).closest(".pr-contact");return b._inlineUpdateContact(d,{comments:a})?(d.data("comments",a),a):d.data("comments")},e);a.find(".pr-emergency-name").editable(function(a){var d=c(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(d,{name:a})?(d.data("name",a),a):d.data("name")},e);a.find(".pr-emergency-relationship").editable(function(a){var d=
c(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(d,{relationship:a})?(d.data("relationship",a),a):d.data("relationship")},e);a.find(".pr-emergency-phone").editable(function(a){var d=c(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(d,{phone:a})?(d.data("phone",a),a):d.data("phone")},e);a.find(".pr-emergency-address").editable(function(a){var d=c(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(d,{address:a})?
(d.data("address",a),a):d.data("address")},e);a.find(".pr-emergency-comments").editable(function(a){var d=c(this).closest(".pr-emergency-contact");return b._inlineUpdateEmergencyContact(d,{comments:a})?(d.data("comments",a),a):d.data("comments")},e);a.find(".pr-contact-priority").editable(function(a){var d=c(this).closest(".pr-contact");return b._inlineUpdateContact(d,{priority:a})?(d.data("priority",a),a):d.data("priority")},{style:"display: inline-block;",data:function(a){for(var b="{",c=1;10>c;c++)b+=
'"'+c+'":"'+c+'",';return b+('"selected":"'+a+'"}')},type:"select",submit:"ok"});return!0},_unbindEvents:function(){var b=c(this.element),a=this.eventNamespace;b.undelegate(a);b.find(".pr-contact-add, .pr-emergency-add, .pr-contact-form").unbind(a);return!0}})})(jQuery);
