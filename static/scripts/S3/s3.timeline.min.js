var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,f=0;f<d;f++){var e=a[f];if(b.call(c,e,f,a))return{i:f,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];if(!(f in c))return;c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var f=a.split(".");a=1===f.length;d=f[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var e=0;e<f.length-1;e++){var g=f[e];if(!(g in d))return;d=d[g]}f=f[f.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[f]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&($jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(f):
$jscomp.POLYFILL_PREFIX+f),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[f],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");SimileAjax={Platform:{}};SimileAjax.urlPrefix=SimileAjax_urlPrefix;SimileAjax.version="2.2.1";SimileAjax.jQuery=jQuery;SimileAjax.Platform.os={isMac:!1,isWin:!1,isWin32:!1,isUnix:!1};
SimileAjax.Platform.browser={isIE:!1,isNetscape:!1,isMozilla:!1,isFirefox:!1,isOpera:!1,isSafari:!1,majorVersion:0,minorVersion:0};
(function(){var a=navigator.appName.toLowerCase(),b=navigator.userAgent.toLowerCase();SimileAjax.Platform.os.isMac=-1!=b.indexOf("mac");SimileAjax.Platform.os.isWin=-1!=b.indexOf("win");SimileAjax.Platform.os.isWin32=SimileAjax.Platform.isWin&&(-1!=b.indexOf("95")||-1!=b.indexOf("98")||-1!=b.indexOf("nt")||-1!=b.indexOf("win32")||-1!=b.indexOf("32bit"));SimileAjax.Platform.os.isUnix=-1!=b.indexOf("x11");SimileAjax.Platform.browser.isIE=-1!=a.indexOf("microsoft");SimileAjax.Platform.browser.isNetscape=
-1!=a.indexOf("netscape");SimileAjax.Platform.browser.isMozilla=-1!=b.indexOf("mozilla");SimileAjax.Platform.browser.isFirefox=-1!=b.indexOf("firefox");SimileAjax.Platform.browser.isOpera=-1!=a.indexOf("opera");SimileAjax.Platform.browser.isSafari=-1!=a.indexOf("safari");a=function(f){f=f.split(".");SimileAjax.Platform.browser.majorVersion=parseInt(f[0]);SimileAjax.Platform.browser.minorVersion=parseInt(f[1])};var c=function(f,e,g){e=f.indexOf(e,g);return 0<=e?e:f.length};if(SimileAjax.Platform.browser.isMozilla){var d=
b.indexOf("mozilla/");0<=d&&a(b.substring(d+8,c(b," ",d)))}SimileAjax.Platform.browser.isIE&&(d=b.indexOf("msie "),0<=d&&a(b.substring(d+5,c(b,";",d))));SimileAjax.Platform.browser.isNetscape&&(d=b.indexOf("rv:"),0<=d&&a(b.substring(d+3,c(b,")",d))));SimileAjax.Platform.browser.isFirefox&&(d=b.indexOf("firefox/"),0<=d&&a(b.substring(d+8,c(b," ",d))));"localeCompare"in String.prototype||(String.prototype.localeCompare=function(f){return this<f?-1:this>f?1:0})})();
SimileAjax.Platform.getDefaultLocale=function(){return SimileAjax.Platform.clientLocale};SimileAjax.Debug={silent:!1};SimileAjax.Debug.log=function(a){var b="console"in window&&"log"in window.console?function(c){console.log(c)}:function(c){SimileAjax.Debug.silent||alert(c)};SimileAjax.Debug.log=b;b(a)};SimileAjax.Debug.warn=function(a){var b="console"in window&&"warn"in window.console?function(c){console.warn(c)}:function(c){SimileAjax.Debug.silent||alert(c)};SimileAjax.Debug.warn=b;b(a)};
SimileAjax.Debug.exception=function(a,b){var c="throw"==SimileAjax.parseURLParameters().errors||"throw"==SimileAjax.params.errors?function(d,f){throw d;}:"console"in window&&"error"in window.console?function(d,f){null!=f?console.error(f+" %o",d):console.error(d);throw d;}:function(d,f){SimileAjax.Debug.silent||alert("Caught exception: "+f+"\n\nDetails: "+("description"in d?d.description:d));throw d;};SimileAjax.Debug.exception=c;c(a,b)};
SimileAjax.Debug.objectToString=function(a){return SimileAjax.Debug._objectToString(a,"")};SimileAjax.Debug._objectToString=function(a,b){var c=b+" ";if("object"==typeof a){var d="{";for(f in a)d+=c+f+": "+SimileAjax.Debug._objectToString(a[f],c)+"\n";return d+(b+"}")}if("array"==typeof a){d="[";for(var f=0;f<a.length;f++)d+=SimileAjax.Debug._objectToString(a[f],c)+"\n";return d+(b+"]")}return a};SimileAjax.XmlHttp={};
SimileAjax.XmlHttp._onReadyStateChange=function(a,b,c){switch(a.readyState){case 4:try{0==a.status||200==a.status?c&&c(a):b&&b(a.statusText,a.status,a)}catch(d){SimileAjax.Debug.exception("XmlHttp: Error handling onReadyStateChange",d)}}};
SimileAjax.XmlHttp._createRequest=function(){if(SimileAjax.Platform.browser.isIE)for(var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b=0;b<a.length;b++)try{var c=a[b],d=function(){return new ActiveXObject(c)},f=d();SimileAjax.XmlHttp._createRequest=d;return f}catch(e){}try{return d=function(){return new XMLHttpRequest},f=d(),SimileAjax.XmlHttp._createRequest=d,f}catch(e){throw Error("Failed to create an XMLHttpRequest object");}};
SimileAjax.XmlHttp.get=function(a,b,c){var d=SimileAjax.XmlHttp._createRequest();d.open("GET",a,!0);d.onreadystatechange=function(){SimileAjax.XmlHttp._onReadyStateChange(d,b,c)};d.send(null)};SimileAjax.XmlHttp.post=function(a,b,c,d){var f=SimileAjax.XmlHttp._createRequest();f.open("POST",a,!0);f.onreadystatechange=function(){SimileAjax.XmlHttp._onReadyStateChange(f,c,d)};f.send(b)};
SimileAjax.XmlHttp._forceXML=function(a){try{a.overrideMimeType("text/xml")}catch(b){a.setrequestheader("Content-Type","text/xml")}};SimileAjax.JSON={};
(function(){var a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},b={array:function(c){var d=["["],f,e,g=c.length;for(e=0;e<g;e+=1){var h=c[e];if(f=b[typeof h])if(h=f(h),"string"==typeof h){k&&(d[d.length]=",");d[d.length]=h;var k=!0}}d[d.length]="]";return d.join("")},"boolean":function(c){return String(c)},"null":function(c){return"null"},number:function(c){return isFinite(c)?String(c):"null"},object:function(c){if(c){if(c instanceof Array)return b.array(c);var d=
["{"],f,e;for(e in c){var g=c[e];if(f=b[typeof g])if(g=f(g),"string"==typeof g){h&&(d[d.length]=",");d.push(b.string(e),":",g);var h=!0}}d[d.length]="}";return d.join("")}return"null"},string:function(c){/["\\\x00-\x1f]/.test(c)&&(c=c.replace(/([\x00-\x1f\\"])/g,function(d,f){if(d=a[f])return d;d=f.charCodeAt();return"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16)}));return'"'+c+'"'}};SimileAjax.JSON.toJSONString=function(c){return c instanceof Object?b.object(c):c instanceof Array?b.array(c):
c.toString()};SimileAjax.JSON.parseJSON=function(){try{return!/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(this.replace(/"(\\.|[^"\\])*"/g,""))&&eval("("+this+")")}catch(c){return!1}}})();SimileAjax.DOM={};SimileAjax.DOM.registerEventWithObject=function(a,b,c,d){SimileAjax.DOM.registerEvent(a,b,function(f,e,g){return c[d].call(c,f,e,g)})};
SimileAjax.DOM.registerEvent=function(a,b,c){var d=function(f){if(f=f?f:event?event:null){var e=f.target?f.target:f.srcElement?f.srcElement:null;e&&(e=1==e.nodeType||9==e.nodeType?e:e.parentNode);return c(a,f,e)}return!0};SimileAjax.Platform.browser.isIE?a.attachEvent("on"+b,d):a.addEventListener(b,d,!1)};
SimileAjax.DOM.getPageCoordinates=function(a){var b=0,c=0;1!=a.nodeType&&(a=a.parentNode);for(var d=a;null!=d;)b+=d.offsetLeft,c+=d.offsetTop,d=d.offsetParent;for(d=document.body;null!=a&&a!=d;)"scrollLeft"in a&&(b-=a.scrollLeft,c-=a.scrollTop),a=a.parentNode;return{left:b,top:c}};SimileAjax.DOM.getSize=function(a){var b=this.getStyle(a,"width");a=this.getStyle(a,"height");-1<b.indexOf("px")&&(b=b.replace("px",""));-1<a.indexOf("px")&&(a=a.replace("px",""));return{w:b,h:a}};
SimileAjax.DOM.getStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?document.defaultView.getComputedStyle(a,null).getPropertyValue(b):""};
SimileAjax.DOM.getEventRelativeCoordinates=function(a,b){if(SimileAjax.Platform.browser.isIE)return"mousewheel"==a.type?(b=SimileAjax.DOM.getPageCoordinates(b),{x:a.clientX-b.left,y:a.clientY-b.top}):{x:a.offsetX,y:a.offsetY};b=SimileAjax.DOM.getPageCoordinates(b);return"DOMMouseScroll"==a.type&&SimileAjax.Platform.browser.isFirefox&&2==SimileAjax.Platform.browser.majorVersion?{x:a.screenX-b.left,y:a.screenY-b.top}:{x:a.pageX-b.left,y:a.pageY-b.top}};
SimileAjax.DOM.getEventPageCoordinates=function(a){if(SimileAjax.Platform.browser.isIE){var b=0,c=0;document.body&&(document.body.scrollLeft||document.body.scrollTop)?(b=document.body.scrollTop,c=document.body.scrollLeft):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(b=document.documentElement.scrollTop,c=document.documentElement.scrollLeft);return{x:a.clientX+c,y:a.clientY+b}}return{x:a.pageX,y:a.pageY}};
SimileAjax.DOM.hittest=function(a,b,c){return SimileAjax.DOM._hittest(document.body,a,b,c)};
SimileAjax.DOM._hittest=function(a,b,c,d){var f=a.childNodes,e=0;a:for(;e<f.length;e++){for(var g=f[e],h=0;h<d.length;h++)if(g==d[h])continue a;if(0==g.offsetWidth&&0==g.offsetHeight){if(h=SimileAjax.DOM._hittest(g,b,c,d),h!=g)return h}else{for(var k=h=0,l=g;l;)h+=l.offsetTop,k+=l.offsetLeft,l=l.offsetParent;if(k<=b&&h<=c&&b-k<g.offsetWidth&&c-h<g.offsetHeight)return SimileAjax.DOM._hittest(g,b,c,d);if(1==g.nodeType&&"TR"==g.tagName&&(h=SimileAjax.DOM._hittest(g,b,c,d),h!=g))return h}}return a};
SimileAjax.DOM.cancelEvent=function(a){a.returnValue=!1;a.cancelBubble=!0;"preventDefault"in a&&a.preventDefault()};SimileAjax.DOM.appendClassName=function(a,b){for(var c=a.className.split(" "),d=0;d<c.length;d++)if(c[d]==b)return;c.push(b);a.className=c.join(" ")};SimileAjax.DOM.createInputElement=function(a){var b=document.createElement("div");b.innerHTML="<input type='"+a+"' />";return b.firstChild};
SimileAjax.DOM.createDOMFromTemplate=function(a){var b={};b.elmt=SimileAjax.DOM._createDOMFromTemplate(a,b,null);return b};
SimileAjax.DOM._createDOMFromTemplate=function(a,b,c){if(null==a)return null;if("object"!=typeof a)return a=document.createTextNode(a),null!=c&&c.appendChild(a),a;var d=null;if("tag"in a){var f=a.tag;null!=c&&("tr"==f?d=c.insertRow(c.rows.length):"td"==f&&(d=c.insertCell(c.cells.length)));null==d&&(d="input"==f?SimileAjax.DOM.createInputElement(a.type):document.createElement(f),null!=c&&c.appendChild(d))}else d=a.elmt,null!=c&&c.appendChild(d);for(var e in a)if(c=a[e],"field"==e)b[c]=d;else if("className"==
e)d.className=c;else if("id"==e)d.id=c;else if("title"==e)d.title=c;else if("type"!=e||"input"!=d.tagName)if("style"==e)for(n in c)f=c[n],"float"==n&&(n=SimileAjax.Platform.browser.isIE?"styleFloat":"cssFloat"),d.style[n]=f;else if("children"==e)for(f=0;f<c.length;f++)SimileAjax.DOM._createDOMFromTemplate(c[f],b,d);else"tag"!=e&&"elmt"!=e&&d.setAttribute(e,c);return d};SimileAjax.DOM._cachedParent=null;
SimileAjax.DOM.createElementFromString=function(a){null==SimileAjax.DOM._cachedParent&&(SimileAjax.DOM._cachedParent=document.createElement("div"));SimileAjax.DOM._cachedParent.innerHTML=a;return SimileAjax.DOM._cachedParent.firstChild};SimileAjax.DOM.createDOMFromString=function(a,b,c){a="string"==typeof a?document.createElement(a):a;a.innerHTML=b;b={elmt:a};SimileAjax.DOM._processDOMChildrenConstructedFromString(b,a,null!=c?c:{});return b};
SimileAjax.DOM._processDOMConstructedFromString=function(a,b,c){var d=b.id;if(null!=d&&0<d.length){b.removeAttribute("id");if(d in c){var f=b.parentNode;f.insertBefore(c[d],b);f.removeChild(b);a[d]=c[d];return}a[d]=b}b.hasChildNodes()&&SimileAjax.DOM._processDOMChildrenConstructedFromString(a,b,c)};SimileAjax.DOM._processDOMChildrenConstructedFromString=function(a,b,c){for(b=b.firstChild;null!=b;){var d=b.nextSibling;1==b.nodeType&&SimileAjax.DOM._processDOMConstructedFromString(a,b,c);b=d}};
SimileAjax.Graphics={};SimileAjax.Graphics.pngIsTranslucent=!SimileAjax.Platform.browser.isIE||6<SimileAjax.Platform.browser.majorVersion;SimileAjax.Graphics.pngIsTranslucent||SimileAjax.includeCssFile(document,SimileAjax.urlPrefix+"styles/graphics-ie6.css");SimileAjax.Graphics._createTranslucentImage1=function(a,b){var c=document.createElement("img");c.setAttribute("src",a);null!=b&&(c.style.verticalAlign=b);return c};
SimileAjax.Graphics._createTranslucentImage2=function(a,b){var c=document.createElement("img");c.style.width="1px";c.style.height="1px";c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image')";c.style.verticalAlign=null!=b?b:"middle";return c};SimileAjax.Graphics.createTranslucentImage=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImage1:SimileAjax.Graphics._createTranslucentImage2;
SimileAjax.Graphics._createTranslucentImageHTML1=function(a,b){return'<img src="'+a+'"'+(null!=b?' style="vertical-align: '+b+';"':"")+" />"};SimileAjax.Graphics._createTranslucentImageHTML2=function(a,b){return"<img src='"+a+"' style=\"width: 1px; height: 1px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+(a+"', sizingMethod='image');"+(null!=b?" vertical-align: "+b+";":""))+'" />'};
SimileAjax.Graphics.createTranslucentImageHTML=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImageHTML1:SimileAjax.Graphics._createTranslucentImageHTML2;SimileAjax.Graphics.setOpacity=function(a,b){SimileAjax.Platform.browser.isIE?a.style.filter="progid:DXImageTransform.Microsoft.Alpha(Style=0,Opacity="+b+")":(b=(b/100).toString(),a.style.opacity=b,a.style.MozOpacity=b)};
SimileAjax.Graphics.bubbleConfig={containerCSSClass:"simileAjax-bubble-container",innerContainerCSSClass:"simileAjax-bubble-innerContainer",contentContainerCSSClass:"simileAjax-bubble-contentContainer",borderGraphicSize:50,borderGraphicCSSClassPrefix:"simileAjax-bubble-border-",arrowGraphicTargetOffset:33,arrowGraphicLength:100,arrowGraphicWidth:49,arrowGraphicCSSClassPrefix:"simileAjax-bubble-arrow-",closeGraphicCSSClass:"simileAjax-bubble-close",extraPadding:20};
SimileAjax.Graphics.createBubbleForContentAndPoint=function(a,b,c,d,f,e){"number"!=typeof d&&(d=300);"number"!=typeof e&&(e=0);a.style.position="absolute";a.style.left="-5000px";a.style.top="0px";a.style.width=d+"px";document.body.appendChild(a);window.setTimeout(function(){var g=a.scrollWidth+10,h=a.scrollHeight+10,k=0;0<e&&h>e&&(h=e,k=g-25);h=SimileAjax.Graphics.createBubbleForPoint(b,c,g,h,f);document.body.removeChild(a);a.style.position="static";a.style.left="";a.style.top="";0<k?(g=document.createElement("div"),
a.style.width="",g.style.width=k+"px",g.appendChild(a),h.content.appendChild(g)):(a.style.width=g+"px",h.content.appendChild(a))},200)};
SimileAjax.Graphics.createBubbleForPoint=function(a,b,c,d,f){c=parseInt(c,10);d=parseInt(d,10);var e=SimileAjax.Graphics.bubbleConfig,g=SimileAjax.Graphics.pngIsTranslucent?"pngTranslucent":"pngNotTranslucent",h=function(u){return u+" "+u+"-"+g},k=document.createElement("div");k.className=h(e.containerCSSClass);k.style.width=c+"px";k.style.height=d+"px";var l=document.createElement("div");l.className=h(e.innerContainerCSSClass);k.appendChild(l);var m={_closed:!1},p=SimileAjax.WindowManager.pushLayer(function(){m._closed||
(document.body.removeChild(m._div),m._doc=null,m._div=null,m._content=null,m._closed=!0)},!0,k);m._div=k;m.close=function(){SimileAjax.WindowManager.popLayer(p)};var r=function(u){var q=document.createElement("div");q.className=h(e.borderGraphicCSSClassPrefix+u);l.appendChild(q)};r("top-left");r("top-right");r("bottom-left");r("bottom-right");r("left");r("right");r("top");r("bottom");r=document.createElement("div");r.className=h(e.contentContainerCSSClass);l.appendChild(r);m.content=r;r=document.createElement("div");
r.className=h(e.closeGraphicCSSClass);l.appendChild(r);SimileAjax.WindowManager.registerEventWithObject(r,"click",m,"close");(function(){var u=SimileAjax.Graphics.getWindowDimensions(),q=u.w,t=u.h;u=Math.ceil(e.arrowGraphicWidth/2);var v=function(C){var D=document.createElement("div");D.className=h(e.arrowGraphicCSSClassPrefix+"point-"+C);l.appendChild(D);return D};if(0<a-u-e.borderGraphicSize-e.extraPadding&&a+u+e.borderGraphicSize+e.extraPadding<q){var w=a-Math.round(c/2);w=a<q/2?Math.max(w,e.extraPadding+
e.borderGraphicSize):Math.min(w,q-e.extraPadding-e.borderGraphicSize-c);if(f&&"top"==f||!f&&0<b-e.arrowGraphicTargetOffset-d-e.borderGraphicSize-e.extraPadding){t=v("down");t.style.left=a-u-w+"px";k.style.left=w+"px";k.style.top=b-e.arrowGraphicTargetOffset-d+"px";return}if(f&&"bottom"==f||!f&&b+e.arrowGraphicTargetOffset+d+e.borderGraphicSize+e.extraPadding<t){t=v("up");t.style.left=a-u-w+"px";k.style.left=w+"px";k.style.top=b+e.arrowGraphicTargetOffset+"px";return}}q=b-Math.round(d/2);q=b<t/2?Math.max(q,
e.extraPadding+e.borderGraphicSize):Math.min(q,t-e.extraPadding-e.borderGraphicSize-d);f&&"left"==f||!f&&0<a-e.arrowGraphicTargetOffset-c-e.borderGraphicSize-e.extraPadding?(t=v("right"),t.style.top=b-u-q+"px",k.style.top=q+"px",k.style.left=a-e.arrowGraphicTargetOffset-c+"px"):(t=v("left"),t.style.top=b-u-q+"px",k.style.top=q+"px",k.style.left=a+e.arrowGraphicTargetOffset+"px")})();document.body.appendChild(k);return m};
SimileAjax.Graphics.getWindowDimensions=function(){if("number"==typeof window.innerHeight)return{w:window.innerWidth,h:window.innerHeight};if(document.documentElement&&document.documentElement.clientHeight)return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight};if(document.body&&document.body.clientHeight)return{w:document.body.clientWidth,h:document.body.clientHeight}};
SimileAjax.Graphics.createMessageBubble=function(a){var b=a.createElement("div");if(SimileAjax.Graphics.pngIsTranslucent){var c=a.createElement("div");c.style.height="33px";c.style.background="url("+SimileAjax.urlPrefix+"images/message-top-left.png) top left no-repeat";c.style.paddingLeft="44px";b.appendChild(c);var d=a.createElement("div");d.style.height="33px";d.style.background="url("+SimileAjax.urlPrefix+"images/message-top-right.png) top right no-repeat";c.appendChild(d);c=a.createElement("div");
c.style.background="url("+SimileAjax.urlPrefix+"images/message-left.png) top left repeat-y";c.style.paddingLeft="44px";b.appendChild(c);d=a.createElement("div");d.style.background="url("+SimileAjax.urlPrefix+"images/message-right.png) top right repeat-y";d.style.paddingRight="44px";c.appendChild(d);c=a.createElement("div");d.appendChild(c);d=a.createElement("div");d.style.height="55px";d.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-left.png) bottom left no-repeat";d.style.paddingLeft=
"44px";b.appendChild(d);a=a.createElement("div");a.style.height="55px";a.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-right.png) bottom right no-repeat";d.appendChild(a)}else b.style.border="2px solid #7777AA",b.style.padding="20px",b.style.background="white",SimileAjax.Graphics.setOpacity(b,90),c=a.createElement("div"),b.appendChild(c);return{containerDiv:b,contentDiv:c}};
SimileAjax.Graphics.createAnimation=function(a,b,c,d,f){return new SimileAjax.Graphics._Animation(a,b,c,d,f)};SimileAjax.Graphics._Animation=function(a,b,c,d,f){this.f=a;this.cont="function"==typeof f?f:function(){};this.from=b;this.to=c;this.current=b;this.duration=d;this.start=(new Date).getTime();this.timePassed=0};SimileAjax.Graphics._Animation.prototype.run=function(){var a=this;window.setTimeout(function(){a.step()},50)};
SimileAjax.Graphics._Animation.prototype.step=function(){this.timePassed+=50;var a=(-Math.cos(this.timePassed/this.duration*Math.PI)/2+.5)*(this.to-this.from)+this.from;try{this.f(a,a-this.current)}catch(b){}this.current=a;this.timePassed<this.duration?this.run():(this.f(this.to,0),this.cont())};
SimileAjax.Graphics.createStructuredDataCopyButton=function(a,b,c,d){var f=document.createElement("div");f.style.position="relative";f.style.display="inline";f.style.width=b+"px";f.style.height=c+"px";f.style.overflow="hidden";f.style.margin="2px";SimileAjax.Graphics.pngIsTranslucent?f.style.background="url("+a+") no-repeat":f.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image')";f.innerHTML="<textarea rows='1' autocomplete='off' value='none' style='"+
(SimileAjax.Platform.browser.isIE?"filter:alpha(opacity=0)":"opacity: 0")+"' />";var e=f.firstChild;e.style.width=b+"px";e.style.height=c+"px";e.onmousedown=function(g){g=g?g:event?event:null;2==g.button&&(e.value=d(),e.select())};return f};SimileAjax.Graphics.getWidthHeight=function(a){if(null==a.getBoundingClientRect){var b=a.offsetWidth;a=a.offsetHeight}else a=a.getBoundingClientRect(),b=Math.ceil(a.right-a.left),a=Math.ceil(a.bottom-a.top);return{width:b,height:a}};
SimileAjax.Graphics.getFontRenderingContext=function(a,b){return new SimileAjax.Graphics._FontRenderingContext(a,b)};SimileAjax.Graphics._FontRenderingContext=function(a,b){this._elmt=a;this._elmt.style.visibility="hidden";"string"==typeof b?this._elmt.style.width=b:"number"==typeof b&&(this._elmt.style.width=b+"px")};SimileAjax.Graphics._FontRenderingContext.prototype.dispose=function(){this._elmt=null};
SimileAjax.Graphics._FontRenderingContext.prototype.update=function(){this._elmt.innerHTML="A";this._lineHeight=this._elmt.offsetHeight};SimileAjax.Graphics._FontRenderingContext.prototype.computeSize=function(a,b){var c=this._elmt;c.innerHTML=a;c.className=void 0===b?"":b;a=SimileAjax.Graphics.getWidthHeight(c);c.className="";return a};SimileAjax.Graphics._FontRenderingContext.prototype.getLineHeight=function(){return this._lineHeight};SimileAjax.DateTime={};SimileAjax.DateTime.MILLISECOND=0;
SimileAjax.DateTime.SECOND=1;SimileAjax.DateTime.MINUTE=2;SimileAjax.DateTime.HOUR=3;SimileAjax.DateTime.DAY=4;SimileAjax.DateTime.WEEK=5;SimileAjax.DateTime.MONTH=6;SimileAjax.DateTime.YEAR=7;SimileAjax.DateTime.DECADE=8;SimileAjax.DateTime.CENTURY=9;SimileAjax.DateTime.MILLENNIUM=10;SimileAjax.DateTime.EPOCH=-1;SimileAjax.DateTime.ERA=-2;SimileAjax.DateTime.gregorianUnitLengths=[];
(function(){var a=SimileAjax.DateTime,b=a.gregorianUnitLengths;b[a.MILLISECOND]=1;b[a.SECOND]=1E3;b[a.MINUTE]=60*b[a.SECOND];b[a.HOUR]=60*b[a.MINUTE];b[a.DAY]=24*b[a.HOUR];b[a.WEEK]=7*b[a.DAY];b[a.MONTH]=31*b[a.DAY];b[a.YEAR]=365*b[a.DAY];b[a.DECADE]=10*b[a.YEAR];b[a.CENTURY]=100*b[a.YEAR];b[a.MILLENNIUM]=1E3*b[a.YEAR]})();SimileAjax.DateTime._dateRegexp=/^(-?)([0-9]{4})((-?([0-9]{2})(-?([0-9]{2}))?)|(-?([0-9]{3}))|(-?W([0-9]{2})(-?([1-7]))?))?$/;SimileAjax.DateTime._timezoneRegexp=/Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$/;
SimileAjax.DateTime._timeRegexp=/^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$/;
SimileAjax.DateTime.setIso8601Date=function(a,b){var c=b.match(SimileAjax.DateTime._dateRegexp);if(!c)throw Error("Invalid date string: "+b);var d=c[5],f=c[7],e=c[9];b=c[11];var g=c[13]?c[13]:1;a.setUTCFullYear(("-"==c[1]?-1:1)*c[2]);e?(a.setUTCMonth(0),a.setUTCDate(Number(e))):b?(a.setUTCMonth(0),a.setUTCDate(1),c=(c=a.getUTCDay())?c:7,b=Number(g)+7*Number(b),4>=c?a.setUTCDate(b+1-c):a.setUTCDate(b+8-c)):(d&&(a.setUTCDate(1),a.setUTCMonth(d-1)),f&&a.setUTCDate(f));return a};
SimileAjax.DateTime.setIso8601Time=function(a,b){var c=b.match(SimileAjax.DateTime._timeRegexp);if(!c)return SimileAjax.Debug.warn("Invalid time string: "+b),!1;b=Number(c[3]?c[3]:0);var d=c[5]?c[5]:0,f=c[7]?1E3*Number("0."+c[7]):0;a.setUTCHours(c[1]);a.setUTCMinutes(b);a.setUTCSeconds(d);a.setUTCMilliseconds(f);return a};SimileAjax.DateTime.timezoneOffset=(new Date).getTimezoneOffset();
SimileAjax.DateTime.setIso8601=function(a,b){var c=null;b=-1==b.indexOf("T")?b.split(" "):b.split("T");SimileAjax.DateTime.setIso8601Date(a,b[0]);if(2==b.length){var d=b[1].match(SimileAjax.DateTime._timezoneRegexp);d&&("Z"==d[0]?c=0:(c=60*Number(d[3])+Number(d[5]),c*="-"==d[2]?1:-1),b[1]=b[1].substr(0,b[1].length-d[0].length));SimileAjax.DateTime.setIso8601Time(a,b[1])}null==c&&(c=a.getTimezoneOffset());a.setTime(a.getTime()+6E4*c);return a};
SimileAjax.DateTime.parseIso8601DateTime=function(a){try{return SimileAjax.DateTime.setIso8601(new Date(0),a)}catch(b){return null}};SimileAjax.DateTime.parseGregorianDateTime=function(a){if(null==a)return null;if(a instanceof Date)return a;var b=a.toString();if(0<b.length&&8>b.length){var c=b.indexOf(" ");0<c?(a=parseInt(b.substr(0,c)),"bc"==b.substr(c+1).toLowerCase()&&(a=1-a)):a=parseInt(b);b=new Date(0);b.setUTCFullYear(a);return b}try{return new Date(Date.parse(b))}catch(d){return null}};
SimileAjax.DateTime.roundDownToInterval=function(a,b,c,d,f){c*=SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var e=new Date(a.getTime()+c),g=function(k){k.setUTCMilliseconds(0);k.setUTCSeconds(0);k.setUTCMinutes(0);k.setUTCHours(0)},h=function(k){g(k);k.setUTCDate(1);k.setUTCMonth(0)};switch(b){case SimileAjax.DateTime.MILLISECOND:b=e.getUTCMilliseconds();e.setUTCMilliseconds(b-b%d);break;case SimileAjax.DateTime.SECOND:e.setUTCMilliseconds(0);b=e.getUTCSeconds();e.setUTCSeconds(b-
b%d);break;case SimileAjax.DateTime.MINUTE:e.setUTCMilliseconds(0);e.setUTCSeconds(0);b=e.getUTCMinutes();e.setTime(e.getTime()-b%d*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:e.setUTCMilliseconds(0);e.setUTCSeconds(0);e.setUTCMinutes(0);b=e.getUTCHours();e.setUTCHours(b-b%d);break;case SimileAjax.DateTime.DAY:g(e);break;case SimileAjax.DateTime.WEEK:g(e);d=(e.getUTCDay()+7-f)%7;e.setTime(e.getTime()-d*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY]);
break;case SimileAjax.DateTime.MONTH:g(e);e.setUTCDate(1);b=e.getUTCMonth();e.setUTCMonth(b-b%d);break;case SimileAjax.DateTime.YEAR:h(e);b=e.getUTCFullYear();e.setUTCFullYear(b-b%d);break;case SimileAjax.DateTime.DECADE:h(e);e.setUTCFullYear(10*Math.floor(e.getUTCFullYear()/10));break;case SimileAjax.DateTime.CENTURY:h(e);e.setUTCFullYear(100*Math.floor(e.getUTCFullYear()/100));break;case SimileAjax.DateTime.MILLENNIUM:h(e),e.setUTCFullYear(1E3*Math.floor(e.getUTCFullYear()/1E3))}a.setTime(e.getTime()-
c)};SimileAjax.DateTime.roundUpToInterval=function(a,b,c,d,f){var e=a.getTime();SimileAjax.DateTime.roundDownToInterval(a,b,c,d,f);a.getTime()<e&&a.setTime(a.getTime()+SimileAjax.DateTime.gregorianUnitLengths[b]*d)};
SimileAjax.DateTime.incrementByInterval=function(a,b,c){c=("undefined"==typeof c?0:c)*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var d=new Date(a.getTime()+c);switch(b){case SimileAjax.DateTime.MILLISECOND:d.setTime(d.getTime()+1);break;case SimileAjax.DateTime.SECOND:d.setTime(d.getTime()+1E3);break;case SimileAjax.DateTime.MINUTE:d.setTime(d.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:d.setTime(d.getTime()+
SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR]);break;case SimileAjax.DateTime.DAY:d.setUTCDate(d.getUTCDate()+1);break;case SimileAjax.DateTime.WEEK:d.setUTCDate(d.getUTCDate()+7);break;case SimileAjax.DateTime.MONTH:d.setUTCMonth(d.getUTCMonth()+1);break;case SimileAjax.DateTime.YEAR:d.setUTCFullYear(d.getUTCFullYear()+1);break;case SimileAjax.DateTime.DECADE:d.setUTCFullYear(d.getUTCFullYear()+10);break;case SimileAjax.DateTime.CENTURY:d.setUTCFullYear(d.getUTCFullYear()+100);
break;case SimileAjax.DateTime.MILLENNIUM:d.setUTCFullYear(d.getUTCFullYear()+1E3)}a.setTime(d.getTime()-c)};SimileAjax.DateTime.removeTimeZoneOffset=function(a,b){return new Date(a.getTime()+b*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR])};SimileAjax.DateTime.getTimezone=function(){return(new Date).getTimezoneOffset()/-60};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};
String.prototype.startsWith=function(a){return this.length>=a.length&&this.substr(0,a.length)==a};String.prototype.endsWith=function(a){return this.length>=a.length&&this.substr(this.length-a.length)==a};
String.substitute=function(a,b){for(var c="",d=0;d<a.length-1;){var f=a.indexOf("%",d);if(0>f||f==a.length-1)break;else if(f>d&&"\\"==a.charAt(f-1))c+=a.substring(d,f-1)+"%",d=f+1;else{var e=parseInt(a.charAt(f+1));c=isNaN(e)||e>=b.length?c+a.substring(d,f+2):c+(a.substring(d,f)+b[e].toString());d=f+2}}d<a.length&&(c+=a.substring(d));return c};SimileAjax.HTML={};SimileAjax.HTML._e2uHash={};
(function(){var a=SimileAjax.HTML._e2uHash;a.nbsp="\u00a0";a.iexcl="\u00a1";a.cent="\u00a2";a.pound="\u00a3";a.curren="\u00a4";a.yen="\u00a5";a.brvbar="\u00a6";a.sect="\u00a7";a.uml="\u00a8";a.copy="\u00a9";a.ordf="\u00aa";a.laquo="\u00ab";a.not="\u00ac";a.shy="\u00ad";a.reg="\u00ae";a.macr="\u00af";a.deg="\u00b0";a.plusmn="\u00b1";a.sup2="\u00b2";a.sup3="\u00b3";a.acute="\u00b4";a.micro="\u00b5";a.para="\u00b6";a.middot="\u00b7";a.cedil="\u00b8";a.sup1="\u00b9";a.ordm="\u00ba";a.raquo="\u00bb";a.frac14=
"\u00bc";a.frac12="\u00bd";a.frac34="\u00be";a.iquest="\u00bf";a.Agrave="\u00c0";a.Aacute="\u00c1";a.Acirc="\u00c2";a.Atilde="\u00c3";a.Auml="\u00c4";a.Aring="\u00c5";a.AElig="\u00c6";a.Ccedil="\u00c7";a.Egrave="\u00c8";a.Eacute="\u00c9";a.Ecirc="\u00ca";a.Euml="\u00cb";a.Igrave="\u00cc";a.Iacute="\u00cd";a.Icirc="\u00ce";a.Iuml="\u00cf";a.ETH="\u00d0";a.Ntilde="\u00d1";a.Ograve="\u00d2";a.Oacute="\u00d3";a.Ocirc="\u00d4";a.Otilde="\u00d5";a.Ouml="\u00d6";a.times="\u00d7";a.Oslash="\u00d8";a.Ugrave=
"\u00d9";a.Uacute="\u00da";a.Ucirc="\u00db";a.Uuml="\u00dc";a.Yacute="\u00dd";a.THORN="\u00de";a.szlig="\u00df";a.agrave="\u00e0";a.aacute="\u00e1";a.acirc="\u00e2";a.atilde="\u00e3";a.auml="\u00e4";a.aring="\u00e5";a.aelig="\u00e6";a.ccedil="\u00e7";a.egrave="\u00e8";a.eacute="\u00e9";a.ecirc="\u00ea";a.euml="\u00eb";a.igrave="\u00ec";a.iacute="\u00ed";a.icirc="\u00ee";a.iuml="\u00ef";a.eth="\u00f0";a.ntilde="\u00f1";a.ograve="\u00f2";a.oacute="\u00f3";a.ocirc="\u00f4";a.otilde="\u00f5";a.ouml="\u00f6";
a.divide="\u00f7";a.oslash="\u00f8";a.ugrave="\u00f9";a.uacute="\u00fa";a.ucirc="\u00fb";a.uuml="\u00fc";a.yacute="\u00fd";a.thorn="\u00fe";a.yuml="\u00ff";a.quot='"';a.amp="&";a.lt="<";a.gt=">";a.OElig="";a.oelig="\u0153";a.Scaron="\u0160";a.scaron="\u0161";a.Yuml="\u0178";a.circ="\u02c6";a.tilde="\u02dc";a.ensp="\u2002";a.emsp="\u2003";a.thinsp="\u2009";a.zwnj="\u200c";a.zwj="\u200d";a.lrm="\u200e";a.rlm="\u200f";a.ndash="\u2013";a.mdash="\u2014";a.lsquo="\u2018";a.rsquo="\u2019";a.sbquo="\u201a";
a.ldquo="\u201c";a.rdquo="\u201d";a.bdquo="\u201e";a.dagger="\u2020";a.Dagger="\u2021";a.permil="\u2030";a.lsaquo="\u2039";a.rsaquo="\u203a";a.euro="\u20ac";a.fnof="\u0192";a.Alpha="\u0391";a.Beta="\u0392";a.Gamma="\u0393";a.Delta="\u0394";a.Epsilon="\u0395";a.Zeta="\u0396";a.Eta="\u0397";a.Theta="\u0398";a.Iota="\u0399";a.Kappa="\u039a";a.Lambda="\u039b";a.Mu="\u039c";a.Nu="\u039d";a.Xi="\u039e";a.Omicron="\u039f";a.Pi="\u03a0";a.Rho="\u03a1";a.Sigma="\u03a3";a.Tau="\u03a4";a.Upsilon="\u03a5";a.Phi=
"\u03a6";a.Chi="\u03a7";a.Psi="\u03a8";a.Omega="\u03a9";a.alpha="\u03b1";a.beta="\u03b2";a.gamma="\u03b3";a.delta="\u03b4";a.epsilon="\u03b5";a.zeta="\u03b6";a.eta="\u03b7";a.theta="\u03b8";a.iota="\u03b9";a.kappa="\u03ba";a.lambda="\u03bb";a.mu="\u03bc";a.nu="\u03bd";a.xi="\u03be";a.omicron="\u03bf";a.pi="\u03c0";a.rho="\u03c1";a.sigmaf="\u03c2";a.sigma="\u03c3";a.tau="\u03c4";a.upsilon="\u03c5";a.phi="\u03c6";a.chi="\u03c7";a.psi="\u03c8";a.omega="\u03c9";a.thetasym="\u03d1";a.upsih="\u03d2";a.piv=
"\u03d6";a.bull="\u2022";a.hellip="\u2026";a.prime="\u2032";a.Prime="\u2033";a.oline="\u203e";a.frasl="\u2044";a.weierp="\u2118";a.image="\u2111";a.real="\u211c";a.trade="\u2122";a.alefsym="\u2135";a.larr="\u2190";a.uarr="\u2191";a.rarr="\u2192";a.darr="\u2193";a.harr="\u2194";a.crarr="\u21b5";a.lArr="\u21d0";a.uArr="\u21d1";a.rArr="\u21d2";a.dArr="\u21d3";a.hArr="\u21d4";a.forall="\u2200";a.part="\u2202";a.exist="\u2203";a.empty="\u2205";a.nabla="\u2207";a.isin="\u2208";a.notin="\u2209";a.ni="\u220b";
a.prod="\u220f";a.sum="\u2211";a.minus="\u2212";a.lowast="\u2217";a.radic="\u221a";a.prop="\u221d";a.infin="\u221e";a.ang="\u2220";a.and="\u2227";a.or="\u2228";a.cap="\u2229";a.cup="\u222a";a["int"]="\u222b";a.there4="\u2234";a.sim="\u223c";a.cong="\u2245";a.asymp="\u2248";a.ne="\u2260";a.equiv="\u2261";a.le="\u2264";a.ge="\u2265";a.sub="\u2282";a.sup="\u2283";a.nsub="\u2284";a.sube="\u2286";a.supe="\u2287";a.oplus="\u2295";a.otimes="\u2297";a.perp="\u22a5";a.sdot="\u22c5";a.lceil="\u2308";a.rceil=
"\u2309";a.lfloor="\u230a";a.rfloor="\u230b";a.lang="\u2329";a.rang="\u232a";a.loz="\u25ca";a.spades="\u2660";a.clubs="\u2663";a.hearts="\u2665";a.diams="\u2666"})();SimileAjax.HTML.deEntify=function(a){for(var b=SimileAjax.HTML._e2uHash,c=/&(\w+?);/;c.test(a);){var d=a.match(c);a=a.replace(c,b[d[1]])}return a};SimileAjax.Set=function(a){this._hash={};this._count=0;if(a instanceof Array)for(var b=0;b<a.length;b++)this.add(a[b]);else a instanceof SimileAjax.Set&&this.addSet(a)};
SimileAjax.Set.prototype.add=function(a){return a in this._hash?!1:(this._hash[a]=!0,this._count++,!0)};SimileAjax.Set.prototype.addSet=function(a){for(var b in a._hash)this.add(b)};SimileAjax.Set.prototype.remove=function(a){return a in this._hash?(delete this._hash[a],this._count--,!0):!1};SimileAjax.Set.prototype.removeSet=function(a){for(var b in a._hash)this.remove(b)};SimileAjax.Set.prototype.retainSet=function(a){for(var b in this._hash)a.contains(b)||(delete this._hash[b],this._count--)};
SimileAjax.Set.prototype.contains=function(a){return a in this._hash};SimileAjax.Set.prototype.size=function(){return this._count};SimileAjax.Set.prototype.toArray=function(){var a=[],b;for(b in this._hash)a.push(b);return a};SimileAjax.Set.prototype.visit=function(a){for(var b in this._hash)if(1==a(b))break};SimileAjax.SortedArray=function(a,b){this._a=b instanceof Array?b:[];this._compare=a};
SimileAjax.SortedArray.prototype.add=function(a){var b=this,c=this.find(function(d){return b._compare(d,a)});c<this._a.length?this._a.splice(c,0,a):this._a.push(a)};SimileAjax.SortedArray.prototype.remove=function(a){for(var b=this,c=this.find(function(d){return b._compare(d,a)});c<this._a.length&&0==this._compare(this._a[c],a);){if(this._a[c]==a)return this._a.splice(c,1),!0;c++}return!1};SimileAjax.SortedArray.prototype.removeAll=function(){this._a=[]};
SimileAjax.SortedArray.prototype.elementAt=function(a){return this._a[a]};SimileAjax.SortedArray.prototype.length=function(){return this._a.length};SimileAjax.SortedArray.prototype.find=function(a){for(var b=0,c=this._a.length;b<c;){var d=Math.floor((b+c)/2),f=a(this._a[d]);if(d==b)return 0>f?b+1:b;0>f?b=d:c=d}return b};SimileAjax.SortedArray.prototype.getFirst=function(){return 0<this._a.length?this._a[0]:null};
SimileAjax.SortedArray.prototype.getLast=function(){return 0<this._a.length?this._a[this._a.length-1]:null};SimileAjax.EventIndex=function(a){var b=this;this._unit=null!=a?a:SimileAjax.NativeDateUnit;this._events=new SimileAjax.SortedArray(function(c,d){return b._unit.compare(c.getStart(),d.getStart())});this._idToEvent={};this._indexed=!0};SimileAjax.EventIndex.prototype.getUnit=function(){return this._unit};SimileAjax.EventIndex.prototype.getEvent=function(a){return this._idToEvent[a]};
SimileAjax.EventIndex.prototype.add=function(a){this._events.add(a);this._idToEvent[a.getID()]=a;this._indexed=!1};SimileAjax.EventIndex.prototype.removeAll=function(){this._events.removeAll();this._idToEvent={};this._indexed=!1};SimileAjax.EventIndex.prototype.getCount=function(){return this._events.length()};SimileAjax.EventIndex.prototype.getIterator=function(a,b){this._indexed||this._index();return new SimileAjax.EventIndex._Iterator(this._events,a,b,this._unit)};
SimileAjax.EventIndex.prototype.getReverseIterator=function(a,b){this._indexed||this._index();return new SimileAjax.EventIndex._ReverseIterator(this._events,a,b,this._unit)};SimileAjax.EventIndex.prototype.getAllIterator=function(){return new SimileAjax.EventIndex._AllIterator(this._events)};SimileAjax.EventIndex.prototype.getEarliestDate=function(){var a=this._events.getFirst();return null==a?null:a.getStart()};
SimileAjax.EventIndex.prototype.getLatestDate=function(){var a=this._events.getLast();if(null==a)return null;this._indexed||this._index();var b=a._earliestOverlapIndex;a=this._events.elementAt(b).getEnd();for(b+=1;b<this._events.length();b++)a=this._unit.later(a,this._events.elementAt(b).getEnd());return a};
SimileAjax.EventIndex.prototype._index=function(){for(var a=this._events.length(),b=0;b<a;b++){var c=this._events.elementAt(b);c._earliestOverlapIndex=b}var d=1;for(b=0;b<a;b++)for(c=this._events.elementAt(b),c=c.getEnd(),d=Math.max(d,b+1);d<a;){var f=this._events.elementAt(d),e=f.getStart();if(0>this._unit.compare(e,c))f._earliestOverlapIndex=b,d++;else break}this._indexed=!0};
SimileAjax.EventIndex._Iterator=function(a,b,c,d){this._events=a;this._startDate=b;this._endDate=c;this._unit=d;this._currentIndex=a.find(function(f){return d.compare(f.getStart(),b)});0<=this._currentIndex-1&&(this._currentIndex=this._events.elementAt(this._currentIndex-1)._earliestOverlapIndex);this._currentIndex--;this._maxIndex=a.find(function(f){return d.compare(f.getStart(),c)});this._hasNext=!1;this._next=null;this._findNext()};
SimileAjax.EventIndex._Iterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}return null},_findNext:function(){for(var a=this._unit;++this._currentIndex<this._maxIndex;){var b=this._events.elementAt(this._currentIndex);if(0>a.compare(b.getStart(),this._endDate)&&0<a.compare(b.getEnd(),this._startDate)){this._next=b;this._hasNext=!0;return}}this._next=null;this._hasNext=!1}};
SimileAjax.EventIndex._ReverseIterator=function(a,b,c,d){this._events=a;this._startDate=b;this._endDate=c;this._unit=d;this._minIndex=a.find(function(f){return d.compare(f.getStart(),b)});0<=this._minIndex-1&&(this._minIndex=this._events.elementAt(this._minIndex-1)._earliestOverlapIndex);this._currentIndex=this._maxIndex=a.find(function(f){return d.compare(f.getStart(),c)});this._hasNext=!1;this._next=null;this._findNext()};
SimileAjax.EventIndex._ReverseIterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}return null},_findNext:function(){for(var a=this._unit;--this._currentIndex>=this._minIndex;){var b=this._events.elementAt(this._currentIndex);if(0>a.compare(b.getStart(),this._endDate)&&0<a.compare(b.getEnd(),this._startDate)){this._next=b;this._hasNext=!0;return}}this._next=null;this._hasNext=!1}};
SimileAjax.EventIndex._AllIterator=function(a){this._events=a;this._index=0};SimileAjax.EventIndex._AllIterator.prototype={hasNext:function(){return this._index<this._events.length()},next:function(){return this._index<this._events.length()?this._events.elementAt(this._index++):null}};SimileAjax.NativeDateUnit={};SimileAjax.NativeDateUnit.makeDefaultValue=function(){return new Date};SimileAjax.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};
SimileAjax.NativeDateUnit.getParser=function(a){"string"==typeof a&&(a=a.toLowerCase());var b="iso8601"==a||"iso 8601"==a?SimileAjax.DateTime.parseIso8601DateTime:SimileAjax.DateTime.parseGregorianDateTime;return function(c){return"undefined"!=typeof c&&"function"==typeof c.toUTCString?c:b(c)}};SimileAjax.NativeDateUnit.parseFromObject=function(a){return SimileAjax.DateTime.parseGregorianDateTime(a)};SimileAjax.NativeDateUnit.toNumber=function(a){return a.getTime()};
SimileAjax.NativeDateUnit.fromNumber=function(a){return new Date(a)};SimileAjax.NativeDateUnit.compare=function(a,b){a="object"==typeof a?a.getTime():Number(a);b="object"==typeof b?b.getTime():Number(b);return a-b};SimileAjax.NativeDateUnit.earlier=function(a,b){return 0>SimileAjax.NativeDateUnit.compare(a,b)?a:b};SimileAjax.NativeDateUnit.later=function(a,b){return 0<SimileAjax.NativeDateUnit.compare(a,b)?a:b};SimileAjax.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};
SimileAjax.ListenerQueue=function(a){this._listeners=[];this._wildcardHandlerName=a};SimileAjax.ListenerQueue.prototype.add=function(a){this._listeners.push(a)};SimileAjax.ListenerQueue.prototype.remove=function(a){for(var b=this._listeners,c=0;c<b.length;c++)if(b[c]==a){b.splice(c,1);break}};
SimileAjax.ListenerQueue.prototype.fire=function(a,b){for(var c=[].concat(this._listeners),d=0;d<c.length;d++){var f=c[d];if(a in f)try{f[a].apply(f,b)}catch(e){SimileAjax.Debug.exception("Error firing event of name "+a,e)}else if(null!=this._wildcardHandlerName&&this._wildcardHandlerName in f)try{f[this._wildcardHandlerName].apply(f,[a])}catch(e){SimileAjax.Debug.exception("Error firing event of name "+a+" to wildcard handler",e)}}};
SimileAjax.History={maxHistoryLength:10,historyFile:"__history__.html",enabled:!0,_initialized:!1,_listeners:new SimileAjax.ListenerQueue,_actions:[],_baseIndex:0,_currentIndex:0,_plainDocumentTitle:document.title};SimileAjax.History.formatHistoryEntryTitle=function(a){return SimileAjax.History._plainDocumentTitle+" {"+a+"}"};
SimileAjax.History.initialize=function(){if(!SimileAjax.History._initialized){if(SimileAjax.History.enabled){var a=document.createElement("iframe");a.id="simile-ajax-history";a.style.position="absolute";a.style.width="10px";a.style.height="10px";a.style.top="0px";a.style.left="0px";a.style.visibility="hidden";a.src=SimileAjax.History.historyFile+"?0";document.body.appendChild(a);SimileAjax.DOM.registerEvent(a,"load",SimileAjax.History._handleIFrameOnLoad);SimileAjax.History._iframe=a}SimileAjax.History._initialized=
!0}};SimileAjax.History.addListener=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.add(a)};SimileAjax.History.removeListener=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.remove(a)};
SimileAjax.History.addAction=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.fire("onBeforePerform",[a]);window.setTimeout(function(){try{if(a.perform(),SimileAjax.History._listeners.fire("onAfterPerform",[a]),SimileAjax.History.enabled){SimileAjax.History._actions=SimileAjax.History._actions.slice(0,SimileAjax.History._currentIndex-SimileAjax.History._baseIndex);SimileAjax.History._actions.push(a);SimileAjax.History._currentIndex++;var b=SimileAjax.History._actions.length-
SimileAjax.History.maxHistoryLength;0<b&&(SimileAjax.History._actions=SimileAjax.History._actions.slice(b),SimileAjax.History._baseIndex+=b);try{SimileAjax.History._iframe.contentWindow.location.search="?"+SimileAjax.History._currentIndex}catch(d){var c=SimileAjax.History.formatHistoryEntryTitle(a.label);document.title=c}}}catch(d){SimileAjax.Debug.exception(d,"Error adding action {"+a.label+"} to history")}},0)};
SimileAjax.History.addLengthyAction=function(a,b,c){SimileAjax.History.addAction({perform:a,undo:b,label:c,uiLayer:SimileAjax.WindowManager.getBaseLayer(),lengthy:!0})};
SimileAjax.History._handleIFrameOnLoad=function(){try{var a=SimileAjax.History._iframe.contentWindow.location.search,b=0==a.length?0:Math.max(0,parseInt(a.substr(1))),c=function(){var e=b-SimileAjax.History._currentIndex;SimileAjax.History._currentIndex+=e;SimileAjax.History._baseIndex+=e;SimileAjax.History._iframe.contentWindow.location.search="?"+b};if(b<SimileAjax.History._currentIndex)SimileAjax.History._listeners.fire("onBeforeUndoSeveral",[]),window.setTimeout(function(){for(;SimileAjax.History._currentIndex>
b&&SimileAjax.History._currentIndex>SimileAjax.History._baseIndex;){SimileAjax.History._currentIndex--;var e=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{e.undo()}catch(g){SimileAjax.Debug.exception(g,"History: Failed to undo action {"+e.label+"}")}}SimileAjax.History._listeners.fire("onAfterUndoSeveral",[]);c()},0);else if(b>SimileAjax.History._currentIndex)SimileAjax.History._listeners.fire("onBeforeRedoSeveral",[]),window.setTimeout(function(){for(;SimileAjax.History._currentIndex<
b&&SimileAjax.History._currentIndex-SimileAjax.History._baseIndex<SimileAjax.History._actions.length;){var e=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{e.perform()}catch(g){SimileAjax.Debug.exception(g,"History: Failed to redo action {"+e.label+"}")}SimileAjax.History._currentIndex++}SimileAjax.History._listeners.fire("onAfterRedoSeveral",[]);c()},0);else{var d=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1,f=0<=d&&d<SimileAjax.History._actions.length?
SimileAjax.History.formatHistoryEntryTitle(SimileAjax.History._actions[d].label):SimileAjax.History._plainDocumentTitle;SimileAjax.History._iframe.contentWindow.document.title=f;document.title=f}}catch(e){}};SimileAjax.History.getNextUndoAction=function(){try{return SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1]}catch(a){return null}};
SimileAjax.History.getNextRedoAction=function(){try{return SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex]}catch(a){return null}};SimileAjax.WindowManager={_initialized:!1,_listeners:[],_draggedElement:null,_draggedElementCallback:null,_dropTargetHighlightElement:null,_lastCoords:null,_ghostCoords:null,_draggingMode:"",_dragging:!1,_layers:[]};
SimileAjax.WindowManager.initialize=function(){SimileAjax.WindowManager._initialized||(SimileAjax.DOM.registerEvent(document.body,"mousedown",SimileAjax.WindowManager._onBodyMouseDown),SimileAjax.DOM.registerEvent(document.body,"mousemove",SimileAjax.WindowManager._onBodyMouseMove),SimileAjax.DOM.registerEvent(document.body,"mouseup",SimileAjax.WindowManager._onBodyMouseUp),SimileAjax.DOM.registerEvent(document,"keydown",SimileAjax.WindowManager._onBodyKeyDown),SimileAjax.DOM.registerEvent(document,
"keyup",SimileAjax.WindowManager._onBodyKeyUp),SimileAjax.WindowManager._layers.push({index:0}),SimileAjax.WindowManager._historyListener={onBeforeUndoSeveral:function(){},onAfterUndoSeveral:function(){},onBeforeUndo:function(){},onAfterUndo:function(){},onBeforeRedoSeveral:function(){},onAfterRedoSeveral:function(){},onBeforeRedo:function(){},onAfterRedo:function(){}},SimileAjax.History.addListener(SimileAjax.WindowManager._historyListener),SimileAjax.WindowManager._initialized=!0)};
SimileAjax.WindowManager.getBaseLayer=function(){SimileAjax.WindowManager.initialize();return SimileAjax.WindowManager._layers[0]};SimileAjax.WindowManager.getHighestLayer=function(){SimileAjax.WindowManager.initialize();return SimileAjax.WindowManager._layers[SimileAjax.WindowManager._layers.length-1]};SimileAjax.WindowManager.registerEventWithObject=function(a,b,c,d,f){SimileAjax.WindowManager.registerEvent(a,b,function(e,g,h){return c[d].call(c,e,g,h)},f)};
SimileAjax.WindowManager.registerEvent=function(a,b,c,d){null==d&&(d=SimileAjax.WindowManager.getHighestLayer());SimileAjax.DOM.registerEvent(a,b,function(f,e,g){if(SimileAjax.WindowManager._canProcessEventAtLayer(d)){SimileAjax.WindowManager._popToLayer(d.index);try{c(f,e,g)}catch(h){SimileAjax.Debug.exception(h)}}SimileAjax.DOM.cancelEvent(e);return!1})};
SimileAjax.WindowManager.pushLayer=function(a,b,c){a={onPop:a,index:SimileAjax.WindowManager._layers.length,ephemeral:b,elmt:c};SimileAjax.WindowManager._layers.push(a);return a};SimileAjax.WindowManager.popLayer=function(a){for(var b=1;b<SimileAjax.WindowManager._layers.length;b++)if(SimileAjax.WindowManager._layers[b]==a){SimileAjax.WindowManager._popToLayer(b-1);break}};SimileAjax.WindowManager.popAllLayers=function(){SimileAjax.WindowManager._popToLayer(0)};
SimileAjax.WindowManager.registerForDragging=function(a,b,c){SimileAjax.WindowManager.registerEvent(a,"mousedown",function(d,f,e){SimileAjax.WindowManager._handleMouseDown(d,f,b)},c)};SimileAjax.WindowManager._popToLayer=function(a){for(;a+1<SimileAjax.WindowManager._layers.length;)try{var b=SimileAjax.WindowManager._layers.pop();if(null!=b.onPop)b.onPop()}catch(c){}};
SimileAjax.WindowManager._canProcessEventAtLayer=function(a){if(a.index==SimileAjax.WindowManager._layers.length-1)return!0;for(a=a.index+1;a<SimileAjax.WindowManager._layers.length;a++)if(!SimileAjax.WindowManager._layers[a].ephemeral)return!1;return!0};
SimileAjax.WindowManager.cancelPopups=function(a){a=a?SimileAjax.DOM.getEventPageCoordinates(a):{x:-1,y:-1};for(var b=SimileAjax.WindowManager._layers.length-1;0<b&&SimileAjax.WindowManager._layers[b].ephemeral;){var c=SimileAjax.WindowManager._layers[b];if(null!=c.elmt){c=c.elmt;var d=SimileAjax.DOM.getPageCoordinates(c);if(a.x>=d.left&&a.x<d.left+c.offsetWidth&&a.y>=d.top&&a.y<d.top+c.offsetHeight)break}b--}SimileAjax.WindowManager._popToLayer(b)};
SimileAjax.WindowManager._onBodyMouseDown=function(a,b,c){"eventPhase"in b&&b.eventPhase!=b.BUBBLING_PHASE||SimileAjax.WindowManager.cancelPopups(b)};SimileAjax.WindowManager._handleMouseDown=function(a,b,c){SimileAjax.WindowManager._draggedElement=a;SimileAjax.WindowManager._draggedElementCallback=c;SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY};SimileAjax.DOM.cancelEvent(b);return!1};
SimileAjax.WindowManager._onBodyKeyDown=function(a,b,c){SimileAjax.WindowManager._dragging&&(27==b.keyCode?SimileAjax.WindowManager._cancelDragging():17!=b.keyCode&&16!=b.keyCode||"copy"==SimileAjax.WindowManager._draggingMode||(SimileAjax.WindowManager._draggingMode="copy",a=SimileAjax.Graphics.createTranslucentImage(SimileAjax.urlPrefix+"images/copy.png"),a.style.position="absolute",a.style.left=SimileAjax.WindowManager._ghostCoords.left-16+"px",a.style.top=SimileAjax.WindowManager._ghostCoords.top+
"px",document.body.appendChild(a),SimileAjax.WindowManager._draggingModeIndicatorElmt=a))};SimileAjax.WindowManager._onBodyKeyUp=function(a,b,c){!SimileAjax.WindowManager._dragging||17!=b.keyCode&&16!=b.keyCode||(SimileAjax.WindowManager._draggingMode="",null!=SimileAjax.WindowManager._draggingModeIndicatorElmt&&(document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt),SimileAjax.WindowManager._draggingModeIndicatorElmt=null))};
SimileAjax.WindowManager._onBodyMouseMove=function(a,b,c){if(null!=SimileAjax.WindowManager._draggedElement){a=SimileAjax.WindowManager._draggedElementCallback;var d=SimileAjax.WindowManager._lastCoords,f=b.clientX-d.x;d=b.clientY-d.y;if(SimileAjax.WindowManager._dragging)try{SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY};if("onDragBy"in a)a.onDragBy(f,d);if("_ghostElmt"in a){m=a._ghostElmt;SimileAjax.WindowManager._ghostCoords.left+=f;SimileAjax.WindowManager._ghostCoords.top+=d;
m.style.left=SimileAjax.WindowManager._ghostCoords.left+"px";m.style.top=SimileAjax.WindowManager._ghostCoords.top+"px";if(null!=SimileAjax.WindowManager._draggingModeIndicatorElmt){var e=SimileAjax.WindowManager._draggingModeIndicatorElmt;e.style.left=SimileAjax.WindowManager._ghostCoords.left-16+"px";e.style.top=SimileAjax.WindowManager._ghostCoords.top+"px"}if("droppable"in a&&a.droppable){var g=SimileAjax.DOM.getEventPageCoordinates(b);c=SimileAjax.DOM.hittest(g.x,g.y,[SimileAjax.WindowManager._ghostElmt,
SimileAjax.WindowManager._dropTargetHighlightElement]);c=SimileAjax.WindowManager._findDropTarget(c);if(c!=SimileAjax.WindowManager._potentialDropTarget&&(null!=SimileAjax.WindowManager._dropTargetHighlightElement&&(document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement),SimileAjax.WindowManager._dropTargetHighlightElement=null,SimileAjax.WindowManager._potentialDropTarget=null),e=!1,null!=c&&("canDropOn"in a&&!a.canDropOn(c)||"canDrop"in c&&!c.canDrop(SimileAjax.WindowManager._draggedElement)||
(e=!0)),e)){var h=SimileAjax.DOM.getPageCoordinates(c),k=document.createElement("div");k.style.border="4px solid yellow";k.style.backgroundColor="yellow";k.style.position="absolute";k.style.left=h.left+"px";k.style.top=h.top+"px";k.style.width=c.offsetWidth-8+"px";k.style.height=c.offsetHeight-8+"px";SimileAjax.Graphics.setOpacity(k,30);document.body.appendChild(k);SimileAjax.WindowManager._potentialDropTarget=c;SimileAjax.WindowManager._dropTargetHighlightElement=k}}}}catch(p){SimileAjax.Debug.exception("WindowManager: Error handling mouse move",
p),SimileAjax.WindowManager._cancelDragging()}else if(5<Math.abs(f)||5<Math.abs(d))try{if("onDragStart"in a)a.onDragStart();if("ghost"in a&&a.ghost){var l=SimileAjax.WindowManager._draggedElement;SimileAjax.WindowManager._ghostCoords=SimileAjax.DOM.getPageCoordinates(l);SimileAjax.WindowManager._ghostCoords.left+=f;SimileAjax.WindowManager._ghostCoords.top+=d;var m=l.cloneNode(!0);m.style.position="absolute";m.style.left=SimileAjax.WindowManager._ghostCoords.left+"px";m.style.top=SimileAjax.WindowManager._ghostCoords.top+
"px";m.style.zIndex=1E3;SimileAjax.Graphics.setOpacity(m,50);document.body.appendChild(m);a._ghostElmt=m}SimileAjax.WindowManager._dragging=!0;SimileAjax.WindowManager._lastCoords={x:b.clientX,y:b.clientY};document.body.focus()}catch(p){SimileAjax.Debug.exception("WindowManager: Error handling mouse down",p),SimileAjax.WindowManager._cancelDragging()}SimileAjax.DOM.cancelEvent(b);return!1}};
SimileAjax.WindowManager._onBodyMouseUp=function(a,b,c){if(null!=SimileAjax.WindowManager._draggedElement){try{if(SimileAjax.WindowManager._dragging){var d=SimileAjax.WindowManager._draggedElementCallback;if("onDragEnd"in d)d.onDragEnd();if("droppable"in d&&d.droppable&&(c=SimileAjax.WindowManager._potentialDropTarget,null!=c&&!("canDropOn"in d&&!d.canDropOn(c)||"canDrop"in c&&!c.canDrop(SimileAjax.WindowManager._draggedElement)))){if("onDropOn"in d)d.onDropOn(c);c.ondrop(SimileAjax.WindowManager._draggedElement,
SimileAjax.WindowManager._draggingMode)}}}finally{SimileAjax.WindowManager._cancelDragging()}SimileAjax.DOM.cancelEvent(b);return!1}};
SimileAjax.WindowManager._cancelDragging=function(){var a=SimileAjax.WindowManager._draggedElementCallback;"_ghostElmt"in a&&(document.body.removeChild(a._ghostElmt),delete a._ghostElmt);null!=SimileAjax.WindowManager._dropTargetHighlightElement&&(document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement),SimileAjax.WindowManager._dropTargetHighlightElement=null);null!=SimileAjax.WindowManager._draggingModeIndicatorElmt&&(document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt),
SimileAjax.WindowManager._draggingModeIndicatorElmt=null);SimileAjax.WindowManager._draggedElement=null;SimileAjax.WindowManager._draggedElementCallback=null;SimileAjax.WindowManager._potentialDropTarget=null;SimileAjax.WindowManager._dropTargetHighlightElement=null;SimileAjax.WindowManager._lastCoords=null;SimileAjax.WindowManager._ghostCoords=null;SimileAjax.WindowManager._draggingMode="";SimileAjax.WindowManager._dragging=!1};
SimileAjax.WindowManager._findDropTarget=function(a){for(;null!=a&&!("ondrop"in a&&"function"==typeof a.ondrop);)a=a.parentNode;return a};SimileAjax.RemoteLog={defaultURL:"http://groups.csail.mit.edu/haystack/facetlog/logger.php",url:null,logActive:!1};SimileAjax.RemoteLog.possiblyLog=function(a){if(SimileAjax.RemoteLog.logActive&&null!=SimileAjax.RemoteLog.url){a.url=window.location.href;try{SimileAjax.jQuery.ajax({type:"POST",url:SimileAjax.RemoteLog.url,data:a})}catch(b){}}};Timeline={};
Timeline.DateTime=window.SimileAjax.DateTime;Timeline.serverLocale="en";Timeline.clientLocale="en";Timeline.urlPrefix=Timeline_urlPrefix;
(function(){var a;S3.timeline.loadGDataCallback=function(e){e=e.feed.entry;for(var g=[],h=0;h<e.length;++h){var k=e[h];if(null!==k.gd$when){var l=k.gd$when[0],m=d(l.startTime);l=d(l.endTime);g.push({start:m,end:l,title:k.title.$t,description:k.content.$t,link:k.link[0].href})}}S3.timeline.data={dateTimeFormat:"iso8601",events:g};a.loadJSON(S3.timeline.data,".");e=S3.timeline.tl;e.hideLoadingMessage();e.layout()};var b=function(e){if(0>e)throw Error("n is negative");return 10>e?"0"+e:e},c=function(e){return e.getFullYear()+
"-"+b(e.getMonth()+1)+"-"+b(e.getDate())},d=function(e){e=e.match(/(\d{4})-(\d{2})-(\d{2})/);return new Date(parseInt(e[1],10),parseInt(e[2],10)-1,parseInt(e[3],10))};S3.timeline.onLoadCalendar=function(){a=new Timeline.DefaultEventSource;var e=document.getElementById("s3timeline"),g=Timeline.ClassicTheme.create();g.event.bubble.width=320;g.event.bubble.height=180;var h=new Date((new Date).getTime()+2592E5);g=[Timeline.createBandInfo({eventSource:a,date:h,width:"40%",intervalUnit:Timeline.DateTime.WEEK,
intervalPixels:300,theme:g}),Timeline.createBandInfo({eventSource:a,date:h,width:"60%",intervalUnit:Timeline.DateTime.MONTH,intervalPixels:550,theme:g})];g[1].syncWith=0;g[1].highlight=!0;e=Timeline.create(e,g);S3.timeline.tl=e;e.showLoadingMessage();e=S3.timeline.calendar;g=new Date((new Date).getDate());h=new Date((new Date).getTime()+7776E6);g="?start-min="+c(g)+"&start-max="+c(h)+"&alt=json-in-script&callback=S3.timeline.loadGDataCallback&max-results=5000";e+=g;g=document.createElement("script");
g.src=e;document.body.appendChild(g)};S3.timeline.onLoad=function(){a=new Timeline.DefaultEventSource;var e=document.getElementById("s3timeline"),g=Timeline.ClassicTheme.create();g.timeline_start=new Date(S3.timeline.tl_start);g.timeline_stop=new Date(S3.timeline.tl_end);g.event.bubble.width=320;g.event.bubble.height=180;var h=Timeline.DateTime.parseIso8601DateTime(S3.timeline.now);g=[Timeline.createBandInfo({width:"90%",intervalUnit:Timeline.DateTime.DAY,intervalPixels:140,eventSource:a,date:h,theme:g}),
Timeline.createBandInfo({overview:!0,width:"10%",intervalUnit:Timeline.DateTime.MONTH,intervalPixels:200,eventSource:a,date:h})];g[1].syncWith=0;g[1].highlight=!0;e=Timeline.create(e,g,Timeline.HORIZONTAL);a.loadJSON(S3.timeline.data,".");e.layout();S3.timeline.tl=e};var f=null;S3.timeline.onResize=function(){null===f&&(f=window.setTimeout(function(){f=null;S3.timeline.tl.layout()},500))}})();
$(document).ready(function(){$(window).on("load",function(){S3.timeline.calendar?(SimileAjax.History.enabled=!1,S3.timeline.onLoadCalendar()):S3.timeline.tl_start&&(SimileAjax.History.enabled=!1,S3.timeline.onLoad())});$(window).resize(function(){if(S3.timeline.tl)S3.timeline.onResize()})});Timeline.version="pre 2.4.0";Timeline.ajax_lib_version=SimileAjax.version;Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")";Timeline.strings={};Timeline.HORIZONTAL=0;
Timeline.VERTICAL=1;Timeline._defaultTheme=null;Timeline.getDefaultLocale=function(){return Timeline.clientLocale};Timeline.create=function(a,b,c,d){null==Timeline.timelines&&(Timeline.timelines=[]);var f=Timeline.timelines.length;Timeline.timelines[f]=null;a=new Timeline._Impl(a,b,c,d,f);return Timeline.timelines[f]=a};
Timeline.createBandInfo=function(a){var b="theme"in a?a.theme:Timeline.getDefaultTheme(),c="decorators"in a?a.decorators:[],d="eventSource"in a?a.eventSource:null,f=new Timeline.LinearEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,theme:b}),e=new Timeline.GregorianEtherPainter({unit:a.intervalUnit,multiple:"multiple"in a?a.multiple:1,theme:b,align:"align"in a?a.align:void 0}),g={showText:"showEventText"in
a?a.showEventText:!0,theme:b};if("eventPainterParams"in a)for(var h in a.eventPainterParams)g[h]=a.eventPainterParams[h];"trackHeight"in a&&(g.trackHeight=a.trackHeight);"trackGap"in a&&(g.trackGap=a.trackGap);h="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)g=new a.eventPainter(g);else switch(h){case "overview":g=new Timeline.OverviewEventPainter(g);break;case "detailed":g=new Timeline.DetailedEventPainter(g);break;default:g=new Timeline.OriginalEventPainter(g)}return{width:a.width,
eventSource:d,timeZone:"timeZone"in a?a.timeZone:0,ether:f,etherPainter:e,eventPainter:g,theme:b,decorators:c,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}};
Timeline.createHotZoneBandInfo=function(a){var b="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,d=new Timeline.HotZoneEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,zones:a.zones,theme:b}),f=new Timeline.HotZoneGregorianEtherPainter({unit:a.intervalUnit,zones:a.zones,theme:b,align:"align"in a?a.align:void 0}),e={showText:"showEventText"in a?a.showEventText:!0,theme:b};
if("eventPainterParams"in a)for(var g in a.eventPainterParams)e[g]=a.eventPainterParams[g];"trackHeight"in a&&(e.trackHeight=a.trackHeight);"trackGap"in a&&(e.trackGap=a.trackGap);g="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)e=new a.eventPainter(e);else switch(g){case "overview":e=new Timeline.OverviewEventPainter(e);break;case "detailed":e=new Timeline.DetailedEventPainter(e);break;default:e=new Timeline.OriginalEventPainter(e)}return{width:a.width,
eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:d,etherPainter:f,eventPainter:e,theme:b,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}};Timeline.getDefaultTheme=function(){null==Timeline._defaultTheme&&(Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale()));return Timeline._defaultTheme};Timeline.setDefaultTheme=function(a){Timeline._defaultTheme=a};
Timeline.loadXML=function(a,b){SimileAjax.XmlHttp.get(a,function(c,d,f){alert("Failed to load data xml from "+a+"\n"+c)},function(c){var d=c.responseXML;!d.documentElement&&c.responseStream&&d.load(c.responseStream);b(d,a)})};Timeline.loadJSON=function(a,b){SimileAjax.XmlHttp.get(a,function(c,d,f){alert("Failed to load json data from "+a+"\n"+c)},function(c){b(eval("("+c.responseText+")"),a)})};Timeline.getTimelineFromID=function(a){return Timeline.timelines[a]};
Timeline.writeVersion=function(a){document.getElementById(a).innerHTML=this.display_version};
Timeline._Impl=function(a,b,c,d,f){SimileAjax.WindowManager.initialize();this._containerDiv=a;this._bandInfos=b;this._orientation=null==c?Timeline.HORIZONTAL:c;this._unit=null!=d?d:SimileAjax.NativeDateUnit;this._starting=!0;this._autoResizing=!1;this.autoWidth=b&&b[0]&&b[0].theme&&b[0].theme.autoWidth;this.autoWidthAnimationTime=b&&b[0]&&b[0].theme&&b[0].theme.autoWidthAnimationTime;this.timelineID=f;this.timeline_start=b&&b[0]&&b[0].theme&&b[0].theme.timeline_start;this.timeline_stop=b&&b[0]&&b[0].theme&&
b[0].theme.timeline_stop;this.timeline_at_stop=this.timeline_at_start=!1;this._initialize()};Timeline._Impl.prototype.dispose=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].dispose();this._bandInfos=this._bands=null;this._containerDiv.innerHTML="";Timeline.timelines[this.timelineID]=null};Timeline._Impl.prototype.getBandCount=function(){return this._bands.length};Timeline._Impl.prototype.getBand=function(a){return this._bands[a]};
Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(!0);this._starting=!1};Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(!0);this._distributeWidths()};Timeline._Impl.prototype.paint=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].paint()};Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument};Timeline._Impl.prototype.addDiv=function(a){this._containerDiv.appendChild(a)};
Timeline._Impl.prototype.removeDiv=function(a){this._containerDiv.removeChild(a)};Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL};Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL};Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};
Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};Timeline._Impl.prototype.getUnit=function(){return this._unit};Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"};
Timeline._Impl.prototype.loadXML=function(a,b){var c=this,d=function(e,g,h){alert("Failed to load data xml from "+a+"\n"+e);c.hideLoadingMessage()},f=function(e){try{var g=e.responseXML;!g.documentElement&&e.responseStream&&g.load(e.responseStream);b(g,a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,d,f)},0)};
Timeline._Impl.prototype.loadJSON=function(a,b){var c=this,d=function(e,g,h){alert("Failed to load json data from "+a+"\n"+e);c.hideLoadingMessage()},f=function(e){try{b(eval("("+e.responseText+")"),a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,d,f)},0)};Timeline._Impl.prototype._autoWidthScrollListener=function(a){a.getTimeline()._autoWidthCheck(!1)};
Timeline._Impl.prototype._autoWidthCheck=function(a){function b(){var e=c.getWidthStyle();if(d)c._containerDiv.style[e]=f+"px";else{c._autoResizing=!0;var g={};g[e]=f+"px";SimileAjax.jQuery(c._containerDiv).animate(g,c.autoWidthAnimationTime,"linear",function(){c._autoResizing=!1})}}var c=this,d=c._starting,f=0;c.autoWidth&&function(){var e=0,g=c.getPixelWidth();if(!c._autoResizing){for(var h=0;h<c._bands.length;h++)c._bands[h].checkAutoWidth(),e+=c._bandInfos[h].width;if(e>g||a)f=e,b(),c._distributeWidths()}}()};
Timeline._Impl.prototype._initialize=function(){var a=this._containerDiv,b=a.ownerDocument;a.className=a.className.split(" ").concat("timeline-container").join(" ");var c=this.isHorizontal()?"horizontal":"vertical";for(a.className+=" timeline-"+c;a.firstChild;)a.removeChild(a.firstChild);c=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));c.className="timeline-copyright";c.title="SIMILE Timeline - http://www.simile-widgets.org/";
SimileAjax.DOM.registerEvent(c,"click",function(){window.location="http://www.simile-widgets.org/"});a.appendChild(c);this._bands=[];for(c=0;c<this._bandInfos.length;c++){var d=new Timeline._Band(this,this._bandInfos[c],c);this._bands.push(d)}this._distributeWidths();for(c=0;c<this._bandInfos.length;c++)d=this._bandInfos[c],"syncWith"in d&&this._bands[c].setSyncWithBand(this._bands[d.syncWith],"highlight"in d?d.highlight:!1);if(this.autoWidth)for(c=0;c<this._bands.length;c++)this._bands[c].addOnScrollListener(this._autoWidthScrollListener);
var f=SimileAjax.Graphics.createMessageBubble(b);f.containerDiv.className="timeline-message-container";a.appendChild(f.containerDiv);f.contentDiv.className="timeline-message";f.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){f.containerDiv.style.display="block"};this.hideLoadingMessage=function(){f.containerDiv.style.display="none"}};
Timeline._Impl.prototype._distributeWidths=function(){for(var a=this.getPixelLength(),b=this.getPixelWidth(),c=0,d=0;d<this._bands.length;d++){var f=this._bands[d],e=this._bandInfos[d].width;if("string"==typeof e){var g=e.indexOf("%");0<g?(e=parseInt(e.substr(0,g)),e=Math.round(e*b/100)):e=parseInt(e)}f.setBandShiftAndWidth(c,e);f.setViewLength(a);c+=e}};
Timeline._Impl.prototype.shiftOK=function(a,b){var c=0<b,d=0>b;if(c&&null==this.timeline_start||d&&null==this.timeline_stop||0==b)return!0;for(var f=!1,e=0;e<this._bands.length&&!f;e++)f=this._bands[e].busy();if(f)return!0;if(c&&this.timeline_at_start||d&&this.timeline_at_stop)return!1;d=!1;for(e=0;e<this._bands.length&&!d;e++)d=this._bands[e],d=c?(e==a?d.getMinVisibleDateAfterDelta(b):d.getMinVisibleDate())>=this.timeline_start:(e==a?d.getMaxVisibleDateAfterDelta(b):d.getMaxVisibleDate())<=this.timeline_stop;
c?(this.timeline_at_start=!d,this.timeline_at_stop=!1):(this.timeline_at_stop=!d,this.timeline_at_start=!1);return d};Timeline._Impl.prototype.zoom=function(a,b,c,d){var f=null,e=/^timeline-band-([0-9]+)$/.exec(d.id);e&&(f=parseInt(e[1]));null!=f&&this._bands[f].zoom(a,b,c,d);this.paint()};
Timeline._Band=function(a,b,c){a.autoWidth&&"string"==typeof b.width&&(b.width=-1<b.width.indexOf("%")?0:parseInt(b.width));this._timeline=a;this._bandInfo=b;this._index=c;this._locale="locale"in b?b.locale:Timeline.getDefaultLocale();this._timeZone="timeZone"in b?b.timeZone:0;this._labeller="labeller"in b?b.labeller:"createLabeller"in a.getUnit()?a.getUnit().createLabeller(this._locale,this._timeZone):new Timeline.GregorianDateLabeller(this._locale,this._timeZone);this._theme=b.theme;this._zoomIndex=
"zoomIndex"in b?b.zoomIndex:0;this._zoomSteps="zoomSteps"in b?b.zoomSteps:null;this._changing=this._dragging=!1;this._scrollSpeed=this._originalScrollSpeed=5;this._onScrollListeners=[];this._orthogonalDragging=!1;this._viewOrthogonalOffset=0;this._onOrthogonalScrollListeners=[];var d=this;this._syncWithBand=null;this._syncWithBandHandler=function(e){d._onHighlightBandScroll()};this._syncWithBandOrthogonalScrollHandler=function(e){d._onHighlightBandOrthogonalScroll()};this._selectorListener=function(e){d._onHighlightBandScroll()};
var f=this._timeline.getDocument().createElement("div");f.className="timeline-band-input";this._timeline.addDiv(f);this._keyboardInput=document.createElement("input");this._keyboardInput.type="text";f.appendChild(this._keyboardInput);SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown");SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp");this._div=this._timeline.getDocument().createElement("div");this._div.id="timeline-band-"+c;this._div.className=
"timeline-band timeline-band-"+c;this._timeline.addDiv(this._div);SimileAjax.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick");SimileAjax.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown");SimileAjax.DOM.registerEventWithObject(document.body,"mousemove",this,"_onMouseMove");SimileAjax.DOM.registerEventWithObject(document.body,"mouseup",this,"_onMouseUp");SimileAjax.DOM.registerEventWithObject(document.body,"mouseout",this,"_onMouseOut");f=null!=this._theme?this._theme.mouseWheel:
"scroll";if("zoom"===f||"scroll"===f||this._zoomSteps)SimileAjax.Platform.browser.isFirefox?SimileAjax.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll"):SimileAjax.DOM.registerEventWithObject(this._div,"mousewheel",this,"_onMouseScroll");this._innerDiv=this._timeline.getDocument().createElement("div");this._innerDiv.className="timeline-band-inner";this._div.appendChild(this._innerDiv);this._ether=b.ether;b.ether.initialize(this,a);this._etherPainter=b.etherPainter;b.etherPainter.initialize(this,
a);if(this._eventSource=b.eventSource)this._eventListener={onAddMany:function(){d._onAddMany()},onClear:function(){d._onClear()}},this._eventSource.addListener(this._eventListener);this._eventPainter=b.eventPainter;this._eventTrackIncrement=this._eventTracksNeeded=0;b.eventPainter.initialize(this,a);this._decorators="decorators"in b?b.decorators:[];for(b=0;b<this._decorators.length;b++)this._decorators[b].initialize(this,a);if(this._supportsOrthogonalScrolling="supportsOrthogonalScrolling"in this._eventPainter&&
this._eventPainter.supportsOrthogonalScrolling())this._scrollBar=this._timeline.getDocument().createElement("div"),this._scrollBar.id="timeline-band-scrollbar-"+c,this._scrollBar.className="timeline-band-scrollbar",this._timeline.addDiv(this._scrollBar),this._scrollBar.innerHTML='<div class="timeline-band-scrollbar-thumb"> </div>',a=this._scrollBar.firstChild,a.style.cursor=SimileAjax.Platform.browser.isIE?"move":"-moz-grab",SimileAjax.DOM.registerEventWithObject(a,"mousedown",this,"_onScrollBarMouseDown")};
Timeline._Band.SCROLL_MULTIPLES=5;
Timeline._Band.prototype.dispose=function(){this.closeBubble();this._eventSource&&(this._eventSource.removeListener(this._eventListener),this._eventSource=this._eventListener=null);this._scrollBar=this._keyboardInput=this._innerDiv=this._div=this._selectorListener=this._syncWithBandOrthogonalScrollHandler=this._syncWithBandHandler=this._onScrollListeners=this._decorators=this._eventPainter=this._etherPainter=this._ether=this._labeller=this._bandInfo=this._timeline=null};
Timeline._Band.prototype.addOnScrollListener=function(a){this._onScrollListeners.push(a)};Timeline._Band.prototype.removeOnScrollListener=function(a){for(var b=0;b<this._onScrollListeners.length;b++)if(this._onScrollListeners[b]==a){this._onScrollListeners.splice(b,1);break}};Timeline._Band.prototype.addOnOrthogonalScrollListener=function(a){this._onOrthogonalScrollListeners.push(a)};
Timeline._Band.prototype.removeOnOrthogonalScrollListener=function(a){for(var b=0;b<this._onOrthogonalScrollListeners.length;b++)if(this._onOrthogonalScrollListeners[b]==a){this._onOrthogonalScrollListeners.splice(b,1);break}};
Timeline._Band.prototype.setSyncWithBand=function(a,b){this._syncWithBand&&(this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler),this._syncWithBand.removeOnOrthogonalScrollListener(this._syncWithBandOrthogonalScrollHandler));this._syncWithBand=a;this._syncWithBand.addOnScrollListener(this._syncWithBandHandler);this._syncWithBand.addOnOrthogonalScrollListener(this._syncWithBandOrthogonalScrollHandler);this._highlight=b;this._positionHighlight()};Timeline._Band.prototype.getLocale=function(){return this._locale};
Timeline._Band.prototype.getTimeZone=function(){return this._timeZone};Timeline._Band.prototype.getLabeller=function(){return this._labeller};Timeline._Band.prototype.getIndex=function(){return this._index};Timeline._Band.prototype.getEther=function(){return this._ether};Timeline._Band.prototype.getEtherPainter=function(){return this._etherPainter};Timeline._Band.prototype.getEventSource=function(){return this._eventSource};Timeline._Band.prototype.getEventPainter=function(){return this._eventPainter};
Timeline._Band.prototype.getTimeline=function(){return this._timeline};Timeline._Band.prototype.updateEventTrackInfo=function(a,b){this._eventTrackIncrement=b;a>this._eventTracksNeeded&&(this._eventTracksNeeded=a)};
Timeline._Band.prototype.checkAutoWidth=function(){if(this._timeline.autoWidth){var a="overview"==this._eventPainter.getType(),b=Math.ceil((this._eventTracksNeeded+(a?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin))*this._eventTrackIncrement);b+=a?this._theme.event.overviewTrack.offset:this._theme.event.track.offset;a=this._bandInfo;b!=a.width&&(a.width=b)}};Timeline._Band.prototype.layout=function(){this.paint()};
Timeline._Band.prototype.paint=function(){this._etherPainter.paint();this._paintDecorators();this._paintEvents()};Timeline._Band.prototype.softLayout=function(){this.softPaint()};Timeline._Band.prototype.softPaint=function(){this._etherPainter.softPaint();this._softPaintDecorators();this._softPaintEvents()};
Timeline._Band.prototype.setBandShiftAndWidth=function(a,b){var c=this._keyboardInput.parentNode,d=a+Math.floor(b/2);this._timeline.isHorizontal()?(this._div.style.top=a+"px",this._div.style.height=b+"px",c.style.top=d+"px",c.style.left="-1em"):(this._div.style.left=a+"px",this._div.style.width=b+"px",c.style.left=d+"px",c.style.top="-1em")};Timeline._Band.prototype.getViewWidth=function(){return this._timeline.isHorizontal()?this._div.offsetHeight:this._div.offsetWidth};
Timeline._Band.prototype.setViewLength=function(a){this._viewLength=a;this._recenterDiv();this._onChanging()};Timeline._Band.prototype.getViewLength=function(){return this._viewLength};Timeline._Band.prototype.getTotalViewLength=function(){return Timeline._Band.SCROLL_MULTIPLES*this._viewLength};Timeline._Band.prototype.getViewOffset=function(){return this._viewOffset};Timeline._Band.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)};
Timeline._Band.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+Timeline._Band.SCROLL_MULTIPLES*this._viewLength)};Timeline._Band.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)};Timeline._Band.prototype.getMinVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(a)};Timeline._Band.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)};
Timeline._Band.prototype.getMaxVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(this._viewLength+a)};Timeline._Band.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)};Timeline._Band.prototype.setMinVisibleDate=function(a){this._changing||this._moveEther(Math.round(-this._ether.dateToPixelOffset(a)))};Timeline._Band.prototype.setMaxVisibleDate=function(a){this._changing||this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(a)))};
Timeline._Band.prototype.setCenterVisibleDate=function(a){this._changing||this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)))};Timeline._Band.prototype.dateToPixelOffset=function(a){return this._ether.dateToPixelOffset(a)-this._viewOffset};Timeline._Band.prototype.pixelOffsetToDate=function(a){return this._ether.pixelOffsetToDate(a+this._viewOffset)};Timeline._Band.prototype.getViewOrthogonalOffset=function(){return this._viewOrthogonalOffset};
Timeline._Band.prototype.setViewOrthogonalOffset=function(a){this._viewOrthogonalOffset=Math.max(0,a)};Timeline._Band.prototype.createLayerDiv=function(a,b){var c=this._timeline.getDocument().createElement("div");c.className="timeline-band-layer"+("string"==typeof b?" "+b:"");c.style.zIndex=a;this._innerDiv.appendChild(c);a=this._timeline.getDocument().createElement("div");a.className="timeline-band-layer-inner";a.style.cursor=SimileAjax.Platform.browser.isIE?"move":"-moz-grab";c.appendChild(a);return a};
Timeline._Band.prototype.removeLayerDiv=function(a){this._innerDiv.removeChild(a.parentNode)};Timeline._Band.prototype.scrollToCenter=function(a,b){var c=this._ether.dateToPixelOffset(a);c<-this._viewLength/2?this.setCenterVisibleDate(this.pixelOffsetToDate(c+this._viewLength)):c>3*this._viewLength/2&&this.setCenterVisibleDate(this.pixelOffsetToDate(c-this._viewLength));this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)),b)};
Timeline._Band.prototype.showBubbleForEvent=function(a){var b=this.getEventSource().getEvent(a);if(b){var c=this;this.scrollToCenter(b.getStart(),function(){c._eventPainter.showBubble(b)})}};Timeline._Band.prototype.zoom=function(a,b,c,d){this._zoomSteps&&(b+=this._viewOffset,c=this._ether.pixelOffsetToDate(b),a=this._ether.zoom(a),this._etherPainter.zoom(a),this._moveEther(Math.round(-this._ether.dateToPixelOffset(c))),this._moveEther(b))};
Timeline._Band.prototype._onMouseDown=function(a,b,c){if(!this._dragging)return this.closeBubble(),this._dragging=!0,this._dragX=b.clientX,this._dragY=b.clientY,this._cancelEvent(b)};
Timeline._Band.prototype._onMouseMove=function(a,b,c){if(this._dragging||this._orthogonalDragging){var d=b.clientX-this._dragX,f=b.clientY-this._dragY;this._dragX=b.clientX;this._dragY=b.clientY}if(this._dragging)this._timeline.isHorizontal()?this._moveEther(d,f):this._moveEther(f,d);else if(this._orthogonalDragging)a=this.getViewWidth(),c=this._scrollBar.firstChild,this._timeline.isHorizontal()?this._moveEther(0,-f*a/c.offsetHeight):this._moveEther(0,-d*a/c.offsetWidth);else return;this._positionHighlight();
this._showScrollbar();return this._cancelEvent(b)};Timeline._Band.prototype._onMouseUp=function(a,b,c){if(this._dragging)this._dragging=!1;else if(this._orthogonalDragging)this._orthogonalDragging=!1;else return;this._keyboardInput.focus();this._bounceBack();return this._cancelEvent(b)};Timeline._Band.prototype._onMouseOut=function(a,b,c){if(c==document.body){if(this._dragging)this._dragging=!1;else if(this._orthogonalDragging)this._orthogonalDragging=!1;else return;this._bounceBack();return this._cancelEvent(b)}};
Timeline._Band.prototype._onScrollBarMouseDown=function(a,b,c){if(!this._orthogonalDragging)return this.closeBubble(),this._orthogonalDragging=!0,this._dragX=b.clientX,this._dragY=b.clientY,this._cancelEvent(b)};
Timeline._Band.prototype._onMouseScroll=function(a,b,c){c=new Date;c=c.getTime();if(!this._lastScrollTime||50<c-this._lastScrollTime){this._lastScrollTime=c;c=0;b.wheelDelta?c=b.wheelDelta/120:b.detail&&(c=-b.detail/3);var d=this._theme.mouseWheel;if(this._zoomSteps||"zoom"===d){if(d=SimileAjax.DOM.getEventRelativeCoordinates(b,a),0!=c){var f;0<c&&(f=!0);0>c&&(f=!1);this._timeline.zoom(f,d.x,d.y,a)}}else"scroll"===d&&this._moveEther(50*(0>c?-1:1))}b.stopPropagation&&b.stopPropagation();b.cancelBubble=
!0;b.preventDefault&&b.preventDefault();b.returnValue=!1};Timeline._Band.prototype._onDblClick=function(a,b,c){a=SimileAjax.DOM.getEventRelativeCoordinates(b,a).x-(this._viewLength/2-this._viewOffset);this._autoScroll(-a)};
Timeline._Band.prototype._onKeyDown=function(a,b,c){if(!this._dragging){switch(b.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(1.05*this._scrollSpeed));this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(1.05*this._scrollSpeed));this._moveEther(this._scrollSpeed);break;default:return!0}this.closeBubble();SimileAjax.DOM.cancelEvent(b);return!1}return!0};
Timeline._Band.prototype._onKeyUp=function(a,b,c){if(!this._dragging){this._scrollSpeed=this._originalScrollSpeed;switch(b.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return!0}this.closeBubble();SimileAjax.DOM.cancelEvent(b);return!1}return!0};
Timeline._Band.prototype._autoScroll=function(a,b){var c=this;SimileAjax.Graphics.createAnimation(function(d,f){c._moveEther(f)},0,a,1E3,b).run()};
Timeline._Band.prototype._moveEther=function(a,b){void 0===b&&(b=0);this.closeBubble();this._timeline.shiftOK(this._index,a)&&(this._viewOffset+=a,this._ether.shiftPixels(-a),this._timeline.isHorizontal()?this._div.style.left=this._viewOffset+"px":this._div.style.top=this._viewOffset+"px",this._supportsOrthogonalScrolling&&(this._eventPainter.getOrthogonalExtent()<=this.getViewWidth()?this._viewOrthogonalOffset=0:this._viewOrthogonalOffset+=b),this._viewOffset>.5*-this._viewLength||this._viewOffset<
-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1.5)?this._recenterDiv():this.softLayout(),this._onChanging())};Timeline._Band.prototype._onChanging=function(){this._changing=!0;this._fireOnScroll();this._setSyncWithBandDate();this._changing=!1};Timeline._Band.prototype.busy=function(){return this._changing};Timeline._Band.prototype._fireOnScroll=function(){for(var a=0;a<this._onScrollListeners.length;a++)this._onScrollListeners[a](this)};
Timeline._Band.prototype._fireOnOrthogonalScroll=function(){for(var a=0;a<this._onOrthogonalScrollListeners.length;a++)this._onOrthogonalScrollListeners[a](this)};Timeline._Band.prototype._setSyncWithBandDate=function(){if(this._syncWithBand){var a=this._ether.pixelOffsetToDate(this.getViewLength()/2);this._syncWithBand.setCenterVisibleDate(a)}};
Timeline._Band.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var a=this._syncWithBand.getCenterVisibleDate();a=this._ether.dateToPixelOffset(a);this._moveEther(Math.round(this._viewLength/2-a));this._positionHighlight()}};Timeline._Band.prototype._onHighlightBandOrthogonalScroll=function(){this._syncWithBand&&this._positionHighlight()};Timeline._Band.prototype._onAddMany=function(){this._paintEvents()};Timeline._Band.prototype._onClear=function(){this._paintEvents()};
Timeline._Band.prototype._positionHighlight=function(){if(this._syncWithBand){var a=this._syncWithBand.getMinVisibleDate(),b=this._syncWithBand.getMaxVisibleDate();if(this._highlight){var c=0,d=1,f=this._syncWithBand.getEventPainter();"supportsOrthogonalScrolling"in f&&f.supportsOrthogonalScrolling()&&(c=f.getOrthogonalExtent(),d=this._syncWithBand.getViewWidth(),c=Math.max(d,c),d/=c,c=-this._syncWithBand.getViewOrthogonalOffset()/c);this._etherPainter.setHighlight(a,b,c,d)}}};
Timeline._Band.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1)/2;this._timeline.isHorizontal()?(this._div.style.left=this._viewOffset+"px",this._div.style.width=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px"):(this._div.style.top=this._viewOffset+"px",this._div.style.height=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px");this.layout()};
Timeline._Band.prototype._paintEvents=function(){this._eventPainter.paint();this._showScrollbar();this._fireOnOrthogonalScroll()};Timeline._Band.prototype._softPaintEvents=function(){this._eventPainter.softPaint()};Timeline._Band.prototype._paintDecorators=function(){for(var a=0;a<this._decorators.length;a++)this._decorators[a].paint()};Timeline._Band.prototype._softPaintDecorators=function(){for(var a=0;a<this._decorators.length;a++)this._decorators[a].softPaint()};
Timeline._Band.prototype.closeBubble=function(){SimileAjax.WindowManager.cancelPopups()};
Timeline._Band.prototype._bounceBack=function(a){if(this._supportsOrthogonalScrolling)if(a=0,0>this._viewOrthogonalOffset&&(a=this._eventPainter.getOrthogonalExtent(),a=this._viewOrthogonalOffset+a>=this.getViewWidth()?this._viewOrthogonalOffset:Math.min(0,this.getViewWidth()-a)),a!=this._viewOrthogonalOffset){var b=this;SimileAjax.Graphics.createAnimation(function(c,d){b._viewOrthogonalOffset=c;b._eventPainter.softPaint();b._showScrollbar();b._fireOnOrthogonalScroll()},this._viewOrthogonalOffset,
a,300,function(){b._hideScrollbar()}).run()}else this._hideScrollbar()};
Timeline._Band.prototype._showScrollbar=function(){if(this._supportsOrthogonalScrolling){var a=this._eventPainter.getOrthogonalExtent(),b=this.getViewWidth();a=b/Math.max(b,a);b=Math.round(b*a)+"px";var c=Math.round(-this._viewOrthogonalOffset*a)+"px",d=this._scrollBar.firstChild;this._timeline.isHorizontal()?(this._scrollBar.style.top=this._div.style.top,this._scrollBar.style.height=this._div.style.height,this._scrollBar.style.right="0px",this._scrollBar.style.width="12px",d.style.top=c,d.style.height=
b):(this._scrollBar.style.left=this._div.style.left,this._scrollBar.style.width=this._div.style.width,this._scrollBar.style.bottom="0px",this._scrollBar.style.height="12px",d.style.left=c,d.style.width=b);this._scrollBar.style.display=1<=a&&0==this._viewOrthogonalOffset?"none":"block"}};Timeline._Band.prototype._hideScrollbar=function(){};Timeline._Band.prototype._cancelEvent=function(a){SimileAjax.DOM.cancelEvent(a);return!1};Timeline.ClassicTheme={};Timeline.ClassicTheme.implementations=[];
Timeline.ClassicTheme.create=function(a){null==a&&(a=Timeline.getDefaultLocale());a=Timeline.ClassicTheme.implementations[a];null==a&&(a=Timeline.ClassicTheme._Impl);return new a};
Timeline.ClassicTheme._Impl=function(){this.firstDayOfWeek=0;this.autoWidth=!1;this.autoWidthAnimationTime=500;this.timeline_stop=this.timeline_start=null;this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:!0,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}};this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:Timeline.urlPrefix+"images/dull-blue-circle.png",
iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:!1,bubble:{width:250,maxHeight:0,titleStyler:function(a){a.className="timeline-event-bubble-title"},bodyStyler:function(a){a.className="timeline-event-bubble-body"},imageStyler:function(a){a.className="timeline-event-bubble-image"},wikiStyler:function(a){a.className="timeline-event-bubble-wiki"},
timeStyler:function(a){a.className="timeline-event-bubble-time"}}};this.mouseWheel="scroll"};Timeline.LinearEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval};
Timeline.LinearEther.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._unit=b.getUnit();"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):(this._start="centersOn"in this._params?this._unit.parseFromObject(this._params.centersOn):this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/
2))};Timeline.LinearEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.LinearEther.prototype.shiftPixels=function(a){this._start=this._unit.change(this._start,this._interval*a/this._pixelsPerInterval)};Timeline.LinearEther.prototype.dateToPixelOffset=function(a){a=this._unit.compare(a,this._start);return this._pixelsPerInterval*a/this._interval};Timeline.LinearEther.prototype.pixelOffsetToDate=function(a){return this._unit.change(this._start,a*this._interval/this._pixelsPerInterval)};
Timeline.LinearEther.prototype.zoom=function(a){var b=this._band._zoomIndex,c=b;a&&0<b&&(c=b-1);!a&&b<this._band._zoomSteps.length-1&&(c=b+1);this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;return this._band._zoomSteps[c].unit-this._band._zoomSteps[b].unit};
Timeline.HotZoneEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval;this._theme=a.theme};
Timeline.HotZoneEther.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._unit=b.getUnit();this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,magnify:1}];a=this._params;for(b=0;b<a.zones.length;b++)for(var c=a.zones[b],d=this._unit.parseFromObject(c.start),f=this._unit.parseFromObject(c.end),e=0;e<this._zones.length&&0<this._unit.compare(f,d);e++){var g=this._zones[e];0>this._unit.compare(d,g.endTime)&&(0<this._unit.compare(d,g.startTime)&&(this._zones.splice(e,
0,{startTime:g.startTime,endTime:d,magnify:g.magnify}),e++,g.startTime=d),0>this._unit.compare(f,g.endTime)?(this._zones.splice(e,0,{startTime:d,endTime:f,magnify:c.magnify*g.magnify}),e++,d=g.startTime=f):(g.magnify*=c.magnify,d=g.endTime))}"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):(this._start="centersOn"in this._params?
this._unit.parseFromObject(this._params.centersOn):this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))};Timeline.HotZoneEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.HotZoneEther.prototype.shiftPixels=function(a){this._start=this.pixelOffsetToDate(a)};Timeline.HotZoneEther.prototype.dateToPixelOffset=function(a){return this._dateDiffToPixelOffset(this._start,a)};
Timeline.HotZoneEther.prototype.pixelOffsetToDate=function(a){return this._pixelOffsetToDate(a,this._start)};Timeline.HotZoneEther.prototype.zoom=function(a){var b=this._band._zoomIndex,c=b;a&&0<b&&(c=b-1);!a&&b<this._band._zoomSteps.length-1&&(c=b+1);this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;return this._band._zoomSteps[c].unit-this._band._zoomSteps[b].unit};
Timeline.HotZoneEther.prototype._dateDiffToPixelOffset=function(a,b){var c=this._getScale(),d=0;if(0>this._unit.compare(a,b)){for(var f=0;f<this._zones.length&&!(0>this._unit.compare(a,this._zones[f].endTime));)f++;for(;0>this._unit.compare(a,b);){var e=this._zones[f],g=this._unit.earlier(b,e.endTime);d+=this._unit.compare(g,a)/(c/e.magnify);a=g;f++}}else{for(f=this._zones.length-1;0<=f&&!(0<this._unit.compare(a,this._zones[f].startTime));)f--;for(;0<this._unit.compare(a,b);)e=this._zones[f],g=this._unit.later(b,
e.startTime),d+=this._unit.compare(g,a)/(c/e.magnify),a=g,f--}return d};
Timeline.HotZoneEther.prototype._pixelOffsetToDate=function(a,b){var c=this._getScale();if(0<a){for(var d=0;d<this._zones.length&&!(0>this._unit.compare(b,this._zones[d].endTime));)d++;for(;0<a;){var f=this._zones[d],e=c/f.magnify;if(f.endTime==Number.POSITIVE_INFINITY)b=this._unit.change(b,a*e),a=0;else{var g=this._unit.compare(f.endTime,b)/e;g>a?(b=this._unit.change(b,a*e),a=0):(b=f.endTime,a-=g)}d++}}else{for(d=this._zones.length-1;0<=d&&!(0<this._unit.compare(b,this._zones[d].startTime));)d--;
for(a=-a;0<a;)f=this._zones[d],e=c/f.magnify,f.startTime==Number.NEGATIVE_INFINITY?(b=this._unit.change(b,-a*e),a=0):(g=this._unit.compare(b,f.startTime)/e,g>a?(b=this._unit.change(b,-a*e),a=0):(b=f.startTime,a-=g)),d--}return b};Timeline.HotZoneEther.prototype._getScale=function(){return this._interval/this._pixelsPerInterval};Timeline.GregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._unit=a.unit;this._multiple="multiple"in a?a.multiple:1};
Timeline.GregorianEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;a="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,
this._band,this._theme,a,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.GregorianEtherPainter.prototype.setHighlight=function(a,b,c,d){this._highlight.position(a,b,c,d)};
Timeline.GregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate(),
c=this._band.getTimeZone(),d=this._band.getLabeller();for(SimileAjax.DateTime.roundDownToInterval(a,this._unit,c,this._multiple,this._theme.firstDayOfWeek);a.getTime()<b.getTime();){this._intervalMarkerLayout.createIntervalMarker(a,d,this._unit,this._markerLayer,this._lineLayer);c=a;for(var f=0;f<this._multiple;f++)SimileAjax.DateTime.incrementByInterval(c,this._unit)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};
Timeline.GregorianEtherPainter.prototype.softPaint=function(){};Timeline.GregorianEtherPainter.prototype.zoom=function(a){0!=a&&(this._unit+=a)};
Timeline.HotZoneGregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:a.unit,multiple:1}];for(var b=0;b<a.zones.length;b++)for(var c=a.zones[b],d=SimileAjax.DateTime.parseGregorianDateTime(c.start).getTime(),f=SimileAjax.DateTime.parseGregorianDateTime(c.end).getTime(),e=0;e<this._zones.length&&f>d;e++){var g=this._zones[e];d<g.endTime&&(d>g.startTime&&(this._zones.splice(e,0,{startTime:g.startTime,
endTime:d,unit:g.unit,multiple:g.multiple}),e++,g.startTime=d),f<g.endTime?(this._zones.splice(e,0,{startTime:d,endTime:f,unit:c.unit,multiple:c.multiple?c.multiple:1}),e++,d=g.startTime=f):(g.multiple=c.multiple,g.unit=c.unit,d=g.endTime))}};
Timeline.HotZoneGregorianEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;a="align"in this._params&&void 0!=this._params.align?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,
this._band,this._theme,a,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.HotZoneGregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.HotZoneGregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";for(var a=this._band.getMinDate(),b=
this._band.getMaxDate(),c=this._band.getTimeZone(),d=this._band.getLabeller(),f=0;f<this._zones.length&&!(a.getTime()<this._zones[f].endTime);)f++;for(var e=this._zones.length-1;0<=e&&!(b.getTime()>this._zones[e].startTime);)e--;for(;f<=e;f++){var g=this._zones[f],h=new Date(Math.max(a.getTime(),g.startTime)),k=new Date(Math.min(b.getTime(),g.endTime));SimileAjax.DateTime.roundDownToInterval(h,g.unit,c,g.multiple,this._theme.firstDayOfWeek);for(SimileAjax.DateTime.roundUpToInterval(k,g.unit,c,g.multiple,
this._theme.firstDayOfWeek);h.getTime()<k.getTime();){this._intervalMarkerLayout.createIntervalMarker(h,d,g.unit,this._markerLayer,this._lineLayer);for(var l=h,m=g,p=0;p<m.multiple;p++)SimileAjax.DateTime.incrementByInterval(l,m.unit)}}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.HotZoneGregorianEtherPainter.prototype.softPaint=function(){};
Timeline.HotZoneGregorianEtherPainter.prototype.zoom=function(a){if(0!=a)for(var b=0;b<this._zones.length;++b)this._zones[b]&&(this._zones[b].unit+=a)};Timeline.YearCountEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate);this._multiple="multiple"in a?a.multiple:1};
Timeline.YearCountEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;a="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,
a,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.YearCountEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.YearCountEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=new Date(this._startDate.getTime()),b=
this._band.getMaxDate(),c=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();a.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-c%this._multiple);var d=this;c=function(e){for(var g=0;g<d._multiple;g++)SimileAjax.DateTime.incrementByInterval(e,SimileAjax.DateTime.YEAR)};for(var f={labelInterval:function(e,g){e=e.getUTCFullYear()-d._startDate.getUTCFullYear();return{text:e,emphasized:0==e}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,f,SimileAjax.DateTime.YEAR,
this._markerLayer,this._lineLayer),c(a);this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.YearCountEtherPainter.prototype.softPaint=function(){};Timeline.QuarterlyEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate)};
Timeline.QuarterlyEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;a="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,
a,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.QuarterlyEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.QuarterlyEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=new Date(0),b=this._band.getMaxDate();
a.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear()));a.setUTCMonth(this._startDate.getUTCMonth());for(var c=this,d={labelInterval:function(f,e){e=(4+(f.getUTCMonth()-c._startDate.getUTCMonth())/3)%4;return 0!=e?{text:"Q"+(e+1),emphasized:!1}:{text:"Y"+(f.getUTCFullYear()-c._startDate.getUTCFullYear()+1),emphasized:!0}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,d,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer),
a.setUTCMonth(a.getUTCMonth()+3);this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.QuarterlyEtherPainter.prototype.softPaint=function(){};
Timeline.EtherIntervalMarkerLayout=function(a,b,c,d,f){var e=a.isHorizontal();this.positionDiv=e?"Top"==d?function(l,m){l.style.left=m+"px";l.style.top="0px"}:function(l,m){l.style.left=m+"px";l.style.bottom="0px"}:"Left"==d?function(l,m){l.style.top=m+"px";l.style.left="0px"}:function(l,m){l.style.top=m+"px";l.style.right="0px"};var g=c.ether.interval.line,h=c.ether.interval.weekend,k=SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY];this.createIntervalMarker=function(l,m,p,r,u){var q=
Math.round(b.dateToPixelOffset(l));if(f&&p!=SimileAjax.DateTime.WEEK){var t=a.getDocument().createElement("div");t.className="timeline-ether-lines";100>g.opacity&&SimileAjax.Graphics.setOpacity(t,g.opacity);e?t.style.left=q+"px":t.style.top=q+"px";u.appendChild(t)}if(p==SimileAjax.DateTime.WEEK){t=c.firstDayOfWeek;t=new Date(l.getTime()+(6-t-7)*k);var v=new Date(t.getTime()+2*k);t=Math.round(b.dateToPixelOffset(t));v=Math.round(b.dateToPixelOffset(v));v=Math.max(1,v-t);var w=a.getDocument().createElement("div");
w.className="timeline-ether-weekends";100>h.opacity&&SimileAjax.Graphics.setOpacity(w,h.opacity);e?(w.style.left=t+"px",w.style.width=v+"px"):(w.style.top=t+"px",w.style.height=v+"px");u.appendChild(w)}l=m.labelInterval(l,p);m=a.getDocument().createElement("div");m.innerHTML=l.text;m.className="timeline-date-label";l.emphasized&&(m.className+=" timeline-date-label-em");this.positionDiv(m,q);r.appendChild(m);return m}};
Timeline.EtherHighlight=function(a,b,c,d){var f=a.isHorizontal();this._highlightDiv=null;this._createHighlightDiv=function(){if(null==this._highlightDiv){this._highlightDiv=a.getDocument().createElement("div");this._highlightDiv.setAttribute("name","ether-highlight");this._highlightDiv.className="timeline-ether-highlight";var e=c.ether.highlightOpacity;100>e&&SimileAjax.Graphics.setOpacity(this._highlightDiv,e);d.appendChild(this._highlightDiv)}};this.position=function(e,g,h,k){h=h||0;k=k||1;this._createHighlightDiv();
e=Math.round(b.dateToPixelOffset(e));g=Math.round(b.dateToPixelOffset(g));g=Math.max(g-e,3);var l=b.getViewWidth()-4;f?(this._highlightDiv.style.left=e+"px",this._highlightDiv.style.width=g+"px",this._highlightDiv.style.top=Math.round(h*l)+"px",this._highlightDiv.style.height=Math.round(k*l)+"px"):(this._highlightDiv.style.top=e+"px",this._highlightDiv.style.height=g+"px",this._highlightDiv.style.left=Math.round(h*l)+"px",this._highlightDiv.style.width=Math.round(k*l)+"px")}};
Timeline.EventUtils={};Timeline.EventUtils.getNewEventID=function(){null==this._lastEventID&&(this._lastEventID=0);this._lastEventID+=1;return"e"+this._lastEventID};Timeline.EventUtils.decodeEventElID=function(a){var b=a.split("-");if("tl"!=b[1])return alert("Internal Timeline problem 101, please consult support"),{band:null,evt:null};a=Timeline.getTimelineFromID(b[2]).getBand(b[3]);b=a.getEventSource.getEvent(b[4]);return{band:a,evt:b}};
Timeline.EventUtils.encodeEventElID=function(a,b,c,d){return c+"-tl-"+a.timelineID+"-"+b.getIndex()+"-"+d.getID()};Timeline.GregorianDateLabeller=function(a,b){this._locale=a;this._timeZone=b};Timeline.GregorianDateLabeller.monthNames=[];Timeline.GregorianDateLabeller.dayNames=[];Timeline.GregorianDateLabeller.labelIntervalFunctions=[];Timeline.GregorianDateLabeller.getMonthName=function(a,b){return Timeline.GregorianDateLabeller.monthNames[b][a]};
Timeline.GregorianDateLabeller.prototype.labelInterval=function(a,b){var c=Timeline.GregorianDateLabeller.labelIntervalFunctions[this._locale];null==c&&(c=Timeline.GregorianDateLabeller.prototype.defaultLabelInterval);return c.call(this,a,b)};Timeline.GregorianDateLabeller.prototype.labelPrecise=function(a){return SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone).toUTCString()};
Timeline.GregorianDateLabeller.prototype.defaultLabelInterval=function(a,b){var c=!1;a=SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone);switch(b){case SimileAjax.DateTime.MILLISECOND:a=a.getUTCMilliseconds();break;case SimileAjax.DateTime.SECOND:a=a.getUTCSeconds();break;case SimileAjax.DateTime.MINUTE:var d=a.getUTCMinutes();0==d?(a=a.getUTCHours()+":00",c=!0):a=d;break;case SimileAjax.DateTime.HOUR:a=a.getUTCHours()+"hr";break;case SimileAjax.DateTime.DAY:a=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),
this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.WEEK:a=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.MONTH:if(d=a.getUTCMonth(),0!=d){a=Timeline.GregorianDateLabeller.getMonthName(d,this._locale);break}case SimileAjax.DateTime.YEAR:case SimileAjax.DateTime.DECADE:case SimileAjax.DateTime.CENTURY:case SimileAjax.DateTime.MILLENNIUM:c=a.getUTCFullYear();a=0<c?a.getUTCFullYear():1-c+"BC";c=b==SimileAjax.DateTime.MONTH||
b==SimileAjax.DateTime.DECADE&&0==c%100||b==SimileAjax.DateTime.CENTURY&&0==c%1E3;break;default:a=a.toUTCString()}return{text:a,emphasized:c}};Timeline.DefaultEventSource=function(a){this._events=a instanceof Object?a:new SimileAjax.EventIndex;this._listeners=[]};Timeline.DefaultEventSource.prototype.addListener=function(a){this._listeners.push(a)};
Timeline.DefaultEventSource.prototype.removeListener=function(a){for(var b=0;b<this._listeners.length;b++)if(this._listeners[b]==a){this._listeners.splice(b,1);break}};
Timeline.DefaultEventSource.prototype.loadXML=function(a,b){b=this._getBaseURL(b);var c=a.documentElement.getAttribute("wiki-url"),d=a.documentElement.getAttribute("wiki-section"),f=a.documentElement.getAttribute("date-time-format");f=this._events.getUnit().getParser(f);a=a.documentElement.firstChild;for(var e=!1;null!=a;){if(1==a.nodeType){e="";null!=a.firstChild&&3==a.firstChild.nodeType&&(e=a.firstChild.nodeValue);var g=null===a.getAttribute("isDuration")&&null===a.getAttribute("durationEvent")||
"false"==a.getAttribute("isDuration")||"false"==a.getAttribute("durationEvent");e=new Timeline.DefaultEventSource.Event({id:a.getAttribute("id"),start:f(a.getAttribute("start")),end:f(a.getAttribute("end")),latestStart:f(a.getAttribute("latestStart")),earliestEnd:f(a.getAttribute("earliestEnd")),instant:g,text:a.getAttribute("title"),description:e,image:this._resolveRelativeURL(a.getAttribute("image"),b),link:this._resolveRelativeURL(a.getAttribute("link"),b),icon:this._resolveRelativeURL(a.getAttribute("icon"),
b),color:a.getAttribute("color"),textColor:a.getAttribute("textColor"),hoverText:a.getAttribute("hoverText"),classname:a.getAttribute("classname"),tapeImage:a.getAttribute("tapeImage"),tapeRepeat:a.getAttribute("tapeRepeat"),caption:a.getAttribute("caption"),eventID:a.getAttribute("eventID"),trackNum:a.getAttribute("trackNum")});e._node=a;e.getProperty=function(h){return this._node.getAttribute(h)};e.setWikiInfo(c,d);this._events.add(e);e=!0}a=a.nextSibling}e&&this._fire("onAddMany",[])};
Timeline.DefaultEventSource.prototype.loadJSON=function(a,b){b=this._getBaseURL(b);var c=!1;if(a&&a.events){var d="wikiURL"in a?a.wikiURL:null,f="wikiSection"in a?a.wikiSection:null,e="dateTimeFormat"in a?a.dateTimeFormat:null;e=this._events.getUnit().getParser(e);for(var g=0;g<a.events.length;g++){c=a.events[g];var h=c.isDuration||"durationEvent"in c&&!c.durationEvent||"de"in c&&!c.de;h=new Timeline.DefaultEventSource.Event({id:"id"in c?c.id:void 0,start:e(c.start||c.s),end:e(c.end||c.e),latestStart:e(c.latestStart||
c.ls),earliestEnd:e(c.earliestEnd||c.ee),instant:h,text:c.title||c.t,description:c.description||c.d,image:this._resolveRelativeURL(c.image,b),link:this._resolveRelativeURL(c.link,b),icon:this._resolveRelativeURL(c.icon,b),color:c.color,textColor:c.textColor,hoverText:c.hoverText,classname:c.classname||c.c,tapeImage:c.tapeImage,tapeRepeat:c.tapeRepeat,caption:c.caption,eventID:c.eventID||c.eid,trackNum:c.trackNum});h._obj=c;h.getProperty=function(k){return this._obj[k]};h.setWikiInfo(d,f);this._events.add(h);
c=!0}}c&&this._fire("onAddMany",[])};
Timeline.DefaultEventSource.prototype.loadSPARQL=function(a,b){b=this._getBaseURL(b);var c=this._events.getUnit().getParser("iso8601");if(null!=a){for(a=a.documentElement.firstChild;null!=a&&(1!=a.nodeType||"results"!=a.nodeName);)a=a.nextSibling;var d=null,f=null;null!=a&&(d=a.getAttribute("wiki-url"),f=a.getAttribute("wiki-section"),a=a.firstChild);for(var e=!1;null!=a;){if(1==a.nodeType){e={};for(var g=a.firstChild;null!=g;)1==g.nodeType&&null!=g.firstChild&&1==g.firstChild.nodeType&&null!=g.firstChild.firstChild&&
3==g.firstChild.firstChild.nodeType&&(e[g.getAttribute("name")]=g.firstChild.firstChild.nodeValue),g=g.nextSibling;null==e.start&&null!=e.date&&(e.start=e.date);g=null===e.isDuration&&null===e.durationEvent||"false"==e.isDuration||"false"==e.durationEvent;g=new Timeline.DefaultEventSource.Event({id:e.id,start:c(e.start),end:c(e.end),latestStart:c(e.latestStart),earliestEnd:c(e.earliestEnd),instant:g,text:e.title,description:e.description,image:this._resolveRelativeURL(e.image,b),link:this._resolveRelativeURL(e.link,
b),icon:this._resolveRelativeURL(e.icon,b),color:e.color,textColor:e.textColor,hoverText:e.hoverText,caption:e.caption,classname:e.classname,tapeImage:e.tapeImage,tapeRepeat:e.tapeRepeat,eventID:e.eventID,trackNum:e.trackNum});g._bindings=e;g.getProperty=function(h){return this._bindings[h]};g.setWikiInfo(d,f);this._events.add(g);e=!0}a=a.nextSibling}e&&this._fire("onAddMany",[])}};Timeline.DefaultEventSource.prototype.add=function(a){this._events.add(a);this._fire("onAddOne",[a])};
Timeline.DefaultEventSource.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._events.add(a[b]);this._fire("onAddMany",[])};Timeline.DefaultEventSource.prototype.clear=function(){this._events.removeAll();this._fire("onClear",[])};Timeline.DefaultEventSource.prototype.getEvent=function(a){return this._events.getEvent(a)};Timeline.DefaultEventSource.prototype.getEventIterator=function(a,b){return this._events.getIterator(a,b)};
Timeline.DefaultEventSource.prototype.getEventReverseIterator=function(a,b){return this._events.getReverseIterator(a,b)};Timeline.DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()};Timeline.DefaultEventSource.prototype.getCount=function(){return this._events.getCount()};Timeline.DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()};Timeline.DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()};
Timeline.DefaultEventSource.prototype._fire=function(a,b){for(var c=0;c<this._listeners.length;c++){var d=this._listeners[c];if(a in d)try{d[a].apply(d,b)}catch(f){SimileAjax.Debug.exception(f)}}};Timeline.DefaultEventSource.prototype._getBaseURL=function(a){if(0>a.indexOf("://")){var b=this._getBaseURL(document.location.href);a="/"==a.substr(0,1)?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a}b=a.lastIndexOf("/");return 0>b?"":a.substr(0,b+1)};
Timeline.DefaultEventSource.prototype._resolveRelativeURL=function(a,b){return null==a||""==a?a:0<a.indexOf("://")?a:"/"==a.substr(0,1)?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a};
Timeline.DefaultEventSource.Event=function(a){function b(d){return null!=a[d]&&""!=a[d]?a[d]:null}var c=a.id?a.id.trim():"";this._id=0<c.length?c:Timeline.EventUtils.getNewEventID();this._instant=a.instant||null==a.end;this._start=a.start;this._end=null!=a.end?a.end:a.start;this._latestStart=null!=a.latestStart?a.latestStart:a.instant?this._end:this._start;this._earliestEnd=null!=a.earliestEnd?a.earliestEnd:this._end;c=[];this._start>this._latestStart&&(this._latestStart=this._start,c.push("start is > latestStart"));
this._start>this._earliestEnd&&(this._earliestEnd=this._latestStart,c.push("start is > earliestEnd"));this._start>this._end&&(this._end=this._earliestEnd,c.push("start is > end"));this._latestStart>this._earliestEnd&&(this._earliestEnd=this._latestStart,c.push("latestStart is > earliestEnd"));this._latestStart>this._end&&(this._end=this._earliestEnd,c.push("latestStart is > end"));this._earliestEnd>this._end&&(this._end=this._earliestEnd,c.push("earliestEnd is > end"));this._eventID=b("eventID");
this._text=null!=a.text?SimileAjax.HTML.deEntify(a.text):"";0<c.length&&(this._text+=" PROBLEM: "+c.join(", "));this._description=SimileAjax.HTML.deEntify(a.description);this._image=b("image");this._link=b("link");this._title=b("hoverText");this._title=b("caption");this._icon=b("icon");this._color=b("color");this._textColor=b("textColor");this._classname=b("classname");this._tapeImage=b("tapeImage");this._tapeRepeat=b("tapeRepeat");this._trackNum=b("trackNum");null!=this._trackNum&&(this._trackNum=
parseInt(this._trackNum));this._wikiSection=this._wikiURL=null};
Timeline.DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},
getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(a){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},
setWikiInfo:function(a,b){this._wikiURL=a;this._wikiSection=b},fillDescription:function(a){this._description&&(a.innerHTML=this._description)},fillWikiInfo:function(a){a.style.display="none";if(null!=this._wikiURL&&null!=this._wikiSection){var b=this.getProperty("wikiID");if(null==b||0==b.length)b=this.getText();if(null!=b&&0!=b.length){a.style.display="inline";b=b.replace(/\s/g,"_");b=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+b;var c=document.createElement("a");c.href=b;c.target="new";
c.innerHTML=Timeline.strings[Timeline.clientLocale].wikiLinkLabel;a.appendChild(document.createTextNode("["));a.appendChild(c);a.appendChild(document.createTextNode("]"))}}},fillTime:function(a,b){this._instant?this.isImprecise()?(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))):a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))):
this.isImprecise()?(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)+" ~ "+b.labelPrecise(this._latestStart))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._earliestEnd)+" ~ "+b.labelPrecise(this._end)))):(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end))))},
fillInfoBubble:function(a,b,c){var d=a.ownerDocument,f=this.getText(),e=this.getLink(),g=this.getImage();if(null!=g){var h=d.createElement("img");h.src=g;b.event.bubble.imageStyler(h);a.appendChild(h)}g=d.createElement("div");f=d.createTextNode(f);null!=e?(h=d.createElement("a"),h.href=e,h.appendChild(f),g.appendChild(h)):g.appendChild(f);b.event.bubble.titleStyler(g);a.appendChild(g);e=d.createElement("div");this.fillDescription(e);b.event.bubble.bodyStyler(e);a.appendChild(e);e=d.createElement("div");
this.fillTime(e,c);b.event.bubble.timeStyler(e);a.appendChild(e);c=d.createElement("div");this.fillWikiInfo(c);b.event.bubble.wikiStyler(c);a.appendChild(c)}};Timeline.OriginalEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._eventPaintListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};
Timeline.OriginalEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.OriginalEventPainter.prototype.getType=function(){return"original"};Timeline.OriginalEventPainter.prototype.supportsOrthogonalScrolling=function(){return!0};Timeline.OriginalEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.OriginalEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.OriginalEventPainter.prototype.addEventPaintListener=function(a){this._eventPaintListeners.push(a)};
Timeline.OriginalEventPainter.prototype.removeEventPaintListener=function(a){for(var b=0;b<this._eventPaintListeners.length;b++)if(this._eventPaintListeners[b]==a){this._eventPaintListeners.splice(b,1);break}};Timeline.OriginalEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OriginalEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OriginalEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.OriginalEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.OriginalEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={};this._fireEventPaintListeners("paintStarting",null,null);this._prepareForPainting();var b=this._computeMetrics(),c=this._band.getMinDate(),d=this._band.getMaxDate(),f=null!=this._filterMatcher?this._filterMatcher:function(g){return!0},e=null!=this._highlightMatcher?this._highlightMatcher:function(g){return-1};for(a=a.getEventReverseIterator(c,d);a.hasNext();)c=a.next(),f(c)&&
this.paintEvent(c,b,this._params.theme,e(c));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,b.trackIncrement);this._fireEventPaintListeners("paintEnded",null,null);this._setOrthogonalOffset(b)}};Timeline.OriginalEventPainter.prototype.softPaint=function(){this._setOrthogonalOffset(this._computeMetrics())};
Timeline.OriginalEventPainter.prototype.getOrthogonalExtent=function(){var a=this._computeMetrics();return 2*a.trackOffset+this._tracks.length*a.trackIncrement};Timeline.OriginalEventPainter.prototype._setOrthogonalOffset=function(a){a=this._band.getViewOrthogonalOffset();this._highlightLayer.style.top=this._lineLayer.style.top=this._eventLayer.style.top=a+"px"};
Timeline.OriginalEventPainter.prototype._computeMetrics=function(){var a=this._params.theme.event,b=Math.max(a.track.height,a.tape.height+this._frc.getLineHeight());return{trackOffset:a.track.offset,trackHeight:b,trackGap:a.track.gap,trackIncrement:b+a.track.gap,icon:a.instant.icon,iconWidth:a.instant.iconWidth,iconHeight:a.instant.iconHeight,labelWidth:a.label.width,maxLabelChar:a.label.maxLabelChar,impreciseIconMargin:a.instant.impreciseIconMargin}};
Timeline.OriginalEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=
a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.OriginalEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.OriginalEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.OriginalEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.OriginalEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),e=a.getStart();e=Math.round(this._band.dateToPixelOffset(e));var g=Math.round(e+b.iconWidth/2);e=Math.round(e-b.iconWidth/2);var h=this._getLabelDivClassName(a),k=this._frc.computeSize(f,h),l=g+c.event.label.offsetFromLine;g=this._findFreeTrack(a,l+k.width);var m=Math.round(b.trackOffset+g*b.trackIncrement+b.trackHeight/2-k.height/2),p=this._paintEventIcon(a,g,e,b,c,0);
f=this._paintEventLabel(a,f,l,m,k.width,k.height,c,h,d);b=[p.elmt,f.elmt];var r=this;h=function(u,q,t){return r._onClickInstantEvent(p.elmt,q,a)};SimileAjax.DOM.registerEvent(p.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",h);c=this._createHighlightDiv(d,p,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=p.elmt;this._tracks[g]=e};
Timeline.OriginalEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),e=a.getStart(),g=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(e)),k=Math.round(this._band.dateToPixelOffset(g));e=Math.round(h+b.iconWidth/2);g=Math.round(h-b.iconWidth/2);var l=this._getLabelDivClassName(a),m=this._frc.computeSize(f,l),p=e+c.event.label.offsetFromLine;e=this._findFreeTrack(a,Math.max(p+m.width,k));var r=c.event.tape.height,u=Math.round(b.trackOffset+
e*b.trackIncrement+r),q=this._paintEventIcon(a,e,g,b,c,r);f=this._paintEventLabel(a,f,p,u,m.width,m.height,c,l,d);l=a.getColor();l=null!=l?l:c.event.instant.impreciseColor;h=this._paintEventTape(a,e,h,k,l,c.event.instant.impreciseOpacity,b,c,0);b=[q.elmt,f.elmt,h.elmt];var t=this;k=function(v,w,C){return t._onClickInstantEvent(q.elmt,w,a)};SimileAjax.DOM.registerEvent(q.elmt,"mousedown",k);SimileAjax.DOM.registerEvent(h.elmt,"mousedown",k);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",k);c=this._createHighlightDiv(d,
q,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=q.elmt;this._tracks[e]=g};
Timeline.OriginalEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),e=a.getStart(),g=a.getEnd();e=Math.round(this._band.dateToPixelOffset(e));var h=Math.round(this._band.dateToPixelOffset(g)),k=this._getLabelDivClassName(a),l=this._frc.computeSize(f,k);g=this._findFreeTrack(a,Math.max(e+l.width,h));var m=Math.round(b.trackOffset+g*b.trackIncrement+c.event.tape.height),p=a.getColor();p=null!=p?p:c.event.duration.color;var r=this._paintEventTape(a,
g,e,h,p,100,b,c,0);f=this._paintEventLabel(a,f,e,m,l.width,l.height,c,k,d);b=[r.elmt,f.elmt];var u=this;h=function(q,t,v){return u._onClickDurationEvent(r.elmt,t,a)};SimileAjax.DOM.registerEvent(r.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",h);c=this._createHighlightDiv(d,r,c,a);null!=c&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=r.elmt;this._tracks[g]=e};
Timeline.OriginalEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),e=a.getStart(),g=a.getLatestStart(),h=a.getEnd(),k=a.getEarliestEnd();e=Math.round(this._band.dateToPixelOffset(e));g=Math.round(this._band.dateToPixelOffset(g));h=Math.round(this._band.dateToPixelOffset(h));var l=Math.round(this._band.dateToPixelOffset(k)),m=this._getLabelDivClassName(a),p=this._frc.computeSize(f,m);k=this._findFreeTrack(a,Math.max(g+p.width,h));var r=
Math.round(b.trackOffset+k*b.trackIncrement+c.event.tape.height),u=a.getColor();u=null!=u?u:c.event.duration.color;h=this._paintEventTape(a,k,e,h,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c,0);var q=this._paintEventTape(a,k,g,l,u,100,b,c,1);b=this._paintEventLabel(a,f,g,r,p.width,p.height,c,m,d);f=[h.elmt,q.elmt,b.elmt];var t=this;g=function(v,w,C){return t._onClickDurationEvent(q.elmt,w,a)};SimileAjax.DOM.registerEvent(q.elmt,"mousedown",g);SimileAjax.DOM.registerEvent(b.elmt,
"mousedown",g);c=this._createHighlightDiv(d,q,c,a);null!=c&&f.push(c);this._fireEventPaintListeners("paintedEvent",a,f);this._eventIdToElmt[a.getID()]=q.elmt;this._tracks[k]=e};Timeline.OriginalEventPainter.prototype._encodeEventElID=function(a,b){return Timeline.EventUtils.encodeEventElID(this._timeline,this._band,a,b)};Timeline.OriginalEventPainter.prototype._findFreeTrack=function(a,b){a=a.getTrackNum();if(null!=a)return a;for(a=0;a<this._tracks.length&&!(this._tracks[a]>b);a++);return a};
Timeline.OriginalEventPainter.prototype._paintEventIcon=function(a,b,c,d,f,e){f=a.getIcon();f=null!=f?f:d.icon;b=0<e?d.trackOffset+b*d.trackIncrement+e+d.impreciseIconMargin:Math.round(d.trackOffset+b*d.trackIncrement+d.trackHeight/2-d.iconHeight/2);e=SimileAjax.Graphics.createTranslucentImage(f);f=this._timeline.getDocument().createElement("div");f.className=this._getElClassName("timeline-event-icon",a,"icon");f.id=this._encodeEventElID("icon",a);f.style.left=c+"px";f.style.top=b+"px";f.appendChild(e);
null!=a._title&&(f.title=a._title);this._eventLayer.appendChild(f);return{left:c,top:b,width:d.iconWidth,height:d.iconHeight,elmt:f}};
Timeline.OriginalEventPainter.prototype._paintEventLabel=function(a,b,c,d,f,e,g,h,k){var l=this._timeline.getDocument().createElement("div");l.className=h;l.id=this._encodeEventElID("label",a);l.style.left=c+"px";l.style.width=f+"px";l.style.top=d+"px";l.innerHTML=b;null!=a._title&&(l.title=a._title);b=a.getTextColor();null==b&&(b=a.getColor());null!=b&&(l.style.color=b);g.event.highlightLabelBackground&&0<=k&&(l.style.background=this._getHighlightColor(k,g));this._eventLayer.appendChild(l);return{left:c,
top:d,width:f,height:e,elmt:l}};
Timeline.OriginalEventPainter.prototype._paintEventTape=function(a,b,c,d,f,e,g,h,k){d-=c;h=h.event.tape.height;b=g.trackOffset+b*g.trackIncrement;g=this._timeline.getDocument().createElement("div");g.className=this._getElClassName("timeline-event-tape",a,"tape");g.id=this._encodeEventElID("tape"+k,a);g.style.left=c+"px";g.style.width=d+"px";g.style.height=h+"px";g.style.top=b+"px";null!=a._title&&(g.title=a._title);null!=f&&(g.style.backgroundColor=f);f=a.getTapeImage();a=a.getTapeRepeat();a=null!=
a?a:"repeat";null!=f&&(g.style.backgroundImage="url("+f+")",g.style.backgroundRepeat=a);SimileAjax.Graphics.setOpacity(g,e);this._eventLayer.appendChild(g);return{left:c,top:b,width:d,height:h,elmt:g}};Timeline.OriginalEventPainter.prototype._getLabelDivClassName=function(a){return this._getElClassName("timeline-event-label",a,"label")};Timeline.OriginalEventPainter.prototype._getElClassName=function(a,b,c){b=b.getClassName();var d=[];b&&(c&&d.push(c+"-"+b+" "),d.push(b+" "));d.push(a);return d.join("")};
Timeline.OriginalEventPainter.prototype._getHighlightColor=function(a,b){b=b.event.highlightColors;return b[Math.min(a,b.length-1)]};
Timeline.OriginalEventPainter.prototype._createHighlightDiv=function(a,b,c,d){var f=null;0<=a&&(f=this._timeline.getDocument(),a=this._getHighlightColor(a,c),f=f.createElement("div"),f.className=this._getElClassName("timeline-event-highlight",d,"highlight"),f.id=this._encodeEventElID("highlight0",d),f.style.position="absolute",f.style.overflow="hidden",f.style.left=b.left-2+"px",f.style.width=b.width+4+"px",f.style.top=b.top-2+"px",f.style.height=b.height+4+"px",f.style.background=a,this._highlightLayer.appendChild(f));
return f};Timeline.OriginalEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.OriginalEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b){a=b.pageX;var d=b.pageY}else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.OriginalEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}};
Timeline.OriginalEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),f=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,f.width,null,f.maxHeight)};Timeline.OriginalEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.OriginalEventPainter.prototype._fireEventPaintListeners=function(a,b,c){for(var d=0;d<this._eventPaintListeners.length;d++)this._eventPaintListeners[d](this._band,a,b,c)};Timeline.DetailedEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};
Timeline.DetailedEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.DetailedEventPainter.prototype.getType=function(){return"detailed"};Timeline.DetailedEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.DetailedEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.DetailedEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.DetailedEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.DetailedEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.DetailedEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.DetailedEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={};this._prepareForPainting();var b=this._params.theme.event,c=Math.max(b.track.height,this._frc.getLineHeight());b={trackOffset:Math.round(this._band.getViewWidth()/2-c/2),trackHeight:c,trackGap:b.track.gap,trackIncrement:c+b.track.gap,icon:b.instant.icon,iconWidth:b.instant.iconWidth,iconHeight:b.instant.iconHeight,labelWidth:b.label.width};var d=this._band.getMinDate(),f=this._band.getMaxDate();
c=null!=this._filterMatcher?this._filterMatcher:function(g){return!0};var e=null!=this._highlightMatcher?this._highlightMatcher:function(g){return-1};for(a=a.getEventReverseIterator(d,f);a.hasNext();)d=a.next(),c(d)&&this.paintEvent(d,b,this._params.theme,e(d));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,b.trackIncrement)}};
Timeline.DetailedEventPainter.prototype.softPaint=function(){};
Timeline.DetailedEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._lowerTracks=[];this._upperTracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);
this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.DetailedEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.DetailedEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.DetailedEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.DetailedEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),e=a.getStart(),g=Math.round(this._band.dateToPixelOffset(e)),h=Math.round(g+b.iconWidth/2);e=Math.round(g-b.iconWidth/2);var k=this._frc.computeSize(f),l=this._findFreeTrackForSolid(h,g),m=this._paintEventIcon(a,l,e,b,c);h+=c.event.label.offsetFromLine;var p=l,r=this._getTrackData(l);Math.min(r.solid,r.text)>=h+k.width?(r.solid=e,r.text=h):(r.solid=e,h=g+c.event.label.offsetFromLine,
p=this._findFreeTrackForText(l,h+k.width,function(q){q.line=g-2}),this._getTrackData(p).text=e,this._paintEventLine(a,g,l,p,b,c));b=this._paintEventLabel(a,f,h,Math.round(b.trackOffset+p*b.trackIncrement+b.trackHeight/2-k.height/2),k.width,k.height,c);var u=this;f=function(q,t,v){return u._onClickInstantEvent(m.elmt,t,a)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(b.elmt,"mousedown",f);this._createHighlightDiv(d,m,c);this._eventIdToElmt[a.getID()]=m.elmt};
Timeline.DetailedEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),e=a.getStart(),g=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(e)),k=Math.round(this._band.dateToPixelOffset(g)),l=Math.round(h+b.iconWidth/2);g=Math.round(h-b.iconWidth/2);var m=this._frc.computeSize(f),p=this._findFreeTrackForSolid(k,h);e=this._paintEventTape(a,p,h,k,c.event.instant.impreciseColor,c.event.instant.impreciseOpacity,b,c);var r=this._paintEventIcon(a,
p,g,b,c);this._getTrackData(p).solid=g;l+=c.event.label.offsetFromLine;var u=l+m.width;u<k?k=p:(l=h+c.event.label.offsetFromLine,u=l+m.width,k=this._findFreeTrackForText(p,u,function(t){t.line=h-2}),this._getTrackData(k).text=g,this._paintEventLine(a,h,p,k,b,c));b=this._paintEventLabel(a,f,l,Math.round(b.trackOffset+k*b.trackIncrement+b.trackHeight/2-m.height/2),m.width,m.height,c);var q=this;f=function(t,v,w){return q._onClickInstantEvent(r.elmt,v,a)};SimileAjax.DOM.registerEvent(r.elmt,"mousedown",
f);SimileAjax.DOM.registerEvent(e.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(b.elmt,"mousedown",f);this._createHighlightDiv(d,r,c);this._eventIdToElmt[a.getID()]=r.elmt};
Timeline.DetailedEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),e=a.getStart(),g=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(e)),k=Math.round(this._band.dateToPixelOffset(g));e=this._frc.computeSize(f);g=this._findFreeTrackForSolid(k);var l=a.getColor();l=null!=l?l:c.event.duration.color;var m=this._paintEventTape(a,g,h,k,l,100,b,c);this._getTrackData(g).solid=h;k=h+c.event.label.offsetFromLine;l=this._findFreeTrackForText(g,
k+e.width,function(r){r.line=h-2});this._getTrackData(l).text=h-2;this._paintEventLine(a,h,g,l,b,c);b=this._paintEventLabel(a,f,k,Math.round(b.trackOffset+l*b.trackIncrement+b.trackHeight/2-e.height/2),e.width,e.height,c);var p=this;f=function(r,u,q){return p._onClickDurationEvent(m.elmt,u,a)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(b.elmt,"mousedown",f);this._createHighlightDiv(d,m,c);this._eventIdToElmt[a.getID()]=m.elmt};
Timeline.DetailedEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),e=a.getStart(),g=a.getLatestStart(),h=a.getEnd(),k=a.getEarliestEnd();e=Math.round(this._band.dateToPixelOffset(e));var l=Math.round(this._band.dateToPixelOffset(g));h=Math.round(this._band.dateToPixelOffset(h));var m=Math.round(this._band.dateToPixelOffset(k));k=this._frc.computeSize(f);g=this._findFreeTrackForSolid(h);var p=a.getColor();p=null!=p?p:c.event.duration.color;
this._paintEventTape(a,g,e,h,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c);var r=this._paintEventTape(a,g,l,m,p,100,b,c);this._getTrackData(g).solid=e;e=l+c.event.label.offsetFromLine;h=this._findFreeTrackForText(g,e+k.width,function(q){q.line=l-2});this._getTrackData(h).text=l-2;this._paintEventLine(a,l,g,h,b,c);b=this._paintEventLabel(a,f,e,Math.round(b.trackOffset+h*b.trackIncrement+b.trackHeight/2-k.height/2),k.width,k.height,c);var u=this;f=function(q,t,v){return u._onClickDurationEvent(r.elmt,
t,a)};SimileAjax.DOM.registerEvent(r.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(b.elmt,"mousedown",f);this._createHighlightDiv(d,r,c);this._eventIdToElmt[a.getID()]=r.elmt};
Timeline.DetailedEventPainter.prototype._findFreeTrackForSolid=function(a,b){for(var c=0;;c++){if(c<this._lowerTracks.length){var d=this._lowerTracks[c];if(Math.min(d.solid,d.text)>a&&(!b||d.line>b))return c}else return this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),c;if(c<this._upperTracks.length){if(d=this._upperTracks[c],Math.min(d.solid,d.text)>a&&(!b||d.line>b))return-1-c}else return this._upperTracks.push({solid:Number.POSITIVE_INFINITY,
text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),-1-c}};
Timeline.DetailedEventPainter.prototype._findFreeTrackForText=function(a,b,c){if(0>a){var d=!0;a=-a;b=this._findFreeUpperTrackForText(a,b);var f=-1-b}else 0<a?(d=!1,a+=1,f=b=this._findFreeLowerTrackForText(a,b)):(f=this._findFreeUpperTrackForText(0,b),b=this._findFreeLowerTrackForText(1,b),b-1<=f?(d=!1,a=1,f=b):(d=!0,a=0,b=f,f=-1-b));if(d)for(b==this._upperTracks.length&&this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),d=a;d<b;d++)c(this._upperTracks[d]);
else for(b==this._lowerTracks.length&&this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),d=a;d<b;d++)c(this._lowerTracks[d]);return f};Timeline.DetailedEventPainter.prototype._findFreeLowerTrackForText=function(a,b){for(;a<this._lowerTracks.length;a++){var c=this._lowerTracks[a];if(Math.min(c.solid,c.text)>=b)break}return a};
Timeline.DetailedEventPainter.prototype._findFreeUpperTrackForText=function(a,b){for(;a<this._upperTracks.length;a++){var c=this._upperTracks[a];if(Math.min(c.solid,c.text)>=b)break}return a};Timeline.DetailedEventPainter.prototype._getTrackData=function(a){return 0>a?this._upperTracks[-a-1]:this._lowerTracks[a]};
Timeline.DetailedEventPainter.prototype._paintEventLine=function(a,b,c,d,f,e){a=Math.round(f.trackOffset+c*f.trackIncrement+f.trackHeight/2);f=Math.round(Math.abs(d-c)*f.trackIncrement);var g="1px solid "+e.event.label.lineColor,h=this._timeline.getDocument().createElement("div");h.style.position="absolute";h.style.left=b+"px";h.style.width=e.event.label.offsetFromLine+"px";h.style.height=f+"px";c>d?(h.style.top=a-f+"px",h.style.borderTop=g):(h.style.top=a+"px",h.style.borderBottom=g);h.style.borderLeft=
g;this._lineLayer.appendChild(h)};
Timeline.DetailedEventPainter.prototype._paintEventIcon=function(a,b,c,d,f){f=a.getIcon();f=null!=f?f:d.icon;b=Math.round(d.trackOffset+b*d.trackIncrement+d.trackHeight/2-d.iconHeight/2);f=SimileAjax.Graphics.createTranslucentImage(f);var e=this._timeline.getDocument().createElement("div");e.style.position="absolute";e.style.left=c+"px";e.style.top=b+"px";e.appendChild(f);e.style.cursor="pointer";null!=a._title&&(e.title=a._title);this._eventLayer.appendChild(e);return{left:c,top:b,width:d.iconWidth,
height:d.iconHeight,elmt:e}};
Timeline.DetailedEventPainter.prototype._paintEventLabel=function(a,b,c,d,f,e,g){var h=this._timeline.getDocument(),k=h.createElement("div");k.style.position="absolute";k.style.left=c+"px";k.style.width=f+"px";k.style.top=d+"px";k.style.height=e+"px";k.style.backgroundColor=g.event.label.backgroundColor;SimileAjax.Graphics.setOpacity(k,g.event.label.backgroundOpacity);this._eventLayer.appendChild(k);g=h.createElement("div");g.style.position="absolute";g.style.left=c+"px";g.style.width=f+"px";g.style.top=
d+"px";g.innerHTML=b;g.style.cursor="pointer";null!=a._title&&(g.title=a._title);b=a.getTextColor();null==b&&(b=a.getColor());null!=b&&(g.style.color=b);this._eventLayer.appendChild(g);return{left:c,top:d,width:f,height:e,elmt:g}};
Timeline.DetailedEventPainter.prototype._paintEventTape=function(a,b,c,d,f,e,g,h){d-=c;h=h.event.tape.height;b=Math.round(g.trackOffset+b*g.trackIncrement+g.trackHeight/2-h/2);g=this._timeline.getDocument().createElement("div");g.style.position="absolute";g.style.left=c+"px";g.style.width=d+"px";g.style.top=b+"px";g.style.height=h+"px";g.style.backgroundColor=f;g.style.overflow="hidden";g.style.cursor="pointer";null!=a._title&&(g.title=a._title);SimileAjax.Graphics.setOpacity(g,e);this._eventLayer.appendChild(g);
return{left:c,top:b,width:d,height:h,elmt:g}};Timeline.DetailedEventPainter.prototype._createHighlightDiv=function(a,b,c){if(0<=a){var d=this._timeline.getDocument();c=c.event;a=c.highlightColors[Math.min(a,c.highlightColors.length-1)];d=d.createElement("div");d.style.position="absolute";d.style.overflow="hidden";d.style.left=b.left-2+"px";d.style.width=b.width+4+"px";d.style.top=b.top-2+"px";d.style.height=b.height+4+"px";d.style.background=a;this._highlightLayer.appendChild(d)}};
Timeline.DetailedEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.DetailedEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b){a=b.pageX;var d=b.pageY}else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.DetailedEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}};
Timeline.DetailedEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),f=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,f.width,null,f.maxHeight)};Timeline.DetailedEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.OverviewEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._highlightMatcher=this._filterMatcher=null};Timeline.OverviewEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._highlightLayer=this._eventLayer=null};Timeline.OverviewEventPainter.prototype.getType=function(){return"overview"};Timeline.OverviewEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.OverviewEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.OverviewEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OverviewEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OverviewEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.OverviewEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.OverviewEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._prepareForPainting();var b=this._params.theme.event;b={trackOffset:b.overviewTrack.offset,trackHeight:b.overviewTrack.height,trackGap:b.overviewTrack.gap,trackIncrement:b.overviewTrack.height+b.overviewTrack.gap};var c=this._band.getMinDate(),d=this._band.getMaxDate(),f=null!=this._filterMatcher?this._filterMatcher:function(g){return!0},e=null!=this._highlightMatcher?this._highlightMatcher:
function(g){return-1};for(a=a.getEventReverseIterator(c,d);a.hasNext();)c=a.next(),f(c)&&this.paintEvent(c,b,this._params.theme,e(c));this._highlightLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,b.trackIncrement)}};Timeline.OverviewEventPainter.prototype.softPaint=function(){};
Timeline.OverviewEventPainter.prototype._prepareForPainting=function(){var a=this._band;this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.OverviewEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.OverviewEventPainter.prototype.paintInstantEvent=function(a,b,c,d){var f=a.getStart();f=Math.round(this._band.dateToPixelOffset(f));var e=a.getColor();e=a.getClassName()?null:null!=e?e:c.event.duration.color;a=this._paintEventTick(a,f,e,100,b,c);this._createHighlightDiv(d,a,c)};
Timeline.OverviewEventPainter.prototype.paintDurationEvent=function(a,b,c,d){var f=a.getLatestStart(),e=a.getEarliestEnd();f=Math.round(this._band.dateToPixelOffset(f));e=Math.round(this._band.dateToPixelOffset(e));for(var g=0;g<this._tracks.length&&!(e<this._tracks[g]);g++);this._tracks[g]=e;var h=a.getColor(),k=a.getClassName();h=k?null:null!=h?h:c.event.duration.color;a=this._paintEventTape(a,g,f,e,h,100,b,c,k);this._createHighlightDiv(d,a,c)};
Timeline.OverviewEventPainter.prototype._paintEventTape=function(a,b,c,d,f,e,g,h,k){a=g.trackOffset+b*g.trackIncrement;d-=c;g=g.trackHeight;b=this._timeline.getDocument().createElement("div");b.className="timeline-small-event-tape";k&&(b.className+=" small-"+k);b.style.left=c+"px";b.style.width=d+"px";b.style.top=a+"px";b.style.height=g+"px";f&&(b.style.backgroundColor=f);100>e&&SimileAjax.Graphics.setOpacity(b,e);this._eventLayer.appendChild(b);return{left:c,top:a,width:d,height:g,elmt:b}};
Timeline.OverviewEventPainter.prototype._paintEventTick=function(a,b,c,d,f,e){c=e.event.overviewTrack.tickHeight;f=f.trackOffset-c;e=this._timeline.getDocument().createElement("div");e.className="timeline-small-event-icon";e.style.left=b+"px";e.style.top=f+"px";if(a=a.getClassName())e.className+=" small-"+a;100>d&&SimileAjax.Graphics.setOpacity(e,d);this._eventLayer.appendChild(e);return{left:b,top:f,width:1,height:c,elmt:e}};
Timeline.OverviewEventPainter.prototype._createHighlightDiv=function(a,b,c){if(0<=a){var d=this._timeline.getDocument();c=c.event;a=c.highlightColors[Math.min(a,c.highlightColors.length-1)];d=d.createElement("div");d.style.position="absolute";d.style.overflow="hidden";d.style.left=b.left-1+"px";d.style.width=b.width+2+"px";d.style.top=b.top-1+"px";d.style.height=b.height+2+"px";d.style.background=a;this._highlightLayer.appendChild(d)}};Timeline.OverviewEventPainter.prototype.showBubble=function(a){};
Timeline.CompactEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};Timeline.CompactEventPainter.prototype.getType=function(){return"compact"};Timeline.CompactEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.CompactEventPainter.prototype.supportsOrthogonalScrolling=function(){return!0};
Timeline.CompactEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.CompactEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.CompactEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.CompactEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};
Timeline.CompactEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.CompactEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.CompactEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(null!=a){this._eventIdToElmt={};this._prepareForPainting();var b=this._computeMetrics(),c=this._band.getMinDate(),d=this._band.getMaxDate(),f=null!=this._filterMatcher?this._filterMatcher:function(l){return!0},e=null!=this._highlightMatcher?this._highlightMatcher:function(l){return-1};d=a.getEventIterator(c,d);a="stackConcurrentPreciseInstantEvents"in this._params&&"object"==typeof this._params.stackConcurrentPreciseInstantEvents;
if("collapseConcurrentPreciseInstantEvents"in this._params&&this._params.collapseConcurrentPreciseInstantEvents||a){c=[];for(var g=null;d.hasNext();){var h=d.next();f(h)&&(!h.isInstant()||h.isImprecise()?this.paintEvent(h,b,this._params.theme,e(h)):null!=g&&g.getStart().getTime()==h.getStart().getTime()?c[c.length-1].push(h):(c.push([h]),g=h))}for(f=0;f<c.length;f++)if(d=c[f],1==d.length)this.paintEvent(d[0],b,this._params.theme,e(h));else{g=-1;for(var k=0;0>g&&k<d.length;k++)g=e(d[k]);a?this.paintStackedPreciseInstantEvents(d,
b,this._params.theme,g):this.paintCompositePreciseInstantEvents(d,b,this._params.theme,g)}}else for(;d.hasNext();)h=d.next(),f(h)&&this.paintEvent(h,b,this._params.theme,e(h));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._setOrthogonalOffset(b)}};Timeline.CompactEventPainter.prototype.softPaint=function(){this._setOrthogonalOffset(this._computeMetrics())};
Timeline.CompactEventPainter.prototype.getOrthogonalExtent=function(){var a=this._computeMetrics();return 2*a.trackOffset+this._tracks.length*a.trackHeight};Timeline.CompactEventPainter.prototype._setOrthogonalOffset=function(a){a=this._band.getViewOrthogonalOffset();this._highlightLayer.style.top=this._lineLayer.style.top=this._eventLayer.style.top=a+"px"};
Timeline.CompactEventPainter.prototype._computeMetrics=function(){var a=this._params.theme,b=a.event;a={trackOffset:"trackOffset"in this._params?this._params.trackOffset:10,trackHeight:"trackHeight"in this._params?this._params.trackHeight:10,tapeHeight:a.event.tape.height,tapeBottomMargin:"tapeBottomMargin"in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin"in this._params?this._params.labelBottomMargin:5,labelRightMargin:"labelRightMargin"in this._params?this._params.labelRightMargin:
5,defaultIcon:b.instant.icon,defaultIconWidth:b.instant.iconWidth,defaultIconHeight:b.instant.iconHeight,customIconWidth:"iconWidth"in this._params?this._params.iconWidth:b.instant.iconWidth,customIconHeight:"iconHeight"in this._params?this._params.iconHeight:b.instant.iconHeight,iconLabelGap:"iconLabelGap"in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin"in this._params?this._params.iconBottomMargin:2};"compositeIcon"in this._params?(a.compositeIcon=this._params.compositeIcon,
a.compositeIconWidth=this._params.compositeIconWidth||a.customIconWidth,a.compositeIconHeight=this._params.compositeIconHeight||a.customIconHeight):(a.compositeIcon=a.defaultIcon,a.compositeIconWidth=a.defaultIconWidth,a.compositeIconHeight=a.defaultIconHeight);a.defaultStackIcon="stackConcurrentPreciseInstantEvents"in this._params&&"icon"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:a.defaultIcon;a.defaultStackIconWidth="stackConcurrentPreciseInstantEvents"in
this._params&&"iconWidth"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:a.defaultIconWidth;a.defaultStackIconHeight="stackConcurrentPreciseInstantEvents"in this._params&&"iconHeight"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:a.defaultIconHeight;return a};
Timeline.CompactEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(null==this._backLayer){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._tracks=[];null!=this._highlightLayer&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=
a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";null!=this._lineLayer&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";null!=this._eventLayer&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.CompactEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.CompactEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.CompactEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.CompactEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){var f={tooltip:a.getProperty("tooltip")||a.getText()},e={url:a.getIcon()};null==e.url?(e.url=b.defaultIcon,e.width=b.defaultIconWidth,e.height=b.defaultIconHeight,e.className="timeline-event-icon-default"):(e.width=a.getProperty("iconWidth")||b.customIconWidth,e.height=a.getProperty("iconHeight")||b.customIconHeight);var g={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},h=this.paintTapeIconLabel(a.getStart(),
f,null,e,g,b,c,d),k=this;b=function(l,m,p){return k._onClickInstantEvent(h.iconElmtData.elmt,m,a)};SimileAjax.DOM.registerEvent(h.iconElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(h.labelElmtData.elmt,"mousedown",b);this._eventIdToElmt[a.getID()]=h.iconElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintCompositePreciseInstantEvents=function(a,b,c,d){for(var f=a[0],e=[],g=0;g<a.length;g++)e.push(a[g].getProperty("tooltip")||a[g].getText());e={tooltip:e.join("; ")};g={url:b.compositeIcon,width:b.compositeIconWidth,height:b.compositeIconHeight,className:"timeline-event-icon-composite"};var h={text:String.substitute(this._params.compositeEventLabelTemplate,[a.length])},k=this.paintTapeIconLabel(f.getStart(),e,null,g,h,b,c,d),l=this;b=function(m,p,r){return l._onClickMultiplePreciseInstantEvent(k.iconElmtData.elmt,
p,a)};SimileAjax.DOM.registerEvent(k.iconElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(k.labelElmtData.elmt,"mousedown",b);for(g=0;g<a.length;g++)this._eventIdToElmt[a[g].getID()]=k.iconElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintStackedPreciseInstantEvents=function(a,b,c,d){d="limit"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10;var f="moreMessageTemplate"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events",e=d<=a.length-2,g=this._band,h=function(y){var x={url:y.getIcon()};null==x.url?(x.url=b.defaultStackIcon,x.width=b.defaultStackIconWidth,
x.height=b.defaultStackIconHeight,x.className="timeline-event-icon-stack timeline-event-icon-default"):(x.width=y.getProperty("iconWidth")||b.customIconWidth,x.height=y.getProperty("iconHeight")||b.customIconHeight,x.className="timeline-event-icon-stack");return x},k=h(a[0]),l=0,m=0,p=0,r=0,u=[],q=0;for(;q<a.length&&(!e||q<d);q++){var t=a[q],v=t.getText();t=h(t);var w=this._frc.computeSize(v);v={text:v,iconData:t,labelSize:w,iconLeft:k.width+5*q-t.width};v.labelLeft=k.width+5*q+b.iconLabelGap;v.top=
p;u.push(v);l=Math.min(l,v.iconLeft);p+=w.height;m=Math.max(m,v.labelLeft+w.width);r=Math.max(r,v.top+t.height)}if(e){var C=String.substitute(f,[a.length-d]),D=this._frc.computeSize(C),K=k.width+5*(d-1)+b.iconLabelGap,M=p;p+=D.height;m=Math.max(m,K+D.width)}m+=b.labelRightMargin;p+=b.labelBottomMargin;r+=b.iconBottomMargin;var F=Math.round(g.dateToPixelOffset(a[0].getStart()));f=[];g=Math.ceil(Math.max(r,p)/b.trackHeight);k=k.width+5*(a.length-1);for(q=0;q<g;q++)f.push({start:l,end:k});l=Math.ceil(p/
b.trackHeight);for(q=0;q<l;q++)p=f[q],p.end=Math.max(p.end,m);var H=this._fitTracks(F,f)*b.trackHeight+b.trackOffset,A=this._timeline.getDocument().createElement("div");A.className="timeline-event-icon-stack";A.style.position="absolute";A.style.overflow="visible";A.style.left=F+"px";A.style.top=H+"px";A.style.width=k+"px";A.style.height=r+"px";A.innerHTML="<div style='position: relative'></div>";this._eventLayer.appendChild(A);var E=this,L=function(y){try{var x=parseInt(this.getAttribute("index")),
B=A.firstChild.childNodes;for(y=0;y<B.length;y++)B[y].style.zIndex=y==x?B.length:B.length-y}catch(z){}};m=function(y){var x=u[y],B=a[y],z=B.getProperty("tooltip")||B.getText(),G=E._paintEventLabel({tooltip:z},{text:x.text},F+x.labelLeft,H+x.top,x.labelSize.width,x.labelSize.height,c);G.elmt.setAttribute("index",y);G.elmt.onmouseover=L;var N=SimileAjax.Graphics.createTranslucentImage(x.iconData.url);z=E._timeline.getDocument().createElement("div");z.className="timeline-event-icon"+("className"in x.iconData?
" "+x.iconData.className:"");z.style.left=x.iconLeft+"px";z.style.top=x.top+"px";z.style.zIndex=u.length-y;z.appendChild(N);z.setAttribute("index",y);z.onmouseover=L;A.firstChild.appendChild(z);y=function(P,O,Q){return E._onClickInstantEvent(G.elmt,O,B)};SimileAjax.DOM.registerEvent(z,"mousedown",y);SimileAjax.DOM.registerEvent(G.elmt,"mousedown",y);E._eventIdToElmt[B.getID()]=z};for(q=0;q<u.length;q++)m(q);if(e){var I=a.slice(d),J=this._paintEventLabel({tooltip:C},{text:C},F+K,H+M,D.width,D.height,
c);SimileAjax.DOM.registerEvent(J.elmt,"mousedown",function(y,x,B){return E._onClickMultiplePreciseInstantEvent(J.elmt,x,I)});for(q=0;q<I.length;q++)this._eventIdToElmt[I[q].getID()]=J.elmt}};
Timeline.CompactEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){var f={tooltip:a.getProperty("tooltip")||a.getText()},e={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),color:a.getColor()||a.getTextColor(),isInstant:!0},g={url:a.getIcon()};null==g.url?g=null:(g.width=a.getProperty("iconWidth")||b.customIconWidth,g.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),
className:a.getClassName()},k=this.paintTapeIconLabel(a.getStart(),f,e,g,h,b,c,d),l=this;b=null!=g?function(m,p,r){return l._onClickInstantEvent(k.iconElmtData.elmt,p,a)}:function(m,p,r){return l._onClickInstantEvent(k.labelElmtData.elmt,p,a)};SimileAjax.DOM.registerEvent(k.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(k.impreciseTapeElmtData.elmt,"mousedown",b);null!=g?(SimileAjax.DOM.registerEvent(k.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=k.iconElmtData.elmt):
this._eventIdToElmt[a.getID()]=k.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){var f={tooltip:a.getProperty("tooltip")||a.getText()},e={start:a.getStart(),end:a.getEnd(),color:a.getColor()||a.getTextColor(),isInstant:!1},g={url:a.getIcon()};null==g.url?g=null:(g.width=a.getProperty("iconWidth")||b.customIconWidth,g.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},k=this.paintTapeIconLabel(a.getLatestStart(),
f,e,g,h,b,c,d),l=this;b=null!=g?function(m,p,r){return l._onClickInstantEvent(k.iconElmtData.elmt,p,a)}:function(m,p,r){return l._onClickInstantEvent(k.labelElmtData.elmt,p,a)};SimileAjax.DOM.registerEvent(k.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(k.tapeElmtData.elmt,"mousedown",b);null!=g?(SimileAjax.DOM.registerEvent(k.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=k.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=k.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){var f={tooltip:a.getProperty("tooltip")||a.getText()},e={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),color:a.getColor()||a.getTextColor(),isInstant:!1},g={url:a.getIcon()};null==g.url?g=null:(g.width=a.getProperty("iconWidth")||b.customIconWidth,g.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),
className:a.getClassName()},k=this.paintTapeIconLabel(a.getLatestStart(),f,e,g,h,b,c,d),l=this;b=null!=g?function(m,p,r){return l._onClickInstantEvent(k.iconElmtData.elmt,p,a)}:function(m,p,r){return l._onClickInstantEvent(k.labelElmtData.elmt,p,a)};SimileAjax.DOM.registerEvent(k.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(k.tapeElmtData.elmt,"mousedown",b);null!=g?(SimileAjax.DOM.registerEvent(k.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=k.iconElmtData.elmt):
this._eventIdToElmt[a.getID()]=k.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintTapeIconLabel=function(a,b,c,d,f,e,g,h){var k=this._band;h=function(C){return Math.round(k.dateToPixelOffset(C))};a=h(a);var l=[],m=0,p=0,r=0;if(null!=c){m=e.tapeHeight+e.tapeBottomMargin;p=Math.ceil(e.tapeHeight/e.trackHeight);for(var u=h(c.end)-a,q=h(c.start)-a,t=0;t<p;t++)l.push({start:q,end:u});r=e.trackHeight-m%e.tapeHeight}q=u=0;if(null!=d)for(("iconAlign"in d)&&"center"==d.iconAlign&&(u=-Math.floor(d.width/2)),q=u+d.width+e.iconLabelGap,0<p&&(l[p-
1].end=Math.max(l[p-1].end,q)),t=d.height+e.iconBottomMargin+r;0<t;)l.push({start:u,end:q}),t-=e.trackHeight;t=this._frc.computeSize(f.text);r=t.height+e.labelBottomMargin+r;var v=q+t.width+e.labelRightMargin;0<p&&(l[p-1].end=Math.max(l[p-1].end,v));for(var w=0;0<r;w++)p+w<l.length?l[p+w].end=v:l.push({start:0,end:v}),r-=e.trackHeight;l=this._fitTracks(a,l)*e.trackHeight+e.trackOffset;p={};p.labelElmtData=this._paintEventLabel(b,f,a+q,l+m,t.width,t.height,g);if(null!=c){if("latestStart"in c||"earliestEnd"in
c)p.impreciseTapeElmtData=this._paintEventTape(b,c,e.tapeHeight,l,h(c.start),h(c.end),g.event.duration.impreciseColor,g.event.duration.impreciseOpacity,e,g);!c.isInstant&&"start"in c&&"end"in c&&(p.tapeElmtData=this._paintEventTape(b,c,e.tapeHeight,l,a,h("earliestEnd"in c?c.earliestEnd:c.end),c.color,100,e,g))}null!=d&&(p.iconElmtData=this._paintEventIcon(b,d,l+m,a+u,e,g));return p};
Timeline.CompactEventPainter.prototype._fitTracks=function(a,b){var c;for(c=0;c<this._tracks.length;c++){for(var d=!0,f=0;f<b.length&&c+f<this._tracks.length;f++)if(a+b[f].start<this._tracks[c+f]){d=!1;break}if(d)break}for(d=0;d<b.length;d++)this._tracks[c+d]=a+b[d].end;return c};
Timeline.CompactEventPainter.prototype._paintEventIcon=function(a,b,c,d,f,e){e=SimileAjax.Graphics.createTranslucentImage(b.url);var g=this._timeline.getDocument().createElement("div");g.className="timeline-event-icon"+("className"in b?" "+b.className:"");g.style.left=d+"px";g.style.top=c+"px";g.appendChild(e);"tooltip"in a&&"string"==typeof a.tooltip&&(g.title=a.tooltip);this._eventLayer.appendChild(g);return{left:d,top:c,width:f.iconWidth,height:f.iconHeight,elmt:g}};
Timeline.CompactEventPainter.prototype._paintEventLabel=function(a,b,c,d,f,e,g){g=this._timeline.getDocument().createElement("div");g.className="timeline-event-label";g.style.left=c+"px";g.style.width=f+1+"px";g.style.top=d+"px";g.innerHTML=b.text;"tooltip"in a&&"string"==typeof a.tooltip&&(g.title=a.tooltip);"color"in b&&"string"==typeof b.color&&(g.style.color=b.color);"className"in b&&"string"==typeof b.className&&(g.className+=" "+b.className);this._eventLayer.appendChild(g);return{left:c,top:d,
width:f,height:e,elmt:g}};
Timeline.CompactEventPainter.prototype._paintEventTape=function(a,b,c,d,f,e,g,h,k,l){e-=f;k=this._timeline.getDocument().createElement("div");k.className="timeline-event-tape";k.style.left=f+"px";k.style.top=d+"px";k.style.width=e+"px";k.style.height=c+"px";"tooltip"in a&&"string"==typeof a.tooltip&&(k.title=a.tooltip);null!=g&&"string"==typeof b.color&&(k.style.backgroundColor=g);"backgroundImage"in b&&"string"==typeof b.backgroundImage&&(k.style.backgroundImage="url("+backgroundImage+")",k.style.backgroundRepeat=
"backgroundRepeat"in b&&"string"==typeof b.backgroundRepeat?b.backgroundRepeat:"repeat");SimileAjax.Graphics.setOpacity(k,h);"className"in b&&"string"==typeof b.className&&(k.className+=" "+b.className);this._eventLayer.appendChild(k);return{left:f,top:d,width:e,height:c,elmt:k}};
Timeline.CompactEventPainter.prototype._createHighlightDiv=function(a,b,c){0<=a&&(a=this._timeline.getDocument().createElement("div"),a.style.position="absolute",a.style.overflow="hidden",a.style.left=b.left-2+"px",a.style.width=b.width+4+"px",a.style.top=b.top-2+"px",a.style.height=b.height+4+"px",this._highlightLayer.appendChild(a))};
Timeline.CompactEventPainter.prototype._onClickMultiplePreciseInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);a=[];for(d=0;d<c.length;d++)a.push(c[d].getID());this._fireOnSelect(a);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),[c]);this._fireOnSelect([c.getID()]);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b){a=b.pageX;var d=b.pageY}else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,[c]);this._fireOnSelect([c.getID()]);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,[a])}};
Timeline.CompactEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div");c="fillInfoBubble"in c?[c]:c;for(var f=0;f<c.length;f++){var e=document.createElement("div");d.appendChild(e);c[f].fillInfoBubble(e,this._params.theme,this._band.getLabeller())}SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,this._params.theme.event.bubble.width)};Timeline.CompactEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.SpanHighlightDecorator=function(a){this._unit=null!=a.unit?a.unit:SimileAjax.NativeDateUnit;this._startDate="string"==typeof a.startDate?this._unit.parseFromObject(a.startDate):a.startDate;this._endDate="string"==typeof a.endDate?this._unit.parseFromObject(a.endDate):a.endDate;this._startLabel=null!=a.startLabel?a.startLabel:"";this._endLabel=null!=a.endLabel?a.endLabel:"";this._color=a.color;this._cssClass=null!=a.cssClass?a.cssClass:null;this._opacity=null!=a.opacity?a.opacity:100;this._zIndex=
null!=a.inFront&&a.inFront?113:10};Timeline.SpanHighlightDecorator.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._layerDiv=null};
Timeline.SpanHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv);this._layerDiv=this._band.createLayerDiv(this._zIndex);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();if(0>this._unit.compare(this._startDate,b)&&0<this._unit.compare(this._endDate,a)){a=this._unit.later(a,this._startDate);b=this._unit.earlier(b,this._endDate);a=this._band.dateToPixelOffset(a);
b=this._band.dateToPixelOffset(b);var c=this._timeline.getDocument(),d=function(){var h=c.createElement("table");h.insertRow(0).insertCell(0);return h},f=c.createElement("div");f.className="timeline-highlight-decorator";this._cssClass&&(f.className+=" "+this._cssClass);null!=this._color&&(f.style.backgroundColor=this._color);100>this._opacity&&SimileAjax.Graphics.setOpacity(f,this._opacity);this._layerDiv.appendChild(f);var e=d();e.className="timeline-highlight-label timeline-highlight-label-start";
var g=e.rows[0].cells[0];g.innerHTML=this._startLabel;this._cssClass&&(g.className="label_"+this._cssClass);this._layerDiv.appendChild(e);d=d();d.className="timeline-highlight-label timeline-highlight-label-end";g=d.rows[0].cells[0];g.innerHTML=this._endLabel;this._cssClass&&(g.className="label_"+this._cssClass);this._layerDiv.appendChild(d);this._timeline.isHorizontal()?(f.style.left=a+"px",f.style.width=b-a+"px",e.style.right=this._band.getTotalViewLength()-a+"px",e.style.width=this._startLabel.length+
"em",d.style.left=b+"px",d.style.width=this._endLabel.length+"em"):(f.style.top=a+"px",f.style.height=b-a+"px",e.style.bottom=a+"px",e.style.height="1.5px",d.style.top=b+"px",d.style.height="1.5px")}this._layerDiv.style.display="block"};Timeline.SpanHighlightDecorator.prototype.softPaint=function(){};
Timeline.PointHighlightDecorator=function(a){this._unit=null!=a.unit?a.unit:SimileAjax.NativeDateUnit;this._date="string"==typeof a.date?this._unit.parseFromObject(a.date):a.date;this._width=null!=a.width?a.width:10;this._color=a.color;this._cssClass=null!=a.cssClass?a.cssClass:"";this._opacity=null!=a.opacity?a.opacity:100};Timeline.PointHighlightDecorator.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._layerDiv=null};
Timeline.PointHighlightDecorator.prototype.paint=function(){null!=this._layerDiv&&this._band.removeLayerDiv(this._layerDiv);this._layerDiv=this._band.createLayerDiv(10);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();0>this._unit.compare(this._date,b)&&0<this._unit.compare(this._date,a)&&(a=this._band.dateToPixelOffset(this._date)-Math.round(this._width/2),b=this._timeline.getDocument().createElement("div"),
b.className="timeline-highlight-point-decorator",b.className+=" "+this._cssClass,null!=this._color&&(b.style.backgroundColor=this._color),100>this._opacity&&SimileAjax.Graphics.setOpacity(b,this._opacity),this._layerDiv.appendChild(b),this._timeline.isHorizontal()?(b.style.left=a+"px",b.style.width=this._width+"px"):(b.style.top=a+"px",b.style.height=this._width+"px"));this._layerDiv.style.display="block"};Timeline.PointHighlightDecorator.prototype.softPaint=function(){};
