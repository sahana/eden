function openPopup(e,t){if(!popupWin||popupWin.closed){var n="width=640,height=480";if(t==true){n+=",left="+(screen.width-640)/2+",top="+(screen.height-480)/2}popupWin=window.open(e,"popupWin",n)}else popupWin.focus()}function s3_tb_remove(){$.fn.colorbox.close()}function S3ConfirmClick(e,t){if(S3.interactive){$(e).click(function(e){if(confirm(t)){return true}else{e.preventDefault();return false}})}}function S3SetNavigateAwayConfirm(){window.onbeforeunload=function(){return i18n.unsaved_changes}}function S3ClearNavigateAwayConfirm(){window.onbeforeunload=function(){}}function S3EnableNavigateAwayConfirm(){$(document).ready(function(){if($("[class=error]").length>0){S3SetNavigateAwayConfirm()}$(":input:not(input[id=gis_location_advanced_checkbox])").keypress(S3SetNavigateAwayConfirm);$(":input:not(input[id=gis_location_advanced_checkbox])").change(S3SetNavigateAwayConfirm);$("form").submit(S3ClearNavigateAwayConfirm)})}function S3StatusBar(e,t){var n=this;var r=null;this.elementId="_showstatus";this.prependMultiline=true;this.showCloseButton=false;this.afterTimeoutText=null;this.cssClass="statusbar";this.highlightClass="statusbarhighlight";this.errorClass="statusbarerror";this.closeButtonClass="statusbarclose";this.additive=false;$.extend(this,t);if(e){r=$(e)}if(!r){r=$("<div id='_statusbar' class='"+n.cssClass+"'>"+"<div class='"+n.closeButtonClass+"'>"+(n.showCloseButton?" X </div></div>":"")).appendTo(document.body).show()}$("."+n.cssClass).click(function(e){$(r).hide()});this.show=function(e,t,i,s){if(i||i==undefined&&n.additive){var o="<div style='margin-bottom: 2px;' >"+e+"</div>";if(n.prependMultiline){r.prepend(o)}else{r.append(o)}}else{if(!n.showCloseButton){r.text(e)}else{var u=r.find("div.statusbarclose");r.text(e).prepend(u)}}r.show();if(t){if(s){r.addClass(n.errorClass)}else{r.addClass(n.highlightClass)}setTimeout(function(){r.removeClass(n.highlightClass);if(n.afterTimeoutText){n.show(n.afterTimeoutText)}},t)}};this.release=function(){if(_statusbar){$("#_statusbar").remove();_statusbar=undefined}}}function s3_showStatus(e,t,n,r){if(!_statusbar){_statusbar=new S3StatusBar}_statusbar.show(e,t,n,r)}function s3_hideStatus(){if(_statusbar){_statusbar.release()}}function s3_viewMap(e){var t=S3.Ap.concat("/gis/display_feature/")+e;var n=$("#map").html();var r="<iframe width='640' height='480' src='"+t+"'></iframe>";var i=$('<a href="#">'+i18n.close_map+"</a>");i.bind("click",function(e){$("#map").html(n);e.preventDefault()});$("#map").html(r);$("#map").append($("<div style='margin-bottom: 10px' />").append(i))}function s3_viewMapMulti(e,t,n,r){var i=S3.Ap.concat("/gis/display_feature//?module=")+e+"&resource="+t+"&instance="+n+"&jresource="+r;var s=$("#map").html();var o='<iframe width="640" height="480" src="'+i+'"></iframe>';var u=$('<a href="#">'+i18n.close_map+"</a>");u.bind("click",function(e){$("#map").html(s);e.preventDefault()});$("#map").html(o);$("#map").append($("<div style='margin-bottom: 10px' />").append(u))}function s3_showMap(e){var t=S3.Ap.concat("/gis/display_feature/")+e;openPopup(t,true)}function S3FilterFieldChange(e){var t=e.FilterField;var n=$('[name = "'+t+'"]');if(undefined==n[0]){return}var r=e.Field;var i=$('[name = "'+r+'"]');if(e.FilterOnLoad!=undefined){var s=e.FilterOnLoad}else{var s=true}n.change(function(){try{S3.JSONRequest[i.attr("id")].abort()}catch(s){}var o;if(n.length==0||n.length==undefined){o=""}else if(n.length==1){o=n.val()}else{o=new Array;n.filter("input:checked").each(function(){o.push($(this).val())})}if(o==""||o==undefined){i.attr("disabled","disabled");return}var u=e.FieldResource;if(e.Widget!=undefined){var a=e.Widget}else{var a=r}var f=$('[name = "'+a+'"]');if(e.FieldKey!=undefined){var l=e.FieldKey}else{var l=t}var c=e.FieldID;if(c==undefined){var c="id"}if(e.url!=undefined&&e.url!=null){var h=e.url}else{var p=e.FieldPrefix;var h=S3.Ap.concat("/",p,"/",u,".json?",u,".",l,"=")}h=h.concat(o);if(i.length==0||i.length==undefined){FieldVal=""}else if(i.length==1){FieldVal=i.val()}else{FieldVal=new Array;i.filter("input:checked").each(function(){FieldVal.push($(this).val())})}if(h.indexOf("?")!=-1){h=h.concat("&value=")}else{h=h.concat("?value=")}h=h.concat(FieldVal);var d=e.GetWidgetHTML;if(d==undefined){var d=false}if(e.ShowEmptyField!=undefined){var v=e.ShowEmptyField}else{var v=true}if(e.msgNoRecords!=undefined){var m=e.msgNoRecords}else{var m="-";e.msgNoRecords=m}if(e.fncPrep!=undefined){var g=e.fncPrep}else{var g=function(e){return null};e.fncPrep=g}if(e.fncRepresent!=undefined){var y=e.fncRepresent}else{var y=function(e){return e.name};e.fncRepresent=y}f.hide();if($("#"+u+"_ajax_throbber").length==0){f.after('<div id="'+u+'_ajax_throbber" class="ajax_throbber"/>')}var b;e.FieldVal=FieldVal;if(!d){S3.JSONRequest[i.attr("id")]=$.ajax({url:h,dataType:"json",context:e,success:function(t){var n="";var r=this.FilterField;var i=this.FieldResource;var s=$('[name = "'+this.Field+'"]');var o=$('[name = "'+r+'"]');var u=g(t);if(t.length==0){if(v){var a=0;n+='<option value="">'+this.msgNoRecords+"</options>"}}else{for(var f=0;f<t.length;f++){if(f==0){var a=t[f][c]}n+='<option value="'+t[f][c]+'">';n+=this.fncRepresent(t[f],u);n+="</option>"}if(e.Optional){a=0;n='<option value=""></option>'+n}if(e.FieldVal){a=e.FieldVal}}if(n!=""){s.html(n).val(a).change().removeAttr("disabled").show()}else{s.attr("disabled","disabled")}var l=$("#"+i+"_add");var h=l.attr("href");if(h.indexOf(r)==-1){h=h+"&"+r+"="+o.val()}else{var p=new RegExp(r+"=.*","g");h=h.replace(p,r+"="+o.val())}l.attr("href",h).show();$("#"+i+"_ajax_throbber").remove()}})}else{S3.JSONRequest[i.attr("id")]=$.ajax({url:h,dataType:"html",context:e,success:function(e){var t=$('[name = "'+this.Field+'"]');if(e!=""){f.html(e).change().removeAttr("disabled").show()}else{f.attr("disabled","disabled")}$("#"+u+"_ajax_throbber").remove()}})}});n.change();S3ClearNavigateAwayConfirm();S3EnableNavigateAwayConfirm()}function S3OptionsFilter(e){var t=e.triggerName;var n=e.targetName;var r='[name="'+t+'"]';r+=',[name*="_i_'+t+'_edit_"]';var i=$(r);if(i.length===0){return}i.change(function(){var r=$(this);var i=r.attr("name");var s,o;if(i==t){o=$('[name="'+n+'"]');if(o.length===0){return}s=o.attr("name")}else{var u=i.split("_");var a=u[0];var f=u.pop();o=$('[name*="'+a+'_"][name*="_i_'+n+"_edit_"+f+'"]');if(o.length===0){return}s=o.attr("name")}try{S3.JSONRequest[o.attr("id")].abort()}catch(l){}var c="";if(r.length==1){c=r.val()}else if(r.length>1){c=new Array;r.filter("input:checked").each(function(){c.push($(this).val())})}if(c==""||c===undefined){o.attr("disabled","disabled");return}var h="";if(o.length==1){h=o.val();if(!h){h=o.attr("value")}}else if(o.length>1){h=new Array;o.filter("input:checked").each(function(){h.push($(this).val())})}var p=e.lookupResource;if(e.lookupURL){var d=e.lookupURL}else{var v=e.lookupPrefix;var d=S3.Ap.concat("/",v,"/",p,".json")}var m;if(c){var g;if(typeof e.lookupKey=="undefined"){g=e.triggerName}else{g=e.lookupKey}m=p+"."+g+"="+c;if(d.indexOf("?")!=-1){d=d.concat("&"+m)}else{d=d.concat("?"+m)}}if(h){m="value="+h;if(d.indexOf("?")!=-1){d=d.concat("&"+m)}else{d=d.concat("?"+m)}}var y={triggerSelector:i,targetSelector:s,currentValue:h,lookupResource:p,triggerName:t};if(e.lookupField){y["lookupField"]=e.lookupField}else{y["lookupField"]="id"}if(e.optional){y["optional"]=e.optional}else{y["optional"]=false}if(e.showEmptyField){y["showEmptyField"]=e.showEmptyField}else{y["showEmptyField"]=true}if(e.msgNoRecords){y["msgNoRecords"]=e.msgNoRecords}else{y["msgNoRecords"]="-"}if(e.fncPrep){y["fncPrep"]=e.fncPrep}else{y["fncPrep"]=function(e){return null}}if(e.fncRepresent){y["fncRepresent"]=e.fncRepresent}else{y["fncRepresent"]=function(e){return e.name}}if(e.targetWidget!=undefined){var b=e.targetWidget}else{var b=s}y["targetWidget"]=b;var w=$('[name = "'+b+'"]');w.hide();if($("#"+p+"_ajax_throbber").length===0){w.after('<div id="'+p+'_ajax_throbber" class="ajax_throbber"/>')}if(!e.getWidgetHTML){S3.JSONRequest[o.attr("id")]=$.ajax({url:d,dataType:"json",context:y,success:function(e){var t=this.fncPrep;try{var n=t(e)}catch(r){var n=null}var i=this.fncRepresent;var s=this.FilterField;var o=this.FieldResource;var u=$('[name = "'+s+'"]');var a="";if(e.length===0){if(this.showEmptyField){var f=0;a+='<option value="">'+this.msgNoRecords+"</options>"}}else{var l=this.lookupField;for(var c=0;c<e.length;c++){if(c==0){var f=e[c][l]}a+='<option value="'+e[c][l]+'">';a+=i(e[c],n);a+="</option>"}if(this.optional){f=0;a='<option value=""></option>'+a}if(this.currentValue){f=this.currentValue}}var h=$('[name = "'+this.targetSelector+'"]');if(a!=""){h.html(a).val(f).change().removeAttr("disabled").show()}else{h.attr("disabled","disabled").show()}var p=this.lookupResource;var d=$("#"+p+"_add");if(d.length!==0){var v=d.attr("href");var u=$('[name = "'+this.triggerSelector+'"]');var m=this.triggerName;if(v.indexOf(m)==-1){v+="&"+m+"="+u.val()}else{var g=new RegExp(m+"=.*","g");v=v.replace(g,m+"="+u.val())}d.attr("href",v).show()}$("#"+p+"_ajax_throbber").remove()}})}else{S3.JSONRequest[o.attr("id")]=$.ajax({url:d,dataType:"html",context:y,success:function(e){var t=$('[name = "'+this.targetWidget+'"]');if(e!=""){t.html(e).change().removeAttr("disabled").show()}else{t.attr("disabled","disabled")}$("#"+this.lookupResource+"_ajax_throbber").remove()}})}});i.change();S3ClearNavigateAwayConfirm();S3EnableNavigateAwayConfirm()}var S3=Object();S3.gis=Object();S3.timeline=Object();S3.JSONRequest=Object();S3.TimeoutVar=Object();S3.uid=function(){return(+(new Date)/1e3*65536+Math.random()*65535>>0).toString(16)};S3.Utf8={encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},decode:function(e){var t="";var n=0;var r,i;var s=r=i=0;while(n<e.length){s=e.charCodeAt(n);if(s<128){t+=String.fromCharCode(s);n++}else if(s>191&&s<224){i=e.charCodeAt(n+1);t+=String.fromCharCode((s&31)<<6|i&63);n+=2}else{i=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((s&15)<<12|(i&63)<<6|c3&63);n+=3}}return t}};var popupWin=null;S3.addTooltips=function(){$.cluetip.defaults.cluezIndex=9999;$(".tooltip").cluetip({activation:"hover",sticky:false,splitTitle:"|"});$("label[title]").cluetip({splitTitle:"|",showTitle:false});$(".tooltipbody").cluetip({activation:"hover",sticky:false,splitTitle:"|",showTitle:false});var e='<img src="'+S3.Ap.concat("/static/img/cross2.png")+'" alt="close" />';$(".stickytip").cluetip({activation:"hover",sticky:true,closePosition:"title",closeText:e,splitTitle:"|"});$(".errortip").cluetip({activation:"click",sticky:true,closePosition:"title",closeText:e,splitTitle:"|"});$(".ajaxtip").cluetip({activation:"click",sticky:true,closePosition:"title",closeText:e,width:380})};$(document).ready(function(){$(".error").hide().slideDown("slow");$(".error").click(function(){$(this).fadeOut("slow");return false});$(".warning").hide().slideDown("slow");$(".warning").click(function(){$(this).fadeOut("slow");return false});$(".information").hide().slideDown("slow");$(".information").click(function(){$(this).fadeOut("slow");return false});$(".confirmation").hide().slideDown("slow");$(".confirmation").click(function(){$(this).fadeOut("slow");return false});$("input[type='checkbox'].delete").click(function(){if(this.checked&&!confirm(i18n.delete_confirmation)){this.checked=false}});inputErrorId=$("form .error[id]").eq(0).attr("id");if(inputErrorId!=undefined){inputName=inputErrorId.replace("__error","");inputId=$("[name="+inputName+"]").attr("id");inputLabel=$("[for="+inputId+"]");window.scrollTo(0,inputLabel.offset().top)}if(S3.interactive){$("a.delete-btn").live("click",function(e){if(confirm(i18n.delete_confirmation)){return true}else{e.preventDefault();return false}});$("input:text:visible:first").focus()}$("input.int_amount").keyup(function(){this.value=this.value.reverse().replace(/[^0-9\-,]|\-(?=.)/g,"").reverse()});$("input.float_amount").keyup(function(){this.value=this.value.reverse().replace(/[^0-9\-\.,]|[\-](?=.)|[\.](?=[0-9]*[\.])/g,"").reverse()});$('input[name="first_name"]').focusout(function(){this.value=this.value.charAt(0).toLocaleUpperCase()+this.value.substring(1)});$('input[name="password"]').keyup(function(){$(".verify-password").removeClass("hide");$("#password_two").removeAttr("disabled")});$("textarea.resizable:not(.textarea-processed)").each(function(){function r(n){t=e.height()-n.pageY;e.css("opacity",.25);$(document).mousemove(i).mouseup(s);return false}function i(n){e.height(Math.max(32,t+n.pageY)+"px");return false}function s(t){$(document).unbind("mousemove",i).unbind("mouseup",s);e.css("opacity",1)}if($(this).is("textarea.teaser:not(.teaser-processed)")){return false}var e=$(this).addClass("textarea-processed");var t=null;$(this).wrap('<div class="resizable-textarea"><span></span></div>').parent().append($('<div class="grippie"></div>').mousedown(r));var n=$("div.grippie",$(this).parent())[0];n.style.marginRight=n.offsetWidth-$(this)[0].offsetWidth+"px"});$("#modulenav .hoverable").hover(function(){$(this).addClass("hovered")},function(){$(this).removeClass("hovered")});$("#modulenav li").hover(function(){var e=$(this).width();var t=$("ul",this).width();if(t!=null){if(t<e){$("ul",this).css({width:e.toString()+"px"})}}$("ul",this).css("display","block")},function(){$("ul",this).css("display","none")});$("a.colorbox").attr("href",function(e,t){var n=$(this).parents("tr").attr("id");if(!n){n=$(this).parent().parent().attr("id")}n=n.replace(/__row/,"");var r=t;if(t.indexOf("&caller=")==-1){r=t+"&caller="+n}return r});$(".colorbox").click(function(){$.fn.colorbox({iframe:true,width:"99%",height:"99%",href:this.href,title:this.title});return false});S3.addTooltips();S3.deduplication();now=new Date;$("form").append("<input type='hidden' value="+now.getTimezoneOffset()+" name='_utc_offset'/>");if($("#socialmedia_share").length>0){var e=document.location.href;var t=document.title;$("#socialmedia_share").append("<div class='socialmedia_element'><script src='//platform.linkedin.com/in.js'></script><script type='IN/Share' data-counter='right'></script></div>");$("#socialmedia_share").append("<div class='socialmedia_element'><a href='https://twitter.com/share' class='twitter-share-button' data-count='none' data-hashtags='sahana-eden'>Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');</script></div>");$("#socialmedia_share").append("<div class='socialmedia_element'><div id='fb-root'></div><script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = '//connect.facebook.net/en_US/all.js#xfbml=1'; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script> <div class='fb-like' data-send='false' data-layout='button_count' data-show-faces='true' data-href='"+e+"'></div></div>")}});S3.deduplication=function(){$(".mark-deduplicate").click(function(){var e=$("#markDuplicateURL").attr("href");if(e){$.ajaxS3({type:"POST",url:e,data:{},success:function(e){$(".mark-deduplicate, .unmark-deduplicate, .deduplicate").toggleClass("hide");return},dataType:"JSON"})}});$(".unmark-deduplicate").click(function(){var e=$("#markDuplicateURL").attr("href");if(e){$.ajaxS3({type:"POST",url:e+"?remove=1",data:{},success:function(e){$(".mark-deduplicate, .unmark-deduplicate, .deduplicate").toggleClass("hide");return},dataType:"JSON"})}});$(".swap-button").click(function(){var e=this.id;var t=e.slice(5);var n=$("#original_"+t);var r=n.attr("id");var i=n.attr("name");var s=n.parent().closest("td.mwidget");var o=$("#duplicate_"+t);var u=o.attr("id");var a=o.attr("name");var f=o.parent().closest("td.mwidget");n.attr("id","swap_original_id");n.attr("name","swap_original_name");$("#dummy"+r).attr("id","dummy_swap_original_id");o.attr("id","swap_duplicate_id");o.attr("name","swap_duplicate_name");$("#dummy"+u).attr("id","dummy_swap_duplicate_id");s.before('<td id="swap_original_placeholder"></td>');var l=s.detach();f.before('<td id="swap_duplicate_placeholder"></td>');var c=f.detach();$("#swap_original_placeholder").after(c);$("#swap_original_placeholder").remove();$("#swap_duplicate_placeholder").after(l);$("#swap_duplicate_placeholder").remove();n.attr("id",u);n.attr("name",a);$("#dummy_swap_original_id").attr("id","dummy"+u);o.attr("id",r);o.attr("name",i);$("#dummy_swap_duplicate").attr("id","dummy"+r)})};(function(e){e.ajaxS3=function(t){var n=e.extend({},e.ajaxS3Settings,t);n.tryCount=0;if(t.message){s3_showStatus(i18n.ajax_get+" "+(t.message?t.message:i18n.ajax_fmd)+"...",this.ajaxS3Settings.msgTimeout)}n.success=function(e,n){s3_hideStatus();if(t.success)t.success(e,n)};n.error=function(n,r,i){if(r=="timeout"){this.tryCount++;if(this.tryCount<=this.retryLimit){s3_showStatus(i18n.ajax_get+" "+(t.message?t.message:i18n.ajax_fmd)+"... "+i18n.ajax_rtr+" "+this.tryCount,e.ajaxS3Settings.msgTimeout);e.ajax(this);return}s3_showStatus(i18n.ajax_wht+" "+(this.retryLimit+1)+" "+i18n.ajax_gvn,e.ajaxS3Settings.msgTimeout,false,true);return}if(n.status==500){s3_showStatus(i18n.ajax_500,e.ajaxS3Settings.msgTimeout,false,true)}else{s3_showStatus(i18n.ajax_dwn,e.ajaxS3Settings.msgTimeout,false,true)}};e.ajax(n)};e.postS3=function(t,n,r,i){return e.ajaxS3({type:"POST",url:t,data:n,success:r,dataType:i})};e.getS3=function(t,n,r,i,s,o){if(e.isFunction(n)){o=s;s=i;i=r;r=n;n=null}if(o){var u=false}return e.ajaxS3({type:"GET",url:t,async:u,data:n,success:r,dataType:i,message:s})};e.getJSONS3=function(t,n,r,i,s){if(e.isFunction(n)){s=i;i=r;r=n;n=null}if(!s){var s=false}return e.getS3(t,n,r,"json",i,s)};e.ajaxS3Settings={timeout:1e4,msgTimeout:2e3,retryLimit:10,dataType:"json",async:true,type:"GET"};e.ajaxS3Setup=function(t){e.extend(e.ajaxS3Settings,t)}})($);var _statusbar=null;S3.autocomplete=function(fieldname,module,resourcename,input,filter,link,postprocess,delay,min_length){var real_input="#"+input;var dummy="dummy_"+input;var dummy_input="#"+dummy;if($(dummy_input)=="undefined"){return true}var url=S3.Ap.concat("/",module,"/",resourcename,"/search.json?filter=~&field=",fieldname);if(filter!="undefined"){url+="&"+filter}if(link=="undefined"||link==""){}else{url+="&link="+link}if(postprocess=="undefined"){var postprocess=""}if(delay=="undefined"){var delay=450}if(min_length=="undefined"){var min_length=2}var data={val:$(dummy_input).val(),accept:false};$(dummy_input).autocomplete({source:url,delay:delay,minLength:min_length,search:function(e,t){$("#"+dummy+"_throbber").removeClass("hide").show();return true},response:function(e,t,n){$("#"+dummy+"_throbber").hide();return n},focus:function(e,t){$(dummy_input).val(t.item[fieldname]);return false},select:function(event,ui){$(dummy_input).val(ui.item[fieldname]);$(real_input).val(ui.item.id);$(real_input).change();if(postprocess){eval(postprocess)}data.accept=true;return false}}).data("autocomplete")._renderItem=function(e,t){return $("<li></li>").data("item.autocomplete",t).append("<a>"+t[fieldname]+"</a>").appendTo(e)};$(dummy_input).blur(function(){if(!$(dummy_input).val()){$(real_input).val("");data.accept=true}if(!data.accept){$(dummy_input).val(data.val)}else{data.val=$(dummy_input).val()}data.accept=false})};S3.slider=function(e,t,n,r,i){$("#"+e).slider({min:parseFloat(t),max:parseFloat(n),step:parseFloat(r),value:parseFloat(i),slide:function(t,n){$("#"+e+"_input").val(n.value)}})}
