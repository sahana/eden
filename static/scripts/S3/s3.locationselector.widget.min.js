$(function(){s3_gis_locationselector_onReady()});function s3_gis_locationselector_activate(){s3_gis_locationselector_onReady()}
function s3_gis_locationselector_onReady(){if("undefined"!=typeof S3.gis.location_id){$("#"+S3.gis.location_id+"__row1").hide();S3.gis.url=S3.Ap.concat("/gis/location");S3.gis.tab&&"search"==S3.gis.tab&&s3_gis_search_tab();if(S3.gis.geocoder)try{google&&s3_gis_initGeocoder()}catch(a){s3_gis_loadGoogle()}s3_gis_autocompletes();S3.gis.site&&$("#"+S3.gis.site+"_name").blur(function(){if(!$("#gis_location_name").val()){var a=$("#"+S3.gis.site+"_name").val();$("#gis_location_name").val(a)}});$("#gis_location_L0").change(function(){s3_gis_l0_select()});
$("#gis_location_search-btn").click(function(a){s3_gis_search_tab();a.preventDefault()});$("#gis_location_add-btn").click(function(a){s3_gis_add_tab();a.preventDefault()});$("#gis_location_edit-btn").click(function(a){s3_gis_edit_tab();a.preventDefault()});$("#gis_location_view-btn").click(function(a){s3_gis_view_tab();a.preventDefault()});$("#gis_location_expand").click(function(a){$("#gis_location_expand").hasClass("expand")?(s3_gis_hide_selector(),$("#gis_location_expand").addClass("expanded"),
$("#gis_location_expand").removeClass("expand")):(s3_gis_show_tab("add"),$("#gis_location_expand").addClass("expand"),$("#gis_location_expand").removeClass("expanded"));a.preventDefault()});$("#gis_location_search_select-btn").click(function(a){s3_gis_select_search_result();a.preventDefault()});$("form").submit(function(){S3ClearNavigateAwayConfirm();return s3_gis_save_locations()?!0:!1})}var b=$("#gis_location_map-btn");if(b){var c=b.attr("map");void 0==c&&(c="default_map");$.when(function(){var a=
new jQuery.Deferred;setTimeout(function f(){void 0!=S3.gis.maps?a.resolve("loaded"):"pending"===a.state()&&(a.notify("waiting for JS to load..."),setTimeout(f,500))},1);return a.promise()}()).then(function(a){var e=S3.gis.maps[c];e.s3.pointPlaced=function(a){a=a.geometry.getBounds().getCenterLonLat();a.transform(e.getProjectionObject(),S3.gis.proj4326);$("#gis_location_lon").val(a.lon);$("#gis_location_lat").val(a.lat);$("#gis_location_wkt").val("")};b.click(function(){e.s3.mapWin.show();if(e.s3.polygonButton)$("#gis_location_wkt").val()||
($(".olMapViewport").addClass("crosshair"),e.s3.polygonButton.control.activate());else{var a=$("#gis_location_lat").val(),b=$("#gis_location_lon").val();a&&b||($(".olMapViewport").addClass("crosshair"),e.s3.pointButton.control.activate())}})})}}function s3_gis_autocompletes(){s3_gis_autocomplete(1);s3_gis_autocomplete(2);s3_gis_autocomplete(3);s3_gis_autocomplete(4);s3_gis_autocomplete(5);s3_gis_autocomplete_search()}
function s3_gis_autocomplete(a){var b=$("#gis_location_L"+a+"_ac");if(void 0!=b.val()){var c=$("#gis_location_L"+a),d=$("#gis_location_L"+a+"_throbber");b.autocomplete({delay:500,minLength:2,source:function(b,c){$.ajax({url:s3_gis_ac_set_source(a),data:{term:b.term}}).done(function(a){if(0==a.length){var b=i18n.no_matching_records;a.push({id:0,value:"",label:b,name:b})}c(a)})},search:function(a,b){d.removeClass("hide").show();c.val("");return!0},response:function(a,b,c){d.hide();return c},focus:function(a,
c){c.item.id&&b.val(c.item.name);return!1},select:function(a,d){var g=d.item;g.id?(b.val(g.name),c.val(g.id),"L1"==g.level&&g.parent&&""===$("#gis_location_L0").val()&&$("#gis_location_L0").val(g.parent),$("ul.ui-autocomplete").hide(),s3_gis_autocomplete(parseInt(g.level.replace("L",""),10)+1)):c.val("").change();return!1}}).data("ui-autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append("<a>"+b.name+"</a>").appendTo(a)}}b.change(function(){for(var b=a+1;5>=
b;b++)$("#gis_location_L"+b+", #gis_location_L"+b+"_ac").val("")})}
function s3_gis_autocomplete_search(){var a=$("#gis_location_search_ac");if(void 0!=a.val()){var b=$("#gis_location_search_throbber");a.autocomplete({delay:500,minLength:2,source:function(a,b){$.ajax({url:s3_gis_ac_set_search_source(),data:{term:a.term}}).done(function(a){if(0==a.length){var c=i18n.no_matching_records;a.push({id:0,value:"",label:c,name:c})}b(a)})},search:function(a,d){b.removeClass("hide").show();$("#gis_location_search_select-btn").hide();return!0},response:function(a,d,e){b.hide();
return e},focus:function(b,d){d.item.id&&a.val(d.item.name);return!1},select:function(b,d){var e=d.item;e.id?(a.val(e.name),$("ul.ui-autocomplete").hide(),s3_gis_ac_search_selected(e)):a.val("");return!1}}).data("ui-autocomplete")._renderItem=function(a,b){var e;e=b.name&&b.addr_street?"<a>"+b.name+",  "+b.addr_street.split(",")[0].split("\n")[0]+"</a>":b.name?"<a>"+b.name+"</a>":"<a>"+b.addr_street.split(",")[0].split("\n")[0]+"</a>";return $("<li></li>").data("item.autocomplete",b).append(e).appendTo(a)}}}
function s3_gis_ac_set_source(a){var b=$("#gis_location_L"+(a-1)).val(),c;""===b&&1<a&&(c=$("#gis_location_L"+(a-2)).val(),""===c&&2<a&&(c=$("#gis_location_L"+(a-2)).val(),""===c&&3<a&&(c=$("#gis_location_L"+(a-3)).val(),""===c&&4<a&&(c=$("#gis_location_L"+(a-4)).val(),""===c&&5<a&&(c=$("#gis_location_L"+(a-5)).val())))));return b?S3.gis.url+"/search_ac?loc_select=1&level=L"+a+"&parent="+b:c?S3.gis.url+"/search_ac?loc_select=1&level=L"+a+"&children="+c:S3.gis.url+"/search_ac?loc_select=1&level=L"+
a}function s3_gis_ac_set_search_source(){return S3.gis.url+"/search_ac?loc_select=1&field2=addr_street&level=nullnone"}
function s3_gis_ac_search_selected(a){var b;for(b=0;5>=b;b++)$("#gis_location_L"+b+"_search").val(""),$("#gis_location_L"+b+"_label__row").hide(),$("#gis_location_L"+b+"_search__row").hide();var c=a.path,d=a.parent;if(c){var e=c.slice(0,c.toString().length+1).split("/"),f=e.length-1;if(0===f)$("#gis_location_search_throbber").hide(),$("#gis_location_search_select-btn").removeClass("hide").show();else for(b=0;b<=f;b++)b==f-1?s3_gis_search_hierarchy(e[b],!1,!0):s3_gis_search_hierarchy(e[b],!1,!1)}else d&&
s3_gis_search_hierarchy(d,!0,!0);a.name?($("#gis_location_name_label__row").removeClass("hide").show(),$("#gis_location_name_search").val(a.name),$("#gis_location_name_search__row").removeClass("hide").show()):($("#gis_location_name_label__row").hide(),$("#gis_location_name_search").val(""),$("#gis_location_name_search__row").hide());a.addr_street?($("#gis_location_street_label__row").removeClass("hide").show(),$("#gis_location_street_search").val(a.addr_street),$("#gis_location_street_search__row").removeClass("hide").show()):
($("#gis_location_street_label__row").hide(),$("#gis_location_street_search").val(""),$("#gis_location_street_search__row").hide());a.addr_postcode?($("#gis_location_postcode_label__row").removeClass("hide").show(),$("#gis_location_postcode_search").val(a.addr_postcode),$("#gis_location_postcode_search__row").removeClass("hide").show()):($("#gis_location_postcode_label__row").hide(),$("#gis_location_postcode_search").val(""),$("#gis_location_postcode_search__row").hide());S3.gis.no_latlon||(a.lat?
($("#gis_location_lat_label__row").removeClass("hide").show(),$("#gis_location_lat_search").val(a.lat),$("#gis_location_lat_search__row").removeClass("hide").show()):($("#gis_location_lat_label__row").hide(),$("#gis_location_lat_search").val(""),$("#gis_location_lat_search__row").hide()),a.lon?($("#gis_location_lon_label__row").removeClass("hide").show(),$("#gis_location_lon_search").val(a.lon),$("#gis_location_lon_search__row").removeClass("hide").show()):($("#gis_location_lon_label__row").hide(),
$("#gis_location_lon_search").val(""),$("#gis_location_lon_search__row").hide()));$("body").data("id",a.id);c||d||$("#gis_location_search_select-btn").removeClass("hide").show()}
function s3_gis_search_hierarchy(a,b,c){$("#gis_location_search_throbber").removeClass("hide").show();$.ajax({async:!0,url:S3.gis.url+"/"+a+".json",dataType:"json"}).done(function(d){if(d[0].id==a){var e=d[0].name,f=d[0].level;d=d[0].parent;$("body").data(f,a);$("#gis_location_"+f+"_search").val(e);$("#gis_location_"+f+"_label__row").removeClass("hide").show();$("#gis_location_"+f+"_search__row").removeClass("hide").show();b&&d?s3_gis_search_hierarchy(d,!0,!0):c&&($("#gis_location_search_throbber").hide(),
$("#gis_location_search_select-btn").removeClass("hide").show())}})}function s3_gis_show_level(a){$("#gis_location_L"+a+"_label__row").removeClass("hide").show();$("#gis_location_L"+a+"__row").removeClass("hide").show()}function s3_gis_hide_level(a){$("#gis_location_L"+a+"_label__row").hide();$("#gis_location_L"+a+"__row").hide()}
function s3_gis_l0_select(){var a=$("#gis_location_L0").val(),b=S3.gis.url.replace("gis/location","gis/l0")+"/"+a;$.ajax({async:!0,url:b,dataType:"json"}).done(function(b){if(b.id==a){S3.gis.country=b.code;for(level=1;5>=level;level++){var d="L"+level;b[d]?($("#gis_location_"+d+"_label__row label").text(b[d]+":"),s3_gis_show_level(level)):s3_gis_hide_level(level);$("#gis_location_"+d+", #gis_location_"+d+"_ac").val("")}if(!S3.gis.no_map){var d=$("#gis_location_lat").val(),e=$("#gis_location_lon").val();
if(!d&&!e){var d=b.lon_min,e=b.lat_min,f=b.lon_max,g=b.lat_max;d&&e&&f&&g?s3_gis_zoomMap(d,e,f,g):(d=b.lat,e=b.lon,d&&e&&(b=S3.gis.maps.default_map,d=new OpenLayers.LonLat(e,d),d.transform(S3.gis.proj4326,b.getProjectionObject()),b.s3.mapWin.rendered?b.setCenter(d):b.s3.mapPanel.center=d))}}}})}
function s3_gis_zoomMap(a,b,c,d){if(S3.gis.maps){var e=S3.gis.maps.default_map,f=S3.gis.proj4326,g=e.getProjectionObject();e.s3.mapWin.rendered&&(b=new OpenLayers.LonLat(a,b),d=new OpenLayers.LonLat(c,d),b.transform(f,g),d.transform(f,g),a=b.lon,b=b.lat,c=d.lon,d=d.lat);c=OpenLayers.Bounds.fromArray([a,b,c,d]);a=c.getCenterLonLat();c=e.getZoomForExtent(c,!0);16<c&&(c=16);e.s3.mapWin.rendered?(e.setCenter(a),e.zoomTo(c)):(a.transform(f,g),e=e.s3.mapPanel,e.center=a,e.zoom=c)}}
function s3_gis_hide_selector(){$(".locselect").hide()}function s3_gis_hide_selector_all(){$("#gis_location_label_row").hide();$(".subheading").hide();s3_gis_hide_selector()}function s3_gis_show_selector(){$("#gis_location_label_row").show();$(".subheading").show();s3_gis_show_tab("add")}function s3_gis_show_tab(a){$("#gis_location_tabs_row").removeClass("hide").show();"search"==a?s3_gis_search_tab():"add"==a?s3_gis_add_tab():"edit"==a?s3_gis_edit_tab():"view"==a&&s3_gis_view_tab()}
function s3_gis_search_tab(){$("#gis_location_L0_label__row").hide();$("#gis_location_L0__row").hide();$("#gis_location_name_label__row").hide();$("#gis_location_name__row").hide();$("#gis_location_street_label__row").hide();$("#gis_location_street__row").hide();$("#gis_location_postcode_label__row").hide();$("#gis_location_postcode__row").hide();$("#gis_location_L1_label__row").hide();$("#gis_location_L1__row").hide();$("#gis_location_L2_label__row").hide();$("#gis_location_L2__row").hide();$("#gis_location_L3_label__row").hide();
$("#gis_location_L3__row").hide();$("#gis_location_L4_label__row").hide();$("#gis_location_L4__row").hide();$("#gis_location_L5_label__row").hide();$("#gis_location_L5__row").hide();$("#gis_location_lat_label__row").hide();$("#gis_location_lat__row").hide();$("#gis_location_lon_label__row").hide();$("#gis_location_lon__row").hide();$("#gis_location_search_label__row").removeClass("hide").show();$("#gis_location_search__row").removeClass("hide").show();$("#gis_location_map-btn").html(i18n.gis_view_on_map);
$("#gis_location_map_button_row").hide();$("#gis_loc_add_tab").removeClass("tab_here").addClass("tab_other");$("#gis_loc_search_tab").removeClass("tab_last").addClass("tab_here");$("#gis_location_search_ac").focus()}
function s3_gis_add_tab(){s3_gis_hide_search_fields();$("#gis_location_L0_label__row").show();$("#gis_location_L0__row").show();$("#gis_location_name_label__row").show();$("#gis_location_name__row").show();$("#gis_location_street_label__row").show();$("#gis_location_street__row").show();$("#gis_location_postcode_label__row").show();$("#gis_location_postcode__row").show();$("#gis_location_L1_ac").hasClass("hide")?($("#gis_location_L1_label__row").hide(),$("#gis_location_L1__row").hide()):($("#gis_location_L1_label__row").show(),
$("#gis_location_L1__row").show());$("#gis_location_L2_ac").hasClass("hide")?($("#gis_location_L2_label__row").hide(),$("#gis_location_L2__row").hide()):($("#gis_location_L2_label__row").show(),$("#gis_location_L2__row").show());$("#gis_location_L3_ac").hasClass("hide")?($("#gis_location_L3_label__row").hide(),$("#gis_location_L3__row").hide()):($("#gis_location_L3_label__row").show(),$("#gis_location_L3__row").show());$("#gis_location_L4_ac").hasClass("hide")?($("#gis_location_L4_label__row").hide(),
$("#gis_location_L4__row").hide()):($("#gis_location_L4_label__row").show(),$("#gis_location_L4__row").show());$("#gis_location_L5_ac").hasClass("hide")?($("#gis_location_L5_label__row").hide(),$("#gis_location_L5__row").hide()):($("#gis_location_L5_label__row").show(),$("#gis_location_L5__row").show());S3.gis.no_latlon||($("#gis_location_lat_label__row").show(),$("#gis_location_lat__row").show(),$("#gis_location_lon_label__row").show(),$("#gis_location_lon__row").show());$("#gis_location_map-btn").html(i18n.gis_place_on_map);
$("#gis_location_map_button_row").show();$("#gis_location_geocoder-btn").removeClass("hide").show();$("#gis_loc_add_tab").removeClass("tab_other").addClass("tab_here");$("#gis_loc_search_tab").removeClass("tab_here").addClass("tab_last");$("#gis_location_search_select-btn").hide()}
function s3_gis_edit_tab(){$("#gis_location_L0").prop("disabled",!1);$("#gis_location_name").prop("disabled",!1);$("#gis_location_street").prop("disabled",!1);$("#gis_location_postcode").prop("disabled",!1);$("#gis_location_lat").prop("disabled",!1);$("#gis_location_lon").prop("disabled",!1);$("#gis_location_wkt").prop("disabled",!1);$("#gis_location_L5_ac").prop("disabled",!1);$("#gis_location_L4_ac").prop("disabled",!1);$("#gis_location_L3_ac").prop("disabled",!1);$("#gis_location_L2_ac").prop("disabled",
!1);$("#gis_location_L1_ac").prop("disabled",!1);$("#gis_location_L0_label__row").removeClass("hide").show();$("#gis_location_L0__row").removeClass("hide").show();$("#gis_location_name_label__row").removeClass("hide").show();$("#gis_location_name__row").removeClass("hide").show();$("#gis_location_street_label__row").removeClass("hide").show();$("#gis_location_street__row").removeClass("hide").show();$("#gis_location_postcode_label__row").removeClass("hide").show();$("#gis_location_postcode__row").removeClass("hide").show();
$("#gis_location_L5_ac").hasClass("hide")?($("#gis_location_L5_label__row").hide(),$("#gis_location_L5__row").hide()):($("#gis_location_L5_label__row").removeClass("hide").show(),$("#gis_location_L5__row").removeClass("hide").show());$("#gis_location_L4_ac").hasClass("hide")?($("#gis_location_L4_label__row").hide(),$("#gis_location_L4__row").hide()):($("#gis_location_L4_label__row").removeClass("hide").show(),$("#gis_location_L4__row").removeClass("hide").show());$("#gis_location_L3_ac").hasClass("hide")?
($("#gis_location_L3_label__row").hide(),$("#gis_location_L3__row").hide()):($("#gis_location_L3_label__row").removeClass("hide").show(),$("#gis_location_L3__row").removeClass("hide").show());$("#gis_location_L2_ac").hasClass("hide")?($("#gis_location_L2_label__row").hide(),$("#gis_location_L2__row").hide()):($("#gis_location_L2_label__row").removeClass("hide").show(),$("#gis_location_L2__row").removeClass("hide").show());$("#gis_location_L1_ac").hasClass("hide")?($("#gis_location_L1_label__row").hide(),
$("#gis_location_L1__row").hide()):($("#gis_location_L1_label__row").removeClass("hide").show(),$("#gis_location_L1__row").removeClass("hide").show());S3.gis.no_latlon||($("#gis_location_lat_label__row").removeClass("hide").show(),$("#gis_location_lat__row").removeClass("hide").show(),$("#gis_location_lon_label__row").removeClass("hide").show(),$("#gis_location_lon__row").removeClass("hide").show());$("#gis_location_wkt_label__row").removeClass("hide").show();$("#gis_location_wkt__row").removeClass("hide").show();
$("#gis_location_map-btn").html(i18n.gis_place_on_map);$("#gis_location_map_button_row").show();$("#gis_location_geocoder-btn").removeClass("hide").show();$("#gis_loc_edit_tab").removeClass("tab_other").addClass("tab_here");$("#gis_loc_view_tab").removeClass("tab_here").addClass("tab_last")}
function s3_gis_view_tab(){""===$("#gis_location_L0").val()?($("#gis_location_L0_label__row").hide(),$("#gis_location_L0__row").hide()):($("#gis_location_L0").prop("disabled",!0),$("#gis_location_L0__row").show());""===$("#gis_location_name").val()?($("#gis_location_name_label__row").hide(),$("#gis_location_name__row").hide()):($("#gis_location_name").prop("disabled",!0),$("#gis_location_name__row").show());""===$("#gis_location_street").val()?($("#gis_location_street_label__row").hide(),$("#gis_location_street__row").hide()):
($("#gis_location_street").prop("disabled",!0),$("#gis_location_street__row").show());""===$("#gis_location_postcode").val()?($("#gis_location_postcode_label__row").hide(),$("#gis_location_postcode__row").hide()):($("#gis_location_postcode").prop("disabled",!0),$("#gis_location_postcode__row").show());S3.gis.no_latlon||(""===$("#gis_location_lat").val()?($("#gis_location_lat_label__row").hide(),$("#gis_location_lat__row").hide()):($("#gis_location_lat").prop("disabled",!0),$("#gis_location_lat__row").show()),
""===$("#gis_location_lon").val()?($("#gis_location_lon_label__row").hide(),$("#gis_location_lon__row").hide()):($("#gis_location_lon").prop("disabled",!0),$("#gis_location_lon__row").show()));""===$("#gis_location_wkt").val()?($("#gis_location_wkt_label__row").hide(),$("#gis_location_wkt__row").hide()):($("#gis_location_wkt_label__row").show(),$("#gis_location_wkt").prop("disabled",!0),$("#gis_location_wkt__row").show());""===$("#gis_location_L5_ac").val()?($("#gis_location_L5_label__row").hide(),
$("#gis_location_L5__row").hide()):$("#gis_location_L5_ac").hasClass("hide")||($("#gis_location_L5_ac").prop("disabled",!0),$("#gis_location_L5__row").show());""===$("#gis_location_L4_ac").val()?($("#gis_location_L4_label__row").hide(),$("#gis_location_L4__row").hide()):$("#gis_location_L4_ac").hasClass("hide")||($("#gis_location_L4_ac").prop("disabled",!0),$("#gis_location_L4__row").show());""===$("#gis_location_L3_ac").val()?($("#gis_location_L3_label__row").hide(),$("#gis_location_L3__row").hide()):
$("#gis_location_L3_ac").hasClass("hide")||($("#gis_location_L3_ac").prop("disabled",!0),$("#gis_location_L3__row").show());""===$("#gis_location_L2_ac").val()?($("#gis_location_L2_label__row").hide(),$("#gis_location_L2__row").hide()):$("#gis_location_L2_ac").hasClass("hide")||($("#gis_location_L2_ac").prop("disabled",!0),$("#gis_location_L2__row").show());""===$("#gis_location_L1_ac").val()?($("#gis_location_L1_label__row").hide(),$("#gis_location_L1__row").hide()):$("#gis_location_L1_ac").hasClass("hide")||
($("#gis_location_L1_ac").prop("disabled",!0),$("#gis_location_L1__row").show());$("#gis_location_map-btn").html(i18n.gis_view_on_map);$("#gis_location_map_button_row").show();$("#gis_location_geocoder-btn").hide();$("#gis_loc_view_tab").removeClass("tab_other").addClass("tab_here");$("#gis_loc_edit_tab").removeClass("tab_here").addClass("tab_last")}
function s3_gis_select_search_result(){id=$("body").data("id");$("#"+S3.gis.location_id).val(id);$("#gis_loc_add_tab").hide();$("#gis_loc_search_tab").hide();$("#gis_loc_view_tab").removeClass("hide").show();$("#gis_loc_edit_tab").removeClass("hide").show();s3_gis_hide_search_fields();var a=$("#gis_location_name_search").val();$("#gis_location_name").val(a);a=$("#gis_location_street_search").val();$("#gis_location_street").val(a);a=$("#gis_location_postcode_search").val();$("#gis_location_postcode").val(a);
a=$("#gis_location_lat_search").val();$("#gis_location_lat").val(a);a=$("#gis_location_lon_search").val();$("#gis_location_lon").val(a);a=$("body").data("L0");$("#gis_location_L0").val(a);a=$("body").data("L1");$("#gis_location_L1").val(a);a=$("body").data("L2");$("#gis_location_L2").val(a);a=$("body").data("L3");$("#gis_location_L3").val(a);a=$("body").data("L4");$("#gis_location_L4").val(a);a=$("body").data("L5");$("#gis_location_L5").val(a);a=$("#gis_location_L1_search").val();$("#gis_location_L1_ac").val(a);
a=$("#gis_location_L2_search").val();$("#gis_location_L2_ac").val(a);a=$("#gis_location_L3_search").val();$("#gis_location_L3_ac").val(a);a=$("#gis_location_L4_search").val();$("#gis_location_L4_ac").val(a);a=$("#gis_location_L5_search").val();$("#gis_location_L5_ac").val(a);s3_gis_view_tab()}
function s3_gis_hide_search_fields(){$("#gis_location_search_label__row").hide();$("#gis_location_search__row").hide();$("#gis_location_name_search__row").hide();$("#gis_location_street_search__row").hide();$("#gis_location_postcode_search__row").hide();$("#gis_location_lat_search__row").hide();$("#gis_location_lon_search__row").hide();$("#gis_location_L0_search__row").hide();$("#gis_location_L1_search__row").hide();$("#gis_location_L2_search__row").hide();$("#gis_location_L3_search__row").hide();
$("#gis_location_L4_search__row").hide();$("#gis_location_L5_search__row").hide()}function s3_gis_loadGoogle(){var a=document.createElement("script");a.type="text/javascript";a.src="http://maps.google.com/maps/api/js?v=3.6&sensor=false&callback=s3_gis_initGeocoder";document.body.appendChild(a)}
function s3_gis_initGeocoder(){try{google&&(S3.gis.geocoder=new google.maps.Geocoder,$("#gis_location_geocoder-btn").click(function(){s3_gis_geocode(!0)}),$("#gis_location_street").blur(function(){var a=$("#gis_location_lat").val(),c=$("#gis_location_lon").val();a||c||s3_gis_geocode()}),$("#gis_location_postcode").blur(function(){var a=$("#gis_location_lat").val(),c=$("#gis_location_lon").val();a||c||s3_gis_geocode()}),$("#gis_location_L3_ac").blur(function(){var a=$("#gis_location_lat").val(),c=
$("#gis_location_lon").val();a||c||s3_gis_geocode()}))}catch(a){$("#gis_location_geocoder-btn").hide()}}
function s3_gis_geocode(a){var b=$("#gis_location_street").val();if(b)var c=b.search(/[A-z]/),b=b.substr(c);var d=$("#gis_location_postcode").val();d&&(b+=", "+d);(c=$("#gis_location_L5_ac").val())&&(b+=", "+c);var e=$("#gis_location_L4_ac").val();e&&(b+=", "+e);var f=$("#gis_location_L3_ac").val();f&&(b+=", "+f);var g=$("#gis_location_L2_ac").val();g&&(b+=", "+g);var h=$("#gis_location_L1_ac").val();h&&(b+=", "+h);b={address:b};S3.gis.country&&(b.region=S3.gis.country.toLowerCase());S3.gis.geocoder.geocode(b,
function(b,c){if(c==google.maps.GeocoderStatus.OK){var k=S3.gis.maps.default_map,l=b[0].geometry.location,p=l.lat(),l=l.lng(),m=new OpenLayers.LonLat(l,p);m.transform(S3.gis.proj4326,k.getProjectionObject());var n=b[0].geometry.viewport;if(n){var q=n.getNorthEast(),r=n.getSouthWest(),n=r.lng(),r=r.lat(),w=q.lng(),q=q.lat();s3_gis_zoomMap(n,r,w,q)}else k.s3.mapWin.rendered?k.setCenter(m):k.s3.mapPanel.center=m;if(a){$("#gis_location_lat").val(p);$("#gis_location_lon").val(l);var t=b[0].address_components;
$.each(t,function(a,b){var c=t[a];$.each(c.types,function(a,b){"postal_code"!=b||d?"administrative_area_level_1"!=b||h?"administrative_area_level_2"!=b||g?"administrative_area_level_3"!=b||f?"administrative_area_level_4"!=b||e||$("#gis_location_L4_ac").val(c.long_name):$("#gis_location_L3_ac").val(c.long_name):$("#gis_location_L2_ac").val(c.long_name):$("#gis_location_L1_ac").val(c.long_name):$("#gis_location_postcode").val(c.long_name)})});p=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(m.lon,
m.lat));k.s3.draftLayer.addFeatures([p])}}else s3_debug("Geocode was not successful for the following reason",c)})}
function s3_gis_save_locations(){$("#"+S3.gis.location_id).val()||$("#"+S3.gis.location_id).val("dummy");var a;if(S3.gis.site){var b="#"+S3.gis.site+"_name";if(a=$(b).val())$("#gis_location_name").val()||$("#gis_location_name").val(a);else return void 0==$("#name__error").val()&&$(b).after('<div id="name__error" class="error" style="display: block;">'+i18n.gis_name_required+"</div>"),$(b).focus(),S3.navigate_away_confirm&&S3SetNavigateAwayConfirm(),!1}var b=$("#gis_location_L1").val(),c=$("#gis_location_L2").val(),
d=$("#gis_location_L3").val(),e=$("#gis_location_L4").val(),f=$("#gis_location_L5").val();if(!$("#gis_location_L0").val()){a=S3.gis.site?"":$("#gis_location_name").val();var g=$("#gis_location_street").val(),h=$("#gis_location_postcode").val(),u=$("#gis_location_lat").val(),v=$("#gis_location_lon").val();if(b||c||d||e||f||a||g||h||u||v)return void 0==$("#country__error").val()&&$("#gis_location_L0").after('<div id="country__error" class="error" style="display: block;">'+i18n.gis_country_required+
"</div>"),$("#gis_location_L0").focus(),S3.navigate_away_confirm&&S3SetNavigateAwayConfirm(),!1}b||(b=$("#gis_location_L1_ac").val())&&$("#gis_location_L1").val(b);c||(c=$("#gis_location_L2_ac").val())&&$("#gis_location_L2").val(c);d||(d=$("#gis_location_L3_ac").val())&&$("#gis_location_L3").val(d);e||(e=$("#gis_location_L4_ac").val())&&$("#gis_location_L4").val(e);f||(f=$("#gis_location_L5_ac").val())&&$("#gis_location_L5").val(f);$("#gis_location_L0").prop("disabled",!1);$("#gis_location_name").prop("disabled",
!1);$("#gis_location_street").prop("disabled",!1);$("#gis_location_postcode").prop("disabled",!1);$("#gis_location_lat").prop("disabled",!1);$("#gis_location_lon").prop("disabled",!1);return!0};
