/*
 2016-2021 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,f,g){a instanceof String&&(a=String(a));for(var b=a.length,c=0;c<b;c++){var d=a[c];if(f.call(g,d,c,a))return{i:c,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,g){if(a==Array.prototype||a==Object.prototype)return a;a[f]=g.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<a.length;++f){var g=a[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,f){var g=$jscomp.propertyToPolyfillSymbol[f];if(null==g)return a[f];g=a[g];return void 0!==g?g:a[f]};
$jscomp.polyfill=function(a,f,g,b){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,f,g,b):$jscomp.polyfillUnisolated(a,f,g,b))};$jscomp.polyfillUnisolated=function(a,f,g,b){g=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var c=a[b];if(!(c in g))return;g=g[c]}a=a[a.length-1];b=g[a];f=f(b);f!=b&&null!=f&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(a,f,g,b){var c=a.split(".");a=1===c.length;b=c[0];b=!a&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var d=0;d<c.length-1;d++){var e=c[d];if(!(e in b))return;b=b[e]}c=c[c.length-1];g=$jscomp.IS_SYMBOL_NATIVE&&"es6"===g?b[c]:null;f=f(g);null!=f&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:f}):f!==g&&(void 0===$jscomp.propertyToPolyfillSymbol[c]&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):
$jscomp.POLYFILL_PREFIX+c),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[c],{configurable:!0,writable:!0,value:f})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(f,g){return $jscomp.findInternal(this,f,g).v}},"es6","es3");
(function(a,f){var g=0;a.widget("dvr.eventRegistration",{options:{tablename:"case_event",ajax:null,ajaxURL:"",showPicture:!0,showPictureText:"Show Picture",hidePictureText:"Hide Picture"},_create:function(){this.id=g;g+=1;this.eventNamespace=".eventRegistration"},_init:function(){this.idPrefix="#"+this.options.tablename;var b=a(this.element);this.flagInfo=b.find("input[type=hidden][name=flags]");this.permissionInfo=b.find("input[type=hidden][name=permitted]");this.actionableInfo=b.find("input[type=hidden][name=actionable]");
this.eventType=b.find('input[type="hidden"][name="event"]');this.blockingInfo=b.find('input[type="hidden"][name="intervals"]');this.actionDetails=b.find('input[type="hidden"][name="actions"]');this.imageURL=b.find('input[type="hidden"][name="image"]');this.blockedEvents=(b=this.blockingInfo.val())?JSON.parse(b):{};this.blockingMessage=null;this.refresh()},_destroy:function(){a.Widget.prototype.destroy.call(this)},refresh:function(){var b=this.options,c=this.idPrefix;this._unbindEvents();b.ajaxURL&&
null===b.ajax&&(b.ajax=!0);this._showFlagInfo();this._showProfilePicture();a(this.element).find(c+"_details__row .controls").addClass("has-details");this.actionDetails.length?JSON.parse(this.actionDetails.val()).length?this._showDetails(!0):this._hideDetails():this._hideDetails();this._checkBlockedEvents()||this._toggleSubmit(!1);b=a(c+"_label");b.focus().val(b.val());this._bindEvents()},_checkID:function(){this._clearAlert();a(this.element);var b=this.idPrefix,c=a(b+"_label"),d=c.val().trim();c.val(d);
if(d){c={l:d,c:!0};d=this.options.ajaxURL;var e=a(b+"_person__row .controls").empty(),m=a('<div class="inline-throbber">').insertAfter(e),l=this;this._removeProfilePicture();this._clearDetails();a.ajaxS3({url:d,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(h){m.remove();if(h.e)a('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+h.e+"</div></div>").hide().insertAfter(a(b+"_label")).slideDown();
else{e.html(h.p).removeClass("hide").show();var k=l.flagInfo;h.f?k.val(JSON.stringify(h.f)):k.val("[]");k=l.permissionInfo;h.s!==f?k.val(JSON.stringify(h.s)):k.val("false");k=l.actionableInfo;var n=h.u;k.length&&(n!==f?k.val(JSON.stringify(h.u)):(n=!0,k.val("true")));h.d&&l._updateDetails(h.d,n);h.b&&(l.imageURL.val(h.b),l._showProfilePicture());l.blockedEvents=h.i||{};l.blockingInfo.val(JSON.stringify(l.blockedEvents));l.eventType.val()&&l._toggleSubmit(!0);l._showFlagInfo()}h.a?S3.showAlert(h.a,
"error"):h.m&&S3.showAlert(h.m,"success")},error:function(){m.remove();l._clearForm(!0)}})}},_registerEvent:function(){this._clearAlert();var b=this.idPrefix,c=a(b+"_label").val(),d=this.eventType.val();if(c&&d){c={l:c,t:d};d=this.options.ajaxURL;var e=a(b+"_person__row .controls"),m=a('<div class="inline-throbber">').insertAfter(e),l=this;e=this.actionDetails;e.length&&(e=e.val(),c.d=e?JSON.parse(e):[]);c.c=a(b+"comments").val();a.ajaxS3({url:d,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",
data:JSON.stringify(c),success:function(h){m.remove();h.e?a('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+h.e+"</div></div>").hide().insertAfter(a(b+"_label")).slideDown():l._clearForm();h.a?S3.showAlert(h.a,"error",!1):h.m&&S3.showAlert(h.m,"success",!1)},error:function(){m.remove();this._clearForm(!0)}})}},_checkBlockedEvents:function(){var b=this.eventType.val();b=this.blockedEvents[b];this.blockingMessage&&this.blockingMessage.remove();if(b){var c=
a("<h6>").addClass("event-registration-blocked").html(b[0]);if(new Date(b[1])>new Date)return this.blockingMessage=a("<div>").addClass("small-12-columns").append(c).prependTo(a("#submit_record__row")),!1}return!0},_showFlagInfo:function(){var b=this.flagInfo,c=a(this.idPrefix+"_flaginfo__row .controls").empty();b=b.length?JSON.parse(b.val()):[];var d=b.length;if(d){c.addClass("has-flaginfo");c=a('<div class="checkpoint-advise">').hide().appendTo(c);for(var e,m,l=0;l<d;l++)e=b[l],m=a('<div class="checkpoint-instructions">').appendTo(c),
a("<h4>"+e.n+"</h4>").appendTo(m),e.i&&a("<p>"+e.i+"</p>").appendTo(m);c.slideDown()}},_showProfilePicture:function(){var b=a(this.element),c=this.options,d=this.imageURL.val();this._removeProfilePicture();if(d){var e=a('<button class="tiny secondary button toggle-picture" type="button">'),m=a('<div class="button-row">').append(e);e.text(c.showPictureText);a('<div class="panel profile-picture">').append(m).data("url",d).appendTo(b);c.showPicture&&this._togglePicture()}},_removeProfilePicture:function(){this.imageURL.val("");
a(this.element).find(".panel.profile-picture").remove()},_togglePicture:function(){var b=a(this.element),c=this.options;b=b.find(".panel.profile-picture");if(b.length){var d=b.find(".image-row"),e=b.data("url"),m=b.find("button.toggle-picture");d.length?(d.remove(),m.text(c.showPictureText)):e&&(d=a("<img>").attr("src",e),d=a('<div class="image-row">').append(d),b.prepend(d),m.text(c.hidePictureText))}},_hideDetails:function(){var b=this.idPrefix;a(b+"_person__row .controls").text()?a(b+"_details__row").show():
a(b+"_details__row").hide();a(b+"_date__row").hide();a(b+"_comments__row").hide()},_showDetails:function(b){var c=this.idPrefix;a(c+"_details__row").show();b&&(a(c+"_date__row").show(),a(c+"_comments__row").show())},_updateDetails:function(b,c){var d=this.idPrefix;a(d+"_details__row .controls");a(d+"_date__row .controls");var e=this.actionDetails;e.length&&(""!==b.h?e.val(JSON.stringify(b.h)):e.val("[]"));a(d+"_details__row .controls").html(b.d);a(d+"_date__row .controls").html(b.t);this._showDetails(c)},
_clearDetails:function(){var b=this.idPrefix;this._hideDetails();this.flagInfo.val("[]");this.permissionInfo.val("false");a(b+"_flaginfo__row .controls").empty();a(b+"_details__row .controls").empty();a(b+"_date__row .controls").empty();a(b+"_comments").val("");this.blockedEvents={};this.blockingMessage&&this.blockingMessage.remove();this.blockingInfo.val(JSON.stringify(this.blockedEvents))},_toggleSubmit:function(b){var c=a(this.element),d=[".check-btn",".submit-btn"],e=this.permissionInfo,m=this.actionableInfo;
if(b){var l=b=!1;e.length&&(e=e.val())&&(b=JSON.parse(e));b&&(l=!0,m.length&&(m=m.val())&&(l=JSON.parse(m)));b&&l&&(l=this._checkBlockedEvents());b&&l&&d.reverse()}e=c.find(d[0]);c.find(d[1]).prop("disabled",!0).hide().insertAfter(e);e.prop("disabled",!1).hide().removeClass("hide").show()},_clearAlert:function(){a(".alert-error, .alert-warning, .alert-info, .alert-success").fadeOut("fast");a(".error_wrapper").fadeOut("fast").remove()},_clearForm:function(b,c){var d=this.idPrefix;a(".inline-throbber").remove();
b||this._clearAlert();c||a(d+"_label").val("");a(d+"_person__row .controls").hide().empty();this._removeProfilePicture();this._clearDetails();this._toggleSubmit(!1)},_bindEvents:function(){var b=a(this.element),c=this.idPrefix,d=this.eventNamespace,e=this,m=a(".zxing-button"),l=a("#event-type-toggle"),h=a("#event-type-selector");-1==navigator.userAgent.toLowerCase().indexOf("android")?m.addClass("disabled").click(function(k){k.preventDefault();k.stopPropagation();return!1}):m.bind("click"+d,function(){e._clearAlert()});
l.bind("click"+d,function(){e._clearAlert();h.hasClass("hide")?h.hide().removeClass("hide").slideDown():h.slideToggle()});h.find("a.event-type-selector").bind("click"+d,function(){var k=a(this),n=k.data("code");k=k.data("name");a('input[type="hidden"][name="event"]').val(n);a(".event-type-name").text(k).removeClass("placeholder");a(c+"_person__row .controls").text()&&e._toggleSubmit(!0);m.each(function(){var p=a(this),q=p.data("tmp");q&&p.attr("href",q.replace("%7BEVENT%7D",n))});h.slideUp()});b.delegate(".toggle-picture",
"click"+d,function(k){k.preventDefault();e._togglePicture()});b.find("a.cancel-action").bind("click"+d,function(k){k.preventDefault();e._clearForm()});this.options.ajax&&(b.find(".check-btn").bind("click"+d,function(k){k.preventDefault();e._checkID()}),b.find(".submit-btn").unbind(d).bind("click"+d,function(k){k.preventDefault();e._registerEvent()}));b=a(c+"_label");b.bind("input"+d,function(k){e._clearForm(!1,!0)});b.bind("keyup"+d,function(k){switch(k.which){case 27:e._clearForm()}});return!0},
_unbindEvents:function(){var b=a(this.element),c=this.eventNamespace,d=this.idPrefix;a(".zxing-button").unbind(c).unbind("click");a("#event-type-toggle").unbind(c);a("#event-type-selector").find("a.event-type-selector").unbind(c);a(d+"_label").unbind(c);b.find("a.cancel-action").unbind(c);b.find(".check-btn").unbind(c);b.find(".submit-btn").unbind(c);b.undelegate(c);return!0}})})(jQuery);
