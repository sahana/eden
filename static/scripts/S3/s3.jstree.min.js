/*
 2013-15 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3

 2015 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3
*/
(function(d){"function"===typeof define&&define.amd?define(["jquery"],d):"object"===typeof exports?d(require("jquery")):d(jQuery)})(function(d,u){if(!d.jstree){var D=0,h=!1,m=!1,n=!1,v=[],r=d("script:last").attr("src"),t=document,A=t.createElement("LI"),y;A.setAttribute("role","treeitem");y=t.createElement("I");y.className="jstree-icon jstree-ocl";y.setAttribute("role","presentation");A.appendChild(y);y=t.createElement("A");y.className="jstree-anchor";y.setAttribute("href","#");y.setAttribute("tabindex",
"-1");t=t.createElement("I");t.className="jstree-icon jstree-themeicon";t.setAttribute("role","presentation");y.appendChild(t);A.appendChild(y);y=t=null;d.jstree={version:"3.0.9",defaults:{plugins:[]},plugins:{},path:r&&-1!==r.indexOf("/")?r.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g};d.jstree.create=function(a,b){var e=new d.jstree.core(++D),k=b;b=d.extend(!0,{},d.jstree.defaults,b);k&&k.plugins&&(b.plugins=k.plugins);d.each(b.plugins,function(a,k){"core"!==a&&
(e=e.plugin(k,b[k]))});e.init(a,b);return e};d.jstree.destroy=function(){d(".jstree:jstree").jstree("destroy");d(document).off(".jstree")};d.jstree.core=function(a){this._id=a;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}};d.jstree.reference=function(a){var b=null,e=null;a&&a.id&&(a=a.id);if(!e||!e.length)try{e=d(a)}catch(k){}if(!e||!e.length)try{e=d("#"+a.replace(d.jstree.idregex,"\\$&"))}catch(c){}e&&
e.length&&(e=e.closest(".jstree")).length&&(e=e.data("jstree"))?b=e:d(".jstree").each(function(){var e=d(this).data("jstree");if(e&&e._model.data[a])return b=e,!1});return b};d.fn.jstree=function(a){var b="string"===typeof a,e=Array.prototype.slice.call(arguments,1),k=null;if(!0===a&&!this.length)return!1;this.each(function(){var c=d.jstree.reference(this),g=b&&c?c[a]:null;k=b&&g?g.apply(c,e):null;c||b||a!==u&&!d.isPlainObject(a)||d(this).data("jstree",new d.jstree.create(this,a));if(c&&!b||!0===
a)k=c||!1;if(null!==k&&k!==u)return!1});return null!==k&&k!==u?k:this};d.expr[":"].jstree=d.expr.createPseudo(function(a){return function(a){return d(a).hasClass("jstree")&&d(a).data("jstree")!==u}});d.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:d.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0};d.jstree.core.prototype={plugin:function(a,b){var e=
d.jstree.plugins[a];return e?(this._data[a]={},e.prototype=this,new e(b,this)):this},init:function(a,b){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this.element=d(a).addClass("jstree jstree-"+this._id);this.settings=b;this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl="rtl"===this.element.css("direction");this.element[this._data.core.rtl?
"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0);this.element.attr("tabindex")||this.element.attr("tabindex","0");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();
this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().height()||
24;this.trigger("loading");this.load_node("#")},destroy:function(a){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(b){}a||this.element.empty();this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){var a="",b=null,e=0;this.element.on("dblclick.jstree",function(){if(document.selection&&
document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(e){}}}).on("mousedown.jstree",d.proxy(function(a){a.target===this.element[0]&&(a.preventDefault(),e=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(a){a.preventDefault()}).on("click.jstree",".jstree-ocl",d.proxy(function(a){this.toggle_node(a.target)},this)).on("dblclick.jstree",".jstree-anchor",d.proxy(function(a){this.settings.core.dblclick_toggle&&
this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",d.proxy(function(a){a.preventDefault();a.currentTarget!==document.activeElement&&d(a.currentTarget).focus();this.activate_node(a.currentTarget,a)},this)).on("keydown.jstree",".jstree-anchor",d.proxy(function(a){if("INPUT"===a.target.tagName)return!0;var e=null;this._data.core.rtl&&(37===a.which?a.which=39:39===a.which&&(a.which=37));switch(a.which){case 32:a.ctrlKey&&(a.type="click",d(a.currentTarget).trigger(a));break;case 13:a.type=
"click";d(a.currentTarget).trigger(a);break;case 37:a.preventDefault();this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(e=this.get_parent(a.currentTarget))&&"#"!==e.id&&this.get_node(e,!0).children(".jstree-anchor").focus();break;case 38:a.preventDefault();(e=this.get_prev_dom(a.currentTarget))&&e.length&&e.children(".jstree-anchor").focus();break;case 39:a.preventDefault();this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):
this.is_open(a.currentTarget)&&(e=this.get_node(a.currentTarget,!0).children(".jstree-children")[0])&&d(this._firstChild(e)).children(".jstree-anchor").focus();break;case 40:a.preventDefault();(e=this.get_next_dom(a.currentTarget))&&e.length&&e.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:a.preventDefault();(e=this._firstChild(this.get_container_ul()[0]))&&d(e).children(".jstree-anchor").filter(":visible").focus();break;case 35:a.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},
this)).on("load_node.jstree",d.proxy(function(a,e){e.status&&("#"!==e.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(d.proxy(function(){if(!this.get_container_ul().find(".jstree-loading").length){this._data.core.ready=!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var a=
[],e,c;e=0;for(c=this._data.core.selected.length;e<c;e++)a=a.concat(this._model.data[this._data.core.selected[e]].parents);a=d.vakata.array_unique(a);e=0;for(c=a.length;e<c;e++)this.open_node(a[e],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",d.proxy(function(e){if("INPUT"===e.target.tagName)return!0;b&&clearTimeout(b);b=setTimeout(function(){a=""},500);var c=String.fromCharCode(e.which).toLowerCase();
e=this.element.find(".jstree-anchor").filter(":visible");var g=e.index(document.activeElement)||0,f=!1;a+=c;if(1<a.length){e.slice(g).each(d.proxy(function(e,c){if(0===d(c).text().toLowerCase().indexOf(a))return d(c).focus(),f=!0,!1},this));if(f)return;e.slice(0,g).each(d.proxy(function(e,c){if(0===d(c).text().toLowerCase().indexOf(a))return d(c).focus(),f=!0,!1},this));if(f)return}(new RegExp("^"+c+"+$")).test(a)&&(e.slice(g+1).each(d.proxy(function(a,e){if(d(e).text().toLowerCase().charAt(0)===
c)return d(e).focus(),f=!0,!1},this)),f||e.slice(0,g+1).each(d.proxy(function(a,e){if(d(e).text().toLowerCase().charAt(0)===c)return d(e).focus(),f=!0,!1},this)))},this)).on("init.jstree",d.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots;this._data.core.themes.stripes=a.stripes;this._data.core.themes.icons=a.icons;this.set_theme(a.name||"default",a.url);this.set_theme_variant(a.variant)},this)).on("loading.jstree",d.proxy(function(){this[this._data.core.themes.dots?
"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",d.proxy(function(a){this._data.core.focused=null;d(a.currentTarget).filter(".jstree-hovered").mouseleave();this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",d.proxy(function(a){var e=this.get_node(a.currentTarget);e&&e.id&&(this._data.core.focused=e.id);this.element.find(".jstree-hovered").not(a.currentTarget).mouseleave();
d(a.currentTarget).mouseenter();this.element.attr("tabindex","-1")},this)).on("focus.jstree",d.proxy(function(){500<+new Date-e&&!this._data.core.focused&&(e=0,this.get_node(this.element.attr("aria-activedescendant"),!0).find("> .jstree-anchor").focus())},this)).on("mouseenter.jstree",".jstree-anchor",d.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",d.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree");
d(document).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={});b.instance=this;this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(a){var b=this.settings.core.strings;return d.isFunction(b)?b.call(this,a):b&&b[a]?b[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=
a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,b){a&&a.id&&(a=a.id);var e;try{if(this._model.data[a])a=this._model.data[a];else if("string"===typeof a&&this._model.data[a.replace(/^#/,"")])a=this._model.data[a.replace(/^#/,"")];else if("string"===typeof a&&(e=d("#"+a.replace(d.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[e.closest(".jstree-node").attr("id")])a=
this._model.data[e.closest(".jstree-node").attr("id")];else if((e=d(a,this.element)).length&&this._model.data[e.closest(".jstree-node").attr("id")])a=this._model.data[e.closest(".jstree-node").attr("id")];else if((e=d(a,this.element)).length&&e.hasClass("jstree"))a=this._model.data["#"];else return!1;b&&(a="#"===a.id?this.element:d("#"+a.id.replace(d.jstree.idregex,"\\$&"),this.element));return a}catch(k){return!1}},get_path:function(a,b,e){a=a.parents?a:this.get_node(a);if(!a||"#"===a.id||!a.parents)return!1;
var k,c,d=[];d.push(e?a.id:a.text);k=0;for(c=a.parents.length;k<c;k++)d.push(e?a.parents[k]:this.get_text(a.parents[k]));d=d.reverse().slice(1);return b?d.join(b):d},get_next_dom:function(a,b){var e;a=this.get_node(a,!0);if(a[0]===this.element[0]){for(e=this._firstChild(this.get_container_ul()[0]);e&&0===e.offsetHeight;)e=this._nextSibling(e);return e?d(e):!1}if(!a||!a.length)return!1;if(b){e=a[0];do e=this._nextSibling(e);while(e&&0===e.offsetHeight);return e?d(e):!1}if(a.hasClass("jstree-open")){for(e=
this._firstChild(a.children(".jstree-children")[0]);e&&0===e.offsetHeight;)e=this._nextSibling(e);if(null!==e)return d(e)}e=a[0];do e=this._nextSibling(e);while(e&&0===e.offsetHeight);return null!==e?d(e):a.parentsUntil(".jstree",".jstree-node").next(".jstree-node:visible").first()},get_prev_dom:function(a,b){var e;a=this.get_node(a,!0);if(a[0]===this.element[0]){for(e=this.get_container_ul()[0].lastChild;e&&0===e.offsetHeight;)e=this._previousSibling(e);return e?d(e):!1}if(!a||!a.length)return!1;
if(b){e=a[0];do e=this._previousSibling(e);while(e&&0===e.offsetHeight);return e?d(e):!1}e=a[0];do e=this._previousSibling(e);while(e&&0===e.offsetHeight);if(null!==e){for(a=d(e);a.hasClass("jstree-open");)a=a.children(".jstree-children").first().children(".jstree-node:visible:last");return a}return(e=a[0].parentNode.parentNode)&&e.className&&-1!==e.className.indexOf("jstree-node")?d(e):!1},get_parent:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.parent:!1},get_children_dom:function(a){a=this.get_node(a,
!0);return a[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):a&&a.length?a.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&
this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(a,b){var e,k,c,g,f;if(d.isArray(a))return this._load_nodes(a.slice(),b),!0;a=this.get_node(a);if(!a)return b&&b.call(this,a,!1),!1;if(a.state.loaded){a.state.loaded=!1;e=0;for(k=a.children_d.length;e<k;e++){c=0;for(g=a.parents.length;c<g;c++)this._model.data[a.parents[c]].children_d=d.vakata.array_remove_item(this._model.data[a.parents[c]].children_d,a.children_d[e]);this._model.data[a.children_d[e]].state.selected&&
(f=!0,this._data.core.selected=d.vakata.array_remove_item(this._data.core.selected,a.children_d[e]));delete this._model.data[a.children_d[e]]}a.children=[];a.children_d=[];f&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.loading=!0;this.get_node(a,!0).addClass("jstree-loading").attr("aria-busy",!0);this._load_node(a,d.proxy(function(e){a=this._model.data[a.id];a.state.loading=!1;a.state.loaded=e;var c=this.get_node(a,!0);a.state.loaded&&!a.children.length&&
c&&c.length&&!c.hasClass("jstree-leaf")&&c.removeClass("jstree-closed jstree-open").addClass("jstree-leaf");c.removeClass("jstree-loading").attr("aria-busy",!1);this.trigger("load_node",{node:a,status:e});b&&b.call(this,a,e)},this));return!0},_load_nodes:function(a,b,e){var k=!0,c=function(){this._load_nodes(a,b,!0)},d=this._model.data,f,q;f=0;for(q=a.length;f<q;f++)!d[a[f]]||d[a[f]].state.loaded&&e||(this.is_loading(a[f])||this.load_node(a[f],c),k=!1);k&&b&&!b.done&&(b.call(this,a),b.done=!0)},load_all:function(a,
b){a||(a="#");a=this.get_node(a);if(!a)return!1;var e=[],k=this._model.data,c=k[a.id].children_d,d,f;a.state&&!a.state.loaded&&e.push(a.id);d=0;for(f=c.length;d<f;d++)k[c[d]]&&k[c[d]].state&&!k[c[d]].state.loaded&&e.push(c[d]);e.length?this._load_nodes(e,function(){this.load_all(a,b)}):(b&&b.call(this,a),this.trigger("load_all",{node:a}))},_load_node:function(a,b){var e=this.settings.core.data;if(!e)return"#"===a.id?this._append_html_data(a,this._data.core.original_container_html.clone(!0),function(a){b.call(this,
a)}):b.call(this,!1);if(d.isFunction(e))return e.call(this,a,d.proxy(function(e){!1===e&&b.call(this,!1);this["string"===typeof e?"_append_html_data":"_append_json_data"](a,"string"===typeof e?d(e):e,function(a){b.call(this,a)})},this));if("object"===typeof e){if(e.url)return e=d.extend(!0,{},e),d.isFunction(e.url)&&(e.url=e.url.call(this,a)),d.isFunction(e.data)&&(e.data=e.data.call(this,a)),d.ajax(e).done(d.proxy(function(e,c,g){c=g.getResponseHeader("Content-Type");if(-1!==c.indexOf("json")||"object"===
typeof e)return this._append_json_data(a,e,function(a){b.call(this,a)});if(-1!==c.indexOf("html")||"string"===typeof e)return this._append_html_data(a,d(e),function(a){b.call(this,a)});this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:g})};this.settings.core.error.call(this,this._data.core.last_error);return b.call(this,!1)},this)).fail(d.proxy(function(e){b.call(this,!1);this._data.core.last_error={error:"ajax",plugin:"core",
id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:e})};this.settings.core.error.call(this,this._data.core.last_error)},this));e=d.isArray(e)||d.isPlainObject(e)?JSON.parse(JSON.stringify(e)):e;if("#"===a.id)return this._append_json_data(a,e,function(a){b.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error);return b.call(this,
!1)}if("string"===typeof e){if("#"===a.id)return this._append_html_data(a,d(e),function(a){b.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error)}return b.call(this,!1)},_node_changed:function(a){(a=this.get_node(a))&&this._model.changed.push(a.id)},_append_html_data:function(a,b,e){a=this.get_node(a);a.children=[];a.children_d=[];b=b.is("ul")?
b.children():b;var k=a.id,c=[],g=[],f=this._model.data,q=f[k];a=this._data.core.selected.length;var l,x;b.each(d.proxy(function(a,e){if(l=this._parse_model_from_html(d(e),k,q.parents.concat()))c.push(l),g.push(l),f[l].children_d.length&&(g=g.concat(f[l].children_d))},this));q.children=c;q.children_d=g;b=0;for(x=q.parents.length;b<x;b++)f[q.parents[b]].children_d=f[q.parents[b]].children_d.concat(g);this.trigger("model",{nodes:g,parent:k});"#"!==k?(this._node_changed(k),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),
this.redraw(!0));this._data.core.selected.length!==a&&this.trigger("changed",{action:"model",selected:this._data.core.selected});e.call(this,!0)},_append_json_data:function(a,b,e,k){a=this.get_node(a);a.children=[];a.children_d=[];b.d&&(b=b.d,"string"===typeof b&&(b=JSON.parse(b)));d.isArray(b)||(b=[b]);var c=null,g={df:this._model.default_state,dat:b,par:a.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},f=function(a,e){a.data&&(a=a.data);var c=a.dat,b=a.par,k=[],
d=[],f=[],g=a.df,l=a.t_id,q=a.t_cnt,h=a.m,m=h[b],n=a.sel,r,t,v,u=function(a,c,b){b=b?b.concat():[];c&&b.unshift(c);var k=a.id.toString(),d,l,q;c={id:k,text:a.text||"",icon:a.icon!==e?a.icon:!0,parent:c,parents:b,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(d in g)g.hasOwnProperty(d)&&(c.state[d]=g[d]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(c.icon=a.data.jstree.icon);if(a&&a.data&&(c.data=a.data,a.data.jstree))for(d in a.data.jstree)a.data.jstree.hasOwnProperty(d)&&
(c.state[d]=a.data.jstree[d]);if(a&&"object"===typeof a.state)for(d in a.state)a.state.hasOwnProperty(d)&&(c.state[d]=a.state[d]);if(a&&"object"===typeof a.li_attr)for(d in a.li_attr)a.li_attr.hasOwnProperty(d)&&(c.li_attr[d]=a.li_attr[d]);c.li_attr.id||(c.li_attr.id=k);if(a&&"object"===typeof a.a_attr)for(d in a.a_attr)a.a_attr.hasOwnProperty(d)&&(c.a_attr[d]=a.a_attr[d]);a&&a.children&&!0===a.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]);h[c.id]=c;d=0;for(k=c.children.length;d<k;d++)l=
u(h[c.children[d]],c.id,b),q=h[l],c.children_d.push(l),q.children_d.length&&(c.children_d=c.children_d.concat(q.children_d));delete a.data;delete a.children;h[c.id].original=a;c.state.selected&&f.push(c.id);return c.id},z=function(a,c,b){b=b?b.concat():[];c&&b.unshift(c);var k=!1,d,x,w;do k="j"+l+"_"+ ++q;while(h[k]);c={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==e?a.icon:!0,parent:c,parents:b,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},
original:!1};for(d in g)g.hasOwnProperty(d)&&(c.state[d]=g[d]);a&&a.id&&(c.id=a.id.toString());a&&a.text&&(c.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(c.icon=a.data.jstree.icon);if(a&&a.data&&(c.data=a.data,a.data.jstree))for(d in a.data.jstree)a.data.jstree.hasOwnProperty(d)&&(c.state[d]=a.data.jstree[d]);if(a&&"object"===typeof a.state)for(d in a.state)a.state.hasOwnProperty(d)&&(c.state[d]=a.state[d]);if(a&&"object"===typeof a.li_attr)for(d in a.li_attr)a.li_attr.hasOwnProperty(d)&&
(c.li_attr[d]=a.li_attr[d]);c.li_attr.id&&!c.id&&(c.id=c.li_attr.id.toString());c.id||(c.id=k);c.li_attr.id||(c.li_attr.id=c.id);if(a&&"object"===typeof a.a_attr)for(d in a.a_attr)a.a_attr.hasOwnProperty(d)&&(c.a_attr[d]=a.a_attr[d]);if(a&&a.children&&a.children.length){d=0;for(k=a.children.length;d<k;d++)x=z(a.children[d],c.id,b),w=h[x],c.children.push(x),w.children_d.length&&(c.children_d=c.children_d.concat(w.children_d));c.children_d=c.children_d.concat(c.children)}a&&a.children&&!0===a.children&&
(c.state.loaded=!1,c.children=[],c.children_d=[]);delete a.data;delete a.children;c.original=a;h[c.id]=c;c.state.selected&&f.push(c.id);return c.id};if(c.length&&c[0].id!==e&&c[0].parent!==e){t=0;for(v=c.length;t<v;t++)c[t].children||(c[t].children=[]),h[c[t].id.toString()]=c[t];t=0;for(v=c.length;t<v;t++)h[c[t].parent.toString()].children.push(c[t].id.toString()),m.children_d.push(c[t].id.toString());t=0;for(v=m.children.length;t<v;t++)r=u(h[m.children[t]],b,m.parents.concat()),d.push(r),h[r].children_d.length&&
(d=d.concat(h[r].children_d))}else{t=0;for(v=c.length;t<v;t++)if(r=z(c[t],b,m.parents.concat()))k.push(r),d.push(r),h[r].children_d.length&&(d=d.concat(h[r].children_d));m.children=k;m.children_d=d}t=0;for(v=m.parents.length;t<v;t++)h[m.parents[t]].children_d=h[m.parents[t]].children_d.concat(d);c={cnt:q,mod:h,sel:n,par:b,dpc:d,add:f};if("undefined"===typeof window||"undefined"===typeof window.document)postMessage(c);else return c},q=function(a,c){this._cnt=a.cnt;this._model.data=a.mod;if(c){var b,
k,f=a.add,g=a.sel,l=this._data.core.selected.slice(),q=this._model.data;if(g.length!==l.length||d.vakata.array_unique(g.concat(l)).length!==g.length){b=0;for(k=g.length;b<k;b++)-1===d.inArray(g[b],f)&&-1===d.inArray(g[b],l)&&(q[g[b]].state.selected=!1);b=0;for(k=l.length;b<k;b++)-1===d.inArray(l[b],g)&&(q[l[b]].state.selected=!0)}}a.add.length&&(this._data.core.selected=this._data.core.selected.concat(a.add));this.trigger("model",{nodes:a.dpc,parent:a.par});"#"!==a.par?(this._node_changed(a.par),
this.redraw()):this.redraw(!0);a.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected});e.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+f.toString()],{type:"text/javascript"}))),!this._data.core.working||k?(this._data.core.working=!0,c=new window.Worker(this._wrk),c.onmessage=d.proxy(function(a){q.call(this,a.data,!0);try{c.terminate(),
c=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),g.par?c.postMessage(g):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([a,b,e,!0])}catch(l){q.call(this,f(g),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):
this._data.core.working=!1}else q.call(this,f(g),!1)},_parse_model_from_html:function(a,b,e){e=e?[].concat(e):[];b&&e.unshift(b);var k,c,g=this._model.data,f={id:!1,text:!1,icon:!0,parent:b,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},q;for(q in this._model.default_state)this._model.default_state.hasOwnProperty(q)&&(f.state[q]=this._model.default_state[q]);b=d.vakata.attributes(a,!0);d.each(b,function(a,e){e=d.trim(e);if(!e.length)return!0;
f.li_attr[a]=e;"id"===a&&(f.id=e.toString())});b=a.children("a").first();b.length&&(b=d.vakata.attributes(b,!0),d.each(b,function(a,e){e=d.trim(e);e.length&&(f.a_attr[a]=e)}));b=a.children("a").first().length?a.children("a").first().clone():a.clone();b.children("ins, i, ul").remove();b=b.html();b=d("<div />").html(b);f.text=this.settings.core.force_text?b.text():b.html();b=a.data();f.data=b?d.extend(!0,{},b):null;f.state.opened=a.hasClass("jstree-open");f.state.selected=a.children("a").hasClass("jstree-clicked");
f.state.disabled=a.children("a").hasClass("jstree-disabled");if(f.data&&f.data.jstree)for(q in f.data.jstree)f.data.jstree.hasOwnProperty(q)&&(f.state[q]=f.data.jstree[q]);b=a.children("a").children(".jstree-themeicon");b.length&&(f.icon=b.hasClass("jstree-themeicon-hidden")?!1:b.attr("rel"));f.state.icon&&(f.icon=f.state.icon);b=a.children("ul").children("li");do q="j"+this._id+"_"+ ++this._cnt;while(g[q]);f.id=f.li_attr.id?f.li_attr.id.toString():q;b.length?(b.each(d.proxy(function(a,b){k=this._parse_model_from_html(d(b),
f.id,e);c=this._model.data[k];f.children.push(k);c.children_d.length&&(f.children_d=f.children_d.concat(c.children_d))},this)),f.children_d=f.children_d.concat(f.children)):a.hasClass("jstree-closed")&&(f.state.loaded=!1);f.li_attr["class"]&&(f.li_attr["class"]=f.li_attr["class"].replace("jstree-closed","").replace("jstree-open",""));f.a_attr["class"]&&(f.a_attr["class"]=f.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled",""));g[f.id]=f;f.state.selected&&this._data.core.selected.push(f.id);
return f.id},_parse_model_from_flat_json:function(a,b,e){e=e?e.concat():[];b&&e.unshift(b);var k=a.id.toString(),c=this._model.data,d=this._model.default_state,f,q;b={id:k,text:a.text||"",icon:a.icon!==u?a.icon:!0,parent:b,parents:e,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in d)d.hasOwnProperty(f)&&(b.state[f]=d[f]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,
a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(b.state[f]=a.data.jstree[f]);if(a&&"object"===typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(b.state[f]=a.state[f]);if(a&&"object"===typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(b.li_attr[f]=a.li_attr[f]);b.li_attr.id||(b.li_attr.id=k);if(a&&"object"===typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(b.a_attr[f]=a.a_attr[f]);a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=
[],b.children_d=[]);c[b.id]=b;f=0;for(k=b.children.length;f<k;f++)d=this._parse_model_from_flat_json(c[b.children[f]],b.id,e),q=c[d],b.children_d.push(d),q.children_d.length&&(b.children_d=b.children_d.concat(q.children_d));delete a.data;delete a.children;c[b.id].original=a;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_parse_model_from_json:function(a,b,e){e=e?e.concat():[];b&&e.unshift(b);var k=!1,c,d,f,q=this._model.data;d=this._model.default_state;do k="j"+this._id+"_"+ ++this._cnt;
while(q[k]);b={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==u?a.icon:!0,parent:b,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(c in d)d.hasOwnProperty(c)&&(b.state[c]=d[c]);a&&a.id&&(b.id=a.id.toString());a&&a.text&&(b.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(c in a.data.jstree)a.data.jstree.hasOwnProperty(c)&&(b.state[c]=
a.data.jstree[c]);if(a&&"object"===typeof a.state)for(c in a.state)a.state.hasOwnProperty(c)&&(b.state[c]=a.state[c]);if(a&&"object"===typeof a.li_attr)for(c in a.li_attr)a.li_attr.hasOwnProperty(c)&&(b.li_attr[c]=a.li_attr[c]);b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString());b.id||(b.id=k);b.li_attr.id||(b.li_attr.id=b.id);if(a&&"object"===typeof a.a_attr)for(c in a.a_attr)a.a_attr.hasOwnProperty(c)&&(b.a_attr[c]=a.a_attr[c]);if(a&&a.children&&a.children.length){c=0;for(k=a.children.length;c<
k;c++)d=this._parse_model_from_json(a.children[c],b.id,e),f=q[d],b.children.push(d),f.children_d.length&&(b.children_d=b.children_d.concat(f.children_d));b.children_d=b.children_d.concat(b.children)}a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);delete a.data;delete a.children;b.original=a;q[b.id]=b;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_redraw:function(){var a=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),
b=document.createElement("UL"),e,k,c,d=this._data.core.focused;k=0;for(c=a.length;k<c;k++)(e=this.redraw_node(a[k],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&b.appendChild(e);this._model.force_full_redraw&&(b.className=this.get_container_ul()[0].className,b.setAttribute("role","group"),this.element.empty().append(b));null!==d&&((e=this.get_node(d,!0))&&e.length&&e.children(".jstree-anchor")[0]!==document.activeElement?e.children(".jstree-anchor").focus():this._data.core.focused=
null);this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:a})},redraw:function(a){a&&(this._model.force_full_redraw=!0);this._redraw()},draw_children:function(a){var b=this.get_node(a),e=!1,k=!1,c=!1,e=document;if(!b)return!1;if("#"===b.id)return this.redraw(!0);a=this.get_node(a,!0);if(!a||!a.length)return!1;a.children(".jstree-children").remove();a=a[0];if(b.children.length&&b.state.loaded){c=e.createElement("UL");c.setAttribute("role","group");c.className="jstree-children";
e=0;for(k=b.children.length;e<k;e++)c.appendChild(this.redraw_node(b.children[e],!0,!0));a.appendChild(c)}},redraw_node:function(a,b,e,k){var c=this.get_node(a),g=!1,f=!1,q=!1,l=!1,x=!1,p=!1,w="",h=document,p=this._model.data,m=!1,n=null,B=w=0;if(!c)return!1;if("#"===c.id)return this.redraw(!0);b=b||0===c.children.length;if(a=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(c.id[0])?"\\3"+c.id[0]+" "+c.id.substr(1).replace(d.jstree.idregex,"\\$&"):c.id.replace(d.jstree.idregex,
"\\$&"))):document.getElementById(c.id))a=d(a),e||(g=a.parent().parent()[0],g===this.element[0]&&(g=null),f=a.index()),b||!c.children.length||a.children(".jstree-children").length||(b=!0),b||(q=a.children(".jstree-children")[0]),m=a.children(".jstree-anchor")[0]===document.activeElement,a.remove();else if(b=!0,!e){g="#"!==c.parent?d("#"+c.parent.replace(d.jstree.idregex,"\\$&"),this.element)[0]:null;if(!(null===g||g&&p[c.parent].state.opened))return!1;f=d.inArray(c.id,null===g?p["#"].children:p[c.parent].children)}a=
A.cloneNode(!0);w="jstree-node ";for(l in c.li_attr)c.li_attr.hasOwnProperty(l)&&"id"!==l&&("class"!==l?a.setAttribute(l,c.li_attr[l]):w+=c.li_attr[l]);c.a_attr.id||(c.a_attr.id=c.id+"_anchor");a.setAttribute("aria-selected",!!c.state.selected);a.setAttribute("aria-level",c.parents.length);a.setAttribute("aria-labelledby",c.a_attr.id);c.state.disabled&&a.setAttribute("aria-disabled",!0);c.state.loaded&&!c.children.length?w+=" jstree-leaf":(w+=c.state.opened&&c.state.loaded?" jstree-open":" jstree-closed",
a.setAttribute("aria-expanded",c.state.opened&&c.state.loaded));null!==c.parent&&p[c.parent].children[p[c.parent].children.length-1]===c.id&&(w+=" jstree-last");a.id=c.id;a.className=w;w=(c.state.selected?" jstree-clicked":"")+(c.state.disabled?" jstree-disabled":"");for(x in c.a_attr)!c.a_attr.hasOwnProperty(x)||"href"===x&&"#"===c.a_attr[x]||("class"!==x?a.childNodes[1].setAttribute(x,c.a_attr[x]):w+=" "+c.a_attr[x]);w.length&&(a.childNodes[1].className="jstree-anchor "+w);if(c.icon&&!0!==c.icon||
!1===c.icon)!1===c.icon?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===c.icon.indexOf("/")&&-1===c.icon.indexOf(".")?a.childNodes[1].childNodes[0].className+=" "+c.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage="url("+c.icon+")",a.childNodes[1].childNodes[0].style.backgroundPosition="center center",a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom");this.settings.core.force_text?
a.childNodes[1].appendChild(h.createTextNode(c.text)):a.childNodes[1].innerHTML+=c.text;if(b&&c.children.length&&(c.state.opened||k)&&c.state.loaded){p=h.createElement("UL");p.setAttribute("role","group");p.className="jstree-children";l=0;for(x=c.children.length;l<x;l++)p.appendChild(this.redraw_node(c.children[l],b,!0));a.appendChild(p)}q&&a.appendChild(q);if(!e){g||(g=this.element[0]);l=0;for(x=g.childNodes.length;l<x;l++)if(g.childNodes[l]&&g.childNodes[l].className&&-1!==g.childNodes[l].className.indexOf("jstree-children")){n=
g.childNodes[l];break}n||(n=h.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",g.appendChild(n));g=n;f<g.childNodes.length?g.insertBefore(a,g.childNodes[f]):g.appendChild(a);m&&(w=this.element[0].scrollTop,B=this.element[0].scrollLeft,a.childNodes[1].focus(),this.element[0].scrollTop=w,this.element[0].scrollLeft=B)}c.state.opened&&!c.state.loaded&&(c.state.opened=!1,setTimeout(d.proxy(function(){this.open_node(c.id,!1,0)},this),0));return a},open_node:function(a,b,
e){var k,c,g;if(d.isArray(a)){a=a.slice();k=0;for(c=a.length;k<c;k++)this.open_node(a[k],b,e);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;e=e===u?this.settings.core.animation:e;if(!this.is_closed(a))return b&&b.call(this,a,!1),!1;if(this.is_loaded(a))k=this.get_node(a,!0),g=this,k.length&&(e&&k.children(".jstree-children").length&&k.children(".jstree-children").stop(!0,!0),a.children.length&&!this._firstChild(k.children(".jstree-children")[0])&&this.draw_children(a),e?(this.trigger("before_open",
{node:a}),k.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(e,function(){this.style.display="";g.trigger("after_open",{node:a})})):(this.trigger("before_open",{node:a}),k[0].className=k[0].className.replace("jstree-closed","jstree-open"),k[0].setAttribute("aria-expanded",!0))),a.state.opened=!0,b&&b.call(this,a,!0),k.length||this.trigger("before_open",{node:a}),
this.trigger("open_node",{node:a}),e&&k.length||this.trigger("after_open",{node:a});else{if(this.is_loading(a))return setTimeout(d.proxy(function(){this.open_node(a,b,e)},this),500);this.load_node(a,function(a,c){return c?this.open_node(a,b,e):b?b.call(this,a,!1):!1})}},_open_to:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b,e,k=a.parents;b=0;for(e=k.length;b<e;b+=1)"#"!==b&&this.open_node(k[b],!1,0);return d("#"+a.id.replace(d.jstree.idregex,"\\$&"),this.element)},close_node:function(a,
b){var e,k,c,g;if(d.isArray(a)){a=a.slice();e=0;for(k=a.length;e<k;e++)this.close_node(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id||this.is_closed(a))return!1;b=b===u?this.settings.core.animation:b;c=this;g=this.get_node(a,!0);g.length&&(b?g.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(b,function(){this.style.display="";g.children(".jstree-children").remove();
c.trigger("after_close",{node:a})}):(g[0].className=g[0].className.replace("jstree-open","jstree-closed"),g.attr("aria-expanded",!1).children(".jstree-children").remove()));a.state.opened=!1;this.trigger("close_node",{node:a});b&&g.length||this.trigger("after_close",{node:a})},toggle_node:function(a){var b,e;if(d.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.toggle_node(a[b]);return!0}if(this.is_closed(a))return this.open_node(a);if(this.is_open(a))return this.close_node(a)},open_all:function(a,
b,e){a||(a="#");a=this.get_node(a);if(!a)return!1;var k="#"===a.id?this.get_container_ul():this.get_node(a,!0),c,d;if(!k.length){k=0;for(c=a.children_d.length;k<c;k++)this.is_closed(this._model.data[a.children_d[k]])&&(this._model.data[a.children_d[k]].state.opened=!0);return this.trigger("open_all",{node:a})}e=e||k;d=this;k=this.is_closed(a)?k.find(".jstree-closed").addBack():k.find(".jstree-closed");k.each(function(){d.open_node(this,function(a,c){c&&this.is_parent(a)&&this.open_all(a,b,e)},b||
0)});0===e.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(e)})},close_all:function(a,b){a||(a="#");a=this.get_node(a);if(!a)return!1;var e="#"===a.id?this.get_container_ul():this.get_node(a,!0),k=this,c;if(!e.length){e=0;for(c=a.children_d.length;e<c;e++)this._model.data[a.children_d[e]].state.opened=!1;return this.trigger("close_all",{node:a})}e=this.is_open(a)?e.find(".jstree-open").addBack():e.find(".jstree-open");d(e.get().reverse()).each(function(){k.close_node(this,
b||0)});this.trigger("close_all",{node:a})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(a){var b,e;if(d.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.enable_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!1;this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1);this.trigger("enable_node",{node:a})},disable_node:function(a){var b,e;if(d.isArray(a)){a=
a.slice();b=0;for(e=a.length;b<e;b++)this.disable_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!0;this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0);this.trigger("disable_node",{node:a})},activate_node:function(a,b){if(this.is_disabled(a))return!1;this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==u?this.get_node(this._data.core.last_clicked.id):null;this._data.core.last_clicked&&
!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null);!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&(!b.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(b.shiftKey){var e=this.get_node(a).id,k=this._data.core.last_clicked.id,
c=this.get_node(this._data.core.last_clicked.parent).children,d=!1,f,q;f=0;for(q=c.length;f<q;f+=1)c[f]===e&&(d=!d),c[f]===k&&(d=!d),d||c[f]===e||c[f]===k?this.select_node(c[f],!0,!1,b):this.deselect_node(c[f],!0,b);this.trigger("changed",{action:"select_node",node:this.get_node(a),selected:this._data.core.selected,event:b})}else this.is_selected(a)?this.deselect_node(a,!1,b):this.select_node(a,!1,!1,b);else!this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&this.is_selected(a)?this.deselect_node(a,
!1,b):(this.deselect_all(!0),this.select_node(a,!1,!1,b),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a)})},hover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),e=this.element;b&&b.length&&this.dehover_node(b);a.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(a)});setTimeout(function(){e.attr("aria-activedescendant",
a[0].id)},0)},dehover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||!a.children(".jstree-hovered").length)return!1;a.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(a)})},select_node:function(a,b,e,k){var c,g;if(d.isArray(a)){a=a.slice();c=0;for(g=a.length;c<g;c++)this.select_node(a[c],b,e,k);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=this.get_node(a,!0);a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),
e||(c=this._open_to(a)),c&&c.length&&c.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:k}),b||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:k}))},deselect_node:function(a,b,e){var k,c;if(d.isArray(a)){a=a.slice();k=0;for(c=a.length;k<c;k++)this.deselect_node(a[k],b,e);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;k=this.get_node(a,!0);a.state.selected&&
(a.state.selected=!1,this._data.core.selected=d.vakata.array_remove_item(this._data.core.selected,a.id),k.length&&k.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:e}),b||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:e}))},select_all:function(a){var b=this._data.core.selected.concat([]),e,d;this._data.core.selected=this._model.data["#"].children_d.concat();
e=0;for(d=this._data.core.selected.length;e<d;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:b})},deselect_all:function(a){var b=this._data.core.selected.concat([]),e,d;e=0;for(d=this._data.core.selected.length;e<d;e++)this._model.data[this._data.core.selected[e]]&&
(this._model.data[this._data.core.selected[e]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1);this.trigger("deselect_all",{selected:this._data.core.selected,node:b});a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:b})},is_selected:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.state.selected:!1},get_selected:function(a){return a?d.map(this._data.core.selected,
d.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(a){var b=this.get_selected(!0),e={},k,c,g,f;k=0;for(c=b.length;k<c;k++)e[b[k].id]=b[k];k=0;for(c=b.length;k<c;k++)for(g=0,f=b[k].children_d.length;g<f;g++)e[b[k].children_d[g]]&&delete e[b[k].children_d[g]];b=[];for(k in e)e.hasOwnProperty(k)&&b.push(k);return a?d.map(b,d.proxy(function(a){return this.get_node(a)},this)):b},get_bottom_selected:function(a){var b=this.get_selected(!0),e=[],
k,c;k=0;for(c=b.length;k<c;k++)b[k].children.length||e.push(b[k].id);return a?d.map(e,d.proxy(function(a){return this.get_node(a)},this)):e},get_state:function(){var a={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},b;for(b in this._model.data)this._model.data.hasOwnProperty(b)&&"#"!==b&&(this._model.data[b].state.opened&&a.core.open.push(b),this._model.data[b].state.selected&&a.core.selected.push(b));return a},set_state:function(a,b){if(a){if(a.core){var e,
k,c,g;if(a.core.open){if(!d.isArray(a.core.open))return delete a.core.open,this.set_state(a,b),!1;e=!0;k=!1;c=this;d.each(a.core.open.concat([]),function(f,g){if(k=c.get_node(g))c.is_loaded(g)?(c.is_closed(g)&&c.open_node(g,!1,0),a&&a.core&&a.core.open&&d.vakata.array_remove_item(a.core.open,g)):(c.is_loading(g)||c.open_node(g,d.proxy(function(e,c){!c&&a&&a.core&&a.core.open&&d.vakata.array_remove_item(a.core.open,e.id);this.set_state(a,b)},c),0),e=!1)});e&&(delete a.core.open,this.set_state(a,b));
return!1}if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==u&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==u&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,b),!1;if(a.core.selected)return g=this,this.deselect_all(),d.each(a.core.selected,function(a,e){g.select_node(e)}),delete a.core.selected,this.set_state(a,b),!1;if(d.isEmptyObject(a.core))return delete a.core,this.set_state(a,b),!1}return d.isEmptyObject(a)?(a=null,b&&
b.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a,b){this._data.core.state=!0===b?{}:this.get_state();b&&d.isFunction(b)&&(this._data.core.state=b.call(this,this._data.core.state));this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var e=this.get_container_ul()[0].className;a||(this.element.html("<ul class='"+e+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+
this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"));this.load_node("#",function(a,c){c&&(this.get_container_ul()[0].className=e,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(d.extend(!0,
{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b=[],e=[];this._data.core.selected.concat([]);e.push(a.id);!0===a.state.opened&&b.push(a.id);this.get_node(a,!0).find(".jstree-open").each(function(){b.push(this.id)});this._load_nodes(e,d.proxy(function(e){this.open_node(b,!1,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:a,nodes:e})},this))},set_id:function(a,
b){a=this.get_node(a);if(!a||"#"===a.id)return!1;var e,k,c=this._model.data;b=b.toString();c[a.parent].children[d.inArray(a.id,c[a.parent].children)]=b;e=0;for(k=a.parents.length;e<k;e++)c[a.parents[e]].children_d[d.inArray(a.id,c[a.parents[e]].children_d)]=b;e=0;for(k=a.children.length;e<k;e++)c[a.children[e]].parent=b;e=0;for(k=a.children_d.length;e<k;e++)c[a.children_d[e]].parents[d.inArray(a.id,c[a.children_d[e]].parents)]=b;e=d.inArray(a.id,this._data.core.selected);-1!==e&&(this._data.core.selected[e]=
b);(e=this.get_node(a.id,!0))&&e.attr("id",b);delete c[a.id];a.id=b;c[b]=a;return!0},get_text:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.text:!1},set_text:function(a,b){var e,k;if(d.isArray(a)){a=a.slice();e=0;for(k=a.length;e<k;e++)this.set_text(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.text=b;this.get_node(a,!0).length&&this.redraw_node(a.id);this.trigger("set_text",{obj:a,text:b});return!0},get_json:function(a,b,e){a=this.get_node(a||"#");if(!a)return!1;b&&b.flat&&
!e&&(e=[]);var k={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:d.extend(!0,{},a.li_attr),a_attr:d.extend(!0,{},a.a_attr),state:{},data:b&&b.no_data?!1:d.extend(!0,{},a.data)},c,g;b&&b.flat?k.parent=a.parent:k.children=[];if(!b||!b.no_state)for(c in a.state)a.state.hasOwnProperty(c)&&(k.state[c]=a.state[c]);b&&b.no_id&&(delete k.id,k.li_attr&&k.li_attr.id&&delete k.li_attr.id,k.a_attr&&k.a_attr.id&&delete k.a_attr.id);b&&b.flat&&"#"!==a.id&&e.push(k);if(!b||!b.no_children)for(c=0,g=a.children.length;c<
g;c++)b&&b.flat?this.get_json(a.children[c],b,e):k.children.push(this.get_json(a.children[c],b));return b&&b.flat?e:"#"===a.id?k.children:k},create_node:function(a,b,e,k,c){null===a&&(a="#");a=this.get_node(a);if(!a)return!1;e=e===u?"last":e;if(!e.toString().match(/^(before|after)$/)&&!c&&!this.is_loaded(a))return this.load_node(a,function(){this.create_node(a,b,e,k,!0)});b||(b={text:this.get_string("New node")});"string"===typeof b&&(b={text:b});b.text===u&&(b.text=this.get_string("New node"));var g,
f,q;"#"===a.id&&("before"===e&&(e="first"),"after"===e&&(e="last"));switch(e){case "before":c=this.get_node(a.parent);e=d.inArray(a.id,c.children);a=c;break;case "after":c=this.get_node(a.parent);e=d.inArray(a.id,c.children)+1;a=c;break;case "inside":case "first":e=0;break;case "last":e=a.children.length;break;default:e||(e=0)}e>a.children.length&&(e=a.children.length);b.id||(b.id=!0);if(!this.check("create_node",b,a,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;!0===
b.id&&delete b.id;b=this._parse_model_from_json(b,a.id,a.parents.concat());if(!b)return!1;c=this.get_node(b);g=[];g.push(b);g=g.concat(c.children_d);this.trigger("model",{nodes:g,parent:a.id});a.children_d=a.children_d.concat(g);f=0;for(q=a.parents.length;f<q;f++)this._model.data[a.parents[f]].children_d=this._model.data[a.parents[f]].children_d.concat(g);b=c;c=[];f=0;for(q=a.children.length;f<q;f++)c[f>=e?f+1:f]=a.children[f];c[e]=b.id;a.children=c;this.redraw_node(a,!0);k&&k.call(this,this.get_node(b));
this.trigger("create_node",{node:this.get_node(b),parent:a.id,position:e});return b.id},rename_node:function(a,b){var e,k;if(d.isArray(a)){a=a.slice();e=0;for(k=a.length;e<k;e++)this.rename_node(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;e=a.text;if(!this.check("rename_node",a,this.get_parent(a),b))return this.settings.core.error.call(this,this._data.core.last_error),!1;this.set_text(a,b);this.trigger("rename_node",{node:a,text:b,old:e});return!0},delete_node:function(a){var b,
e,k,c,g,f,q,l;if(d.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.delete_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;b=this.get_node(a.parent);e=d.inArray(a.id,b.children);l=!1;if(!this.check("delete_node",a,b,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;-1!==e&&(b.children=d.vakata.array_remove(b.children,e));k=a.children_d.concat([]);k.push(a.id);f=0;for(q=k.length;f<q;f++){c=0;for(g=a.parents.length;c<g;c++)e=d.inArray(k[f],this._model.data[a.parents[c]].children_d),
-1!==e&&(this._model.data[a.parents[c]].children_d=d.vakata.array_remove(this._model.data[a.parents[c]].children_d,e));this._model.data[k[f]].state.selected&&(l=!0,e=d.inArray(k[f],this._data.core.selected),-1!==e&&(this._data.core.selected=d.vakata.array_remove(this._data.core.selected,e)))}this.trigger("delete_node",{node:a,parent:b.id});l&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:b.id});f=0;for(q=k.length;f<q;f++)delete this._model.data[k[f]];
this.redraw_node(b,!0);return!0},check:function(a,b,e,k,c){b=b&&b.id?b:this.get_node(b);e=e&&e.id?e:this.get_node(e);var g=a.match(/^move_node|copy_node|create_node$/i)?e:b,f=this.settings.core.check_callback;if(!("move_node"!==a&&"copy_node"!==a||c&&c.is_multi||b.id!==e.id&&d.inArray(b.id,e.children)!==k&&-1===d.inArray(e.id,b.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,pos:k,obj:b&&b.id?b.id:
!1,par:e&&e.id?e.id:!1})},!1;g&&g.data&&(g=g.data);return g&&g.functions&&(!1===g.functions[a]||!0===g.functions[a])?(!1===g.functions[a]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:k,obj:b&&b.id?b.id:!1,par:e&&e.id?e.id:!1})}),g.functions[a]):!1===f||d.isFunction(f)&&!1===f.call(this,a,b,e,k,c)||f&&!1===f[a]?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+
a,data:JSON.stringify({chk:a,pos:k,obj:b&&b.id?b.id:!1,par:e&&e.id?e.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(a,b,e,k,c,g){var f,q,l,x,p,w,h,m,n,B;b=this.get_node(b);e=e===u?0:e;if(!b)return!1;if(!e.toString().match(/^(before|after)$/)&&!c&&!this.is_loaded(b))return this.load_node(b,function(){this.move_node(a,b,e,k,!0)});if(d.isArray(a)){a=a.slice();g=0;for(f=a.length;g<f;g++)this.move_node(a[g],b,e,k,c,!0)&&(b=a[g],e="after");this.redraw();return!0}a=
a&&a.id?a:this.get_node(a);if(!a||"#"===a.id)return!1;f=(a.parent||"#").toString();l=e.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;x=a.instance?a.instance:this._model.data[a.id]?this:d.jstree.reference(a.id);p=!x||!x._id||this._id!==x._id;q=x&&x._id&&f&&x._model.data[f]&&x._model.data[f].children?d.inArray(a.id,x._model.data[f].children):-1;if(p)return this.copy_node(a,b,e,k,c)?(x&&x.delete_node(a),!0):!1;"#"===b.id&&("before"===e&&(e="first"),"after"===e&&(e="last"));
switch(e){case "before":e=d.inArray(b.id,l.children);break;case "after":e=d.inArray(b.id,l.children)+1;break;case "inside":case "first":e=0;break;case "last":e=l.children.length;break;default:e||(e=0)}e>l.children.length&&(e=l.children.length);if(!this.check("move_node",a,l,e,{core:!0,is_multi:x&&x._id&&x._id!==this._id,is_foreign:!x||!x._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===l.id){c=l.children.concat();p=d.inArray(a.id,c);-1!==p&&(c=d.vakata.array_remove(c,
p),e>p&&e--);p=[];w=0;for(h=c.length;w<h;w++)p[w>=e?w+1:w]=c[w];p[e]=a.id;l.children=p;this._node_changed(l.id);this.redraw("#"===l.id)}else{p=a.children_d.concat();p.push(a.id);w=0;for(h=a.parents.length;w<h;w++){c=[];B=x._model.data[a.parents[w]].children_d;m=0;for(n=B.length;m<n;m++)-1===d.inArray(B[m],p)&&c.push(B[m]);x._model.data[a.parents[w]].children_d=c}x._model.data[f].children=d.vakata.array_remove_item(x._model.data[f].children,a.id);w=0;for(h=l.parents.length;w<h;w++)this._model.data[l.parents[w]].children_d=
this._model.data[l.parents[w]].children_d.concat(p);c=[];w=0;for(h=l.children.length;w<h;w++)c[w>=e?w+1:w]=l.children[w];c[e]=a.id;l.children=c;l.children_d.push(a.id);l.children_d=l.children_d.concat(a.children_d);a.parent=l.id;p=l.parents.concat();p.unshift(l.id);B=a.parents.length;a.parents=p;p=p.concat();w=0;for(h=a.children_d.length;w<h;w++)this._model.data[a.children_d[w]].parents=this._model.data[a.children_d[w]].parents.slice(0,-1*B),Array.prototype.push.apply(this._model.data[a.children_d[w]].parents,
p);if("#"===f||"#"===l.id)this._model.force_full_redraw=!0;this._model.force_full_redraw||(this._node_changed(f),this._node_changed(l.id));g||this.redraw()}k&&k.call(this,a,l,e);this.trigger("move_node",{node:a,parent:l.id,position:e,old_parent:f,old_position:q,is_multi:x&&x._id&&x._id!==this._id,is_foreign:!x||!x._id,old_instance:x,new_instance:this});return!0},copy_node:function(a,b,e,k,c,g){var f,q,l,x,p,h;b=this.get_node(b);e=e===u?0:e;if(!b)return!1;if(!e.toString().match(/^(before|after)$/)&&
!c&&!this.is_loaded(b))return this.load_node(b,function(){this.copy_node(a,b,e,k,!0)});if(d.isArray(a)){a=a.slice();g=0;for(f=a.length;g<f;g++)if(q=this.copy_node(a[g],b,e,k,c,!0))b=q,e="after";this.redraw();return!0}a=a&&a.id?a:this.get_node(a);if(!a||"#"===a.id)return!1;f=(a.parent||"#").toString();p=e.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;h=a.instance?a.instance:this._model.data[a.id]?this:d.jstree.reference(a.id);"#"===b.id&&("before"===e&&(e="first"),"after"===
e&&(e="last"));switch(e){case "before":e=d.inArray(b.id,p.children);break;case "after":e=d.inArray(b.id,p.children)+1;break;case "inside":case "first":e=0;break;case "last":e=p.children.length;break;default:e||(e=0)}e>p.children.length&&(e=p.children.length);if(!this.check("copy_node",a,p,e,{core:!0,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;l=h?h.get_json(a,{no_id:!0,no_data:!0,no_state:!0}):a;if(!l)return!1;
!0===l.id&&delete l.id;l=this._parse_model_from_json(l,p.id,p.parents.concat());if(!l)return!1;q=this.get_node(l);a&&a.state&&!1===a.state.loaded&&(q.state.loaded=!1);c=[];c.push(l);c=c.concat(q.children_d);this.trigger("model",{nodes:c,parent:p.id});l=0;for(x=p.parents.length;l<x;l++)this._model.data[p.parents[l]].children_d=this._model.data[p.parents[l]].children_d.concat(c);c=[];l=0;for(x=p.children.length;l<x;l++)c[l>=e?l+1:l]=p.children[l];c[e]=q.id;p.children=c;p.children_d.push(q.id);p.children_d=
p.children_d.concat(q.children_d);"#"===p.id&&(this._model.force_full_redraw=!0);this._model.force_full_redraw||this._node_changed(p.id);g||this.redraw("#"===p.id);k&&k.call(this,q,p,e);this.trigger("copy_node",{node:q,original:a,parent:p.id,position:e,old_parent:f,old_position:h&&h._id&&f&&h._model.data[f]&&h._model.data[f].children?d.inArray(a.id,h._model.data[f].children):-1,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this});return q.id},cut:function(a){a||
(a=this._data.core.selected.concat());d.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],e,k,c;k=0;for(c=a.length;k<c;k++)(e=this.get_node(a[k]))&&e.id&&"#"!==e.id&&b.push(e);if(!b.length)return!1;h=b;n=this;m="move_node";this.trigger("cut",{node:a})},copy:function(a){a||(a=this._data.core.selected.concat());d.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],e,k,c;k=0;for(c=a.length;k<c;k++)(e=this.get_node(a[k]))&&e.id&&"#"!==e.id&&b.push(e);if(!b.length)return!1;h=b;n=this;m="copy_node";this.trigger("copy",
{node:a})},get_buffer:function(){return{mode:m,node:h,inst:n}},can_paste:function(){return!1!==m&&!1!==h},paste:function(a,b){a=this.get_node(a);if(!(a&&m&&m.match(/^(copy_node|move_node)$/)&&h))return!1;this[m](h,a,b)&&this.trigger("paste",{parent:a.id,node:h,mode:m});n=m=h=!1},clear_buffer:function(){n=m=h=!1;this.trigger("clear_buffer")},edit:function(a,b){a=this.get_node(a);if(!a)return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",
id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;b="string"===typeof b?b:a.text;this.set_text(a,"");a=this._open_to(a);var e=this._data.core.rtl,k=this.element.width(),c=a.children(".jstree-anchor"),g=d("<span>"),f=b,q=d("<div />",{css:{position:"absolute",top:"-200px",left:e?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=d("<input />",{value:f,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver",
"box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:d.proxy(function(){var e=g.children(".jstree-rename-input").val();""===e&&(e=f);q.remove();g.replaceWith(c);g.remove();this.set_text(a,f);!1===this.rename_node(a,d("<div></div>").text(e)[this.settings.core.force_text?"text":"html"]())&&this.set_text(a,f)},this),keydown:function(a){var e=a.which;27===e&&(this.value=f);27!==e&&13!==e&&37!==e&&38!==e&&39!==
e&&40!==e&&32!==e||a.stopImmediatePropagation();if(27===e||13===e)a.preventDefault(),this.blur()},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){l.width(Math.min(q.text("pW"+this.value).width(),k))},keypress:function(a){if(13===a.which)return!1}}),e={fontFamily:c.css("fontFamily")||"",fontSize:c.css("fontSize")||"",fontWeight:c.css("fontWeight")||"",fontStyle:c.css("fontStyle")||"",fontStretch:c.css("fontStretch")||"",fontVariant:c.css("fontVariant")||
"",letterSpacing:c.css("letterSpacing")||"",wordSpacing:c.css("wordSpacing")||""};g.attr("class",c.attr("class")).append(c.contents().clone()).append(l);c.replaceWith(g);q.css(e);l.css(e).width(Math.min(q.text("pW"+l[0].value).width(),k))[0].select()},set_theme:function(a,b){if(!a)return!1;if(!0===b){var e=this.settings.core.themes.dir;e||(e=d.jstree.path+"/themes");b=e+"/"+a+"/style.css"}b&&-1===d.inArray(b,v)&&(d("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />'),v.push(b));
this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=a;this.element.addClass("jstree-"+a);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive");this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);
(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():
this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons")},
toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(a,b){var e,k;if(d.isArray(a)){a=a.slice();e=0;for(k=a.length;e<k;e++)this.set_icon(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;k=a.icon;a.icon=b;e=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon");!1===b?this.hide_icon(a):(!0===b?e.removeClass("jstree-themeicon-custom "+k).css("background","").removeAttr("rel"):-1===b.indexOf("/")&&-1===b.indexOf(".")?
(e.removeClass(k).css("background",""),e.addClass(b+" jstree-themeicon-custom").attr("rel",b)):(e.removeClass(k).css("background",""),e.addClass("jstree-themeicon-custom").css("background","url('"+b+"') center center no-repeat").attr("rel",b)),!1===k&&this.show_icon(a));return!0},get_icon:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.icon:!1},hide_icon:function(a){var b,e;if(d.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.hide_icon(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;
a.icon=!1;this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return!0},show_icon:function(a){var b,e;if(d.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.show_icon(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;b=this.get_node(a,!0);a.icon=b.length?b.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0;a.icon||(a.icon=!0);b.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");
return!0}};d.vakata={};d.vakata.attributes=function(a,b){a=d(a)[0];var e=b?{}:[];a&&a.attributes&&d.each(a.attributes,function(a,c){-1===d.inArray(c.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==c.value&&""!==d.trim(c.value)&&(b?e[c.name]=c.value:e.push(c.name))});return e};d.vakata.array_unique=function(a){var b=[],e,d,c;e=0;for(c=a.length;e<c;e++){for(d=0;d<=e&&a[e]!==a[d];d++);d===e&&b.push(a[e])}return b};d.vakata.array_remove=function(a,b,e){e=a.slice((e||b)+1||
a.length);a.length=0>b?a.length+b:b;a.push.apply(a,e);return a};d.vakata.array_remove_item=function(a,b){var e=d.inArray(b,a);return-1!==e?d.vakata.array_remove(a,e):a};var z=document.createElement("I");z.className="jstree-icon jstree-checkbox";z.setAttribute("role","presentation");d.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0};d.jstree.plugins.checkbox=function(a,b){this.bind=function(){b.bind.call(this);this._data.checkbox.uto=
!1;this._data.checkbox.selected=[];this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",d.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked");this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",d.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":
"hide_checkboxes"]()},this));if(-1!==this.settings.checkbox.cascade.indexOf("undetermined"))this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",d.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(d.proxy(this._undetermined,this),50)},this));if(!this.settings.checkbox.tie_selection)this.element.on("model.jstree",d.proxy(function(a,
b){var c=this._model.data,d=b.nodes,f,q;f=0;for(q=d.length;f<q;f++)c[d[f]].state.checked=c[d[f]].original&&c[d[f]].original.state&&c[d[f]].original.state.checked,c[d[f]].state.checked&&this._data.checkbox.selected.push(d[f])},this));if(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))this.element.on("model.jstree",d.proxy(function(a,b){var c=this._model.data,g=c[b.parent],f=b.nodes,q=[],l,h,p,w,m=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection;
if(-1!==m.indexOf("down"))if(g.state[n?"selected":"checked"]){l=0;for(h=f.length;l<h;l++)c[f[l]].state[n?"selected":"checked"]=!0;this._data[n?"core":"checkbox"].selected=this._data[n?"core":"checkbox"].selected.concat(f)}else for(l=0,h=f.length;l<h;l++)if(c[f[l]].state[n?"selected":"checked"]){p=0;for(w=c[f[l]].children_d.length;p<w;p++)c[c[f[l]].children_d[p]].state[n?"selected":"checked"]=!0;this._data[n?"core":"checkbox"].selected=this._data[n?"core":"checkbox"].selected.concat(c[f[l]].children_d)}if(-1!==
m.indexOf("up")){l=0;for(h=g.children_d.length;l<h;l++)c[g.children_d[l]].children.length||q.push(c[g.children_d[l]].parent);q=d.vakata.array_unique(q);p=0;for(w=q.length;p<w;p++)for(g=c[q[p]];g&&"#"!==g.id;){l=f=0;for(h=g.children.length;l<h;l++)f+=c[g.children[l]].state[n?"selected":"checked"];if(f===h)g.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(g.id),(l=this.get_node(g,!0))&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":
"jstree-checked");else break;g=this.get_node(g.parent)}}this._data[n?"core":"checkbox"].selected=d.vakata.array_unique(this._data[n?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",d.proxy(function(a,b){var c=b.node,g=this._model.data,f=this.get_node(c.parent),q=this.get_node(c,!0),l,h,p,m=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection;if(-1!==m.indexOf("down"))for(this._data[n?"core":"checkbox"].selected=
d.vakata.array_unique(this._data[n?"core":"checkbox"].selected.concat(c.children_d)),l=0,h=c.children_d.length;l<h;l++)p=g[c.children_d[l]],p.state[n?"selected":"checked"]=!0,p&&p.original&&p.original.state&&p.original.state.undetermined&&(p.original.state.undetermined=!1);if(-1!==m.indexOf("up"))for(;f&&"#"!==f.id;){l=c=0;for(h=f.children.length;l<h;l++)c+=g[f.children[l]].state[n?"selected":"checked"];if(c===h)f.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(f.id),
(p=this.get_node(f,!0))&&p.length&&p.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked");else break;f=this.get_node(f.parent)}-1!==m.indexOf("down")&&q.length&&q.find(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",d.proxy(function(a,b){var c=this.get_node("#"),d=this._model.data,f,q,l;f=0;for(q=c.children_d.length;f<
q;f++)(l=d[c.children_d[f]])&&l.original&&l.original.state&&l.original.state.undetermined&&(l.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",d.proxy(function(a,b){var c=b.node,g=this.get_node(c,!0),f,q,l,h=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;c&&c.original&&c.original.state&&c.original.state.undetermined&&(c.original.state.undetermined=!1);if(-1!==h.indexOf("down"))for(f=0,q=c.children_d.length;f<
q;f++)l=this._model.data[c.children_d[f]],l.state[p?"selected":"checked"]=!1,l&&l.original&&l.original.state&&l.original.state.undetermined&&(l.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(f=0,q=c.parents.length;f<q;f++)l=this._model.data[c.parents[f]],l.state[p?"selected":"checked"]=!1,l&&l.original&&l.original.state&&l.original.state.undetermined&&(l.original.state.undetermined=!1),(l=this.get_node(c.parents[f],!0))&&l.length&&l.attr("aria-selected",!1).children(".jstree-anchor").removeClass(p?
"jstree-clicked":"jstree-checked");l=[];f=0;for(q=this._data[p?"core":"checkbox"].selected.length;f<q;f++)-1!==h.indexOf("down")&&-1!==d.inArray(this._data[p?"core":"checkbox"].selected[f],c.children_d)||-1!==h.indexOf("up")&&-1!==d.inArray(this._data[p?"core":"checkbox"].selected[f],c.parents)||l.push(this._data[p?"core":"checkbox"].selected[f]);this._data[p?"core":"checkbox"].selected=d.vakata.array_unique(l);-1!==h.indexOf("down")&&g.length&&g.find(".jstree-anchor").removeClass(p?"jstree-clicked":
"jstree-checked").parent().attr("aria-selected",!1)},this));if(-1!==this.settings.checkbox.cascade.indexOf("up"))this.element.on("delete_node.jstree",d.proxy(function(a,b){for(var c=this.get_node(b.parent),d=this._model.data,f,q,l,h=this.settings.checkbox.tie_selection;c&&"#"!==c.id;){f=l=0;for(q=c.children.length;f<q;f++)l+=d[c.children[f]].state[h?"selected":"checked"];if(l===q)c.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(c.id),(f=this.get_node(c,!0))&&f.length&&
f.attr("aria-selected",!0).children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}},this)).on("move_node.jstree",d.proxy(function(a,b){var c=b.is_multi,g=b.old_parent,f=this.get_node(b.parent),q=this._model.data,l,h,p=this.settings.checkbox.tie_selection;if(!c)for(c=this.get_node(g);c&&"#"!==c.id;){l=g=0;for(h=c.children.length;l<h;l++)g+=q[c.children[l]].state[p?"selected":"checked"];if(g===h)c.state[p?"selected":"checked"]=!0,this._data[p?"core":
"checkbox"].selected.push(c.id),(g=this.get_node(c,!0))&&g.length&&g.attr("aria-selected",!0).children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}for(c=f;c&&"#"!==c.id;){l=g=0;for(h=c.children.length;l<h;l++)g+=q[c.children[l]].state[p?"selected":"checked"];if(g===h)c.state[p?"selected":"checked"]||(c.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(c.id),(g=this.get_node(c,!0))&&g.length&&g.attr("aria-selected",
!0).children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked"));else if(c.state[p?"selected":"checked"])c.state[p?"selected":"checked"]=!1,this._data[p?"core":"checkbox"].selected=d.vakata.array_remove_item(this._data[p?"core":"checkbox"].selected,c.id),(g=this.get_node(c,!0))&&g.length&&g.attr("aria-selected",!1).children(".jstree-anchor").removeClass(p?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}},this))};this._undetermined=function(){var a,b,c=this._model.data,
g=this.settings.checkbox.tie_selection,f=this._data[g?"core":"checkbox"].selected,h=[],l=this;a=0;for(b=f.length;a<b;a++)c[f[a]]&&c[f[a]].parents&&(h=h.concat(c[f[a]].parents));this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d=l.get_node(this),f;if(d.state.loaded)for(a=0,b=d.children_d.length;a<b;a++)f=c[d.children_d[a]],!f.state.loaded&&f.original&&f.original.state&&f.original.state.undetermined&&!0===f.original.state.undetermined&&(h.push(f.id),h=h.concat(f.parents));
else d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined&&(h.push(d.id),h=h.concat(d.parents))});h=d.vakata.array_unique(h);h=d.vakata.array_remove_item(h,"#");this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");a=0;for(b=h.length;a<b;a++)c[h[a]].state[g?"selected":"checked"]||(f=this.get_node(h[a],!0))&&f.length&&f.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")};this.redraw_node=function(a,
k,c,g){if(a=b.redraw_node.apply(this,arguments)){var f,h,l=null;f=0;for(h=a.childNodes.length;f<h;f++)if(a.childNodes[f]&&a.childNodes[f].className&&-1!==a.childNodes[f].className.indexOf("jstree-anchor")){l=a.childNodes[f];break}l&&(!this.settings.checkbox.tie_selection&&this._model.data[a.id].state.checked&&(l.className+=" jstree-checked"),l.insertBefore(z.cloneNode(!1),l.childNodes[0]))}c||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),
this._data.checkbox.uto=setTimeout(d.proxy(this._undetermined,this),50));return a};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()};this.is_undetermined=function(a){a=this.get_node(a);
var b=this.settings.checkbox.cascade,c;c=this.settings.checkbox.tie_selection;var g=this._data[c?"core":"checkbox"].selected,f=this._model.data;if(!a||!0===a.state[c?"selected":"checked"]||-1===b.indexOf("undetermined")||-1===b.indexOf("down")&&-1===b.indexOf("up"))return!1;if(!a.state.loaded&&!0===a.original.state.undetermined)return!0;b=0;for(c=a.children_d.length;b<c;b++)if(-1!==d.inArray(a.children_d[b],g)||!f[a.children_d[b]].state.loaded&&f[a.children_d[b]].original.state.undetermined)return!0;
return!1};this.activate_node=function(a,k){this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||d(k.target).hasClass("jstree-checkbox"))&&(k.ctrlKey=!0);if(this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!d(k.target).hasClass("jstree-checkbox"))return b.activate_node.call(this,a,k);if(this.is_disabled(a))return!1;this.is_checked(a)?this.uncheck_node(a,k):this.check_node(a,k);this.trigger("activate_node",{node:this.get_node(a)})};this.check_node=function(a,
b){if(this.settings.checkbox.tie_selection)return this.select_node(a,!1,!0,b);var c,g;if(d.isArray(a)){a=a.slice();c=0;for(g=a.length;c<g;c++)this.check_node(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=this.get_node(a,!0);a.state.checked||(a.state.checked=!0,this._data.checkbox.selected.push(a.id),c&&c.length&&c.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:a,selected:this._data.checkbox.selected,event:b}))};this.uncheck_node=function(a,
b){if(this.settings.checkbox.tie_selection)return this.deselect_node(a,!1,b);var c,g;if(d.isArray(a)){a=a.slice();c=0;for(g=a.length;c<g;c++)this.uncheck_node(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=this.get_node(a,!0);a.state.checked&&(a.state.checked=!1,this._data.checkbox.selected=d.vakata.array_remove_item(this._data.checkbox.selected,a.id),c.length&&c.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:a,selected:this._data.checkbox.selected,
event:b}))};this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();this._data.checkbox.selected.concat([]);var a,b;this._data.checkbox.selected=this._model.data["#"].children_d.concat();a=0;for(b=this._data.checkbox.selected.length;a<b;a++)this._model.data[this._data.checkbox.selected[a]]&&(this._model.data[this._data.checkbox.selected[a]].state.checked=!0);this.redraw(!0);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();
var a=this._data.checkbox.selected.concat([]),b,c;b=0;for(c=this._data.checkbox.selected.length;b<c;b++)this._model.data[this._data.checkbox.selected[b]]&&(this._model.data[this._data.checkbox.selected[b]].state.checked=!1);this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:a})};this.is_checked=function(a){return this.settings.checkbox.tie_selection?this.is_selected(a):(a=this.get_node(a))&&
"#"!==a.id?a.state.checked:!1};this.get_checked=function(a){return this.settings.checkbox.tie_selection?this.get_selected(a):a?d.map(this._data.checkbox.selected,d.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected};this.get_top_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_top_selected(a);var b=this.get_checked(!0),c={},g,f,h,l;g=0;for(f=b.length;g<f;g++)c[b[g].id]=b[g];g=0;for(f=b.length;g<f;g++)for(h=0,l=b[g].children_d.length;h<l;h++)c[b[g].children_d[h]]&&
delete c[b[g].children_d[h]];b=[];for(g in c)c.hasOwnProperty(g)&&b.push(g);return a?d.map(b,d.proxy(function(a){return this.get_node(a)},this)):b};this.get_bottom_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(a);var b=this.get_checked(!0),c=[],g,f;g=0;for(f=b.length;g<f;g++)b[g].children.length||c.push(b[g].id);return a?d.map(c,d.proxy(function(a){return this.get_node(a)},this)):c};this.load_node=function(a,k){var c,g,f;if(!d.isArray(a)&&!this.settings.checkbox.tie_selection&&
(f=this.get_node(a))&&f.state.loaded)for(c=0,g=f.children_d.length;c<g;c++)this._model.data[f.children_d[c]].state.checked&&(this._data.checkbox.selected=d.vakata.array_remove_item(this._data.checkbox.selected,f.children_d[c]));return b.load_node.apply(this,arguments)};this.get_state=function(){var a=b.get_state.apply(this,arguments);if(this.settings.checkbox.tie_selection)return a;a.checkbox=this._data.checkbox.selected.slice();return a};this.set_state=function(a,k){var c=b.set_state.apply(this,
arguments);if(c&&a.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var g=this;d.each(a.checkbox,function(a,e){g.check_node(e)})}delete a.checkbox;return!1}return c}};var C=null,I,J;d.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,b){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.create_node(a,{},"last",function(a){setTimeout(function(){b.edit(a)},
0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.edit(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.delete_node(b.get_selected()):b.delete_node(a)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,
separator_after:!1,label:"Cut",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.cut(b.get_selected()):b.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.copy(b.get_selected()):b.copy(a)}},paste:{separator_before:!1,icon:!1,_disabled:function(a){return!d.jstree.reference(a.reference).can_paste()},separator_after:!1,label:"Paste",
action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.paste(a)}}}}}}};d.jstree.plugins.contextmenu=function(a,b){this.bind=function(){b.bind.call(this);var a=0;this.element.on("contextmenu.jstree",".jstree-anchor",d.proxy(function(b,c){b.preventDefault();a=b.ctrlKey?+new Date:0;if(c||C)a=+new Date+1E4;C&&clearTimeout(C);this.is_loading(b.currentTarget)||this.show_contextmenu(b.currentTarget,b.pageX,b.pageY,b)},this)).on("click.jstree",".jstree-anchor",d.proxy(function(b){this._data.contextmenu.visible&&
(!a||250<+new Date-a)&&d.vakata.context.hide();a=0},this)).on("touchstart.jstree",".jstree-anchor",function(a){a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(I=a.pageX,J=a.pageY,C=setTimeout(function(){d(a.currentTarget).trigger("contextmenu",!0)},750))});d(document).on("context_hide.vakata.jstree",d.proxy(function(){this._data.contextmenu.visible=!1},this))};this.teardown=function(){this._data.contextmenu.visible&&d.vakata.context.hide();b.teardown.call(this)};
this.show_contextmenu=function(a,b,c,g){a=this.get_node(a);if(!a||"#"===a.id)return!1;var f=this.settings.contextmenu,h=this.get_node(a,!0).children(".jstree-anchor"),l=!1,l=!1;if(f.show_at_node||b===u||c===u)l=h.offset(),b=l.left,c=l.top+this._data.core.li_height;this.settings.contextmenu.select_node&&!this.is_selected(a)&&this.activate_node(a,g);l=f.items;d.isFunction(l)&&(l=l.call(this,a,d.proxy(function(d){this._show_contextmenu(a,b,c,d)},this)));d.isPlainObject(l)&&this._show_contextmenu(a,b,
c,l)};this._show_contextmenu=function(a,b,c,g){var f=this.get_node(a,!0).children(".jstree-anchor");d(document).one("context_show.vakata.jstree",d.proxy(function(a,e){var b="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";d(e.element).addClass(b)},this));this._data.contextmenu.visible=!0;d.vakata.context.show(f,{x:b,y:c},g);this.trigger("show_contextmenu",{node:a,x:b,y:c})}};d(function(){d(document).on("touchmove.vakata.jstree",function(a){C&&a.originalEvent&&a.originalEvent.changedTouches&&
a.originalEvent.changedTouches[0]&&(50<Math.abs(I-a.pageX)||50<Math.abs(J-a.pageY))&&clearTimeout(C)}).on("touchend.vakata.jstree",function(a){C&&clearTimeout(C)})});(function(a){var b=!1,e=!1,d=!1,c=0,g=0,f=[],h="",l=!1;a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(document).triggerHandler("context_"+b+".vakata",{reference:d,element:e,position:{x:c,y:g}})},_execute:function(b){return(b=f[b])&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:d,
element:e}))&&b.action?b.action.call(null,{item:b,reference:d,element:e,position:{x:c,y:g}}):!1},_parse:function(b,c){if(!b)return!1;c||(h="",f=[]);var g="",l=!1,m;c&&(g+="<ul>");a.each(b,function(b,c){if(!c)return!0;f.push(c);!l&&c.separator_before&&(g+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>");l=!1;g+="<li class='"+(c._class||"")+(!0===c._disabled||a.isFunction(c._disabled)&&c._disabled({item:c,reference:d,
element:e})?" vakata-contextmenu-disabled ":"")+"' "+(c.shortcut?" data-shortcut='"+c.shortcut+"' ":"")+">";g+="<a href='#' rel='"+(f.length-1)+"'>";a.vakata.context.settings.icons&&(g+="<i ",c.icon&&(g=-1!==c.icon.indexOf("/")||-1!==c.icon.indexOf(".")?g+(" style='background:url(\""+c.icon+"\") center center no-repeat' "):g+(" class='"+c.icon+"' ")),g+="></i><span class='vakata-contextmenu-sep'>&#160;</span>");g+=(a.isFunction(c.label)?c.label({item:b,reference:d,element:e}):c.label)+(c.shortcut?
' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+c.shortcut+'">'+(c.shortcut_label||"")+"</span>":"")+"</a>";c.submenu&&(m=a.vakata.context._parse(c.submenu,!0))&&(g+=m);g+="</li>";c.separator_after&&(g+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",l=!0)});g=g.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");c&&(g+="</ul>");c||(h=g,a.vakata.context._trigger("parse"));return 10<
g.length?g:!1},_show_submenu:function(e){e=a(e);if(e.length&&e.children("ul").length){var c=e.children("ul"),d=e.offset().left+e.outerWidth(),f=e.offset().top,g=c.width(),k=c.height(),l=a(window).width()+a(window).scrollLeft(),h=a(window).height()+a(window).scrollTop();if(b)e[0>d-(g+10+e.outerWidth())?"addClass":"removeClass"]("vakata-context-left");else e[d+g+10>l?"addClass":"removeClass"]("vakata-context-right");f+k+10>h&&c.css("bottom","-1px");c.show()}},show:function(m,p,n){var t,r,v,B,E;e&&e.length&&
e.width("");switch(!0){case !p&&!m:return!1;case !!p&&!!m:d=m;c=p.x;g=p.y;break;case !p&&!!m:d=m;p=m.offset();c=p.left+m.outerHeight();g=p.top;break;case !!p&&!m:c=p.x,g=p.y}m&&!n&&a(m).data("vakata_contextmenu")&&(n=a(m).data("vakata_contextmenu"));a.vakata.context._parse(n)&&e.html(h);f.length&&(e.appendTo("body"),n=e,p=c,t=g,r=n.width(),v=n.height(),B=a(window).width()+a(window).scrollLeft(),E=a(window).height()+a(window).scrollTop(),b&&(p-=n.outerWidth()-a(m).outerWidth(),p<a(window).scrollLeft()+
20&&(p=a(window).scrollLeft()+20)),p+r+20>B&&(p=B-(r+20)),t+v+20>E&&(t=E-(v+20)),e.css({left:p,top:t}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),l=!0,a.vakata.context._trigger("show"))},hide:function(){l&&(e.hide().find("ul").hide().end().find(":focus").blur().end().detach(),l=!1,a.vakata.context._trigger("hide"))}};a(function(){b="rtl"===a("body").css("direction");var c=!1;e=a("<ul class='vakata-context'></ul>");e.on("mouseenter","li",function(b){b.stopImmediatePropagation();
a.contains(this,b.relatedTarget)||(c&&clearTimeout(c),e.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(e){a.contains(this,e.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(e){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover");
a.vakata.context.settings.hide_onmouseleave&&(c=setTimeout(function(e){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(e){e.preventDefault();a(this).blur().parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(c){var b=null;switch(c.which){case 13:case 32:c.type="mouseup";c.preventDefault();a(c.currentTarget).trigger(c);break;case 37:l&&
(e.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 38:l&&(b=e.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),b.length||(b=e.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),
b.addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 39:l&&(e.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 40:l&&(b=e.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),
b.length||(b=e.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),b.addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 27:a.vakata.context.hide(),c.preventDefault()}}).on("keydown",function(a){a.preventDefault();a=e.find(".vakata-contextmenu-shortcut-"+a.which).parent();a.parent().not(".vakata-context-disabled")&&a.click()});a(document).on("mousedown.vakata.jstree",function(c){l&&!a.contains(e[0],
c.target)&&a.vakata.context.hide()}).on("context_show.vakata.jstree",function(a,c){e.find("li:has(ul)").children("a").addClass("vakata-context-parent");b&&e.addClass("vakata-context-rtl").css("direction","rtl");e.find("ul").hide().end()})})})(d);d.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0};d.jstree.plugins.dnd=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",
".jstree-anchor",d.proxy(function(a){if("touchstart"===a.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!d(a.currentTarget).hasClass("jstree-clicked")))return!0;var b=this.get_node(a.target),c=this.is_selected(b)&&this.settings.drag_selection?this.get_selected().length:1,g=1<c?c+" "+this.get_string("nodes"):this.get_text(a.currentTarget);this.settings.core.force_text&&(g=d("<div />").text(g).html());if(b&&b.id&&"#"!==b.id&&(1===a.which||"touchstart"===a.type)&&(!0===this.settings.dnd.is_draggable||
d.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<c?this.get_selected(!0):[b])))return this.element.trigger("mousedown.jstree"),d.vakata.dnd.start(a,{jstree:!0,origin:this,obj:this.get_node(b,!0),nodes:1<c?this.get_selected():[b.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+g+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},
this))}};d(function(){var a=!1,b=!1,e=!1,k=d('<div id="jstree-marker">&#160;</div>').hide();d(document).on("dnd_start.vakata.jstree",function(e,b){a=!1;b&&b.data&&b.data.jstree&&k.appendTo("body")}).on("dnd_move.vakata.jstree",function(c,g){e&&clearTimeout(e);if(g&&g.data&&g.data.jstree&&(!g.event.target.id||"jstree-marker"!==g.event.target.id)){var f=d.jstree.reference(g.event.target),h=!1,l=!1,m=!1,p,n,t,r,v,B,E,F,u,z,A,C,y,G;if(f&&f._data&&f._data.dnd)if(k.attr("class","jstree-"+f.get_theme()+
(f.settings.core.themes.responsive?" jstree-dnd-responsive":"")),g.helper.children().attr("class","jstree-"+f.get_theme()+" jstree-"+f.get_theme()+"-"+f.get_theme_variant()+" "+(f.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"show":"hide"](),g.event.target!==f.element[0]&&g.event.target!==f.get_container_ul()[0]||0!==f.get_container_ul().children().length){if((h=
d(g.event.target).closest(".jstree-anchor"))&&h.length&&h.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(l=h.offset(),m=g.event.pageY-l.top,t=h.height(),B=m<t/3?["b","i","a"]:m>t-t/3?["a","i","b"]:m>t/2?["i","a","b"]:["i","b","a"],d.each(B,function(c,m){switch(m){case "b":p=l.left-6;n=l.top;r=f.get_parent(h);v=h.parent().index();break;case "i":y=f.settings.dnd.inside_pos;G=f.get_node(h.parent());p=l.left-2;n=l.top+t/2+1;r=G.id;v="first"===y?0:"last"===y?G.children.length:Math.min(y,G.children.length);
break;case "a":p=l.left-6,n=l.top+t,r=f.get_parent(h),v=h.parent().index()+1}E=!0;F=0;for(u=g.data.nodes.length;F<u;F++)if(z=g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node",A=v,"move_node"===z&&"a"===m&&g.data.origin&&g.data.origin===f&&r===f.get_parent(g.data.nodes[F])&&(C=f.get_node(r),A>d.inArray(g.data.nodes[F],C.children)&&--A),E=E&&(f&&f.settings&&f.settings.dnd&&!1===f.settings.dnd.check_while_dragging||
f.check(z,g.data.origin&&g.data.origin!==f?g.data.origin.get_node(g.data.nodes[F]):g.data.nodes[F],r,A,{dnd:!0,ref:f.get_node(h.parent()),pos:m,is_multi:g.data.origin&&g.data.origin!==f,is_foreign:!g.data.origin})),!E){f&&f.last_error&&(b=f.last_error());break}"i"===m&&h.parent().is(".jstree-closed")&&f.settings.dnd.open_timeout&&(e=setTimeout(function(a,e){return function(){a.open_node(e)}}(f,h),f.settings.dnd.open_timeout));if(E)return a={ins:f,par:r,pos:"i"!==m||"last"!==y||0!==v||f.is_loaded(G)?
v:"last"},k.css({left:p+"px",top:n+"px"}).show(),g.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),b={},B=!0,!1}),!0===B))return}else{E=!0;F=0;for(u=g.data.nodes.length;F<u&&(E=E&&f.check(g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node",g.data.origin&&g.data.origin!==f?g.data.origin.get_node(g.data.nodes[F]):g.data.nodes[F],"#","last",{dnd:!0,ref:f.get_node("#"),pos:"i",
is_multi:g.data.origin&&g.data.origin!==f,is_foreign:!g.data.origin}),E);F++);if(E){a={ins:f,par:"#",pos:"last"};k.hide();g.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");return}}a=!1;g.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");k.hide()}}).on("dnd_scroll.vakata.jstree",function(e,b){b&&b.data&&b.data.jstree&&(k.hide(),a=!1,b.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",
function(c,g){e&&clearTimeout(e);if(g&&g.data&&g.data.jstree){k.hide().detach();var f,h,l=[];if(a){f=0;for(h=g.data.nodes.length;f<h;f++)l[f]=g.data.origin?g.data.origin.get_node(g.data.nodes[f]):g.data.nodes[f],g.data.origin&&(l[f].instance=g.data.origin);a.ins[g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node"](l,a.par,a.pos);f=0;for(h=l.length;f<h;f++)l[f].instance&&(l[f].instance=null)}else f=d(g.event.target).closest(".jstree"),
f.length&&b&&b.error&&"check"===b.error&&(f=f.jstree(!0))&&f.settings.core.error.call(this,b)}}).on("keyup.jstree keydown.jstree",function(a,e){if((e=d.vakata.dnd._get())&&e.data&&e.data.jstree)e.helper.find(".jstree-copy").first()[e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(a.metaKey||a.ctrlKey))?"show":"hide"]()})});(function(a){var b=!1,e=!1,d=!1,c=!1,g=!1,f=0,h=!1,l=0,m=0,p=0,n=0,t=!1,r=!1,v=!1;a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,
helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(e,c){var b=a.vakata.dnd._get();b.event=c;a(document).triggerHandler("dnd_"+e+".vakata",b)},_get:function(){return{data:h,element:b,helper:g}},_clean:function(){g&&g.remove();r&&(clearInterval(r),r=!1);g=c=d=e=b=!1;f=0;h=!1;n=p=m=l=0;v=r=t=!1;a(document).off("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag);a(document).off("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop)},_scroll:function(e){if(!t||
!p&&!n)return r&&(clearInterval(r),r=!1),!1;if(!r)return r=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===e)return!1;e=t.scrollTop();var c=t.scrollLeft();t.scrollTop(e+n*a.vakata.dnd.settings.scroll_speed);t.scrollLeft(c+p*a.vakata.dnd.settings.scroll_speed);e===t.scrollTop()&&c===t.scrollLeft()||a.vakata.dnd._trigger("scroll",t)},start:function(f,p,n){"touchstart"===f.type&&f.originalEvent&&f.originalEvent.changedTouches&&f.originalEvent.changedTouches[0]&&(f.pageX=f.originalEvent.changedTouches[0].pageX,
f.pageY=f.originalEvent.changedTouches[0].pageY,f.target=document.elementFromPoint(f.originalEvent.changedTouches[0].pageX-window.pageXOffset,f.originalEvent.changedTouches[0].pageY-window.pageYOffset));c&&a.vakata.dnd.stop({});try{f.currentTarget.unselectable="on",f.currentTarget.onselectstart=function(){return!1},f.currentTarget.style&&(f.currentTarget.style.MozUserSelect="none")}catch(t){}l=f.pageX;m=f.pageY;h=p;d=!0;b=f.currentTarget;e=f.target;v="touchstart"===f.type;!1!==n&&(g=a("<div id='vakata-dnd'></div>").html(n).css({display:"block",
margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));a(document).on("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag);a(document).on("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop);return!1},drag:function(e){"touchmove"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX-
window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(d){if(!c)if(Math.abs(e.pageX-l)>(v?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(e.pageY-m)>(v?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold))g&&(g.appendTo("body"),f=g.outerWidth()),c=!0,a.vakata.dnd._trigger("start",e);else return;var b=!1,h=!1,q=!1,r=!1,u=!1,z=h=!1,A=!1,r=b=!1;p=n=0;t=!1;a(a(e.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&
(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var b=a(this),c=b.offset();this.scrollHeight>this.offsetHeight&&(c.top+b.height()-e.pageY<a.vakata.dnd.settings.scroll_proximity&&(n=1),e.pageY-c.top<a.vakata.dnd.settings.scroll_proximity&&(n=-1));this.scrollWidth>this.offsetWidth&&(c.left+b.width()-e.pageX<a.vakata.dnd.settings.scroll_proximity&&(p=1),e.pageX-c.left<a.vakata.dnd.settings.scroll_proximity&&(p=-1));if(n||p)return t=a(this),!1});!t&&(b=a(document),
h=a(window),q=b.height(),r=h.height(),u=b.width(),h=h.width(),z=b.scrollTop(),A=b.scrollLeft(),q>r&&e.pageY-z<a.vakata.dnd.settings.scroll_proximity&&(n=-1),q>r&&r-(e.pageY-z)<a.vakata.dnd.settings.scroll_proximity&&(n=1),u>h&&e.pageX-A<a.vakata.dnd.settings.scroll_proximity&&(p=-1),u>h&&h-(e.pageX-A)<a.vakata.dnd.settings.scroll_proximity&&(p=1),n||p)&&(t=b);t&&a.vakata.dnd._scroll(!0);g&&(b=parseInt(e.pageY+a.vakata.dnd.settings.helper_top,10),r=parseInt(e.pageX+a.vakata.dnd.settings.helper_left,
10),q&&b+25>q&&(b=q-50),u&&r+f>u&&(r=u-(f+2)),g.css({left:r+"px",top:b+"px"}));a.vakata.dnd._trigger("move",e);return!1}},stop:function(b){"touchend"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(c)a.vakata.dnd._trigger("stop",
b);else if("touchend"===b.type&&b.target===e){var d=setTimeout(function(){a(b.target).click()},100);a(b.target).one("click",function(){d&&clearTimeout(d)})}a.vakata.dnd._clean();return!1}}})(d);d.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1};d.jstree.plugins.search=function(a,b){this.bind=function(){b.bind.call(this);this._data.search.str="";this._data.search.dom=d();this._data.search.res=[];this._data.search.opn=
[];this._data.search.som=!1;this.element.on("before_open.jstree",d.proxy(function(a,b){var c,g,f=this._data.search.res,h=[];c=d();if(f&&f.length&&(this._data.search.dom=d(this.element[0].querySelectorAll("#"+d.map(f,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this._data.search.som&&this._data.search.res.length)){c=
0;for(g=f.length;c<g;c++)h=h.concat(this.get_node(f[c]).parents);h=d.vakata.array_remove_item(d.vakata.array_unique(h),"#");c=h.length?d(this.element[0].querySelectorAll("#"+d.map(h,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))):d();this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");c=c.add(this._data.search.dom);
c.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){d(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)).on("search.jstree",d.proxy(function(a,b){this._data.search.som&&b.nodes.length&&(this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),b.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){d(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))},
this)).on("clear_search.jstree",d.proxy(function(a,b){this._data.search.som&&b.nodes.length&&this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")},this))};this.search=function(a,b,c){if(!1===a||""===d.trim(a.toString()))return this.clear_search();a=a.toString();var g=this.settings.search,f=g.ajax?g.ajax:!1,h=null,l=[],m=[];this._data.search.res.length&&this.clear_search();c===u&&(c=g.show_only_matches);if(!b&&
!1!==f){if(d.isFunction(f))return f.call(this,a,d.proxy(function(b){b&&b.d&&(b=b.d);this._load_nodes(d.isArray(b)?d.vakata.array_unique(b):[],function(){this.search(a,!0,c)},!0)},this));f=d.extend({},f);f.data||(f.data={});f.data.str=a;return d.ajax(f).fail(d.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(f)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(d.proxy(function(b){b&&
b.d&&(b=b.d);this._load_nodes(d.isArray(b)?d.vakata.array_unique(b):[],function(){this.search(a,!0,c)},!0)},this))}this._data.search.str=a;this._data.search.dom=d();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=c;h=new d.vakata.search(a,!0,{caseSensitive:g.case_sensitive,fuzzy:g.fuzzy});d.each(this._model.data,function(b,c){c.text&&(g.search_callback&&g.search_callback.call(this,a,c)||!g.search_callback&&h.search(c.text).isMatch)&&(!g.search_leaves_only||c.state.loaded&&
0===c.children.length)&&(l.push(b),m=m.concat(c.parents))});l.length&&(m=d.vakata.array_unique(m),this._search_open(m),this._data.search.dom=d(this.element[0].querySelectorAll("#"+d.map(l,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=l,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"));this.trigger("search",{nodes:this._data.search.dom,str:a,
res:this._data.search.res,show_only_matches:c})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=d()};this._search_open=function(a){var b=this;d.each(a.concat([]),
function(c,g){if("#"===g)return!0;try{g=d("#"+g.replace(d.jstree.idregex,"\\$&"),b.element)}catch(f){}g&&g.length&&b.is_closed(g)&&(b._data.search.opn.push(g[0].id),b.open_node(g,function(){b._search_open(a)},0))})}};(function(a){a.vakata.search=function(a,e,d){d=d||{};!1!==d.fuzzy&&(d.fuzzy=!0);a=d.caseSensitive?a:a.toLowerCase();var c=d.location||0,g=d.distance||100,f=d.threshold||.6,h=a.length,l,m,p,n;32<h&&(d.fuzzy=!1);d.fuzzy&&(l=1<<h-1,m=function(){for(var e={},c=0,c=0;c<h;c++)e[a.charAt(c)]=
0;for(c=0;c<h;c++)e[a.charAt(c)]|=1<<h-c-1;return e}(),p=function(a,e){var b=a/h,d=Math.abs(c-e);return g?b+d/g:d?1:b});n=function(e){e=d.caseSensitive?e:e.toLowerCase();if(a===e||-1!==e.indexOf(a))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var g,n,r=e.length,t=f,v=e.indexOf(a,c),w,u,z=h+r,A,C,y=1,I=[];-1!==v&&(t=Math.min(p(0,v),t),v=e.lastIndexOf(a,c+h),-1!==v&&(t=Math.min(p(0,v),t)));v=-1;for(g=0;g<h;g++){w=0;for(u=z;w<u;)p(g,c+u)<=t?w=u:z=u,u=Math.floor((z-w)/2+w);z=u;w=
Math.max(1,c-u+1);n=Math.min(c+u,r)+h;u=Array(n+2);for(u[n+1]=(1<<g)-1;n>=w;n--)if(C=m[e.charAt(n-1)],u[n]=0===g?(u[n+1]<<1|1)&C:(u[n+1]<<1|1)&C|(A[n+1]|A[n])<<1|1|A[n+1],u[n]&l&&(y=p(g,n-1),y<=t))if(t=y,v=n-1,I.push(v),v>c)w=Math.max(1,2*c-v);else break;if(p(g+1,c)>t)break;A=u}return{isMatch:0<=v,score:y}};return!0===e?{search:n}:n(e)}})(d);d.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1};d.jstree.plugins.sort=function(a,b){this.bind=function(){b.bind.call(this);
this.element.on("model.jstree",d.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",d.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1);this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",d.proxy(function(a,b){this.sort(b.parent,!1);this.redraw_node(b.parent,!0)},this))};this.sort=function(a,b){var c,g;if((a=this.get_node(a))&&a.children&&a.children.length&&(a.children.sort(d.proxy(this.settings.sort,this)),
b))for(c=0,g=a.children_d.length;c<g;c++)this.sort(a.children_d[c],!1)}};var K=!1;d.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1};d.jstree.plugins.state=function(a,b){this.bind=function(){b.bind.call(this);var a=d.proxy(function(){this.element.on(this.settings.state.events,d.proxy(function(){K&&clearTimeout(K);K=setTimeout(d.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},
this);this.element.on("ready.jstree",d.proxy(function(b,c){this.element.one("restore_state.jstree",a);this.restore_state()||a()},this))};this.save_state=function(){var a={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};d.vakata.storage.set(this.settings.state.key,JSON.stringify(a))};this.restore_state=function(){var a=d.vakata.storage.get(this.settings.state.key);if(a)try{a=JSON.parse(a)}catch(b){return!1}if(a&&a.ttl&&a.sec&&+new Date-a.sec>a.ttl)return!1;a&&a.state&&(a=a.state);
a&&d.isFunction(this.settings.state.filter)&&(a=this.settings.state.filter.call(this,a));return a?(this.element.one("set_state.jstree",function(b,g){g.instance.trigger("restore_state",{state:d.extend(!0,{},a)})}),this.set_state(a),!0):!1};this.clear_state=function(){return d.vakata.storage.del(this.settings.state.key)}};(function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}})(d);
d.jstree.defaults.types={"#":{},"default":{}};d.jstree.plugins.types=function(a,b){this.init=function(a,d){var c,g;if(d&&d.types&&d.types["default"])for(c in d.types)if("default"!==c&&"#"!==c&&d.types.hasOwnProperty(c))for(g in d.types["default"])d.types["default"].hasOwnProperty(g)&&d.types[c][g]===u&&(d.types[c][g]=d.types["default"][g]);b.init.call(this,a,d);this._model.data["#"].type="#"};this.refresh=function(a,d){b.refresh.call(this,a,d);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",
d.proxy(function(a,b){var c=this._model.data,d=b.nodes,f=this.settings.types,h,l,m="default";h=0;for(l=d.length;h<l;h++)m="default",c[d[h]].original&&c[d[h]].original.type&&f[c[d[h]].original.type]&&(m=c[d[h]].original.type),c[d[h]].data&&c[d[h]].data.jstree&&c[d[h]].data.jstree.type&&f[c[d[h]].data.jstree.type]&&(m=c[d[h]].data.jstree.type),c[d[h]].type=m,!0===c[d[h]].icon&&f[m].icon!==u&&(c[d[h]].icon=f[m].icon);c["#"].type="#"},this));b.bind.call(this)};this.get_json=function(a,k,c){var g=this._model.data,
f=k?d.extend(!0,{},k,{no_id:!1}):{},f=b.get_json.call(this,a,f,c);if(!1===f)return!1;if(d.isArray(f))for(a=0,c=f.length;a<c;a++)f[a].type=f[a].id&&g[f[a].id]&&g[f[a].id].type?g[f[a].id].type:"default",k&&k.no_id&&(delete f[a].id,f[a].li_attr&&f[a].li_attr.id&&delete f[a].li_attr.id,f[a].a_attr&&f[a].a_attr.id&&delete f[a].a_attr.id);else f.type=f.id&&g[f.id]&&g[f.id].type?g[f.id].type:"default",k&&k.no_id&&(f=this._delete_ids(f));return f};this._delete_ids=function(a){if(d.isArray(a)){for(var b=0,
c=a.length;b<c;b++)a[b]=this._delete_ids(a[b]);return a}delete a.id;a.li_attr&&a.li_attr.id&&delete a.li_attr.id;a.a_attr&&a.a_attr.id&&delete a.a_attr.id;a.children&&d.isArray(a.children)&&(a.children=this._delete_ids(a.children));return a};this.check=function(a,k,c,g,f){if(!1===b.check.call(this,a,k,c,g,f))return!1;k=k&&k.id?k:this.get_node(k);c=c&&c.id?c:this.get_node(c);f=k&&k.id?d.jstree.reference(k.id):null;var h,l,m,n;f=f&&f._model&&f._model.data?f._model.data:null;switch(a){case "create_node":case "move_node":case "copy_node":if("move_node"!==
a||-1===d.inArray(k.id,c.children)){h=this.get_rules(c);if(h.max_children!==u&&-1!==h.max_children&&h.max_children===c.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:k&&k.id?k.id:!1,par:c&&c.id?c.id:!1})},!1;if(h.valid_children!==u&&-1!==h.valid_children&&-1===d.inArray(k.type||"default",h.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",
reason:"valid_children prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:k&&k.id?k.id:!1,par:c&&c.id?c.id:!1})},!1;if(f&&k.children_d&&k.parents){m=l=0;for(n=k.children_d.length;m<n;m++)l=Math.max(l,f[k.children_d[m]].parents.length);l=l-k.parents.length+1}if(0>=l||l===u)l=1;do{if(h.max_depth!==u&&-1!==h.max_depth&&h.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:k&&k.id?
k.id:!1,par:c&&c.id?c.id:!1})},!1;c=this.get_node(c.parent);h=this.get_rules(c);l++}while(c)}}return!0};this.get_rules=function(a){a=this.get_node(a);if(!a)return!1;a=this.get_type(a,!0);a.max_depth===u&&(a.max_depth=-1);a.max_children===u&&(a.max_children=-1);a.valid_children===u&&(a.valid_children=-1);return a};this.get_type=function(a,b){return(a=this.get_node(a))?b?d.extend({type:a.type},this.settings.types[a.type]):a.type:!1};this.set_type=function(a,b){var c,g,f;if(d.isArray(a)){a=a.slice();
c=0;for(g=a.length;c<g;c++)this.set_type(a[c],b);return!0}c=this.settings.types;a=this.get_node(a);if(!c[b]||!a)return!1;g=a.type;f=this.get_icon(a);a.type=b;(!0===f||c[g]&&c[g].icon!==u&&f===c[g].icon)&&this.set_icon(a,c[b].icon!==u?c[b].icon:!0);return!0}};d.jstree.defaults.unique={case_sensitive:!1,duplicate:function(a,b){return a+" ("+b+")"}};d.jstree.plugins.unique=function(a,b){this.check=function(a,h,c,g,f){if(!1===b.check.call(this,a,h,c,g,f))return!1;h=h&&h.id?h:this.get_node(h);c=c&&c.id?
c:this.get_node(c);if(!c||!c.children)return!0;f="rename_node"===a?g:h.text;var m=[],l=this.settings.unique.case_sensitive,n=this._model.data,p,t;p=0;for(t=c.children.length;p<t;p++)m.push(l?n[c.children[p]].text:n[c.children[p]].text.toLowerCase());l||(f=f.toLowerCase());switch(a){case "rename_node":return p=-1===d.inArray(f,m)||h.text&&h.text[l?"toString":"toLowerCase"]()===f,p||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+f+" already exists. Preventing: "+
a,data:JSON.stringify({chk:a,pos:g,obj:h&&h.id?h.id:!1,par:c&&c.id?c.id:!1})}),p;case "create_node":return p=-1===d.inArray(f,m),p||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+f+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:g,obj:h&&h.id?h.id:!1,par:c&&c.id?c.id:!1})}),p;case "copy_node":return p=-1===d.inArray(f,m),p||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+f+" already exists. Preventing: "+
a,data:JSON.stringify({chk:a,pos:g,obj:h&&h.id?h.id:!1,par:c&&c.id?c.id:!1})}),p;case "move_node":return p=h.parent===c.id||-1===d.inArray(f,m),p||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+f+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:g,obj:h&&h.id?h.id:!1,par:c&&c.id?c.id:!1})}),p}return!0};this.create_node=function(a,h,c,g,f){if(!h||h.text===u){null===a&&(a="#");a=this.get_node(a);if(!a)return b.create_node.call(this,
a,h,c,g,f);c=c===u?"last":c;if(!c.toString().match(/^(before|after)$/)&&!f&&!this.is_loaded(a))return b.create_node.call(this,a,h,c,g,f);h||(h={});var m,l,n,p,t,r=this._model.data,v=this.settings.unique.case_sensitive,z=this.settings.unique.duplicate;l=m=this.get_string("New node");n=[];p=0;for(t=a.children.length;p<t;p++)n.push(v?r[a.children[p]].text:r[a.children[p]].text.toLowerCase());for(p=1;-1!==d.inArray(v?l:l.toLowerCase(),n);)l=z.call(this,m,++p).toString();h.text=l}return b.create_node.call(this,
a,h,c,g,f)}};var H=document.createElement("DIV");H.setAttribute("unselectable","on");H.setAttribute("role","presentation");H.className="jstree-wholerow";H.innerHTML="&#160;";d.jstree.plugins.wholerow=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("ready.jstree set_state.jstree",d.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",d.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",d.proxy(function(a,
b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",d.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var c=!1,d,f;d=0;for(f=b.selected.length;d<f;d++)(c=this.get_node(b.selected[d],!0))&&c.length&&c.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",d.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},
this)).on("hover_node.jstree dehover_node.jstree",d.proxy(function(a,b){if("hover_node"!==a.type||!this.is_disabled(b.node))this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",d.proxy(function(a){a.preventDefault();var b=d.Event("contextmenu",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,pageX:a.pageX,pageY:a.pageY});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b)},
this)).on("click.jstree",".jstree-wholerow",function(a){a.stopImmediatePropagation();var b=d.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",d.proxy(function(a){a.stopImmediatePropagation();var b=d.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()},
this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",d.proxy(function(a){a.stopImmediatePropagation();this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget);return!1},this)).on("mouseleave.jstree",".jstree-node",d.proxy(function(a){this.dehover_node(a.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();b.teardown.call(this)};this.redraw_node=function(a,h,c,g){if(a=b.redraw_node.apply(this,arguments)){var f=H.cloneNode(!0);
-1!==d.inArray(a.id,this._data.core.selected)&&(f.className+=" jstree-wholerow-clicked");this._data.core.focused&&this._data.core.focused===a.id&&(f.className+=" jstree-wholerow-hovered");a.insertBefore(f,a.childNodes[0])}return a}};(function(a){if(document.registerElement&&Object&&Object.create){var b=Object.create(HTMLElement.prototype);b.createdCallback=function(){var b={core:{},plugins:[]},c;for(c in a.jstree.plugins)a.jstree.plugins.hasOwnProperty(c)&&this.attributes[c]&&(b.plugins.push(c),this.getAttribute(c)&&
JSON.parse(this.getAttribute(c))&&(b[c]=JSON.parse(this.getAttribute(c))));for(c in a.jstree.defaults.core)a.jstree.defaults.core.hasOwnProperty(c)&&this.attributes[c]&&(b.core[c]=JSON.parse(this.getAttribute(c))||this.getAttribute(c));jQuery(this).jstree(b)};try{document.registerElement("vakata-jstree",{prototype:b})}catch(e){}}})(jQuery)}});
(function(d,u){var D=0;d.widget("s3.hierarchicalopts",{options:{selected:null,multiple:!0,leafonly:!0,cascade:!1,bulkSelect:!1,cascadeOptionInTree:!0,noneSelectedText:"Select",selectedText:"selected",noOptionsText:"No options available",selectAllText:"Select All",deselectAllText:"Deselect All",icons:!1,stripes:!0,htmlTitles:!0},_create:function(){var h=d(this.element),m=this.options;this.id=D;D+=1;this._namespace=".hierarchicalopts"+D;this.treeID=h.attr("id")+"-tree";this.input=h.find(".s3-hierarchy-input").first();
var n=m.selected;n&&this.input.val(JSON.stringify(n));this.button=d('<button type="button" class="s3-hierarchy-button ui-multiselect ui-widget ui-state-default ui-corner-all"><span class="ui-icon ui-icon-triangle-1-s"></span></button>');this.buttonText=d("<span>"+m.noneSelectedText+"</span>").appendTo(this.button);this.noopts=d('<span class="no-options-available">'+m.noOptionsText+"</span>").hide();this.tree=h.find(".s3-hierarchy-tree").first();this.wrapper=this.tree.closest(".s3-hierarchy-wrapper").hide().before(this.noopts).before(this.button).detach().appendTo("body");
this.manualCascadeOption=this._isBulk=this._isOpen=!1},_init:function(){this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this);this._unbindEvents();d(this.button).remove();d(this.noopts).remove();d(this.tree).detach().appendTo(this.element).show()},refresh:function(){this._unbindEvents();var h=this.options,m=this.tree;if(m.find("li").length){this.noopts.hide();this.button.show();var n=this.input.val();if(n){var n=JSON.parse(n),v=this.treeID;d.each(n,function(){d("#"+v+"-"+this).data("jstree",
{selected:!0})})}n=m.find("> ul > li");if(1==n.length){var n=n.first(),r=n.data("jstree");n.data("jstree",d.extend({},r,{opened:!0}))}var n=h.multiple,r=h.leafonly,t=!1,u=null,y=["sort","checkbox"];if((h.cascade||r)&&n)t=!0;else if(n)if(h.cascadeOptionInTree)this.manualCascadeOption=!0;else{var z=this,u=function(h){return m.jstree("is_parent",h)?(d.vakata.context.settings.icons=!1,{select_all:{label:z.options.selectAllText,icon:!1,action:function(d){z._selectBranch(h)}},deselect_all:{label:z.options.deselectAllText,
icon:!1,action:function(d){z._deselectBranch(h)}}}):null};y.push("contextmenu")}m.jstree({core:{themes:{name:"s3",icons:h.icons,stripes:h.stripes},animation:100,multiple:n,check_callback:!0},checkbox:{three_state:t},sort:function(d,h){var m=this.get_text(d)>this.get_text(h)?1:-1,n,t;try{n=this.get_node(d).li_attr.rel}catch(a){n=null}try{t=this.get_node(h).li_attr.rel}catch(b){t=null}return"bulk"==n?-1:"bulk"==t?1:m},contextmenu:{items:u,select_node:!1,icons:!1},plugins:y});r=jQuery.jstree.reference(m);
n&&((h.bulkSelect||this.manualCascadeOption)&&h.cascadeOptionInTree?(this.wrapper.find(".s3-hierarchy-header").hide(),r.create_node("#",{id:this.treeID+"-select-all",text:h.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first")):this.wrapper.find(".s3-hierarchy-header").removeClass("hide").show());h=r.get_checked();this._updateButtonText(h);this._bindEvents()}else this.button.hide(),this.noopts.show()},_updateSelectedNodes:function(){var h=jQuery.jstree.reference(d(this.tree)),
m=this.input.val(),m=m?JSON.parse(m):[],n=[],v=[],r=this.options.leafonly,t=h.get_checked(!0);d(t).each(function(){var m=d(this).attr("id");if("bulk"!=d(this).attr("rel")&&m&&(!r||h.is_leaf(this))){var t=parseInt(m.split("-").pop());t&&(n.push(t),v.push(m))}});var t=!1,u=d(n).not(m).get();u.length?t=!0:(u=d(m).not(n).get(),u.length&&(t=!0));this.input.val(JSON.stringify(n));this._updateButtonText(v);t&&(this.input.change(),d(this.element).trigger("select.s3hierarchy"));return!0},_updateButtonText:function(h){var m=
null,m=this.options,n=0;h&&(n=h.length);if(n)if(1<n)m=m.selectedText.replace("#",n);else{for(var v=[],r=0;r<n;r++)v.push(d("#"+h[r]+" > a").text().replace(/^\s+|\s+$/g,""));m=v.length?v.join(" "):m.noneSelectedText}else m=m.noneSelectedText;this.buttonText.text(m)},_updateAndClose:function(){if(!this._isBulk){this._updateSelectedNodes();var d=this.wrapper,m=this;if(m.options.multiple)d.unbind("mouseleave.hierarchicalopts").one("mouseleave.hierarchicalopts",function(){window.setTimeout(function(){m.closeMenu()},
100)});else window.setTimeout(function(){m.closeMenu()},100)}},_selectNode:function(h){var m=this.options,n=jQuery.jstree.reference(d(this.tree)),v=m.multiple,r=m.leafonly;if(v)this._isBulk||"bulk"!=h.li_attr.rel||((m=n.get_parent(h))&&"#"!=m?(m=n.get_node(m),this._selectBranch(m,!0)):n.select_all());else{var t=h.id;d(n.get_checked(!0)).each(function(){t!=this.id&&(r&&!n.is_leaf(this)||n.uncheck_node(this))})}if(r&&!v&&!n.is_leaf(h))return n.deselect_node(h),!1;this._updateAndClose()},_deselectNode:function(h){var m=
jQuery.jstree.reference(d(this.tree));if(!this._isBulk){if("bulk"==h.li_attr.rel)(h=m.get_parent(h))&&"#"!=h?(h=m.get_node(h),this._deselectBranch(h,!0)):m.deselect_all();else if(h=m.get_parent(h))if(h=m.get_node(h+"-select-all"))this._isBulk=!0,m.uncheck_node(h),this._isBulk=!1;if(h=m.get_node(this.treeID+"-select-all"))this._isBulk=!0,m.uncheck_node(h),this._isBulk=!1}this._updateSelectedNodes()},_openNode:function(h){var m=jQuery.jstree.reference(d(this.tree)),n=m.get_parent(h);n.length&&m.open_node(n,
!1,!0);if(this.manualCascadeOption){var v=h.id,n=m.get_node(v+"-select-all");n||(h=m.create_node(h,{id:v+"-select-all",text:this.options.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first"),n=m.get_node(h));(h=m.get_node(this.treeID+"-select-all"))&&m.is_checked(h)&&(this._isBulk=!0,m.check_node(n),this._isBulk=!1)}},_selectBranch:function(h,m){var n=jQuery.jstree.reference(d(this.tree)),v=this;this._isBulk=!0;n.open_node(h,function(){var r=n.get_children_dom(h);d(r).each(function(){v._selectBranch(this)});
m||n.check_node(h)});this._isBulk=!1;this._updateAndClose()},_deselectBranch:function(h,m){var n=jQuery.jstree.reference(d(this.tree)),v=this;this._isBulk=!0;n.open_node(h,function(){var r=n.get_children_dom(h);d(r).each(function(){v._deselectBranch(this)});m||n.uncheck_node(h)});this._isBulk=!1;this._updateSelectedNodes()},set:function(h){var m=jQuery.jstree.reference(d(this.tree));m.uncheck_all();if(h)for(var n=0,v=h.length,r;n<v;n++)r=d("#"+this.treeID+"-"+h[n]),m.check_node(r)},get:function(){var d=
this.input.val();return d?JSON.parse(d):[]},reset:function(){this._isBulk=!0;this.tree.jstree("uncheck_all");this._isBulk=!1;this._updateSelectedNodes();return!0},openMenu:function(){this._isOpen&&this.closeMenu();var h=d(this.button),m=h.offset();d(this.wrapper).css({position:"absolute",top:m.top+h.outerHeight(),left:m.left,minWidth:h.outerWidth()-8}).show();d(this.tree).jstree("set_focus");this._isOpen=!0;h.addClass("ui-state-active");d(this).trigger("open")},closeMenu:function(){d(this.tree).jstree("unset_focus").unbind("click.hierarchicalopts").unbind("mouseleave.hierarchicalopts");
d(this.wrapper).fadeOut(50);this._isOpen=!1;d(this.button).removeClass("ui-state-active");d(this).trigger("close")},addNode:function(h,m,n,v){var r=this.tree,t=this.treeID,u="#";h&&(u=d("#"+t+"-"+h),u.length||(u="#"));m=t+"-"+m;r.jstree("create_node",u,{id:m,text:n,li_attr:{rel:"leaf"}},"last");h&&(u.attr({rel:"parent"}),r.jstree("open_node",u));v&&r.jstree("check_node",d("#"+m))},_bindEvents:function(){var h=this,m=d(this.wrapper),n=d(this.tree),v=d(this.button),r=this._namespace,t=this.options,
u=jQuery.jstree.reference(n),y=d.vakata.context.settings.icons;d(document).bind("context_show.vakata",function(){m.unbind("mouseleave.hierarchicalopts");d.vakata.context.settings.icons=y});n.bind("select_node.jstree",function(d,m){h._selectNode(m.node)}).bind("deselect_node.jstree",function(d,m){h._deselectNode(m.node)}).bind("open_node.jstree",function(d,m){h._openNode(m.node)});v.bind("click"+r,function(){h._isOpen?h.closeMenu():h.openMenu()}).bind("keyup"+r,function(d){d.preventDefault();switch(d.keyCode){case 27:case 38:case 37:h.closeMenu();
break;case 39:case 40:h.openMenu()}}).bind("mouseenter"+r,function(){v.hasClass("ui-state-disabled")||d(this).addClass("ui-state-hover")}).bind("mouseleave"+r,function(){d(this).removeClass("ui-state-hover")}).bind("focus"+r,function(){v.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")}).bind("blur"+r,function(){d(this).removeClass("ui-state-focus")});t.multiple&&t.bulkSelect&&!t.cascadeOptionInTree&&(m.find(".s3-hierarchy-select-all").bind("click"+r,function(d){d.preventDefault();
u.select_all();h._updateSelectedNodes()}),m.find(".s3-hierarchy-deselect-all").bind("click"+r,function(d){d.preventDefault();u.deselect_all();h._updateSelectedNodes()}),m.find(".s3-hierarchy-header").bind("click"+r,function(d){d.preventDefault();d.stopPropagation()}).bind("mousedown"+r,function(d){d.preventDefault();d.stopPropagation()}));d(document).bind("mousedown"+r,function(t){var r=t.target;if(d(".jstree-contextmenu").has(r).length||3==t.which)return m.unbind("mouseleave.hierarchicalopts"),!0;
n.is(r)||v.is(r)||0!==n.has(r).length||0!==v.has(r).length||h.closeMenu()});return!0},_unbindEvents:function(){var h=d(this.tree);d(this.button);var m=this._namespace;h.unbind("select_node.jstree").unbind("deselect_node.jstree").unbind("loaded.jstree").unbind("open_node.jstree");d(this.button).unbind(m);d(document).unbind(m);return!0}})})(jQuery);
(function(d,u){var D=0;d.widget("s3.hierarchicalcrud",{options:{widgetID:null,ajaxURL:null,openLabel:"Open",openURL:null,editTitle:"Edit Record",editLabel:"Edit",editURL:null,deleteLabel:"Delete",deleteURL:null,addTitle:"Add Record",addLabel:"Add",addURL:null,icons:!1,stripes:!0,htmlTitles:!0},_create:function(){this.treeID=d(this.element).attr("id")+"-tree";this.id=D;D+=1},_init:function(){this.tree=d(this.element).find(".s3-hierarchy-tree");this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this)},
refresh:function(){var h=this.tree,m=this.options;this._unbindEvents();var n=h.find("> ul > li");if(1==n.length){var n=n.first(),v=n.data("jstree");n.data("jstree",d.extend({},v,{opened:!0}))}var r=this;h.jstree({core:{themes:{name:"s3",icons:m.icons,stripes:m.stripes},animation:100,multiple:!1,check_callback:!0},contextmenu:{items:function(d){return{open:{label:r.options.openLabel,action:function(h){r._openNode(d)},separator_after:!0},edit:{label:r.options.editLabel,action:function(h){r._editNode(d)}},
"delete":{label:r.options.deleteLabel,separator_after:!0,action:function(h){r._deleteNode(d)}},add:{label:r.options.addLabel,action:function(h){r._addNode(d)}}}},select_node:!0},plugins:["sort","contextmenu"]});this._bindEvents()},_openNode:function(d){var m=this.options.openURL;d=d.id;m&&d&&(d=parseInt(d.split("-").pop()))&&(m=m.replace("[id]",d).replace("%5Bid%5D",d),window.location.href=m)},refreshNode:function(h){var m=this.options.ajaxURL,n=h.attr("id");if(m&&n&&(n=parseInt(n.split("-").pop()))){var v=
this.tree,r=this.treeID;d.getJSONS3(m+"?node="+n,function(d){d.label&&v.jstree("rename_node",h,d.label);if(d=d.children){v.jstree("open_node",h,!1,!1);for(var m,n,u,C=0,D=0,J=d.length;D<J;D++)m=d[D],n=r+"-"+m.node,(u=v.jstree("get_node","#"+n,!0))?v.jstree("rename_node",u,m.label):(v.jstree("create_node",h,{id:n,text:m.label,li_attr:{rel:"leaf"}}),C++);C&&(v.jstree("open_node",h),h.attr({rel:"parent"}))}})}},_editNode:function(h){var m=this.options.editURL;h=h.id;if(m&&h){var n=parseInt(h.split("-").pop());
n&&(m=m.replace("[id]",n).replace("%5Bid%5D",n).split("?")[0],m+="?node="+h+"&hierarchy="+this.options.widgetID,h=S3.uid(),m=d('<iframe id="'+h+'" src='+m+" onload=\"S3.popup_loaded('"+h+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(m,this.options.editTitle))}},_addNode:function(h){var m=this.options.addURL;h=h.id;if(m&&h){var n=parseInt(h.split("-").pop());n&&(m=m.split("?")[0],m+="?node="+h+"&link_to_parent="+n+"&hierarchy="+
this.options.widgetID,h=S3.uid(),m=d('<iframe id="'+h+'" src='+m+" onload=\"S3.popup_loaded('"+h+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(m,this.options.addTitle))}},_deleteNode:function(h){if(!confirm(i18n.delete_confirmation))return!1;var m=this.options.deleteURL,n=h.id,v=this.tree;m&&n&&(n=parseInt(n.split("-").pop()))&&(m=m.replace("[id]",n).replace("%5Bid%5D",n).split("?")[0],d.ajaxS3({type:"POST",url:m+"?recursive=1",
data:{},dataType:"JSON",success:function(d){v.jstree("delete_node",h)},error:function(d,h,m){h=d.responseText;if("{"==h[0])try{h=JSON.parse(d.responseText),S3.showAlert(h.message,"error")}catch(n){}}}))},_openPopup:function(h,m){h.dialog({close:function(d,m){if(self.parent){var r=self.parent.$("iframe.ui-dialog-content"),t=r.width();r.width(0);window.setTimeout(function(){r.width(t)},300)}h.remove()},minHeight:480,modal:!0,open:function(m,u){d(".ui-widget-overlay").bind("click",function(){h.dialog("close")})},
title:m,minWidth:320,closeText:""})},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);
