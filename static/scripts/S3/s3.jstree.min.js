/*
 2013-2018 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3

 2015-2018 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3
 jsTree 3.0.9
 http://jstree.com/

 Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)

 Licensed same as jquery - under the terms of the MIT License
   http://www.opensource.org/licenses/mit-license.php
 if using jslint please allow for the jQuery global and use following options: 
 jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 'themes' : {
      'name' : this.get_theme(),
      'icons' : this._data.core.themes.icons,
      'dots' : this._data.core.themes.dots
     },
 if(state.core.themes) {
      if(state.core.themes.name) {
       this.set_theme(state.core.themes.name);
      }
      if(typeof state.core.themes.dots !== 'undefined') {
       this[ state.core.themes.dots ? "show_dots" : "hide_dots" ]();
      }
      if(typeof state.core.themes.icons !== 'undefined') {
       this[ state.core.themes.icons ? "show_icons" : "hide_icons" ]();
      }
      delete state.core.themes;
      delete state.core.open;
      this.set_state(state, callback);
      return false;
     }
 oi = obj.children("i:visible"),
    ai = a.children("i:visible"),
    w1 = oi.width() * oi.length,
    w2 = ai.width() * ai.length,
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,u,w){d instanceof String&&(d=String(d));for(var g=d.length,k=0;k<g;k++){var m=d[k];if(u.call(w,m,k,d))return{i:k,v:m}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,u,w){d!=Array.prototype&&d!=Object.prototype&&(d[u]=w.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,u,w,g){if(u){w=$jscomp.global;d=d.split(".");for(g=0;g<d.length-1;g++){var k=d[g];k in w||(w[k]={});w=w[k]}d=d[d.length-1];g=w[d];u=u(g);u!=g&&null!=u&&$jscomp.defineProperty(w,d,{configurable:!0,writable:!0,value:u})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,w){return $jscomp.findInternal(this,d,w).v}},"es6","es3");
(function(d){"function"===typeof define&&define.amd?define(["jquery"],d):"object"===typeof exports?d(require("jquery")):d(jQuery)})(function(d,u){if(!d.jstree){var w=0,g=!1,k=!1,m=!1,r=[],p=d("script:last").attr("src"),v=document,D=v.createElement("LI");D.setAttribute("role","treeitem");var z=v.createElement("I");z.className="jstree-icon jstree-ocl";z.setAttribute("role","presentation");D.appendChild(z);z=v.createElement("A");z.className="jstree-anchor";z.setAttribute("href","#");z.setAttribute("tabindex",
"-1");v=v.createElement("I");v.className="jstree-icon jstree-themeicon";v.setAttribute("role","presentation");z.appendChild(v);D.appendChild(z);z=v=null;d.jstree={version:"3.0.9",defaults:{plugins:[]},plugins:{},path:p&&-1!==p.indexOf("/")?p.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g};d.jstree.create=function(a,b){var c=new d.jstree.core(++w),e=b;b=d.extend(!0,{},d.jstree.defaults,b);e&&e.plugins&&(b.plugins=e.plugins);d.each(b.plugins,function(a,e){"core"!==a&&
(c=c.plugin(e,b[e]))});c.init(a,b);return c};d.jstree.destroy=function(){d(".jstree:jstree").jstree("destroy");d(document).off(".jstree")};d.jstree.core=function(a){this._id=a;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}};d.jstree.reference=function(a){var b=null,c=null;a&&a.id&&(a=a.id);if(!c||!c.length)try{c=d(a)}catch(e){}if(!c||!c.length)try{c=d("#"+a.replace(d.jstree.idregex,"\\$&"))}catch(e){}c&&
c.length&&(c=c.closest(".jstree")).length&&(c=c.data("jstree"))?b=c:d(".jstree").each(function(){var c=d(this).data("jstree");if(c&&c._model.data[a])return b=c,!1});return b};d.fn.jstree=function(a){var b="string"===typeof a,c=Array.prototype.slice.call(arguments,1),e=null;if(!0===a&&!this.length)return!1;this.each(function(){var f=d.jstree.reference(this),l=b&&f?f[a]:null;e=b&&l?l.apply(f,c):null;f||b||a!==u&&!d.isPlainObject(a)||d(this).data("jstree",new d.jstree.create(this,a));if(f&&!b||!0===
a)e=f||!1;if(null!==e&&e!==u)return!1});return null!==e&&e!==u?e:this};d.expr[":"].jstree=d.expr.createPseudo(function(a){return function(a){return d(a).hasClass("jstree")&&d(a).data("jstree")!==u}});d.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:d.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0};d.jstree.core.prototype={plugin:function(a,b){var c=
d.jstree.plugins[a];return c?(this._data[a]={},c.prototype=this,new c(b,this)):this},init:function(a,b){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this.element=d(a).addClass("jstree jstree-"+this._id);this.settings=b;this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl="rtl"===this.element.css("direction");this.element[this._data.core.rtl?
"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0);this.element.attr("tabindex")||this.element.attr("tabindex","0");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();
this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().height()||
24;this.trigger("loading");this.load_node("#")},destroy:function(a){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(b){}a||this.element.empty();this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){var a="",b=null,c=0;this.element.on("dblclick.jstree",function(){if(document.selection&&
document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(f){}}}).on("mousedown.jstree",d.proxy(function(a){a.target===this.element[0]&&(a.preventDefault(),c=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(a){a.preventDefault()}).on("click.jstree",".jstree-ocl",d.proxy(function(a){this.toggle_node(a.target)},this)).on("dblclick.jstree",".jstree-anchor",d.proxy(function(a){this.settings.core.dblclick_toggle&&
this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",d.proxy(function(a){a.preventDefault();a.currentTarget!==document.activeElement&&d(a.currentTarget).focus();this.activate_node(a.currentTarget,a)},this)).on("keydown.jstree",".jstree-anchor",d.proxy(function(a){if("INPUT"===a.target.tagName)return!0;var c=null;this._data.core.rtl&&(37===a.which?a.which=39:39===a.which&&(a.which=37));switch(a.which){case 32:a.ctrlKey&&(a.type="click",d(a.currentTarget).trigger(a));break;case 13:a.type=
"click";d(a.currentTarget).trigger(a);break;case 37:a.preventDefault();this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(c=this.get_parent(a.currentTarget))&&"#"!==c.id&&this.get_node(c,!0).children(".jstree-anchor").focus();break;case 38:a.preventDefault();(c=this.get_prev_dom(a.currentTarget))&&c.length&&c.children(".jstree-anchor").focus();break;case 39:a.preventDefault();this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):
this.is_open(a.currentTarget)&&(c=this.get_node(a.currentTarget,!0).children(".jstree-children")[0])&&d(this._firstChild(c)).children(".jstree-anchor").focus();break;case 40:a.preventDefault();(c=this.get_next_dom(a.currentTarget))&&c.length&&c.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:a.preventDefault();(c=this._firstChild(this.get_container_ul()[0]))&&d(c).children(".jstree-anchor").filter(":visible").focus();break;case 35:a.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},
this)).on("load_node.jstree",d.proxy(function(a,c){c.status&&("#"!==c.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(d.proxy(function(){if(!this.get_container_ul().find(".jstree-loading").length){this._data.core.ready=!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var a=
[],c;var b=0;for(c=this._data.core.selected.length;b<c;b++)a=a.concat(this._model.data[this._data.core.selected[b]].parents);a=d.vakata.array_unique(a);b=0;for(c=a.length;b<c;b++)this.open_node(a[b],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",d.proxy(function(c){if("INPUT"===c.target.tagName)return!0;b&&clearTimeout(b);b=setTimeout(function(){a=""},500);var e=String.fromCharCode(c.which).toLowerCase();
c=this.element.find(".jstree-anchor").filter(":visible");var l=c.index(document.activeElement)||0,h=!1;a+=e;if(1<a.length){c.slice(l).each(d.proxy(function(c,b){if(0===d(b).text().toLowerCase().indexOf(a))return d(b).focus(),h=!0,!1},this));if(h)return;c.slice(0,l).each(d.proxy(function(c,b){if(0===d(b).text().toLowerCase().indexOf(a))return d(b).focus(),h=!0,!1},this));if(h)return}(new RegExp("^"+e+"+$")).test(a)&&(c.slice(l+1).each(d.proxy(function(a,c){if(d(c).text().toLowerCase().charAt(0)===
e)return d(c).focus(),h=!0,!1},this)),h||c.slice(0,l+1).each(d.proxy(function(a,c){if(d(c).text().toLowerCase().charAt(0)===e)return d(c).focus(),h=!0,!1},this)))},this)).on("init.jstree",d.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots;this._data.core.themes.stripes=a.stripes;this._data.core.themes.icons=a.icons;this.set_theme(a.name||"default",a.url);this.set_theme_variant(a.variant)},this)).on("loading.jstree",d.proxy(function(){this[this._data.core.themes.dots?
"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",d.proxy(function(a){this._data.core.focused=null;d(a.currentTarget).filter(".jstree-hovered").mouseleave();this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",d.proxy(function(a){var c=this.get_node(a.currentTarget);c&&c.id&&(this._data.core.focused=c.id);this.element.find(".jstree-hovered").not(a.currentTarget).mouseleave();
d(a.currentTarget).mouseenter();this.element.attr("tabindex","-1")},this)).on("focus.jstree",d.proxy(function(){500<+new Date-c&&!this._data.core.focused&&(c=0,this.get_node(this.element.attr("aria-activedescendant"),!0).find("> .jstree-anchor").focus())},this)).on("mouseenter.jstree",".jstree-anchor",d.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",d.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree");
d(document).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={});b.instance=this;this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(a){var b=this.settings.core.strings;return d.isFunction(b)?b.call(this,a):b&&b[a]?b[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=
a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,b){a&&a.id&&(a=a.id);var c;try{if(this._model.data[a])a=this._model.data[a];else if("string"===typeof a&&this._model.data[a.replace(/^#/,"")])a=this._model.data[a.replace(/^#/,"")];else if("string"===typeof a&&(c=d("#"+a.replace(d.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[c.closest(".jstree-node").attr("id")])a=
this._model.data[c.closest(".jstree-node").attr("id")];else if((c=d(a,this.element)).length&&this._model.data[c.closest(".jstree-node").attr("id")])a=this._model.data[c.closest(".jstree-node").attr("id")];else if((c=d(a,this.element)).length&&c.hasClass("jstree"))a=this._model.data["#"];else return!1;b&&(a="#"===a.id?this.element:d("#"+a.id.replace(d.jstree.idregex,"\\$&"),this.element));return a}catch(e){return!1}},get_path:function(a,b,c){a=a.parents?a:this.get_node(a);if(!a||"#"===a.id||!a.parents)return!1;
var e,f=[];f.push(c?a.id:a.text);var d=0;for(e=a.parents.length;d<e;d++)f.push(c?a.parents[d]:this.get_text(a.parents[d]));f=f.reverse().slice(1);return b?f.join(b):f},get_next_dom:function(a,b){a=this.get_node(a,!0);if(a[0]===this.element[0]){for(b=this._firstChild(this.get_container_ul()[0]);b&&0===b.offsetHeight;)b=this._nextSibling(b);return b?d(b):!1}if(!a||!a.length)return!1;if(b){b=a[0];do b=this._nextSibling(b);while(b&&0===b.offsetHeight);return b?d(b):!1}if(a.hasClass("jstree-open")){for(b=
this._firstChild(a.children(".jstree-children")[0]);b&&0===b.offsetHeight;)b=this._nextSibling(b);if(null!==b)return d(b)}b=a[0];do b=this._nextSibling(b);while(b&&0===b.offsetHeight);return null!==b?d(b):a.parentsUntil(".jstree",".jstree-node").next(".jstree-node:visible").first()},get_prev_dom:function(a,b){a=this.get_node(a,!0);if(a[0]===this.element[0]){for(b=this.get_container_ul()[0].lastChild;b&&0===b.offsetHeight;)b=this._previousSibling(b);return b?d(b):!1}if(!a||!a.length)return!1;if(b){b=
a[0];do b=this._previousSibling(b);while(b&&0===b.offsetHeight);return b?d(b):!1}b=a[0];do b=this._previousSibling(b);while(b&&0===b.offsetHeight);if(null!==b){for(a=d(b);a.hasClass("jstree-open");)a=a.children(".jstree-children").first().children(".jstree-node:visible:last");return a}return(b=a[0].parentNode.parentNode)&&b.className&&-1!==b.className.indexOf("jstree-node")?d(b):!1},get_parent:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.parent:!1},get_children_dom:function(a){a=this.get_node(a,
!0);return a[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):a&&a.length?a.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&
this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(a,b){var c,e;if(d.isArray(a))return this._load_nodes(a.slice(),b),!0;a=this.get_node(a);if(!a)return b&&b.call(this,a,!1),!1;if(a.state.loaded){a.state.loaded=!1;var f=0;for(c=a.children_d.length;f<c;f++){var l=0;for(e=a.parents.length;l<e;l++)this._model.data[a.parents[l]].children_d=d.vakata.array_remove_item(this._model.data[a.parents[l]].children_d,a.children_d[f]);if(this._model.data[a.children_d[f]].state.selected){var h=
!0;this._data.core.selected=d.vakata.array_remove_item(this._data.core.selected,a.children_d[f])}delete this._model.data[a.children_d[f]]}a.children=[];a.children_d=[];h&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.loading=!0;this.get_node(a,!0).addClass("jstree-loading").attr("aria-busy",!0);this._load_node(a,d.proxy(function(c){a=this._model.data[a.id];a.state.loading=!1;a.state.loaded=c;var e=this.get_node(a,!0);a.state.loaded&&!a.children.length&&
e&&e.length&&!e.hasClass("jstree-leaf")&&e.removeClass("jstree-closed jstree-open").addClass("jstree-leaf");e.removeClass("jstree-loading").attr("aria-busy",!1);this.trigger("load_node",{node:a,status:c});b&&b.call(this,a,c)},this));return!0},_load_nodes:function(a,b,c){var e=!0,f=function(){this._load_nodes(a,b,!0)},d=this._model.data,h;var n=0;for(h=a.length;n<h;n++)!d[a[n]]||d[a[n]].state.loaded&&c||(this.is_loading(a[n])||this.load_node(a[n],f),e=!1);e&&b&&!b.done&&(b.call(this,a),b.done=!0)},
load_all:function(a,b){a||(a="#");a=this.get_node(a);if(!a)return!1;var c=[],e=this._model.data,f=e[a.id].children_d,d;a.state&&!a.state.loaded&&c.push(a.id);var h=0;for(d=f.length;h<d;h++)e[f[h]]&&e[f[h]].state&&!e[f[h]].state.loaded&&c.push(f[h]);c.length?this._load_nodes(c,function(){this.load_all(a,b)}):(b&&b.call(this,a),this.trigger("load_all",{node:a}))},_load_node:function(a,b){var c=this.settings.core.data;if(!c)return"#"===a.id?this._append_html_data(a,this._data.core.original_container_html.clone(!0),
function(a){b.call(this,a)}):b.call(this,!1);if(d.isFunction(c))return c.call(this,a,d.proxy(function(c){!1===c&&b.call(this,!1);this["string"===typeof c?"_append_html_data":"_append_json_data"](a,"string"===typeof c?d(c):c,function(a){b.call(this,a)})},this));if("object"===typeof c){if(c.url)return c=d.extend(!0,{},c),d.isFunction(c.url)&&(c.url=c.url.call(this,a)),d.isFunction(c.data)&&(c.data=c.data.call(this,a)),d.ajax(c).done(d.proxy(function(c,f,l){f=l.getResponseHeader("Content-Type");if(-1!==
f.indexOf("json")||"object"===typeof c)return this._append_json_data(a,c,function(a){b.call(this,a)});if(-1!==f.indexOf("html")||"string"===typeof c)return this._append_html_data(a,d(c),function(a){b.call(this,a)});this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:l})};this.settings.core.error.call(this,this._data.core.last_error);return b.call(this,!1)},this)).fail(d.proxy(function(c){b.call(this,!1);this._data.core.last_error=
{error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:c})};this.settings.core.error.call(this,this._data.core.last_error)},this));c=d.isArray(c)||d.isPlainObject(c)?JSON.parse(JSON.stringify(c)):c;if("#"===a.id)return this._append_json_data(a,c,function(a){b.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error);
return b.call(this,!1)}if("string"===typeof c){if("#"===a.id)return this._append_html_data(a,d(c),function(a){b.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error)}return b.call(this,!1)},_node_changed:function(a){(a=this.get_node(a))&&this._model.changed.push(a.id)},_append_html_data:function(a,b,c){a=this.get_node(a);a.children=[];a.children_d=
[];b=b.is("ul")?b.children():b;var e=a.id,f=[],l=[],h=this._model.data,n=h[e];a=this._data.core.selected.length;var x,t;b.each(d.proxy(function(a,c){if(x=this._parse_model_from_html(d(c),e,n.parents.concat()))f.push(x),l.push(x),h[x].children_d.length&&(l=l.concat(h[x].children_d))},this));n.children=f;n.children_d=l;b=0;for(t=n.parents.length;b<t;b++)h[n.parents[b]].children_d=h[n.parents[b]].children_d.concat(l);this.trigger("model",{nodes:l,parent:e});"#"!==e?(this._node_changed(e),this.redraw()):
(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0));this._data.core.selected.length!==a&&this.trigger("changed",{action:"model",selected:this._data.core.selected});c.call(this,!0)},_append_json_data:function(a,b,c,e){a=this.get_node(a);a.children=[];a.children_d=[];b.d&&(b=b.d,"string"===typeof b&&(b=JSON.parse(b)));d.isArray(b)||(b=[b]);var f=null,l={df:this._model.default_state,dat:b,par:a.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},
h=function(a,c){a.data&&(a=a.data);var b=a.dat,e=a.par,f=[],d=[],l=[],h=a.df,n=a.t_id,t=a.t_cnt,x=a.m,g=x[e];a=a.sel;var k,m=function(a,b,e){e=e?e.concat():[];b&&e.unshift(b);var f=a.id.toString();b={id:f,text:a.text||"",icon:a.icon!==c?a.icon:!0,parent:b,parents:e,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(d in h)h.hasOwnProperty(d)&&(b.state[d]=h[d]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);
if(a&&a.data&&(b.data=a.data,a.data.jstree))for(d in a.data.jstree)a.data.jstree.hasOwnProperty(d)&&(b.state[d]=a.data.jstree[d]);if(a&&"object"===typeof a.state)for(d in a.state)a.state.hasOwnProperty(d)&&(b.state[d]=a.state[d]);if(a&&"object"===typeof a.li_attr)for(d in a.li_attr)a.li_attr.hasOwnProperty(d)&&(b.li_attr[d]=a.li_attr[d]);b.li_attr.id||(b.li_attr.id=f);if(a&&"object"===typeof a.a_attr)for(d in a.a_attr)a.a_attr.hasOwnProperty(d)&&(b.a_attr[d]=a.a_attr[d]);a&&a.children&&!0===a.children&&
(b.state.loaded=!1,b.children=[],b.children_d=[]);x[b.id]=b;var d=0;for(f=b.children.length;d<f;d++){var n=m(x[b.children[d]],b.id,e);var t=x[n];b.children_d.push(n);t.children_d.length&&(b.children_d=b.children_d.concat(t.children_d))}delete a.data;delete a.children;x[b.id].original=a;b.state.selected&&l.push(b.id);return b.id},r=function(a,b,e){e=e?e.concat():[];b&&e.unshift(b);do var f="j"+n+"_"+ ++t;while(x[f]);b={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==c?a.icon:
!0,parent:b,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(d in h)h.hasOwnProperty(d)&&(b.state[d]=h[d]);a&&a.id&&(b.id=a.id.toString());a&&a.text&&(b.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(d in a.data.jstree)a.data.jstree.hasOwnProperty(d)&&(b.state[d]=a.data.jstree[d]);if(a&&"object"===typeof a.state)for(d in a.state)a.state.hasOwnProperty(d)&&
(b.state[d]=a.state[d]);if(a&&"object"===typeof a.li_attr)for(d in a.li_attr)a.li_attr.hasOwnProperty(d)&&(b.li_attr[d]=a.li_attr[d]);b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString());b.id||(b.id=f);b.li_attr.id||(b.li_attr.id=b.id);if(a&&"object"===typeof a.a_attr)for(d in a.a_attr)a.a_attr.hasOwnProperty(d)&&(b.a_attr[d]=a.a_attr[d]);if(a&&a.children&&a.children.length){var d=0;for(f=a.children.length;d<f;d++){var q=r(a.children[d],b.id,e);var g=x[q];b.children.push(q);g.children_d.length&&(b.children_d=
b.children_d.concat(g.children_d))}b.children_d=b.children_d.concat(b.children)}a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);delete a.data;delete a.children;b.original=a;x[b.id]=b;b.state.selected&&l.push(b.id);return b.id};if(b.length&&b[0].id!==c&&b[0].parent!==c){var p=0;for(k=b.length;p<k;p++)b[p].children||(b[p].children=[]),x[b[p].id.toString()]=b[p];p=0;for(k=b.length;p<k;p++)x[b[p].parent.toString()].children.push(b[p].id.toString()),g.children_d.push(b[p].id.toString());
p=0;for(k=g.children.length;p<k;p++){var v=m(x[g.children[p]],e,g.parents.concat());d.push(v);x[v].children_d.length&&(d=d.concat(x[v].children_d))}}else{p=0;for(k=b.length;p<k;p++)if(v=r(b[p],e,g.parents.concat()))f.push(v),d.push(v),x[v].children_d.length&&(d=d.concat(x[v].children_d));g.children=f;g.children_d=d}p=0;for(k=g.parents.length;p<k;p++)x[g.parents[p]].children_d=x[g.parents[p]].children_d.concat(d);b={cnt:t,mod:x,sel:a,par:e,dpc:d,add:l};if("undefined"===typeof window||"undefined"===
typeof window.document)postMessage(b);else return b},n=function(a,b){this._cnt=a.cnt;this._model.data=a.mod;if(b){var e,f=a.add,l=a.sel,h=this._data.core.selected.slice(),n=this._model.data;if(l.length!==h.length||d.vakata.array_unique(l.concat(h)).length!==l.length){b=0;for(e=l.length;b<e;b++)-1===d.inArray(l[b],f)&&-1===d.inArray(l[b],h)&&(n[l[b]].state.selected=!1);b=0;for(e=h.length;b<e;b++)-1===d.inArray(h[b],l)&&(n[h[b]].state.selected=!0)}}a.add.length&&(this._data.core.selected=this._data.core.selected.concat(a.add));
this.trigger("model",{nodes:a.dpc,parent:a.par});"#"!==a.par?(this._node_changed(a.par),this.redraw()):this.redraw(!0);a.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected});c.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+h.toString()],{type:"text/javascript"}))),!this._data.core.working||e?(this._data.core.working=!0,f=new window.Worker(this._wrk),
f.onmessage=d.proxy(function(a){n.call(this,a.data,!0);try{f.terminate(),f=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),l.par?f.postMessage(l):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([a,b,c,!0])}catch(x){n.call(this,h(l),!1),this._data.core.worker_queue.length?
this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else n.call(this,h(l),!1)},_parse_model_from_html:function(a,b,c){c=c?[].concat(c):[];b&&c.unshift(b);var e,f,l=this._model.data,h={id:!1,text:!1,icon:!0,parent:b,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in this._model.default_state)this._model.default_state.hasOwnProperty(n)&&(h.state[n]=this._model.default_state[n]);b=d.vakata.attributes(a,
!0);d.each(b,function(a,c){c=d.trim(c);if(!c.length)return!0;h.li_attr[a]=c;"id"===a&&(h.id=c.toString())});b=a.children("a").first();b.length&&(b=d.vakata.attributes(b,!0),d.each(b,function(a,c){c=d.trim(c);c.length&&(h.a_attr[a]=c)}));b=a.children("a").first().length?a.children("a").first().clone():a.clone();b.children("ins, i, ul").remove();b=b.html();b=d("<div />").html(b);h.text=this.settings.core.force_text?b.text():b.html();b=a.data();h.data=b?d.extend(!0,{},b):null;h.state.opened=a.hasClass("jstree-open");
h.state.selected=a.children("a").hasClass("jstree-clicked");h.state.disabled=a.children("a").hasClass("jstree-disabled");if(h.data&&h.data.jstree)for(n in h.data.jstree)h.data.jstree.hasOwnProperty(n)&&(h.state[n]=h.data.jstree[n]);b=a.children("a").children(".jstree-themeicon");b.length&&(h.icon=b.hasClass("jstree-themeicon-hidden")?!1:b.attr("rel"));h.state.icon&&(h.icon=h.state.icon);b=a.children("ul").children("li");do var n="j"+this._id+"_"+ ++this._cnt;while(l[n]);h.id=h.li_attr.id?h.li_attr.id.toString():
n;b.length?(b.each(d.proxy(function(a,b){e=this._parse_model_from_html(d(b),h.id,c);f=this._model.data[e];h.children.push(e);f.children_d.length&&(h.children_d=h.children_d.concat(f.children_d))},this)),h.children_d=h.children_d.concat(h.children)):a.hasClass("jstree-closed")&&(h.state.loaded=!1);h.li_attr["class"]&&(h.li_attr["class"]=h.li_attr["class"].replace("jstree-closed","").replace("jstree-open",""));h.a_attr["class"]&&(h.a_attr["class"]=h.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled",
""));l[h.id]=h;h.state.selected&&this._data.core.selected.push(h.id);return h.id},_parse_model_from_flat_json:function(a,b,c){c=c?c.concat():[];b&&c.unshift(b);var e=a.id.toString(),f=this._model.data,d=this._model.default_state;b={id:e,text:a.text||"",icon:a.icon!==u?a.icon:!0,parent:b,parents:c,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(h in d)d.hasOwnProperty(h)&&(b.state[h]=d[h]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&
(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(h in a.data.jstree)a.data.jstree.hasOwnProperty(h)&&(b.state[h]=a.data.jstree[h]);if(a&&"object"===typeof a.state)for(h in a.state)a.state.hasOwnProperty(h)&&(b.state[h]=a.state[h]);if(a&&"object"===typeof a.li_attr)for(h in a.li_attr)a.li_attr.hasOwnProperty(h)&&(b.li_attr[h]=a.li_attr[h]);b.li_attr.id||(b.li_attr.id=e);if(a&&"object"===typeof a.a_attr)for(h in a.a_attr)a.a_attr.hasOwnProperty(h)&&(b.a_attr[h]=a.a_attr[h]);
a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);f[b.id]=b;var h=0;for(e=b.children.length;h<e;h++){d=this._parse_model_from_flat_json(f[b.children[h]],b.id,c);var n=f[d];b.children_d.push(d);n.children_d.length&&(b.children_d=b.children_d.concat(n.children_d))}delete a.data;delete a.children;f[b.id].original=a;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_parse_model_from_json:function(a,b,c){c=c?c.concat():[];b&&c.unshift(b);var e=this._model.data;
var f=this._model.default_state;do var d="j"+this._id+"_"+ ++this._cnt;while(e[d]);b={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==u?a.icon:!0,parent:b,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(h in f)f.hasOwnProperty(h)&&(b.state[h]=f[h]);a&&a.id&&(b.id=a.id.toString());a&&a.text&&(b.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(h in a.data.jstree)a.data.jstree.hasOwnProperty(h)&&
(b.state[h]=a.data.jstree[h]);if(a&&"object"===typeof a.state)for(h in a.state)a.state.hasOwnProperty(h)&&(b.state[h]=a.state[h]);if(a&&"object"===typeof a.li_attr)for(h in a.li_attr)a.li_attr.hasOwnProperty(h)&&(b.li_attr[h]=a.li_attr[h]);b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString());b.id||(b.id=d);b.li_attr.id||(b.li_attr.id=b.id);if(a&&"object"===typeof a.a_attr)for(h in a.a_attr)a.a_attr.hasOwnProperty(h)&&(b.a_attr[h]=a.a_attr[h]);if(a&&a.children&&a.children.length){var h=0;for(d=a.children.length;h<
d;h++){f=this._parse_model_from_json(a.children[h],b.id,c);var n=e[f];b.children.push(f);n.children_d.length&&(b.children_d=b.children_d.concat(n.children_d))}b.children_d=b.children_d.concat(b.children)}a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);delete a.data;delete a.children;b.original=a;e[b.id]=b;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_redraw:function(){var a=this._model.force_full_redraw?this._model.data["#"].children.concat([]):
this._model.changed.concat([]),b=document.createElement("UL"),c,e,f=this._data.core.focused;var d=0;for(e=a.length;d<e;d++)(c=this.redraw_node(a[d],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&b.appendChild(c);this._model.force_full_redraw&&(b.className=this.get_container_ul()[0].className,b.setAttribute("role","group"),this.element.empty().append(b));null!==f&&((c=this.get_node(f,!0))&&c.length&&c.children(".jstree-anchor")[0]!==document.activeElement?c.children(".jstree-anchor").focus():
this._data.core.focused=null);this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:a})},redraw:function(a){a&&(this._model.force_full_redraw=!0);this._redraw()},draw_children:function(a){var b=this.get_node(a),c;var e=document;if(!b)return!1;if("#"===b.id)return this.redraw(!0);a=this.get_node(a,!0);if(!a||!a.length)return!1;a.children(".jstree-children").remove();a=a[0];if(b.children.length&&b.state.loaded){var f=e.createElement("UL");f.setAttribute("role","group");
f.className="jstree-children";e=0;for(c=b.children.length;e<c;e++)f.appendChild(this.redraw_node(b.children[e],!0,!0));a.appendChild(f)}},redraw_node:function(a,b,c,e){var f=this.get_node(a),l=!1,h=!1,n=!1,g=!1,t=!1,q=!1,k="",m=document;q=this._model.data;var p=!1,r=null,A=k=0;if(!f)return!1;if("#"===f.id)return this.redraw(!0);b=b||0===f.children.length;if(a=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(f.id[0])?"\\3"+f.id[0]+" "+f.id.substr(1).replace(d.jstree.idregex,
"\\$&"):f.id.replace(d.jstree.idregex,"\\$&"))):document.getElementById(f.id))a=d(a),c||(l=a.parent().parent()[0],l===this.element[0]&&(l=null),h=a.index()),b||!f.children.length||a.children(".jstree-children").length||(b=!0),b||(n=a.children(".jstree-children")[0]),p=a.children(".jstree-anchor")[0]===document.activeElement,a.remove();else if(b=!0,!c){l="#"!==f.parent?d("#"+f.parent.replace(d.jstree.idregex,"\\$&"),this.element)[0]:null;if(!(null===l||l&&q[f.parent].state.opened))return!1;h=d.inArray(f.id,
null===l?q["#"].children:q[f.parent].children)}a=D.cloneNode(!0);k="jstree-node ";for(g in f.li_attr)f.li_attr.hasOwnProperty(g)&&"id"!==g&&("class"!==g?a.setAttribute(g,f.li_attr[g]):k+=f.li_attr[g]);f.a_attr.id||(f.a_attr.id=f.id+"_anchor");a.setAttribute("aria-selected",!!f.state.selected);a.setAttribute("aria-level",f.parents.length);a.setAttribute("aria-labelledby",f.a_attr.id);f.state.disabled&&a.setAttribute("aria-disabled",!0);f.state.loaded&&!f.children.length?k+=" jstree-leaf":(k+=f.state.opened&&
f.state.loaded?" jstree-open":" jstree-closed",a.setAttribute("aria-expanded",f.state.opened&&f.state.loaded));null!==f.parent&&q[f.parent].children[q[f.parent].children.length-1]===f.id&&(k+=" jstree-last");a.id=f.id;a.className=k;k=(f.state.selected?" jstree-clicked":"")+(f.state.disabled?" jstree-disabled":"");for(t in f.a_attr)!f.a_attr.hasOwnProperty(t)||"href"===t&&"#"===f.a_attr[t]||("class"!==t?a.childNodes[1].setAttribute(t,f.a_attr[t]):k+=" "+f.a_attr[t]);k.length&&(a.childNodes[1].className=
"jstree-anchor "+k);if(f.icon&&!0!==f.icon||!1===f.icon)!1===f.icon?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===f.icon.indexOf("/")&&-1===f.icon.indexOf(".")?a.childNodes[1].childNodes[0].className+=" "+f.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage="url("+f.icon+")",a.childNodes[1].childNodes[0].style.backgroundPosition="center center",a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=
" jstree-themeicon-custom");this.settings.core.force_text?a.childNodes[1].appendChild(m.createTextNode(f.text)):a.childNodes[1].innerHTML+=f.text;if(b&&f.children.length&&(f.state.opened||e)&&f.state.loaded){q=m.createElement("UL");q.setAttribute("role","group");q.className="jstree-children";g=0;for(t=f.children.length;g<t;g++)q.appendChild(this.redraw_node(f.children[g],b,!0));a.appendChild(q)}n&&a.appendChild(n);if(!c){l||(l=this.element[0]);g=0;for(t=l.childNodes.length;g<t;g++)if(l.childNodes[g]&&
l.childNodes[g].className&&-1!==l.childNodes[g].className.indexOf("jstree-children")){r=l.childNodes[g];break}r||(r=m.createElement("UL"),r.setAttribute("role","group"),r.className="jstree-children",l.appendChild(r));l=r;h<l.childNodes.length?l.insertBefore(a,l.childNodes[h]):l.appendChild(a);p&&(k=this.element[0].scrollTop,A=this.element[0].scrollLeft,a.childNodes[1].focus(),this.element[0].scrollTop=k,this.element[0].scrollLeft=A)}f.state.opened&&!f.state.loaded&&(f.state.opened=!1,setTimeout(d.proxy(function(){this.open_node(f.id,
!1,0)},this),0));return a},open_node:function(a,b,c){var e;if(d.isArray(a)){a=a.slice();var f=0;for(e=a.length;f<e;f++)this.open_node(a[f],b,c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=c===u?this.settings.core.animation:c;if(!this.is_closed(a))return b&&b.call(this,a,!1),!1;if(this.is_loaded(a)){f=this.get_node(a,!0);var l=this;f.length&&(c&&f.children(".jstree-children").length&&f.children(".jstree-children").stop(!0,!0),a.children.length&&!this._firstChild(f.children(".jstree-children")[0])&&
this.draw_children(a),c?(this.trigger("before_open",{node:a}),f.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(c,function(){this.style.display="";l.trigger("after_open",{node:a})})):(this.trigger("before_open",{node:a}),f[0].className=f[0].className.replace("jstree-closed","jstree-open"),f[0].setAttribute("aria-expanded",!0)));a.state.opened=!0;b&&b.call(this,
a,!0);f.length||this.trigger("before_open",{node:a});this.trigger("open_node",{node:a});c&&f.length||this.trigger("after_open",{node:a})}else{if(this.is_loading(a))return setTimeout(d.proxy(function(){this.open_node(a,b,c)},this),500);this.load_node(a,function(a,e){return e?this.open_node(a,b,c):b?b.call(this,a,!1):!1})}},_open_to:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b,c=a.parents;var e=0;for(b=c.length;e<b;e+=1)"#"!==e&&this.open_node(c[e],!1,0);return d("#"+a.id.replace(d.jstree.idregex,
"\\$&"),this.element)},close_node:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.close_node(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id||this.is_closed(a))return!1;b=b===u?this.settings.core.animation:b;var f=this;var l=this.get_node(a,!0);l.length&&(b?l.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(b,
function(){this.style.display="";l.children(".jstree-children").remove();f.trigger("after_close",{node:a})}):(l[0].className=l[0].className.replace("jstree-open","jstree-closed"),l.attr("aria-expanded",!1).children(".jstree-children").remove()));a.state.opened=!1;this.trigger("close_node",{node:a});b&&l.length||this.trigger("after_close",{node:a})},toggle_node:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.toggle_node(a[c]);return!0}if(this.is_closed(a))return this.open_node(a);
if(this.is_open(a))return this.close_node(a)},open_all:function(a,b,c){a||(a="#");a=this.get_node(a);if(!a)return!1;var e="#"===a.id?this.get_container_ul():this.get_node(a,!0),f;if(!e.length){e=0;for(f=a.children_d.length;e<f;e++)this.is_closed(this._model.data[a.children_d[e]])&&(this._model.data[a.children_d[e]].state.opened=!0);return this.trigger("open_all",{node:a})}c=c||e;var d=this;e=this.is_closed(a)?e.find(".jstree-closed").addBack():e.find(".jstree-closed");e.each(function(){d.open_node(this,
function(a,e){e&&this.is_parent(a)&&this.open_all(a,b,c)},b||0)});0===c.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(c)})},close_all:function(a,b){a||(a="#");a=this.get_node(a);if(!a)return!1;var c="#"===a.id?this.get_container_ul():this.get_node(a,!0),e=this,f;if(!c.length){c=0;for(f=a.children_d.length;c<f;c++)this._model.data[a.children_d[c]].state.opened=!1;return this.trigger("close_all",{node:a})}c=this.is_open(a)?c.find(".jstree-open").addBack():c.find(".jstree-open");
d(c.get().reverse()).each(function(){e.close_node(this,b||0)});this.trigger("close_all",{node:a})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.enable_node(a[c]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!1;this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1);this.trigger("enable_node",{node:a})},
disable_node:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.disable_node(a[c]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!0;this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0);this.trigger("disable_node",{node:a})},activate_node:function(a,b){if(this.is_disabled(a))return!1;this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==u?this.get_node(this._data.core.last_clicked.id):
null;this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null);!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&(!b.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(b.shiftKey){var c=this.get_node(a).id,
e=this._data.core.last_clicked.id,f=this.get_node(this._data.core.last_clicked.parent).children,d=!1,h;var n=0;for(h=f.length;n<h;n+=1)f[n]===c&&(d=!d),f[n]===e&&(d=!d),d||f[n]===c||f[n]===e?this.select_node(f[n],!0,!1,b):this.deselect_node(f[n],!0,b);this.trigger("changed",{action:"select_node",node:this.get_node(a),selected:this._data.core.selected,event:b})}else this.is_selected(a)?this.deselect_node(a,!1,b):this.select_node(a,!1,!1,b);else!this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&
this.is_selected(a)?this.deselect_node(a,!1,b):(this.deselect_all(!0),this.select_node(a,!1,!1,b),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a)})},hover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),c=this.element;b&&b.length&&this.dehover_node(b);a.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(a)});
setTimeout(function(){c.attr("aria-activedescendant",a[0].id)},0)},dehover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||!a.children(".jstree-hovered").length)return!1;a.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(a)})},select_node:function(a,b,c,e){var f;if(d.isArray(a)){a=a.slice();var l=0;for(f=a.length;l<f;l++)this.select_node(a[l],b,c,e);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;l=this.get_node(a,!0);a.state.selected||
(a.state.selected=!0,this._data.core.selected.push(a.id),c||(l=this._open_to(a)),l&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:e}),b||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:e}))},deselect_node:function(a,b,c){var e;if(d.isArray(a)){a=a.slice();var f=0;for(e=a.length;f<e;f++)this.deselect_node(a[f],b,c);return!0}a=this.get_node(a);
if(!a||"#"===a.id)return!1;f=this.get_node(a,!0);a.state.selected&&(a.state.selected=!1,this._data.core.selected=d.vakata.array_remove_item(this._data.core.selected,a.id),f.length&&f.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:c}),b||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:c}))},select_all:function(a){var b=this._data.core.selected.concat([]),
c;this._data.core.selected=this._model.data["#"].children_d.concat();var e=0;for(c=this._data.core.selected.length;e<c;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:b})},deselect_all:function(a){var b=this._data.core.selected.concat([]),c;var e=0;for(c=this._data.core.selected.length;e<
c;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1);this.trigger("deselect_all",{selected:this._data.core.selected,node:b});a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:b})},is_selected:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.state.selected:
!1},get_selected:function(a){return a?d.map(this._data.core.selected,d.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(a){var b=this.get_selected(!0),c={},e,f;var l=0;for(e=b.length;l<e;l++)c[b[l].id]=b[l];l=0;for(e=b.length;l<e;l++){var h=0;for(f=b[l].children_d.length;h<f;h++)c[b[l].children_d[h]]&&delete c[b[l].children_d[h]]}b=[];for(l in c)c.hasOwnProperty(l)&&b.push(l);return a?d.map(b,d.proxy(function(a){return this.get_node(a)},
this)):b},get_bottom_selected:function(a){var b=this.get_selected(!0),c=[],e;var f=0;for(e=b.length;f<e;f++)b[f].children.length||c.push(b[f].id);return a?d.map(c,d.proxy(function(a){return this.get_node(a)},this)):c},get_state:function(){var a={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},b;for(b in this._model.data)this._model.data.hasOwnProperty(b)&&"#"!==b&&(this._model.data[b].state.opened&&a.core.open.push(b),this._model.data[b].state.selected&&
a.core.selected.push(b));return a},set_state:function(a,b){if(a){if(a.core){if(a.core.open){if(!d.isArray(a.core.open))return delete a.core.open,this.set_state(a,b),!1;var c=!0;var e=!1;var f=this;d.each(a.core.open.concat([]),function(h,l){if(e=f.get_node(l))f.is_loaded(l)?(f.is_closed(l)&&f.open_node(l,!1,0),a&&a.core&&a.core.open&&d.vakata.array_remove_item(a.core.open,l)):(f.is_loading(l)||f.open_node(l,d.proxy(function(c,e){!e&&a&&a.core&&a.core.open&&d.vakata.array_remove_item(a.core.open,c.id);
this.set_state(a,b)},f),0),c=!1)});c&&(delete a.core.open,this.set_state(a,b));return!1}if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==u&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==u&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,b),!1;if(a.core.selected){var l=this;this.deselect_all();d.each(a.core.selected,function(a,c){l.select_node(c)});delete a.core.selected;this.set_state(a,b);return!1}if(d.isEmptyObject(a.core))return delete a.core,
this.set_state(a,b),!1}return d.isEmptyObject(a)?(a=null,b&&b.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a,b){this._data.core.state=!0===b?{}:this.get_state();b&&d.isFunction(b)&&(this._data.core.state=b.call(this,this._data.core.state));this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var c=this.get_container_ul()[0].className;a||(this.element.html("<ul class='"+c+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+
this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"));this.load_node("#",function(a,b){b&&(this.get_container_ul()[0].className=c,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(d.extend(!0,
{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b=[],c=[];this._data.core.selected.concat([]);c.push(a.id);!0===a.state.opened&&b.push(a.id);this.get_node(a,!0).find(".jstree-open").each(function(){b.push(this.id)});this._load_nodes(c,d.proxy(function(c){this.open_node(b,!1,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:a,nodes:c})},this))},set_id:function(a,
b){a=this.get_node(a);if(!a||"#"===a.id)return!1;var c,e=this._model.data;b=b.toString();e[a.parent].children[d.inArray(a.id,e[a.parent].children)]=b;var f=0;for(c=a.parents.length;f<c;f++)e[a.parents[f]].children_d[d.inArray(a.id,e[a.parents[f]].children_d)]=b;f=0;for(c=a.children.length;f<c;f++)e[a.children[f]].parent=b;f=0;for(c=a.children_d.length;f<c;f++)e[a.children_d[f]].parents[d.inArray(a.id,e[a.children_d[f]].parents)]=b;f=d.inArray(a.id,this._data.core.selected);-1!==f&&(this._data.core.selected[f]=
b);(f=this.get_node(a.id,!0))&&f.attr("id",b);delete e[a.id];a.id=b;e[b]=a;return!0},get_text:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.text:!1},set_text:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.set_text(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.text=b;this.get_node(a,!0).length&&this.redraw_node(a.id);this.trigger("set_text",{obj:a,text:b});return!0},get_json:function(a,b,c){a=this.get_node(a||"#");if(!a)return!1;b&&b.flat&&
!c&&(c=[]);var e={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:d.extend(!0,{},a.li_attr),a_attr:d.extend(!0,{},a.a_attr),state:{},data:b&&b.no_data?!1:d.extend(!0,{},a.data)},f;b&&b.flat?e.parent=a.parent:e.children=[];if(!b||!b.no_state)for(l in a.state)a.state.hasOwnProperty(l)&&(e.state[l]=a.state[l]);b&&b.no_id&&(delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id);b&&b.flat&&"#"!==a.id&&c.push(e);if(!b||!b.no_children){var l=0;for(f=a.children.length;l<
f;l++)b&&b.flat?this.get_json(a.children[l],b,c):e.children.push(this.get_json(a.children[l],b))}return b&&b.flat?c:"#"===a.id?e.children:e},create_node:function(a,b,c,e,f){null===a&&(a="#");a=this.get_node(a);if(!a)return!1;c=c===u?"last":c;if(!c.toString().match(/^(before|after)$/)&&!f&&!this.is_loaded(a))return this.load_node(a,function(){this.create_node(a,b,c,e,!0)});b||(b={text:this.get_string("New node")});"string"===typeof b&&(b={text:b});b.text===u&&(b.text=this.get_string("New node"));var l;
"#"===a.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":f=this.get_node(a.parent);c=d.inArray(a.id,f.children);a=f;break;case "after":f=this.get_node(a.parent);c=d.inArray(a.id,f.children)+1;a=f;break;case "inside":case "first":c=0;break;case "last":c=a.children.length;break;default:c||(c=0)}c>a.children.length&&(c=a.children.length);b.id||(b.id=!0);if(!this.check("create_node",b,a,c))return this.settings.core.error.call(this,this._data.core.last_error),!1;!0===b.id&&
delete b.id;b=this._parse_model_from_json(b,a.id,a.parents.concat());if(!b)return!1;f=this.get_node(b);var h=[];h.push(b);h=h.concat(f.children_d);this.trigger("model",{nodes:h,parent:a.id});a.children_d=a.children_d.concat(h);var n=0;for(l=a.parents.length;n<l;n++)this._model.data[a.parents[n]].children_d=this._model.data[a.parents[n]].children_d.concat(h);b=f;f=[];n=0;for(l=a.children.length;n<l;n++)f[n>=c?n+1:n]=a.children[n];f[c]=b.id;a.children=f;this.redraw_node(a,!0);e&&e.call(this,this.get_node(b));
this.trigger("create_node",{node:this.get_node(b),parent:a.id,position:c});return b.id},rename_node:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.rename_node(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;e=a.text;if(!this.check("rename_node",a,this.get_parent(a),b))return this.settings.core.error.call(this,this._data.core.last_error),!1;this.set_text(a,b);this.trigger("rename_node",{node:a,text:b,old:e});return!0},delete_node:function(a){var b,
c,e;if(d.isArray(a)){a=a.slice();var f=0;for(b=a.length;f<b;f++)this.delete_node(a[f]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;f=this.get_node(a.parent);b=d.inArray(a.id,f.children);var l=!1;if(!this.check("delete_node",a,f,b))return this.settings.core.error.call(this,this._data.core.last_error),!1;-1!==b&&(f.children=d.vakata.array_remove(f.children,b));var h=a.children_d.concat([]);h.push(a.id);var n=0;for(e=h.length;n<e;n++){var g=0;for(c=a.parents.length;g<c;g++)b=d.inArray(h[n],
this._model.data[a.parents[g]].children_d),-1!==b&&(this._model.data[a.parents[g]].children_d=d.vakata.array_remove(this._model.data[a.parents[g]].children_d,b));this._model.data[h[n]].state.selected&&(l=!0,b=d.inArray(h[n],this._data.core.selected),-1!==b&&(this._data.core.selected=d.vakata.array_remove(this._data.core.selected,b)))}this.trigger("delete_node",{node:a,parent:f.id});l&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:f.id});n=0;for(e=h.length;n<
e;n++)delete this._model.data[h[n]];this.redraw_node(f,!0);return!0},check:function(a,b,c,e,f){b=b&&b.id?b:this.get_node(b);c=c&&c.id?c:this.get_node(c);var l=a.match(/^move_node|copy_node|create_node$/i)?c:b,h=this.settings.core.check_callback;if(!("move_node"!==a&&"copy_node"!==a||f&&f.is_multi||b.id!==c.id&&d.inArray(b.id,c.children)!==e&&-1===d.inArray(c.id,b.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,
pos:e,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1;l&&l.data&&(l=l.data);return l&&l.functions&&(!1===l.functions[a]||!0===l.functions[a])?(!1===l.functions[a]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})}),l.functions[a]):!1===h||d.isFunction(h)&&!1===h.call(this,a,b,c,e,f)||h&&!1===h[a]?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",
reason:"User config for core.check_callback prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(a,b,c,e,f,l){var h,n,g;b=this.get_node(b);c=c===u?0:c;if(!b)return!1;if(!c.toString().match(/^(before|after)$/)&&!f&&!this.is_loaded(b))return this.load_node(b,function(){this.move_node(a,b,c,e,!0)});if(d.isArray(a)){a=a.slice();l=0;for(h=a.length;l<h;l++)this.move_node(a[l],
b,c,e,f,!0)&&(b=a[l],c="after");this.redraw();return!0}a=a&&a.id?a:this.get_node(a);if(!a||"#"===a.id)return!1;h=(a.parent||"#").toString();var t=c.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;var q=a.instance?a.instance:this._model.data[a.id]?this:d.jstree.reference(a.id);var k=!q||!q._id||this._id!==q._id;var m=q&&q._id&&h&&q._model.data[h]&&q._model.data[h].children?d.inArray(a.id,q._model.data[h].children):-1;if(k)return this.copy_node(a,b,c,e,f)?(q&&q.delete_node(a),
!0):!1;"#"===b.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":c=d.inArray(b.id,t.children);break;case "after":c=d.inArray(b.id,t.children)+1;break;case "inside":case "first":c=0;break;case "last":c=t.children.length;break;default:c||(c=0)}c>t.children.length&&(c=t.children.length);if(!this.check("move_node",a,t,c,{core:!0,is_multi:q&&q._id&&q._id!==this._id,is_foreign:!q||!q._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===
t.id){f=t.children.concat();k=d.inArray(a.id,f);-1!==k&&(f=d.vakata.array_remove(f,k),c>k&&c--);k=[];var p=0;for(n=f.length;p<n;p++)k[p>=c?p+1:p]=f[p];k[c]=a.id;t.children=k;this._node_changed(t.id);this.redraw("#"===t.id)}else{k=a.children_d.concat();k.push(a.id);p=0;for(n=a.parents.length;p<n;p++){f=[];var r=q._model.data[a.parents[p]].children_d;var A=0;for(g=r.length;A<g;A++)-1===d.inArray(r[A],k)&&f.push(r[A]);q._model.data[a.parents[p]].children_d=f}q._model.data[h].children=d.vakata.array_remove_item(q._model.data[h].children,
a.id);p=0;for(n=t.parents.length;p<n;p++)this._model.data[t.parents[p]].children_d=this._model.data[t.parents[p]].children_d.concat(k);f=[];p=0;for(n=t.children.length;p<n;p++)f[p>=c?p+1:p]=t.children[p];f[c]=a.id;t.children=f;t.children_d.push(a.id);t.children_d=t.children_d.concat(a.children_d);a.parent=t.id;k=t.parents.concat();k.unshift(t.id);r=a.parents.length;a.parents=k;k=k.concat();p=0;for(n=a.children_d.length;p<n;p++)this._model.data[a.children_d[p]].parents=this._model.data[a.children_d[p]].parents.slice(0,
-1*r),Array.prototype.push.apply(this._model.data[a.children_d[p]].parents,k);if("#"===h||"#"===t.id)this._model.force_full_redraw=!0;this._model.force_full_redraw||(this._node_changed(h),this._node_changed(t.id));l||this.redraw()}e&&e.call(this,a,t,c);this.trigger("move_node",{node:a,parent:t.id,position:c,old_parent:h,old_position:m,is_multi:q&&q._id&&q._id!==this._id,is_foreign:!q||!q._id,old_instance:q,new_instance:this});return!0},copy_node:function(a,b,c,e,f,l){var h,n,g;b=this.get_node(b);
c=c===u?0:c;if(!b)return!1;if(!c.toString().match(/^(before|after)$/)&&!f&&!this.is_loaded(b))return this.load_node(b,function(){this.copy_node(a,b,c,e,!0)});if(d.isArray(a)){a=a.slice();l=0;for(h=a.length;l<h;l++)if(n=this.copy_node(a[l],b,c,e,f,!0))b=n,c="after";this.redraw();return!0}a=a&&a.id?a:this.get_node(a);if(!a||"#"===a.id)return!1;h=(a.parent||"#").toString();var t=c.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;var q=a.instance?a.instance:this._model.data[a.id]?
this:d.jstree.reference(a.id);"#"===b.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":c=d.inArray(b.id,t.children);break;case "after":c=d.inArray(b.id,t.children)+1;break;case "inside":case "first":c=0;break;case "last":c=t.children.length;break;default:c||(c=0)}c>t.children.length&&(c=t.children.length);if(!this.check("copy_node",a,t,c,{core:!0,is_multi:q&&q._id&&q._id!==this._id,is_foreign:!q||!q._id}))return this.settings.core.error.call(this,this._data.core.last_error),
!1;var k=q?q.get_json(a,{no_id:!0,no_data:!0,no_state:!0}):a;if(!k)return!1;!0===k.id&&delete k.id;k=this._parse_model_from_json(k,t.id,t.parents.concat());if(!k)return!1;n=this.get_node(k);a&&a.state&&!1===a.state.loaded&&(n.state.loaded=!1);f=[];f.push(k);f=f.concat(n.children_d);this.trigger("model",{nodes:f,parent:t.id});k=0;for(g=t.parents.length;k<g;k++)this._model.data[t.parents[k]].children_d=this._model.data[t.parents[k]].children_d.concat(f);f=[];k=0;for(g=t.children.length;k<g;k++)f[k>=
c?k+1:k]=t.children[k];f[c]=n.id;t.children=f;t.children_d.push(n.id);t.children_d=t.children_d.concat(n.children_d);"#"===t.id&&(this._model.force_full_redraw=!0);this._model.force_full_redraw||this._node_changed(t.id);l||this.redraw("#"===t.id);e&&e.call(this,n,t,c);this.trigger("copy_node",{node:n,original:a,parent:t.id,position:c,old_parent:h,old_position:q&&q._id&&h&&q._model.data[h]&&q._model.data[h].children?d.inArray(a.id,q._model.data[h].children):-1,is_multi:q&&q._id&&q._id!==this._id,is_foreign:!q||
!q._id,old_instance:q,new_instance:this});return n.id},cut:function(a){a||(a=this._data.core.selected.concat());d.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],c,e;var f=0;for(e=a.length;f<e;f++)(c=this.get_node(a[f]))&&c.id&&"#"!==c.id&&b.push(c);if(!b.length)return!1;g=b;m=this;k="move_node";this.trigger("cut",{node:a})},copy:function(a){a||(a=this._data.core.selected.concat());d.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],c,e;var f=0;for(e=a.length;f<e;f++)(c=this.get_node(a[f]))&&
c.id&&"#"!==c.id&&b.push(c);if(!b.length)return!1;g=b;m=this;k="copy_node";this.trigger("copy",{node:a})},get_buffer:function(){return{mode:k,node:g,inst:m}},can_paste:function(){return!1!==k&&!1!==g},paste:function(a,b){a=this.get_node(a);if(!(a&&k&&k.match(/^(copy_node|move_node)$/)&&g))return!1;this[k](g,a,b)&&this.trigger("paste",{parent:a.id,node:g,mode:k});m=k=g=!1},clear_buffer:function(){m=k=g=!1;this.trigger("clear_buffer")},edit:function(a,b){a=this.get_node(a);if(!a)return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error=
{error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;b="string"===typeof b?b:a.text;this.set_text(a,"");a=this._open_to(a);var c=this._data.core.rtl,e=this.element.width(),f=a.children(".jstree-anchor"),l=d("<span>"),h=b,n=d("<div />",{css:{position:"absolute",top:"-200px",left:c?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),g=d("<input />",{value:h,"class":"jstree-rename-input",
css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:d.proxy(function(){var c=l.children(".jstree-rename-input").val();""===c&&(c=h);n.remove();l.replaceWith(f);l.remove();this.set_text(a,h);!1===this.rename_node(a,d("<div></div>").text(c)[this.settings.core.force_text?"text":"html"]())&&this.set_text(a,h)},this),keydown:function(a){var c=a.which;27===c&&(this.value=
h);27!==c&&13!==c&&37!==c&&38!==c&&39!==c&&40!==c&&32!==c||a.stopImmediatePropagation();if(27===c||13===c)a.preventDefault(),this.blur()},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){g.width(Math.min(n.text("pW"+this.value).width(),e))},keypress:function(a){if(13===a.which)return!1}});b={fontFamily:f.css("fontFamily")||"",fontSize:f.css("fontSize")||"",fontWeight:f.css("fontWeight")||"",fontStyle:f.css("fontStyle")||"",fontStretch:f.css("fontStretch")||
"",fontVariant:f.css("fontVariant")||"",letterSpacing:f.css("letterSpacing")||"",wordSpacing:f.css("wordSpacing")||""};l.attr("class",f.attr("class")).append(f.contents().clone()).append(g);f.replaceWith(l);n.css(b);g.css(b).width(Math.min(n.text("pW"+g[0].value).width(),e))[0].select()},set_theme:function(a,b){if(!a)return!1;!0===b&&((b=this.settings.core.themes.dir)||(b=d.jstree.path+"/themes"),b=b+"/"+a+"/style.css");b&&-1===d.inArray(b,r)&&(d("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />'),
r.push(b));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=a;this.element.addClass("jstree-"+a);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive");this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);
(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():
this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons")},
toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.set_icon(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=a.icon;a.icon=b;e=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon");!1===b?this.hide_icon(a):(!0===b?e.removeClass("jstree-themeicon-custom "+c).css("background","").removeAttr("rel"):-1===b.indexOf("/")&&-1===b.indexOf(".")?
(e.removeClass(c).css("background",""),e.addClass(b+" jstree-themeicon-custom").attr("rel",b)):(e.removeClass(c).css("background",""),e.addClass("jstree-themeicon-custom").css("background","url('"+b+"') center center no-repeat").attr("rel",b)),!1===c&&this.show_icon(a));return!0},get_icon:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.icon:!1},hide_icon:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.hide_icon(a[c]);return!0}a=this.get_node(a);if(!a||"#"===
a)return!1;a.icon=!1;this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return!0},show_icon:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.show_icon(a[c]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;c=this.get_node(a,!0);a.icon=c.length?c.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0;a.icon||(a.icon=!0);c.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");
return!0}};d.vakata={};d.vakata.attributes=function(a,b){a=d(a)[0];var c=b?{}:[];a&&a.attributes&&d.each(a.attributes,function(a,f){-1===d.inArray(f.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==f.value&&""!==d.trim(f.value)&&(b?c[f.name]=f.value:c.push(f.name))});return c};d.vakata.array_unique=function(a){var b=[],c,e;var f=0;for(e=a.length;f<e;f++){for(c=0;c<=f&&a[f]!==a[c];c++);c===f&&b.push(a[f])}return b};d.vakata.array_remove=function(a,b,c){c=a.slice((c||b)+
1||a.length);a.length=0>b?a.length+b:b;a.push.apply(a,c);return a};d.vakata.array_remove_item=function(a,b){b=d.inArray(b,a);return-1!==b?d.vakata.array_remove(a,b):a};var y=document.createElement("I");y.className="jstree-icon jstree-checkbox";y.setAttribute("role","presentation");d.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0};d.jstree.plugins.checkbox=function(a,b){this.bind=function(){b.bind.call(this);this._data.checkbox.uto=
!1;this._data.checkbox.selected=[];this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",d.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked");this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",d.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":
"hide_checkboxes"]()},this));if(-1!==this.settings.checkbox.cascade.indexOf("undetermined"))this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",d.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(d.proxy(this._undetermined,this),50)},this));if(!this.settings.checkbox.tie_selection)this.element.on("model.jstree",d.proxy(function(a,
b){a=this._model.data;b=b.nodes;var c;var e=0;for(c=b.length;e<c;e++)a[b[e]].state.checked=a[b[e]].original&&a[b[e]].original.state&&a[b[e]].original.state.checked,a[b[e]].state.checked&&this._data.checkbox.selected.push(b[e])},this));if(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))this.element.on("model.jstree",d.proxy(function(a,b){a=this._model.data;var c=a[b.parent],e=b.nodes;b=[];var h,n,g=this.settings.checkbox.cascade,k=this.settings.checkbox.tie_selection;
if(-1!==g.indexOf("down"))if(c.state[k?"selected":"checked"]){var q=0;for(h=e.length;q<h;q++)a[e[q]].state[k?"selected":"checked"]=!0;this._data[k?"core":"checkbox"].selected=this._data[k?"core":"checkbox"].selected.concat(e)}else for(q=0,h=e.length;q<h;q++)if(a[e[q]].state[k?"selected":"checked"]){var p=0;for(n=a[e[q]].children_d.length;p<n;p++)a[a[e[q]].children_d[p]].state[k?"selected":"checked"]=!0;this._data[k?"core":"checkbox"].selected=this._data[k?"core":"checkbox"].selected.concat(a[e[q]].children_d)}if(-1!==
g.indexOf("up")){q=0;for(h=c.children_d.length;q<h;q++)a[c.children_d[q]].children.length||b.push(a[c.children_d[q]].parent);b=d.vakata.array_unique(b);p=0;for(n=b.length;p<n;p++)for(c=a[b[p]];c&&"#"!==c.id;){q=e=0;for(h=c.children.length;q<h;q++)e+=a[c.children[q]].state[k?"selected":"checked"];if(e===h)c.state[k?"selected":"checked"]=!0,this._data[k?"core":"checkbox"].selected.push(c.id),(q=this.get_node(c,!0))&&q.length&&q.attr("aria-selected",!0).children(".jstree-anchor").addClass(k?"jstree-clicked":
"jstree-checked");else break;c=this.get_node(c.parent)}}this._data[k?"core":"checkbox"].selected=d.vakata.array_unique(this._data[k?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",d.proxy(function(a,b){var c=b.node;a=this._model.data;b=this.get_node(c.parent);var e=this.get_node(c,!0),h,n=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==n.indexOf("down")){this._data[g?"core":"checkbox"].selected=d.vakata.array_unique(this._data[g?
"core":"checkbox"].selected.concat(c.children_d));var k=0;for(h=c.children_d.length;k<h;k++){var q=a[c.children_d[k]];q.state[g?"selected":"checked"]=!0;q&&q.original&&q.original.state&&q.original.state.undetermined&&(q.original.state.undetermined=!1)}}if(-1!==n.indexOf("up"))for(;b&&"#"!==b.id;){k=c=0;for(h=b.children.length;k<h;k++)c+=a[b.children[k]].state[g?"selected":"checked"];if(c===h)b.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(b.id),(q=this.get_node(b,
!0))&&q.length&&q.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}-1!==n.indexOf("down")&&e.length&&e.find(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",d.proxy(function(a,b){a=this.get_node("#");b=this._model.data;var c,e;var d=0;for(c=a.children_d.length;d<c;d++)(e=b[a.children_d[d]])&&
e.original&&e.original.state&&e.original.state.undetermined&&(e.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",d.proxy(function(a,b){a=b.node;b=this.get_node(a,!0);var c,e=this.settings.checkbox.cascade,h=this.settings.checkbox.tie_selection;a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==e.indexOf("down")){var n=0;for(c=a.children_d.length;n<c;n++){var g=this._model.data[a.children_d[n]];
g.state[h?"selected":"checked"]=!1;g&&g.original&&g.original.state&&g.original.state.undetermined&&(g.original.state.undetermined=!1)}}if(-1!==e.indexOf("up"))for(n=0,c=a.parents.length;n<c;n++)g=this._model.data[a.parents[n]],g.state[h?"selected":"checked"]=!1,g&&g.original&&g.original.state&&g.original.state.undetermined&&(g.original.state.undetermined=!1),(g=this.get_node(a.parents[n],!0))&&g.length&&g.attr("aria-selected",!1).children(".jstree-anchor").removeClass(h?"jstree-clicked":"jstree-checked");
g=[];n=0;for(c=this._data[h?"core":"checkbox"].selected.length;n<c;n++)-1!==e.indexOf("down")&&-1!==d.inArray(this._data[h?"core":"checkbox"].selected[n],a.children_d)||-1!==e.indexOf("up")&&-1!==d.inArray(this._data[h?"core":"checkbox"].selected[n],a.parents)||g.push(this._data[h?"core":"checkbox"].selected[n]);this._data[h?"core":"checkbox"].selected=d.vakata.array_unique(g);-1!==e.indexOf("down")&&b.length&&b.find(".jstree-anchor").removeClass(h?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",
!1)},this));if(-1!==this.settings.checkbox.cascade.indexOf("up"))this.element.on("delete_node.jstree",d.proxy(function(a,b){a=this.get_node(b.parent);b=this._model.data;for(var c,e,d,g=this.settings.checkbox.tie_selection;a&&"#"!==a.id;){c=d=0;for(e=a.children.length;c<e;c++)d+=b[a.children[c]].state[g?"selected":"checked"];if(d===e)a.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(a.id),(c=this.get_node(a,!0))&&c.length&&c.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?
"jstree-clicked":"jstree-checked");else break;a=this.get_node(a.parent)}},this)).on("move_node.jstree",d.proxy(function(a,b){var c=b.is_multi,e=b.old_parent;b=this.get_node(b.parent);a=this._model.data;var h,g=this.settings.checkbox.tie_selection;if(!c)for(c=this.get_node(e);c&&"#"!==c.id;){var k=e=0;for(h=c.children.length;k<h;k++)e+=a[c.children[k]].state[g?"selected":"checked"];if(e===h)c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),(e=this.get_node(c,!0))&&
e.length&&e.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}for(c=b;c&&"#"!==c.id;){k=e=0;for(h=c.children.length;k<h;k++)e+=a[c.children[k]].state[g?"selected":"checked"];if(e===h)c.state[g?"selected":"checked"]||(c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),(e=this.get_node(c,!0))&&e.length&&e.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":
"jstree-checked"));else if(c.state[g?"selected":"checked"])c.state[g?"selected":"checked"]=!1,this._data[g?"core":"checkbox"].selected=d.vakata.array_remove_item(this._data[g?"core":"checkbox"].selected,c.id),(e=this.get_node(c,!0))&&e.length&&e.attr("aria-selected",!1).children(".jstree-anchor").removeClass(g?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}},this))};this._undetermined=function(){var a,b=this._model.data,f=this.settings.checkbox.tie_selection,l=this._data[f?
"core":"checkbox"].selected,h=[],g=this;var k=0;for(a=l.length;k<a;k++)b[l[k]]&&b[l[k]].parents&&(h=h.concat(b[l[k]].parents));this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var c=g.get_node(this);if(c.state.loaded)for(k=0,a=c.children_d.length;k<a;k++){var e=b[c.children_d[k]];!e.state.loaded&&e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined&&(h.push(e.id),h=h.concat(e.parents))}else c.original&&c.original.state&&c.original.state.undetermined&&
!0===c.original.state.undetermined&&(h.push(c.id),h=h.concat(c.parents))});h=d.vakata.array_unique(h);h=d.vakata.array_remove_item(h,"#");this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");k=0;for(a=h.length;k<a;k++)b[h[k]].state[f?"selected":"checked"]||(l=this.get_node(h[k],!0))&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")};this.redraw_node=function(a,e,f,l){if(a=b.redraw_node.apply(this,arguments)){var c,g=null;var k=
0;for(c=a.childNodes.length;k<c;k++)if(a.childNodes[k]&&a.childNodes[k].className&&-1!==a.childNodes[k].className.indexOf("jstree-anchor")){g=a.childNodes[k];break}g&&(!this.settings.checkbox.tie_selection&&this._model.data[a.id].state.checked&&(g.className+=" jstree-checked"),g.insertBefore(y.cloneNode(!1),g.childNodes[0]))}f||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(d.proxy(this._undetermined,
this),50));return a};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()};this.is_undetermined=function(a){a=this.get_node(a);var c=this.settings.checkbox.cascade;var b=this.settings.checkbox.tie_selection;
var l=this._data[b?"core":"checkbox"].selected,h=this._model.data;if(!a||!0===a.state[b?"selected":"checked"]||-1===c.indexOf("undetermined")||-1===c.indexOf("down")&&-1===c.indexOf("up"))return!1;if(!a.state.loaded&&!0===a.original.state.undetermined)return!0;c=0;for(b=a.children_d.length;c<b;c++)if(-1!==d.inArray(a.children_d[c],l)||!h[a.children_d[c]].state.loaded&&h[a.children_d[c]].original.state.undetermined)return!0;return!1};this.activate_node=function(a,e){this.settings.checkbox.tie_selection&&
(this.settings.checkbox.whole_node||d(e.target).hasClass("jstree-checkbox"))&&(e.ctrlKey=!0);if(this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!d(e.target).hasClass("jstree-checkbox"))return b.activate_node.call(this,a,e);if(this.is_disabled(a))return!1;this.is_checked(a)?this.uncheck_node(a,e):this.check_node(a,e);this.trigger("activate_node",{node:this.get_node(a)})};this.check_node=function(a,b){if(this.settings.checkbox.tie_selection)return this.select_node(a,!1,!0,
b);var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.check_node(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;e=this.get_node(a,!0);a.state.checked||(a.state.checked=!0,this._data.checkbox.selected.push(a.id),e&&e.length&&e.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:a,selected:this._data.checkbox.selected,event:b}))};this.uncheck_node=function(a,b){if(this.settings.checkbox.tie_selection)return this.deselect_node(a,!1,
b);var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.uncheck_node(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;e=this.get_node(a,!0);a.state.checked&&(a.state.checked=!1,this._data.checkbox.selected=d.vakata.array_remove_item(this._data.checkbox.selected,a.id),e.length&&e.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:a,selected:this._data.checkbox.selected,event:b}))};this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();
this._data.checkbox.selected.concat([]);var a;this._data.checkbox.selected=this._model.data["#"].children_d.concat();var b=0;for(a=this._data.checkbox.selected.length;b<a;b++)this._model.data[this._data.checkbox.selected[b]]&&(this._model.data[this._data.checkbox.selected[b]].state.checked=!0);this.redraw(!0);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var a=this._data.checkbox.selected.concat([]),
b;var d=0;for(b=this._data.checkbox.selected.length;d<b;d++)this._model.data[this._data.checkbox.selected[d]]&&(this._model.data[this._data.checkbox.selected[d]].state.checked=!1);this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:a})};this.is_checked=function(a){return this.settings.checkbox.tie_selection?this.is_selected(a):(a=this.get_node(a))&&"#"!==a.id?a.state.checked:!1};this.get_checked=
function(a){return this.settings.checkbox.tie_selection?this.get_selected(a):a?d.map(this._data.checkbox.selected,d.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected};this.get_top_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_top_selected(a);var c=this.get_checked(!0),b={},l,h;var g=0;for(l=c.length;g<l;g++)b[c[g].id]=c[g];g=0;for(l=c.length;g<l;g++){var k=0;for(h=c[g].children_d.length;k<h;k++)b[c[g].children_d[k]]&&delete b[c[g].children_d[k]]}c=
[];for(g in b)b.hasOwnProperty(g)&&c.push(g);return a?d.map(c,d.proxy(function(a){return this.get_node(a)},this)):c};this.get_bottom_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(a);var c=this.get_checked(!0),b=[],l;var h=0;for(l=c.length;h<l;h++)c[h].children.length||b.push(c[h].id);return a?d.map(b,d.proxy(function(a){return this.get_node(a)},this)):b};this.load_node=function(a,e){var c,l;if(!d.isArray(a)&&!this.settings.checkbox.tie_selection&&(l=this.get_node(a))&&
l.state.loaded){var h=0;for(c=l.children_d.length;h<c;h++)this._model.data[l.children_d[h]].state.checked&&(this._data.checkbox.selected=d.vakata.array_remove_item(this._data.checkbox.selected,l.children_d[h]))}return b.load_node.apply(this,arguments)};this.get_state=function(){var a=b.get_state.apply(this,arguments);if(this.settings.checkbox.tie_selection)return a;a.checkbox=this._data.checkbox.selected.slice();return a};this.set_state=function(a,e){var c=b.set_state.apply(this,arguments);if(c&&
a.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var l=this;d.each(a.checkbox,function(a,c){l.check_node(c)})}delete a.checkbox;return!1}return c}};var B=null,F,H;d.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,b){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.create_node(a,{},"last",function(a){setTimeout(function(){c.edit(a)},
0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.edit(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.delete_node(c.get_selected()):c.delete_node(a)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,
separator_after:!1,label:"Cut",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.cut(c.get_selected()):c.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.copy(c.get_selected()):c.copy(a)}},paste:{separator_before:!1,icon:!1,_disabled:function(a){return!d.jstree.reference(a.reference).can_paste()},separator_after:!1,label:"Paste",
action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.paste(a)}}}}}}};d.jstree.plugins.contextmenu=function(a,b){this.bind=function(){b.bind.call(this);var a=0;this.element.on("contextmenu.jstree",".jstree-anchor",d.proxy(function(c,b){c.preventDefault();a=c.ctrlKey?+new Date:0;if(b||B)a=+new Date+1E4;B&&clearTimeout(B);this.is_loading(c.currentTarget)||this.show_contextmenu(c.currentTarget,c.pageX,c.pageY,c)},this)).on("click.jstree",".jstree-anchor",d.proxy(function(c){this._data.contextmenu.visible&&
(!a||250<+new Date-a)&&d.vakata.context.hide();a=0},this)).on("touchstart.jstree",".jstree-anchor",function(a){a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(F=a.pageX,H=a.pageY,B=setTimeout(function(){d(a.currentTarget).trigger("contextmenu",!0)},750))});d(document).on("context_hide.vakata.jstree",d.proxy(function(){this._data.contextmenu.visible=!1},this))};this.teardown=function(){this._data.contextmenu.visible&&d.vakata.context.hide();b.teardown.call(this)};
this.show_contextmenu=function(a,b,f,l){a=this.get_node(a);if(!a||"#"===a.id)return!1;var c=this.settings.contextmenu,e=this.get_node(a,!0).children(".jstree-anchor"),g=!1;g=!1;if(c.show_at_node||b===u||f===u)g=e.offset(),b=g.left,f=g.top+this._data.core.li_height;this.settings.contextmenu.select_node&&!this.is_selected(a)&&this.activate_node(a,l);g=c.items;d.isFunction(g)&&(g=g.call(this,a,d.proxy(function(c){this._show_contextmenu(a,b,f,c)},this)));d.isPlainObject(g)&&this._show_contextmenu(a,b,
f,g)};this._show_contextmenu=function(a,b,f,l){var c=this.get_node(a,!0).children(".jstree-anchor");d(document).one("context_show.vakata.jstree",d.proxy(function(a,c){a="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";d(c.element).addClass(a)},this));this._data.contextmenu.visible=!0;d.vakata.context.show(c,{x:b,y:f},l);this.trigger("show_contextmenu",{node:a,x:b,y:f})}};d(function(){d(document).on("touchmove.vakata.jstree",function(a){B&&a.originalEvent&&a.originalEvent.changedTouches&&
a.originalEvent.changedTouches[0]&&(50<Math.abs(F-a.pageX)||50<Math.abs(H-a.pageY))&&clearTimeout(B)}).on("touchend.vakata.jstree",function(a){B&&clearTimeout(B)})});(function(a){var b=!1,c=!1,d=!1,f=0,l=0,h=[],g="",k=!1;a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(document).triggerHandler("context_"+b+".vakata",{reference:d,element:c,position:{x:f,y:l}})},_execute:function(b){return(b=h[b])&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:d,
element:c}))&&b.action?b.action.call(null,{item:b,reference:d,element:c,position:{x:f,y:l}}):!1},_parse:function(b,e){if(!b)return!1;e||(g="",h=[]);var f="",l=!1,k;e&&(f+="<ul>");a.each(b,function(b,e){if(!e)return!0;h.push(e);!l&&e.separator_before&&(f+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>");l=!1;f+="<li class='"+(e._class||"")+(!0===e._disabled||a.isFunction(e._disabled)&&e._disabled({item:e,reference:d,
element:c})?" vakata-contextmenu-disabled ":"")+"' "+(e.shortcut?" data-shortcut='"+e.shortcut+"' ":"")+">";f+="<a href='#' rel='"+(h.length-1)+"'>";a.vakata.context.settings.icons&&(f+="<i ",e.icon&&(f=-1!==e.icon.indexOf("/")||-1!==e.icon.indexOf(".")?f+(" style='background:url(\""+e.icon+"\") center center no-repeat' "):f+(" class='"+e.icon+"' ")),f+="></i><span class='vakata-contextmenu-sep'>&#160;</span>");f+=(a.isFunction(e.label)?e.label({item:b,reference:d,element:c}):e.label)+(e.shortcut?
' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+e.shortcut+'">'+(e.shortcut_label||"")+"</span>":"")+"</a>";e.submenu&&(k=a.vakata.context._parse(e.submenu,!0))&&(f+=k);f+="</li>";e.separator_after&&(f+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",l=!0)});f=f.replace(/<li class='vakata-context-separator'><\/li>$/,"");e&&(f+="</ul>");e||(g=f,a.vakata.context._trigger("parse"));return 10<
f.length?f:!1},_show_submenu:function(c){c=a(c);if(c.length&&c.children("ul").length){var d=c.children("ul"),e=c.offset().left+c.outerWidth(),f=c.offset().top,h=d.width(),l=d.height(),g=a(window).width()+a(window).scrollLeft(),k=a(window).height()+a(window).scrollTop();if(b)c[0>e-(h+10+c.outerWidth())?"addClass":"removeClass"]("vakata-context-left");else c[e+h+10>g?"addClass":"removeClass"]("vakata-context-right");f+l+10>k&&d.css("bottom","-1px");d.show()}},show:function(e,q,n){c&&c.length&&c.width("");
switch(!0){case !q&&!e:return!1;case !!q&&!!e:d=e;f=q.x;l=q.y;break;case !q&&!!e:d=e;q=e.offset();f=q.left+e.outerHeight();l=q.top;break;case !!q&&!e:f=q.x,l=q.y}e&&!n&&a(e).data("vakata_contextmenu")&&(n=a(e).data("vakata_contextmenu"));a.vakata.context._parse(n)&&c.html(g);if(h.length){c.appendTo("body");n=c;q=f;var p=l;var t=n.width();var m=n.height();var A=a(window).width()+a(window).scrollLeft();var r=a(window).height()+a(window).scrollTop();b&&(q-=n.outerWidth()-a(e).outerWidth(),q<a(window).scrollLeft()+
20&&(q=a(window).scrollLeft()+20));q+t+20>A&&(q=A-(t+20));p+m+20>r&&(p=r-(m+20));c.css({left:q,top:p}).show().find("a").first().focus().parent().addClass("vakata-context-hover");k=!0;a.vakata.context._trigger("show")}},hide:function(){k&&(c.hide().find("ul").hide().end().find(":focus").blur().end().detach(),k=!1,a.vakata.context._trigger("hide"))}};a(function(){b="rtl"===a("body").css("direction");var d=!1;c=a("<ul class='vakata-context'></ul>");c.on("mouseenter","li",function(b){b.stopImmediatePropagation();
a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),c.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(c){a.contains(this,c.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(c){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover");
a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(c){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(c){c.preventDefault();a(this).blur().parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(b){switch(b.which){case 13:case 32:b.type="mouseup";b.preventDefault();a(b.currentTarget).trigger(b);break;case 37:k&&(c.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),
b.stopImmediatePropagation(),b.preventDefault());break;case 38:if(k){var d=c.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();d.length||(d=c.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last());d.addClass("vakata-context-hover").children("a").focus();b.stopImmediatePropagation();b.preventDefault()}break;case 39:k&&(c.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),
b.stopImmediatePropagation(),b.preventDefault());break;case 40:k&&(d=c.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),d.length||(d=c.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on("keydown",
function(a){a.preventDefault();a=c.find(".vakata-contextmenu-shortcut-"+a.which).parent();a.parent().not(".vakata-context-disabled")&&a.click()});a(document).on("mousedown.vakata.jstree",function(b){k&&!a.contains(c[0],b.target)&&a.vakata.context.hide()}).on("context_show.vakata.jstree",function(a,d){c.find("li:has(ul)").children("a").addClass("vakata-context-parent");b&&c.addClass("vakata-context-rtl").css("direction","rtl");c.find("ul").hide().end()})})})(d);d.jstree.defaults.dnd={copy:!0,open_timeout:500,
is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0};d.jstree.plugins.dnd=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",d.proxy(function(a){if("touchstart"===a.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!d(a.currentTarget).hasClass("jstree-clicked")))return!0;var c=this.get_node(a.target),b=this.is_selected(c)&&this.settings.drag_selection?this.get_selected().length:
1,l=1<b?b+" "+this.get_string("nodes"):this.get_text(a.currentTarget);this.settings.core.force_text&&(l=d("<div />").text(l).html());if(c&&c.id&&"#"!==c.id&&(1===a.which||"touchstart"===a.type)&&(!0===this.settings.dnd.is_draggable||d.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<b?this.get_selected(!0):[c])))return this.element.trigger("mousedown.jstree"),d.vakata.dnd.start(a,{jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:1<b?this.get_selected():[c.id]},
'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+l+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},this))}};d(function(){var a=!1,b=!1,c=!1,e=d('<div id="jstree-marker">&#160;</div>').hide();d(document).on("dnd_start.vakata.jstree",function(c,b){a=!1;b&&b.data&&b.data.jstree&&e.appendTo("body")}).on("dnd_move.vakata.jstree",
function(f,l){c&&clearTimeout(c);if(l&&l.data&&l.data.jstree&&(!l.event.target.id||"jstree-marker"!==l.event.target.id)){var h=d.jstree.reference(l.event.target),g=!1,k=!1;f=!1;var p,q,m,r,v,u,A,y,E,D;if(h&&h._data&&h._data.dnd)if(e.attr("class","jstree-"+h.get_theme()+(h.settings.core.themes.responsive?" jstree-dnd-responsive":"")),l.helper.children().attr("class","jstree-"+h.get_theme()+" jstree-"+h.get_theme()+"-"+h.get_theme_variant()+" "+(h.settings.core.themes.responsive?" jstree-dnd-responsive":
"")).find(".jstree-copy").first()[l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"show":"hide"](),l.event.target!==h.element[0]&&l.event.target!==h.get_container_ul()[0]||0!==h.get_container_ul().children().length){if((g=d(l.event.target).closest(".jstree-anchor"))&&g.length&&g.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){k=g.offset();f=l.event.pageY-k.top;var z=g.height();var B=f<z/3?["b","i","a"]:f>z-z/3?
["a","i","b"]:f>z/2?["i","a","b"]:["i","b","a"];d.each(B,function(f,n){switch(n){case "b":p=k.left-6;q=k.top;m=h.get_parent(g);r=g.parent().index();break;case "i":E=h.settings.dnd.inside_pos;D=h.get_node(g.parent());p=k.left-2;q=k.top+z/2+1;m=D.id;r="first"===E?0:"last"===E?D.children.length:Math.min(E,D.children.length);break;case "a":p=k.left-6,q=k.top+z,m=h.get_parent(g),r=g.parent().index()+1}w=!0;C=0;for(v=l.data.nodes.length;C<v;C++)if(u=l.data.origin&&(l.data.origin.settings.dnd.always_copy||
l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",A=r,"move_node"===u&&"a"===n&&l.data.origin&&l.data.origin===h&&m===h.get_parent(l.data.nodes[C])&&(y=h.get_node(m),A>d.inArray(l.data.nodes[C],y.children)&&--A),w=w&&(h&&h.settings&&h.settings.dnd&&!1===h.settings.dnd.check_while_dragging||h.check(u,l.data.origin&&l.data.origin!==h?l.data.origin.get_node(l.data.nodes[C]):l.data.nodes[C],m,A,{dnd:!0,ref:h.get_node(g.parent()),pos:n,is_multi:l.data.origin&&
l.data.origin!==h,is_foreign:!l.data.origin})),!w){h&&h.last_error&&(b=h.last_error());break}"i"===n&&g.parent().is(".jstree-closed")&&h.settings.dnd.open_timeout&&(c=setTimeout(function(a,c){return function(){a.open_node(c)}}(h,g),h.settings.dnd.open_timeout));if(w)return a={ins:h,par:m,pos:"i"!==n||"last"!==E||0!==r||h.is_loaded(D)?r:"last"},e.css({left:p+"px",top:q+"px"}).show(),l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),b={},B=!0,!1});if(!0===B)return}}else{var w=
!0;var C=0;for(v=l.data.nodes.length;C<v&&(w=w&&h.check(l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node",l.data.origin&&l.data.origin!==h?l.data.origin.get_node(l.data.nodes[C]):l.data.nodes[C],"#","last",{dnd:!0,ref:h.get_node("#"),pos:"i",is_multi:l.data.origin&&l.data.origin!==h,is_foreign:!l.data.origin}),w);C++);if(w){a={ins:h,par:"#",pos:"last"};e.hide();l.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");
return}}a=!1;l.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");e.hide()}}).on("dnd_scroll.vakata.jstree",function(c,b){b&&b.data&&b.data.jstree&&(e.hide(),a=!1,b.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(f,l){c&&clearTimeout(c);if(l&&l.data&&l.data.jstree){e.hide().detach();var h,g=[];if(a){f=0;for(h=l.data.nodes.length;f<h;f++)g[f]=l.data.origin?l.data.origin.get_node(l.data.nodes[f]):l.data.nodes[f],
l.data.origin&&(g[f].instance=l.data.origin);a.ins[l.data.origin&&(l.data.origin.settings.dnd.always_copy||l.data.origin.settings.dnd.copy&&(l.event.metaKey||l.event.ctrlKey))?"copy_node":"move_node"](g,a.par,a.pos);f=0;for(h=g.length;f<h;f++)g[f].instance&&(g[f].instance=null)}else f=d(l.event.target).closest(".jstree"),f.length&&b&&b.error&&"check"===b.error&&(f=f.jstree(!0))&&f.settings.core.error.call(this,b)}}).on("keyup.jstree keydown.jstree",function(a,c){if((c=d.vakata.dnd._get())&&c.data&&
c.data.jstree)c.helper.find(".jstree-copy").first()[c.data.origin&&(c.data.origin.settings.dnd.always_copy||c.data.origin.settings.dnd.copy&&(a.metaKey||a.ctrlKey))?"show":"hide"]()})});(function(a){var b=!1,c=!1,d=!1,f=!1,l=!1,h=0,g=!1,k=0,p=0,q=0,m=0,r=!1,v=!1,u=!1;a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(c,b){var d=a.vakata.dnd._get();d.event=b;a(document).triggerHandler("dnd_"+c+".vakata",d)},_get:function(){return{data:g,
element:b,helper:l}},_clean:function(){l&&l.remove();v&&(clearInterval(v),v=!1);l=f=d=c=b=!1;h=0;g=!1;m=q=p=k=0;u=v=r=!1;a(document).off("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag);a(document).off("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop)},_scroll:function(c){if(!r||!q&&!m)return v&&(clearInterval(v),v=!1),!1;if(!v)return v=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===c)return!1;c=r.scrollTop();var b=r.scrollLeft();r.scrollTop(c+m*a.vakata.dnd.settings.scroll_speed);
r.scrollLeft(b+q*a.vakata.dnd.settings.scroll_speed);c===r.scrollTop()&&b===r.scrollLeft()||a.vakata.dnd._trigger("scroll",r)},start:function(e,h,n){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset));
f&&a.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.MozUserSelect="none")}catch(J){}k=e.pageX;p=e.pageY;g=h;d=!0;b=e.currentTarget;c=e.target;u="touchstart"===e.type;!1!==n&&(l=a("<div id='vakata-dnd'></div>").html(n).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));a(document).on("mousemove.vakata.jstree touchmove.vakata.jstree",
a.vakata.dnd.drag);a(document).on("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop);return!1},drag:function(c){"touchmove"===c.type&&c.originalEvent&&c.originalEvent.changedTouches&&c.originalEvent.changedTouches[0]&&(c.pageX=c.originalEvent.changedTouches[0].pageX,c.pageY=c.originalEvent.changedTouches[0].pageY,c.target=document.elementFromPoint(c.originalEvent.changedTouches[0].pageX-window.pageXOffset,c.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(d){if(!f)if(Math.abs(c.pageX-
k)>(u?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(c.pageY-p)>(u?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold))l&&(l.appendTo("body"),h=l.outerWidth()),f=!0,a.vakata.dnd._trigger("start",c);else return;var b=!1,e=!1,g=!1,n=!1,t=!1,v=e=!1,x=!1;n=b=!1;q=m=0;r=!1;a(a(c.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>
this.offsetWidth)}).each(function(){var b=a(this),d=b.offset();this.scrollHeight>this.offsetHeight&&(d.top+b.height()-c.pageY<a.vakata.dnd.settings.scroll_proximity&&(m=1),c.pageY-d.top<a.vakata.dnd.settings.scroll_proximity&&(m=-1));this.scrollWidth>this.offsetWidth&&(d.left+b.width()-c.pageX<a.vakata.dnd.settings.scroll_proximity&&(q=1),c.pageX-d.left<a.vakata.dnd.settings.scroll_proximity&&(q=-1));if(m||q)return r=a(this),!1});!r&&(b=a(document),e=a(window),g=b.height(),n=e.height(),t=b.width(),
e=e.width(),v=b.scrollTop(),x=b.scrollLeft(),g>n&&c.pageY-v<a.vakata.dnd.settings.scroll_proximity&&(m=-1),g>n&&n-(c.pageY-v)<a.vakata.dnd.settings.scroll_proximity&&(m=1),t>e&&c.pageX-x<a.vakata.dnd.settings.scroll_proximity&&(q=-1),t>e&&e-(c.pageX-x)<a.vakata.dnd.settings.scroll_proximity&&(q=1),m||q)&&(r=b);r&&a.vakata.dnd._scroll(!0);l&&(b=parseInt(c.pageY+a.vakata.dnd.settings.helper_top,10),n=parseInt(c.pageX+a.vakata.dnd.settings.helper_left,10),g&&b+25>g&&(b=g-50),t&&n+h>t&&(n=t-(h+2)),l.css({left:n+
"px",top:b+"px"}));a.vakata.dnd._trigger("move",c);return!1}},stop:function(b){"touchend"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(f)a.vakata.dnd._trigger("stop",b);else if("touchend"===b.type&&
b.target===c){var d=setTimeout(function(){a(b.target).click()},100);a(b.target).one("click",function(){d&&clearTimeout(d)})}a.vakata.dnd._clean();return!1}}})(d);d.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1};d.jstree.plugins.search=function(a,b){this.bind=function(){b.bind.call(this);this._data.search.str="";this._data.search.dom=d();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=
!1;this.element.on("before_open.jstree",d.proxy(function(a,b){var c;a=this._data.search.res;b=[];var e=d();if(a&&a.length&&(this._data.search.dom=d(this.element[0].querySelectorAll("#"+d.map(a,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this._data.search.som&&this._data.search.res.length)){e=0;for(c=a.length;e<
c;e++)b=b.concat(this.get_node(a[e]).parents);b=d.vakata.array_remove_item(d.vakata.array_unique(b),"#");e=b.length?d(this.element[0].querySelectorAll("#"+d.map(b,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))):d();this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");e=e.add(this._data.search.dom);e.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){d(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},
this)).on("search.jstree",d.proxy(function(a,b){this._data.search.som&&b.nodes.length&&(this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),b.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){d(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))},this)).on("clear_search.jstree",d.proxy(function(a,b){this._data.search.som&&b.nodes.length&&this.element.find(".jstree-node").css("display",
"").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")},this))};this.search=function(a,b,f){if(!1===a||""===d.trim(a.toString()))return this.clear_search();a=a.toString();var c=this.settings.search,e=c.ajax?c.ajax:!1,g=null,k=[],p=[];this._data.search.res.length&&this.clear_search();f===u&&(f=c.show_only_matches);if(!b&&!1!==e){if(d.isFunction(e))return e.call(this,a,d.proxy(function(c){c&&c.d&&(c=c.d);this._load_nodes(d.isArray(c)?d.vakata.array_unique(c):
[],function(){this.search(a,!0,f)},!0)},this));e=d.extend({},e);e.data||(e.data={});e.data.str=a;return d.ajax(e).fail(d.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(e)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(d.proxy(function(c){c&&c.d&&(c=c.d);this._load_nodes(d.isArray(c)?d.vakata.array_unique(c):[],function(){this.search(a,!0,f)},!0)},this))}this._data.search.str=
a;this._data.search.dom=d();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=f;g=new d.vakata.search(a,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy});d.each(this._model.data,function(b,d){d.text&&(c.search_callback&&c.search_callback.call(this,a,d)||!c.search_callback&&g.search(d.text).isMatch)&&(!c.search_leaves_only||d.state.loaded&&0===d.children.length)&&(k.push(b),p=p.concat(d.parents))});k.length&&(p=d.vakata.array_unique(p),this._search_open(p),this._data.search.dom=
d(this.element[0].querySelectorAll("#"+d.map(k,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=k,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"));this.trigger("search",{nodes:this._data.search.dom,str:a,res:this._data.search.res,show_only_matches:f})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");
this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=d()};this._search_open=function(a){var c=this;d.each(a.concat([]),function(b,e){if("#"===e)return!0;try{e=d("#"+e.replace(d.jstree.idregex,"\\$&"),c.element)}catch(h){}e&&e.length&&c.is_closed(e)&&(c._data.search.opn.push(e[0].id),
c.open_node(e,function(){c._search_open(a)},0))})}};(function(a){a.vakata.search=function(a,c,d){d=d||{};!1!==d.fuzzy&&(d.fuzzy=!0);a=d.caseSensitive?a:a.toLowerCase();var b=d.location||0,e=d.distance||100,h=d.threshold||.6,g=a.length;32<g&&(d.fuzzy=!1);if(d.fuzzy){var k=1<<g-1;var p=function(){var c={},b;for(b=0;b<g;b++)c[a.charAt(b)]=0;for(b=0;b<g;b++)c[a.charAt(b)]|=1<<g-b-1;return c}();var q=function(a,c){a/=g;c=Math.abs(b-c);return e?a+c/e:c?1:a}}var m=function(c){c=d.caseSensitive?c:c.toLowerCase();
if(a===c||-1!==c.indexOf(a))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var e,f=c.length,l=h,n=c.indexOf(a,b),m,r=g+f,t=1,v=[];-1!==n&&(l=Math.min(q(0,n),l),n=c.lastIndexOf(a,b+g),-1!==n&&(l=Math.min(q(0,n),l)));n=-1;for(e=0;e<g;e++){var u=0;for(m=r;u<m;)q(e,b+m)<=l?u=m:r=m,m=Math.floor((r-u)/2+u);r=m;u=Math.max(1,b-m+1);var y=Math.min(b+m,f)+g;m=Array(y+2);for(m[y+1]=(1<<e)-1;y>=u;y--){var x=p[c.charAt(y-1)];m[y]=0===e?(m[y+1]<<1|1)&x:(m[y+1]<<1|1)&x|(z[y+1]|z[y])<<1|1|z[y+
1];if(m[y]&k&&(t=q(e,y-1),t<=l))if(l=t,n=y-1,v.push(n),n>b)u=Math.max(1,2*b-n);else break}if(q(e+1,b)>l)break;var z=m}return{isMatch:0<=n,score:t}};return!0===c?{search:m}:m(c)}})(d);d.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1};d.jstree.plugins.sort=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("model.jstree",d.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",d.proxy(function(a,b){this.sort(b.parent||
b.node.parent,!1);this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",d.proxy(function(a,b){this.sort(b.parent,!1);this.redraw_node(b.parent,!0)},this))};this.sort=function(a,b){var c;if((a=this.get_node(a))&&a.children&&a.children.length&&(a.children.sort(d.proxy(this.settings.sort,this)),b))for(b=0,c=a.children_d.length;b<c;b++)this.sort(a.children_d[b],!1)}};var I=!1;d.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",
ttl:!1,filter:!1};d.jstree.plugins.state=function(a,b){this.bind=function(){b.bind.call(this);var a=d.proxy(function(){this.element.on(this.settings.state.events,d.proxy(function(){I&&clearTimeout(I);I=setTimeout(d.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},this);this.element.on("ready.jstree",d.proxy(function(c,b){this.element.one("restore_state.jstree",a);this.restore_state()||a()},this))};this.save_state=function(){var a={state:this.get_state(),ttl:this.settings.state.ttl,
sec:+new Date};d.vakata.storage.set(this.settings.state.key,JSON.stringify(a))};this.restore_state=function(){var a=d.vakata.storage.get(this.settings.state.key);if(a)try{a=JSON.parse(a)}catch(e){return!1}if(a&&a.ttl&&a.sec&&+new Date-a.sec>a.ttl)return!1;a&&a.state&&(a=a.state);a&&d.isFunction(this.settings.state.filter)&&(a=this.settings.state.filter.call(this,a));return a?(this.element.one("set_state.jstree",function(c,b){b.instance.trigger("restore_state",{state:d.extend(!0,{},a)})}),this.set_state(a),
!0):!1};this.clear_state=function(){return d.vakata.storage.del(this.settings.state.key)}};(function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}})(d);d.jstree.defaults.types={"#":{},"default":{}};d.jstree.plugins.types=function(a,b){this.init=function(a,d){var c,e;if(d&&d.types&&d.types["default"])for(c in d.types)if("default"!==c&&"#"!==c&&d.types.hasOwnProperty(c))for(e in d.types["default"])d.types["default"].hasOwnProperty(e)&&
d.types[c][e]===u&&(d.types[c][e]=d.types["default"][e]);b.init.call(this,a,d);this._model.data["#"].type="#"};this.refresh=function(a,d){b.refresh.call(this,a,d);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",d.proxy(function(a,b){a=this._model.data;b=b.nodes;var c=this.settings.types,d;var e=0;for(d=b.length;e<d;e++){var g="default";a[b[e]].original&&a[b[e]].original.type&&c[a[b[e]].original.type]&&(g=a[b[e]].original.type);a[b[e]].data&&a[b[e]].data.jstree&&
a[b[e]].data.jstree.type&&c[a[b[e]].data.jstree.type]&&(g=a[b[e]].data.jstree.type);a[b[e]].type=g;!0===a[b[e]].icon&&c[g].icon!==u&&(a[b[e]].icon=c[g].icon)}a["#"].type="#"},this));b.bind.call(this)};this.get_json=function(a,e,f){var c=this._model.data,h=e?d.extend(!0,{},e,{no_id:!1}):{};h=b.get_json.call(this,a,h,f);if(!1===h)return!1;if(d.isArray(h))for(a=0,f=h.length;a<f;a++)h[a].type=h[a].id&&c[h[a].id]&&c[h[a].id].type?c[h[a].id].type:"default",e&&e.no_id&&(delete h[a].id,h[a].li_attr&&h[a].li_attr.id&&
delete h[a].li_attr.id,h[a].a_attr&&h[a].a_attr.id&&delete h[a].a_attr.id);else h.type=h.id&&c[h.id]&&c[h.id].type?c[h.id].type:"default",e&&e.no_id&&(h=this._delete_ids(h));return h};this._delete_ids=function(a){if(d.isArray(a)){for(var b=0,c=a.length;b<c;b++)a[b]=this._delete_ids(a[b]);return a}delete a.id;a.li_attr&&a.li_attr.id&&delete a.li_attr.id;a.a_attr&&a.a_attr.id&&delete a.a_attr.id;a.children&&d.isArray(a.children)&&(a.children=this._delete_ids(a.children));return a};this.check=function(a,
e,f,g,h){if(!1===b.check.call(this,a,e,f,g,h))return!1;e=e&&e.id?e:this.get_node(e);f=f&&f.id?f:this.get_node(f);h=e&&e.id?d.jstree.reference(e.id):null;var c,l;h=h&&h._model&&h._model.data?h._model.data:null;switch(a){case "create_node":case "move_node":case "copy_node":if("move_node"!==a||-1===d.inArray(e.id,f.children)){var k=this.get_rules(f);if(k.max_children!==u&&-1!==k.max_children&&k.max_children===f.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",
reason:"max_children prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(k.valid_children!==u&&-1!==k.valid_children&&-1===d.inArray(e.type||"default",k.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(h&&e.children_d&&e.parents){var p=c=0;for(l=e.children_d.length;p<l;p++)c=
Math.max(c,h[e.children_d[p]].parents.length);c=c-e.parents.length+1}if(0>=c||c===u)c=1;do{if(k.max_depth!==u&&-1!==k.max_depth&&k.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent);k=this.get_rules(f);c++}while(f)}}return!0};this.get_rules=function(a){a=this.get_node(a);if(!a)return!1;a=this.get_type(a,!0);a.max_depth===
u&&(a.max_depth=-1);a.max_children===u&&(a.max_children=-1);a.valid_children===u&&(a.valid_children=-1);return a};this.get_type=function(a,b){return(a=this.get_node(a))?b?d.extend({type:a.type},this.settings.types[a.type]):a.type:!1};this.set_type=function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.set_type(a[e],b);return!0}e=this.settings.types;a=this.get_node(a);if(!e[b]||!a)return!1;c=a.type;var h=this.get_icon(a);a.type=b;(!0===h||e[c]&&e[c].icon!==u&&h===e[c].icon)&&
this.set_icon(a,e[b].icon!==u?e[b].icon:!0);return!0}};d.jstree.defaults.unique={case_sensitive:!1,duplicate:function(a,b){return a+" ("+b+")"}};d.jstree.plugins.unique=function(a,b){this.check=function(a,e,f,g,h){if(!1===b.check.call(this,a,e,f,g,h))return!1;e=e&&e.id?e:this.get_node(e);f=f&&f.id?f:this.get_node(f);if(!f||!f.children)return!0;h="rename_node"===a?g:e.text;var c=[],k=this.settings.unique.case_sensitive,l=this._model.data,p;var m=0;for(p=f.children.length;m<p;m++)c.push(k?l[f.children[m]].text:
l[f.children[m]].text.toLowerCase());k||(h=h.toLowerCase());switch(a){case "rename_node":return m=-1===d.inArray(h,c)||e.text&&e.text[k?"toString":"toLowerCase"]()===h,m||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+h+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})}),m;case "create_node":return m=-1===d.inArray(h,c),m||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",
reason:"Child with name "+h+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})}),m;case "copy_node":return m=-1===d.inArray(h,c),m||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+h+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})}),m;case "move_node":return m=e.parent===f.id||-1===d.inArray(h,c),m||(this._data.core.last_error={error:"check",
plugin:"unique",id:"unique_03",reason:"Child with name "+h+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})}),m}return!0};this.create_node=function(a,e,f,g,h){if(!e||e.text===u){null===a&&(a="#");a=this.get_node(a);if(!a)return b.create_node.call(this,a,e,f,g,h);f=f===u?"last":f;if(!f.toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(a))return b.create_node.call(this,a,e,f,g,h);e||(e={});var c,k,l=this._model.data,m=this.settings.unique.case_sensitive,
p=this.settings.unique.duplicate;var r=c=this.get_string("New node");var v=[];var y=0;for(k=a.children.length;y<k;y++)v.push(m?l[a.children[y]].text:l[a.children[y]].text.toLowerCase());for(y=1;-1!==d.inArray(m?r:r.toLowerCase(),v);)r=p.call(this,c,++y).toString();e.text=r}return b.create_node.call(this,a,e,f,g,h)}};var G=document.createElement("DIV");G.setAttribute("unselectable","on");G.setAttribute("role","presentation");G.className="jstree-wholerow";G.innerHTML="&#160;";d.jstree.plugins.wholerow=
function(a,b){this.bind=function(){b.bind.call(this);this.element.on("ready.jstree set_state.jstree",d.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",d.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",d.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",d.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");
var c;var d=0;for(c=b.selected.length;d<c;d++)(a=this.get_node(b.selected[d],!0))&&a.length&&a.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",d.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",d.proxy(function(a,b){if("hover_node"!==a.type||!this.is_disabled(b.node))this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===
a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",d.proxy(function(a){a.preventDefault();var b=d.Event("contextmenu",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,pageX:a.pageX,pageY:a.pageY});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b)},this)).on("click.jstree",".jstree-wholerow",function(a){a.stopImmediatePropagation();var b=d.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,
altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",d.proxy(function(a){a.stopImmediatePropagation();var b=d.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",d.proxy(function(a){a.stopImmediatePropagation();
this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget);return!1},this)).on("mouseleave.jstree",".jstree-node",d.proxy(function(a){this.dehover_node(a.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();b.teardown.call(this)};this.redraw_node=function(a,e,f,g){if(a=b.redraw_node.apply(this,arguments)){var c=G.cloneNode(!0);-1!==d.inArray(a.id,this._data.core.selected)&&(c.className+=" jstree-wholerow-clicked");this._data.core.focused&&
this._data.core.focused===a.id&&(c.className+=" jstree-wholerow-hovered");a.insertBefore(c,a.childNodes[0])}return a}};(function(a){if(document.registerElement&&Object&&Object.create){var b=Object.create(HTMLElement.prototype);b.createdCallback=function(){var b={core:{},plugins:[]},d;for(d in a.jstree.plugins)a.jstree.plugins.hasOwnProperty(d)&&this.attributes[d]&&(b.plugins.push(d),this.getAttribute(d)&&JSON.parse(this.getAttribute(d))&&(b[d]=JSON.parse(this.getAttribute(d))));for(d in a.jstree.defaults.core)a.jstree.defaults.core.hasOwnProperty(d)&&
this.attributes[d]&&(b.core[d]=JSON.parse(this.getAttribute(d))||this.getAttribute(d));jQuery(this).jstree(b)};try{document.registerElement("vakata-jstree",{prototype:b})}catch(c){}}})(jQuery)}});
(function(d,u){var w=0;d.widget("s3.hierarchicalopts",{options:{selected:null,multiple:!0,leafonly:!0,cascade:!1,bulkSelect:!1,cascadeOptionInTree:!0,noneSelectedText:"Select",selectedText:"selected",noOptionsText:"No options available",selectAllText:"Select All",deselectAllText:"Deselect All",icons:!1,stripes:!0,htmlTitles:!0},_create:function(){var g=d(this.element),k=this.options;this.id=w;w+=1;this._namespace=".hierarchicalopts"+w;this.treeID=g.attr("id")+"-tree";this.input=g.find(".s3-hierarchy-input").first();
this.input.data("input",!0);var m=k.selected;m&&this.input.val(this._stringifySelection(m));this.button=d('<button type="button" class="s3-hierarchy-button ui-multiselect ui-widget ui-state-default ui-corner-all"><span class="ui-icon ui-icon-triangle-1-s"></span></button>');this.buttonText=d("<span>"+k.noneSelectedText+"</span>").appendTo(this.button);this.noopts=d('<span class="no-options-available">'+k.noOptionsText+"</span>").hide();this.tree=g.find(".s3-hierarchy-tree").first();this.wrapper=this.tree.closest(".s3-hierarchy-wrapper").hide().before(this.noopts).before(this.button).detach().appendTo("body");
this.manualCascadeOption=this._isBulk=this._isOpen=!1},_init:function(){this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this);this._unbindEvents();d(this.button).remove();d(this.noopts).remove();d(this.tree).detach().appendTo(this.element).show()},refresh:function(){this._unbindEvents();var g=this.options,k=this.tree,m=this;if(k.find("li").length){this.noopts.hide();this.button.show();this.input.next(".error_wrapper").insertAfter(this.button).one("click",function(){d(this).fadeOut()});
var r=this.input.val();if(r){r=this._parseSelection(r);var p=this.treeID;d.each(r,function(){d("#"+p+"-"+this).data("jstree",{selected:!0})})}r=k.find("> ul > li");if(1==r.length){r=r.first();var v=r.data("jstree");r.data("jstree",d.extend({},v,{opened:!0}))}r=g.multiple;v=g.leafonly;var u=g.cascade,z=!1,y=null,w=["sort","checkbox"];this.input.data("multiple",r);(u||v)&&r?z=!0:r&&(g.cascadeOptionInTree?this.manualCascadeOption=!0:(y=function(g){return k.jstree("is_parent",g)?(d.vakata.context.settings.icons=
!1,{select_all:{label:m.options.selectAllText,icon:!1,action:function(d){m._selectBranch(g)}},deselect_all:{label:m.options.deselectAllText,icon:!1,action:function(d){m._deselectBranch(g)}}}):null},w.push("contextmenu")));k.jstree({core:{themes:{name:"s3",icons:g.icons,stripes:g.stripes},animation:100,multiple:r,check_callback:!0},checkbox:{three_state:z},sort:function(d,g){var k=this.get_text(d)>this.get_text(g)?1:-1;try{var a=this.get_node(d).li_attr.rel}catch(c){a=null}try{var b=this.get_node(g).li_attr.rel}catch(c){b=
null}return"bulk"==a?-1:"bulk"==b?1:"none"==a?-1:"none"==b?1:k},contextmenu:{items:y,select_node:!1,icons:!1},plugins:w});var F=jQuery.jstree.reference(k);r&&((g.bulkSelect||this.manualCascadeOption)&&g.cascadeOptionInTree?(this.wrapper.find(".s3-hierarchy-header").hide(),F.create_node("#",{id:this.treeID+"-select-all",text:g.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first")):this.wrapper.find(".s3-hierarchy-header").removeClass("hide").show());k.on("ready.jstree",function(){var d=
F.get_checked();m._updateButtonText(d)});this._bindEvents()}else this.button.hide(),this.noopts.show()},_setOption:function(g,k){if("selected"===g){var m=jQuery.jstree.reference(d(this.tree));if(m&&(m.uncheck_all(),k)){this.input.val(this._stringifySelection(k));var r=this.treeID;d.each(k,function(){m.check_node("#"+r+"-"+this)});this._updateButtonText(k)}}this._super(g,k)},_updateSelectedNodes:function(){var g=jQuery.jstree.reference(d(this.tree)),k=this._parseSelection(this.input.val()),m=[],r=
[],p=this.options.leafonly,v=g.get_checked(!0);d(v).each(function(){var k=d(this).attr("id");if("bulk"!=d(this).attr("rel")&&k&&(!p||g.is_leaf(this))){var v=k.split("-").pop();"None"!=v&&(v=parseInt(v));v&&(m.push(v),r.push(k))}});v=!1;var u=d(m).not(k).get();u.length?v=!0:(u=d(k).not(m).get(),u.length&&(v=!0));k=this.input.val(this._stringifySelection(m));this._updateButtonText(r);v&&(k.change(),d(this.element).trigger("select.s3hierarchy"));return!0},_updateButtonText:function(g){var k=this.options,
m=0;g&&(m=g.length);if(m)if(1<m)g=k.selectedText.replace("#",m);else{for(var r=[],p=0;p<m;p++)r.push(d("#"+g[p]+" > a").text().replace(/^\s+|\s+$/g,""));g=r.length?r.join(" "):k.noneSelectedText}else g=k.noneSelectedText;this.buttonText.text(g)},_updateAndClose:function(){if(!this._isBulk){this._updateSelectedNodes();var d=this.wrapper,k=this;if(k.options.multiple)d.unbind("mouseleave.hierarchicalopts").one("mouseleave.hierarchicalopts",function(){window.setTimeout(function(){k.closeMenu()},100)});
else window.setTimeout(function(){k.closeMenu()},100)}},_selectNode:function(g){var k=this.options,m=jQuery.jstree.reference(d(this.tree)),r=k.multiple,p=k.leafonly;if(r)this._isBulk||"bulk"!=g.li_attr.rel||((k=m.get_parent(g))&&"#"!=k?(k=m.get_node(k),this._selectBranch(k,!0)):m.select_all());else{var v=g.id;d(m.get_checked(!0)).each(function(){v==this.id||p&&!m.is_leaf(this)||m.uncheck_node(this)})}if(p&&!r&&!m.is_leaf(g))return m.deselect_node(g),!1;this._updateAndClose()},_deselectNode:function(g){var k=
jQuery.jstree.reference(d(this.tree));if(!this._isBulk){if("bulk"==g.li_attr.rel)(g=k.get_parent(g))&&"#"!=g?(g=k.get_node(g),this._deselectBranch(g,!0)):k.deselect_all();else if(g=k.get_parent(g))if(g=k.get_node(g+"-select-all"))this._isBulk=!0,k.uncheck_node(g),this._isBulk=!1;if(g=k.get_node(this.treeID+"-select-all"))this._isBulk=!0,k.uncheck_node(g),this._isBulk=!1}this._updateSelectedNodes()},_openNode:function(g){var k=jQuery.jstree.reference(d(this.tree)),m=k.get_parent(g);m.length&&k.open_node(m,
!1,!0);if(this.manualCascadeOption){var r=g.id;m=k.get_node(r+"-select-all");m||(g=k.create_node(g,{id:r+"-select-all",text:this.options.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first"),m=k.get_node(g));(g=k.get_node(this.treeID+"-select-all"))&&k.is_checked(g)&&(this._isBulk=!0,k.check_node(m),this._isBulk=!1)}},_selectBranch:function(g,k){var m=jQuery.jstree.reference(d(this.tree)),r=this;this._isBulk=!0;m.open_node(g,function(){var p=m.get_children_dom(g);d(p).each(function(){r._selectBranch(this)});
k||m.check_node(g)});this._isBulk=!1;this._updateAndClose()},_deselectBranch:function(g,k){var m=jQuery.jstree.reference(d(this.tree)),r=this;this._isBulk=!0;m.open_node(g,function(){var p=m.get_children_dom(g);d(p).each(function(){r._deselectBranch(this)});k||m.uncheck_node(g)});this._isBulk=!1;this._updateSelectedNodes()},set:function(g){var k=jQuery.jstree.reference(d(this.tree)),m=this.treeID;this._isBulk=!0;k.uncheck_all();k.close_all();if(g){var r=function(d,g){if(d=k.get_parent(d))"#"!=d?(r(d),
k.open_node(d,g)):g&&g()};g.forEach(function(d){var g=k.get_node(m+"-"+d);g&&r(g,function(){k.check_node(g)})})}this._isBulk=!1;this._updateSelectedNodes()},get:function(){return this._parseSelection(this.input.val())},reset:function(){var g=jQuery.jstree.reference(d(this.tree));this._isBulk=!0;g.uncheck_all();g.close_all();this._isBulk=!1;this._updateSelectedNodes();return!0},_setMenuPosition:function(g,k){var m=k.offset(),r={position:"absolute",top:m.top+k.outerHeight(),minWidth:k.outerWidth()-
8};"rtl"===d("body").css("direction")?r.right=d(window).width()-(m.left+k.outerWidth()):r.left=m.left;g.css(r)},openMenu:function(){this._isOpen&&this.closeMenu();var g=d(this.button),k=d(this.wrapper),m=this;this._setMenuPosition(k,g);d(window).on("resize"+this._namespace+"-mpos",function(){m._setMenuPosition(k,g)});k.show();d(this.tree).jstree("set_focus");this._isOpen=!0;g.addClass("ui-state-active");d(this).trigger("open")},closeMenu:function(){d(window).off(this._namespace+"-mpos");d(this.tree).jstree("unset_focus").unbind("click.hierarchicalopts").unbind("mouseleave.hierarchicalopts");
d(this.wrapper).fadeOut(50);this._isOpen=!1;d(this.button).removeClass("ui-state-active");d(this).trigger("close")},addNode:function(g,k,m,r){var p=this.tree,v=this.treeID,u="#";g&&(u=d("#"+v+"-"+g),u.length||(u="#"));k=v+"-"+k;p.jstree("create_node",u,{id:k,text:m,li_attr:{rel:"leaf"}},"last");g&&(u.attr({rel:"parent"}),p.jstree("open_node",u));r&&p.jstree("check_node",d("#"+k))},_parseSelection:function(d){if(d)d=JSON.parse(d);else return[];d?d.constructor!==Array&&(d=[d]):d=[];return d},_stringifySelection:function(d){if(!this.options.multiple)if(d.length)d=
d[0];else return"";return JSON.stringify(d)},_bindEvents:function(){var g=this,k=d(this.wrapper),m=d(this.tree),r=d(this.button),p=this._namespace,v=this.options,u=jQuery.jstree.reference(m),z=d.vakata.context.settings.icons;d(document).bind("context_show.vakata",function(){k.unbind("mouseleave.hierarchicalopts");d.vakata.context.settings.icons=z});m.bind("select_node.jstree",function(d,k){g._selectNode(k.node)}).bind("deselect_node.jstree",function(d,k){g._deselectNode(k.node)}).bind("open_node.jstree",
function(d,k){g._openNode(k.node)});r.bind("click"+p,function(){g._isOpen?g.closeMenu():g.openMenu()}).bind("keyup"+p,function(d){d.preventDefault();switch(d.keyCode){case 27:case 38:case 37:g.closeMenu();break;case 39:case 40:g.openMenu()}}).bind("mouseenter"+p,function(){r.hasClass("ui-state-disabled")||d(this).addClass("ui-state-hover")}).bind("mouseleave"+p,function(){d(this).removeClass("ui-state-hover")}).bind("focus"+p,function(){r.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")}).bind("blur"+
p,function(){d(this).removeClass("ui-state-focus")});v.multiple&&v.bulkSelect&&!v.cascadeOptionInTree&&(k.find(".s3-hierarchy-select-all").bind("click"+p,function(d){d.preventDefault();u.select_all();g._updateSelectedNodes()}),k.find(".s3-hierarchy-deselect-all").bind("click"+p,function(d){d.preventDefault();u.deselect_all();g._updateSelectedNodes()}),k.find(".s3-hierarchy-header").bind("click"+p,function(d){d.preventDefault();d.stopPropagation()}).bind("mousedown"+p,function(d){d.preventDefault();
d.stopPropagation()}));d(document).bind("mousedown"+p,function(p){var v=p.target;if(d(".jstree-contextmenu").has(v).length||3==p.which)return k.unbind("mouseleave.hierarchicalopts"),!0;m.is(v)||r.is(v)||0!==m.has(v).length||0!==r.has(v).length||g.closeMenu()});return!0},_unbindEvents:function(){var g=d(this.tree);d(this.button);var k=this._namespace;g.unbind("select_node.jstree").unbind("deselect_node.jstree").unbind("loaded.jstree").unbind("open_node.jstree");d(this.button).unbind(k);d(document).unbind(k);
return!0}})})(jQuery);
(function(d,u){var w=0;d.widget("s3.hierarchicalcrud",{options:{widgetID:null,ajaxURL:null,openLabel:"Open",openURL:null,editTitle:"Edit Record",editLabel:"Edit",editURL:null,deleteLabel:"Delete",deleteURL:null,deleteRoot:!0,addTitle:"Add Record",addLabel:"Add",addURL:null,icons:!1,stripes:!0,htmlTitles:!0},_create:function(){this.treeID=d(this.element).attr("id")+"-tree";this.id=w;w+=1},_init:function(){this.tree=d(this.element).find(".s3-hierarchy-tree");this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this)},refresh:function(){var g=
this.tree,k=this.options;this._unbindEvents();var m=g.find("> ul > li");if(1==m.length){m=m.first();var r=m.data("jstree");m.data("jstree",d.extend({},r,{opened:!0}))}var p=this;g.jstree({core:{themes:{name:"s3",icons:k.icons,stripes:k.stripes},animation:100,multiple:!1,check_callback:!0},contextmenu:{items:function(d){var m=!0;"#"==g.jstree(!0).get_parent(d)&&(m=k.deleteRoot);var r={open:{label:p.options.openLabel,action:function(g){p._openNode(d)},separator_after:!0}};k.editURL&&(r.edit={label:p.options.editLabel,
action:function(g){p._editNode(d)}});m&&k.deleteURL&&(r.delete={label:p.options.deleteLabel,separator_after:!0,action:function(g){p._deleteNode(d)}});k.addURL&&(r.add={label:p.options.addLabel,action:function(g){p._addNode(d)}});return r},select_node:!0},plugins:["sort","contextmenu"]});this._bindEvents()},_openNode:function(d){var g=this.options.openURL;d=d.id;g&&d&&(d=parseInt(d.split("-").pop()))&&(g=g.replace("[id]",d).replace("%5Bid%5D",d),window.location.href=g)},refreshNode:function(g){var k=
this.options.ajaxURL,m=g.attr("id");if(k&&m&&(m=parseInt(m.split("-").pop()))){var r=this.tree,p=this.treeID;d.getJSONS3(k+"?node="+m,function(d){d.label&&r.jstree("rename_node",g,d.label);if(d=d.children){r.jstree("open_node",g,!1,!1);for(var k,m,v,u=0,w=0,H=d.length;w<H;w++)k=d[w],m=p+"-"+k.node,(v=r.jstree("get_node","#"+m,!0))?r.jstree("rename_node",v,k.label):(r.jstree("create_node",g,{id:m,text:k.label,li_attr:{rel:"leaf"}}),u++);u&&(r.jstree("open_node",g),g.attr({rel:"parent"}))}})}},_editNode:function(g){var k=
this.options.editURL;g=g.id;if(k&&g){var m=parseInt(g.split("-").pop());m&&(k=k.replace("[id]",m).replace("%5Bid%5D",m).split("?")[0],k+="?node="+g+"&hierarchy="+this.options.widgetID,g=S3.uid(),k=d('<iframe id="'+g+'" src='+k+" onload=\"S3.popup_loaded('"+g+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(k,this.options.editTitle))}},_addNode:function(g){var k=this.options.addURL;g=g.id;if(k&&g){var m=parseInt(g.split("-").pop());
m&&(k=k.split("?")[0],k+="?node="+g+"&link_to_parent="+m+"&hierarchy="+this.options.widgetID,g=S3.uid(),k=d('<iframe id="'+g+'" src='+k+" onload=\"S3.popup_loaded('"+g+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(k,this.options.addTitle))}},_deleteNode:function(g){if(!confirm(i18n.delete_confirmation))return!1;var k=this.options.deleteURL,m=g.id,r=this.tree;k&&m&&(m=parseInt(m.split("-").pop()))&&(k=k.replace("[id]",m).replace("%5Bid%5D",
m).split("?")[0],d.ajaxS3({type:"POST",url:k+"?recursive=1",data:{},dataType:"JSON",success:function(d){r.jstree("delete_node",g)},error:function(d,g,k){g=d.responseText;if("{"==g[0])try{g=JSON.parse(d.responseText),S3.showAlert(g.message,"error")}catch(z){}}}))},_openPopup:function(g,k){g.dialog({close:function(d,k){if(self.parent){var m=self.parent.$("iframe.ui-dialog-content"),r=m.width();m.width(0);window.setTimeout(function(){m.width(r)},300)}g.remove()},minHeight:480,modal:!0,open:function(k,
r){d(".ui-widget-overlay").bind("click",function(){g.dialog("close")})},title:k,minWidth:320,closeText:""})},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);
