/*
 2013-2016 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3

 2015-2016 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3
 jsTree 3.0.9
 http://jstree.com/

 Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)

 Licensed same as jquery - under the terms of the MIT License
   http://www.opensource.org/licenses/mit-license.php
 if using jslint please allow for the jQuery global and use following options: 
 jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 'themes' : {
      'name' : this.get_theme(),
      'icons' : this._data.core.themes.icons,
      'dots' : this._data.core.themes.dots
     },
 if(state.core.themes) {
      if(state.core.themes.name) {
       this.set_theme(state.core.themes.name);
      }
      if(typeof state.core.themes.dots !== 'undefined') {
       this[ state.core.themes.dots ? "show_dots" : "hide_dots" ]();
      }
      if(typeof state.core.themes.icons !== 'undefined') {
       this[ state.core.themes.icons ? "show_icons" : "hide_icons" ]();
      }
      delete state.core.themes;
      delete state.core.open;
      this.set_state(state, callback);
      return false;
     }
 oi = obj.children("i:visible"),
    ai = a.children("i:visible"),
    w1 = oi.width() * oi.length,
    w2 = ai.width() * ai.length,
*/
var $jscomp={scope:{},findInternal:function(d,u,x){d instanceof String&&(d=String(d));for(var h=d.length,l=0;l<h;l++){var p=d[l];if(u.call(x,p,l,d))return{i:l,v:p}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,u,x){if(x.get||x.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[u]=x.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,u,x,h){if(u){x=$jscomp.global;d=d.split(".");for(h=0;h<d.length-1;h++){var l=d[h];l in x||(x[l]={});x=x[l]}d=d[d.length-1];h=x[d];u=u(h);u!=h&&null!=u&&$jscomp.defineProperty(x,d,{configurable:!0,writable:!0,value:u})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,x){return $jscomp.findInternal(this,d,x).v}},"es6-impl","es3");
(function(d){"function"===typeof define&&define.amd?define(["jquery"],d):"object"===typeof exports?d(require("jquery")):d(jQuery)})(function(d,u){if(!d.jstree){var x=0,h=!1,l=!1,p=!1,v=[],q=d("script:last").attr("src"),w=document,D=w.createElement("LI"),z;D.setAttribute("role","treeitem");z=w.createElement("I");z.className="jstree-icon jstree-ocl";z.setAttribute("role","presentation");D.appendChild(z);z=w.createElement("A");z.className="jstree-anchor";z.setAttribute("href","#");z.setAttribute("tabindex",
"-1");w=w.createElement("I");w.className="jstree-icon jstree-themeicon";w.setAttribute("role","presentation");z.appendChild(w);D.appendChild(z);z=w=null;d.jstree={version:"3.0.9",defaults:{plugins:[]},plugins:{},path:q&&-1!==q.indexOf("/")?q.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g};d.jstree.create=function(a,c){var b=new d.jstree.core(++x),f=c;c=d.extend(!0,{},d.jstree.defaults,c);f&&f.plugins&&(c.plugins=f.plugins);d.each(c.plugins,function(a,f){"core"!==a&&
(b=b.plugin(f,c[f]))});b.init(a,c);return b};d.jstree.destroy=function(){d(".jstree:jstree").jstree("destroy");d(document).off(".jstree")};d.jstree.core=function(a){this._id=a;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}};d.jstree.reference=function(a){var c=null,b=null;a&&a.id&&(a=a.id);if(!b||!b.length)try{b=d(a)}catch(f){}if(!b||!b.length)try{b=d("#"+a.replace(d.jstree.idregex,"\\$&"))}catch(f){}b&&
b.length&&(b=b.closest(".jstree")).length&&(b=b.data("jstree"))?c=b:d(".jstree").each(function(){var b=d(this).data("jstree");if(b&&b._model.data[a])return c=b,!1});return c};d.fn.jstree=function(a){var c="string"===typeof a,b=Array.prototype.slice.call(arguments,1),f=null;if(!0===a&&!this.length)return!1;this.each(function(){var e=d.jstree.reference(this),k=c&&e?e[a]:null;f=c&&k?k.apply(e,b):null;e||c||a!==u&&!d.isPlainObject(a)||d(this).data("jstree",new d.jstree.create(this,a));if(e&&!c||!0===
a)f=e||!1;if(null!==f&&f!==u)return!1});return null!==f&&f!==u?f:this};d.expr[":"].jstree=d.expr.createPseudo(function(a){return function(a){return d(a).hasClass("jstree")&&d(a).data("jstree")!==u}});d.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:d.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0};d.jstree.core.prototype={plugin:function(a,c){var b=
d.jstree.plugins[a];return b?(this._data[a]={},b.prototype=this,new b(c,this)):this},init:function(a,c){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this.element=d(a).addClass("jstree jstree-"+this._id);this.settings=c;this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl="rtl"===this.element.css("direction");this.element[this._data.core.rtl?
"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0);this.element.attr("tabindex")||this.element.attr("tabindex","0");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();
this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().height()||
24;this.trigger("loading");this.load_node("#")},destroy:function(a){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(c){}a||this.element.empty();this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){var a="",c=null,b=0;this.element.on("dblclick.jstree",function(){if(document.selection&&
document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(e){}}}).on("mousedown.jstree",d.proxy(function(a){a.target===this.element[0]&&(a.preventDefault(),b=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(a){a.preventDefault()}).on("click.jstree",".jstree-ocl",d.proxy(function(a){this.toggle_node(a.target)},this)).on("dblclick.jstree",".jstree-anchor",d.proxy(function(a){this.settings.core.dblclick_toggle&&
this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",d.proxy(function(a){a.preventDefault();a.currentTarget!==document.activeElement&&d(a.currentTarget).focus();this.activate_node(a.currentTarget,a)},this)).on("keydown.jstree",".jstree-anchor",d.proxy(function(a){if("INPUT"===a.target.tagName)return!0;var b=null;this._data.core.rtl&&(37===a.which?a.which=39:39===a.which&&(a.which=37));switch(a.which){case 32:a.ctrlKey&&(a.type="click",d(a.currentTarget).trigger(a));break;case 13:a.type=
"click";d(a.currentTarget).trigger(a);break;case 37:a.preventDefault();this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(b=this.get_parent(a.currentTarget))&&"#"!==b.id&&this.get_node(b,!0).children(".jstree-anchor").focus();break;case 38:a.preventDefault();(b=this.get_prev_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 39:a.preventDefault();this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):
this.is_open(a.currentTarget)&&(b=this.get_node(a.currentTarget,!0).children(".jstree-children")[0])&&d(this._firstChild(b)).children(".jstree-anchor").focus();break;case 40:a.preventDefault();(b=this.get_next_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:a.preventDefault();(b=this._firstChild(this.get_container_ul()[0]))&&d(b).children(".jstree-anchor").filter(":visible").focus();break;case 35:a.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},
this)).on("load_node.jstree",d.proxy(function(a,b){b.status&&("#"!==b.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(d.proxy(function(){if(!this.get_container_ul().find(".jstree-loading").length){this._data.core.ready=!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var a=
[],b,e;b=0;for(e=this._data.core.selected.length;b<e;b++)a=a.concat(this._model.data[this._data.core.selected[b]].parents);a=d.vakata.array_unique(a);b=0;for(e=a.length;b<e;b++)this.open_node(a[b],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",d.proxy(function(b){if("INPUT"===b.target.tagName)return!0;c&&clearTimeout(c);c=setTimeout(function(){a=""},500);var e=String.fromCharCode(b.which).toLowerCase();
b=this.element.find(".jstree-anchor").filter(":visible");var f=b.index(document.activeElement)||0,g=!1;a+=e;if(1<a.length){b.slice(f).each(d.proxy(function(b,e){if(0===d(e).text().toLowerCase().indexOf(a))return d(e).focus(),g=!0,!1},this));if(g)return;b.slice(0,f).each(d.proxy(function(b,e){if(0===d(e).text().toLowerCase().indexOf(a))return d(e).focus(),g=!0,!1},this));if(g)return}(new RegExp("^"+e+"+$")).test(a)&&(b.slice(f+1).each(d.proxy(function(a,b){if(d(b).text().toLowerCase().charAt(0)===
e)return d(b).focus(),g=!0,!1},this)),g||b.slice(0,f+1).each(d.proxy(function(a,b){if(d(b).text().toLowerCase().charAt(0)===e)return d(b).focus(),g=!0,!1},this)))},this)).on("init.jstree",d.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots;this._data.core.themes.stripes=a.stripes;this._data.core.themes.icons=a.icons;this.set_theme(a.name||"default",a.url);this.set_theme_variant(a.variant)},this)).on("loading.jstree",d.proxy(function(){this[this._data.core.themes.dots?
"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",d.proxy(function(a){this._data.core.focused=null;d(a.currentTarget).filter(".jstree-hovered").mouseleave();this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",d.proxy(function(a){var b=this.get_node(a.currentTarget);b&&b.id&&(this._data.core.focused=b.id);this.element.find(".jstree-hovered").not(a.currentTarget).mouseleave();
d(a.currentTarget).mouseenter();this.element.attr("tabindex","-1")},this)).on("focus.jstree",d.proxy(function(){500<+new Date-b&&!this._data.core.focused&&(b=0,this.get_node(this.element.attr("aria-activedescendant"),!0).find("> .jstree-anchor").focus())},this)).on("mouseenter.jstree",".jstree-anchor",d.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",d.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree");
d(document).off(".jstree-"+this._id)},trigger:function(a,c){c||(c={});c.instance=this;this.element.triggerHandler(a.replace(".jstree","")+".jstree",c)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(a){var c=this.settings.core.strings;return d.isFunction(c)?c.call(this,a):c&&c[a]?c[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=
a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,c){a&&a.id&&(a=a.id);var b;try{if(this._model.data[a])a=this._model.data[a];else if("string"===typeof a&&this._model.data[a.replace(/^#/,"")])a=this._model.data[a.replace(/^#/,"")];else if("string"===typeof a&&(b=d("#"+a.replace(d.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[b.closest(".jstree-node").attr("id")])a=
this._model.data[b.closest(".jstree-node").attr("id")];else if((b=d(a,this.element)).length&&this._model.data[b.closest(".jstree-node").attr("id")])a=this._model.data[b.closest(".jstree-node").attr("id")];else if((b=d(a,this.element)).length&&b.hasClass("jstree"))a=this._model.data["#"];else return!1;c&&(a="#"===a.id?this.element:d("#"+a.id.replace(d.jstree.idregex,"\\$&"),this.element));return a}catch(f){return!1}},get_path:function(a,c,b){a=a.parents?a:this.get_node(a);if(!a||"#"===a.id||!a.parents)return!1;
var f,e,d=[];d.push(b?a.id:a.text);f=0;for(e=a.parents.length;f<e;f++)d.push(b?a.parents[f]:this.get_text(a.parents[f]));d=d.reverse().slice(1);return c?d.join(c):d},get_next_dom:function(a,c){var b;a=this.get_node(a,!0);if(a[0]===this.element[0]){for(b=this._firstChild(this.get_container_ul()[0]);b&&0===b.offsetHeight;)b=this._nextSibling(b);return b?d(b):!1}if(!a||!a.length)return!1;if(c){b=a[0];do b=this._nextSibling(b);while(b&&0===b.offsetHeight);return b?d(b):!1}if(a.hasClass("jstree-open")){for(b=
this._firstChild(a.children(".jstree-children")[0]);b&&0===b.offsetHeight;)b=this._nextSibling(b);if(null!==b)return d(b)}b=a[0];do b=this._nextSibling(b);while(b&&0===b.offsetHeight);return null!==b?d(b):a.parentsUntil(".jstree",".jstree-node").next(".jstree-node:visible").first()},get_prev_dom:function(a,c){var b;a=this.get_node(a,!0);if(a[0]===this.element[0]){for(b=this.get_container_ul()[0].lastChild;b&&0===b.offsetHeight;)b=this._previousSibling(b);return b?d(b):!1}if(!a||!a.length)return!1;
if(c){b=a[0];do b=this._previousSibling(b);while(b&&0===b.offsetHeight);return b?d(b):!1}b=a[0];do b=this._previousSibling(b);while(b&&0===b.offsetHeight);if(null!==b){for(a=d(b);a.hasClass("jstree-open");)a=a.children(".jstree-children").first().children(".jstree-node:visible:last");return a}return(b=a[0].parentNode.parentNode)&&b.className&&-1!==b.className.indexOf("jstree-node")?d(b):!1},get_parent:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.parent:!1},get_children_dom:function(a){a=this.get_node(a,
!0);return a[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):a&&a.length?a.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&
this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(a,c){var b,f,e,k,g;if(d.isArray(a))return this._load_nodes(a.slice(),c),!0;a=this.get_node(a);if(!a)return c&&c.call(this,a,!1),!1;if(a.state.loaded){a.state.loaded=!1;b=0;for(f=a.children_d.length;b<f;b++){e=0;for(k=a.parents.length;e<k;e++)this._model.data[a.parents[e]].children_d=d.vakata.array_remove_item(this._model.data[a.parents[e]].children_d,a.children_d[b]);this._model.data[a.children_d[b]].state.selected&&
(g=!0,this._data.core.selected=d.vakata.array_remove_item(this._data.core.selected,a.children_d[b]));delete this._model.data[a.children_d[b]]}a.children=[];a.children_d=[];g&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.loading=!0;this.get_node(a,!0).addClass("jstree-loading").attr("aria-busy",!0);this._load_node(a,d.proxy(function(b){a=this._model.data[a.id];a.state.loading=!1;a.state.loaded=b;var e=this.get_node(a,!0);a.state.loaded&&!a.children.length&&
e&&e.length&&!e.hasClass("jstree-leaf")&&e.removeClass("jstree-closed jstree-open").addClass("jstree-leaf");e.removeClass("jstree-loading").attr("aria-busy",!1);this.trigger("load_node",{node:a,status:b});c&&c.call(this,a,b)},this));return!0},_load_nodes:function(a,c,b){var f=!0,e=function(){this._load_nodes(a,c,!0)},d=this._model.data,g,t;g=0;for(t=a.length;g<t;g++)!d[a[g]]||d[a[g]].state.loaded&&b||(this.is_loading(a[g])||this.load_node(a[g],e),f=!1);f&&c&&!c.done&&(c.call(this,a),c.done=!0)},load_all:function(a,
c){a||(a="#");a=this.get_node(a);if(!a)return!1;var b=[],f=this._model.data,e=f[a.id].children_d,d,g;a.state&&!a.state.loaded&&b.push(a.id);d=0;for(g=e.length;d<g;d++)f[e[d]]&&f[e[d]].state&&!f[e[d]].state.loaded&&b.push(e[d]);b.length?this._load_nodes(b,function(){this.load_all(a,c)}):(c&&c.call(this,a),this.trigger("load_all",{node:a}))},_load_node:function(a,c){var b=this.settings.core.data;if(!b)return"#"===a.id?this._append_html_data(a,this._data.core.original_container_html.clone(!0),function(a){c.call(this,
a)}):c.call(this,!1);if(d.isFunction(b))return b.call(this,a,d.proxy(function(b){!1===b&&c.call(this,!1);this["string"===typeof b?"_append_html_data":"_append_json_data"](a,"string"===typeof b?d(b):b,function(a){c.call(this,a)})},this));if("object"===typeof b){if(b.url)return b=d.extend(!0,{},b),d.isFunction(b.url)&&(b.url=b.url.call(this,a)),d.isFunction(b.data)&&(b.data=b.data.call(this,a)),d.ajax(b).done(d.proxy(function(b,e,k){e=k.getResponseHeader("Content-Type");if(-1!==e.indexOf("json")||"object"===
typeof b)return this._append_json_data(a,b,function(a){c.call(this,a)});if(-1!==e.indexOf("html")||"string"===typeof b)return this._append_html_data(a,d(b),function(a){c.call(this,a)});this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:k})};this.settings.core.error.call(this,this._data.core.last_error);return c.call(this,!1)},this)).fail(d.proxy(function(b){c.call(this,!1);this._data.core.last_error={error:"ajax",plugin:"core",
id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:b})};this.settings.core.error.call(this,this._data.core.last_error)},this));b=d.isArray(b)||d.isPlainObject(b)?JSON.parse(JSON.stringify(b)):b;if("#"===a.id)return this._append_json_data(a,b,function(a){c.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error);return c.call(this,
!1)}if("string"===typeof b){if("#"===a.id)return this._append_html_data(a,d(b),function(a){c.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error)}return c.call(this,!1)},_node_changed:function(a){(a=this.get_node(a))&&this._model.changed.push(a.id)},_append_html_data:function(a,c,b){a=this.get_node(a);a.children=[];a.children_d=[];c=c.is("ul")?
c.children():c;var f=a.id,e=[],k=[],g=this._model.data,t=g[f];a=this._data.core.selected.length;var m,r;c.each(d.proxy(function(a,b){if(m=this._parse_model_from_html(d(b),f,t.parents.concat()))e.push(m),k.push(m),g[m].children_d.length&&(k=k.concat(g[m].children_d))},this));t.children=e;t.children_d=k;c=0;for(r=t.parents.length;c<r;c++)g[t.parents[c]].children_d=g[t.parents[c]].children_d.concat(k);this.trigger("model",{nodes:k,parent:f});"#"!==f?(this._node_changed(f),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),
this.redraw(!0));this._data.core.selected.length!==a&&this.trigger("changed",{action:"model",selected:this._data.core.selected});b.call(this,!0)},_append_json_data:function(a,c,b,f){a=this.get_node(a);a.children=[];a.children_d=[];c.d&&(c=c.d,"string"===typeof c&&(c=JSON.parse(c)));d.isArray(c)||(c=[c]);var e=null,k={df:this._model.default_state,dat:c,par:a.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},g=function(a,b){a.data&&(a=a.data);var e=a.dat,c=a.par,f=[],
d=[],g=[],k=a.df,m=a.t_id,t=a.t_cnt,r=a.m,h=r[c],l=a.sel,p,q,v,u=function(a,e,c){c=c?c.concat():[];e&&c.unshift(e);var f=a.id.toString(),d,m,n;e={id:f,text:a.text||"",icon:a.icon!==b?a.icon:!0,parent:e,parents:c,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(d in k)k.hasOwnProperty(d)&&(e.state[d]=k[d]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(e.icon=a.data.jstree.icon);if(a&&a.data&&(e.data=a.data,a.data.jstree))for(d in a.data.jstree)a.data.jstree.hasOwnProperty(d)&&
(e.state[d]=a.data.jstree[d]);if(a&&"object"===typeof a.state)for(d in a.state)a.state.hasOwnProperty(d)&&(e.state[d]=a.state[d]);if(a&&"object"===typeof a.li_attr)for(d in a.li_attr)a.li_attr.hasOwnProperty(d)&&(e.li_attr[d]=a.li_attr[d]);e.li_attr.id||(e.li_attr.id=f);if(a&&"object"===typeof a.a_attr)for(d in a.a_attr)a.a_attr.hasOwnProperty(d)&&(e.a_attr[d]=a.a_attr[d]);a&&a.children&&!0===a.children&&(e.state.loaded=!1,e.children=[],e.children_d=[]);r[e.id]=e;d=0;for(f=e.children.length;d<f;d++)m=
u(r[e.children[d]],e.id,c),n=r[m],e.children_d.push(m),n.children_d.length&&(e.children_d=e.children_d.concat(n.children_d));delete a.data;delete a.children;r[e.id].original=a;e.state.selected&&g.push(e.id);return e.id},w=function(a,e,c){c=c?c.concat():[];e&&c.unshift(e);var f,d,n,h;do f="j"+m+"_"+ ++t;while(r[f]);e={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==b?a.icon:!0,parent:e,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};
for(d in k)k.hasOwnProperty(d)&&(e.state[d]=k[d]);a&&a.id&&(e.id=a.id.toString());a&&a.text&&(e.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(e.icon=a.data.jstree.icon);if(a&&a.data&&(e.data=a.data,a.data.jstree))for(d in a.data.jstree)a.data.jstree.hasOwnProperty(d)&&(e.state[d]=a.data.jstree[d]);if(a&&"object"===typeof a.state)for(d in a.state)a.state.hasOwnProperty(d)&&(e.state[d]=a.state[d]);if(a&&"object"===typeof a.li_attr)for(d in a.li_attr)a.li_attr.hasOwnProperty(d)&&(e.li_attr[d]=
a.li_attr[d]);e.li_attr.id&&!e.id&&(e.id=e.li_attr.id.toString());e.id||(e.id=f);e.li_attr.id||(e.li_attr.id=e.id);if(a&&"object"===typeof a.a_attr)for(d in a.a_attr)a.a_attr.hasOwnProperty(d)&&(e.a_attr[d]=a.a_attr[d]);if(a&&a.children&&a.children.length){d=0;for(f=a.children.length;d<f;d++)n=w(a.children[d],e.id,c),h=r[n],e.children.push(n),h.children_d.length&&(e.children_d=e.children_d.concat(h.children_d));e.children_d=e.children_d.concat(e.children)}a&&a.children&&!0===a.children&&(e.state.loaded=
!1,e.children=[],e.children_d=[]);delete a.data;delete a.children;e.original=a;r[e.id]=e;e.state.selected&&g.push(e.id);return e.id};if(e.length&&e[0].id!==b&&e[0].parent!==b){q=0;for(v=e.length;q<v;q++)e[q].children||(e[q].children=[]),r[e[q].id.toString()]=e[q];q=0;for(v=e.length;q<v;q++)r[e[q].parent.toString()].children.push(e[q].id.toString()),h.children_d.push(e[q].id.toString());q=0;for(v=h.children.length;q<v;q++)p=u(r[h.children[q]],c,h.parents.concat()),d.push(p),r[p].children_d.length&&
(d=d.concat(r[p].children_d))}else{q=0;for(v=e.length;q<v;q++)if(p=w(e[q],c,h.parents.concat()))f.push(p),d.push(p),r[p].children_d.length&&(d=d.concat(r[p].children_d));h.children=f;h.children_d=d}q=0;for(v=h.parents.length;q<v;q++)r[h.parents[q]].children_d=r[h.parents[q]].children_d.concat(d);e={cnt:t,mod:r,sel:l,par:c,dpc:d,add:g};if("undefined"===typeof window||"undefined"===typeof window.document)postMessage(e);else return e},t=function(a,e){this._cnt=a.cnt;this._model.data=a.mod;if(e){var c,
f,g=a.add,k=a.sel,m=this._data.core.selected.slice(),t=this._model.data;if(k.length!==m.length||d.vakata.array_unique(k.concat(m)).length!==k.length){c=0;for(f=k.length;c<f;c++)-1===d.inArray(k[c],g)&&-1===d.inArray(k[c],m)&&(t[k[c]].state.selected=!1);c=0;for(f=m.length;c<f;c++)-1===d.inArray(m[c],k)&&(t[m[c]].state.selected=!0)}}a.add.length&&(this._data.core.selected=this._data.core.selected.concat(a.add));this.trigger("model",{nodes:a.dpc,parent:a.par});"#"!==a.par?(this._node_changed(a.par),
this.redraw()):this.redraw(!0);a.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected});b.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+g.toString()],{type:"text/javascript"}))),!this._data.core.working||f?(this._data.core.working=!0,e=new window.Worker(this._wrk),e.onmessage=d.proxy(function(a){t.call(this,a.data,!0);try{e.terminate(),
e=null}catch(r){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),k.par?e.postMessage(k):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([a,c,b,!0])}catch(m){t.call(this,g(k),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):
this._data.core.working=!1}else t.call(this,g(k),!1)},_parse_model_from_html:function(a,c,b){b=b?[].concat(b):[];c&&b.unshift(c);var f,e,k=this._model.data,g={id:!1,text:!1,icon:!0,parent:c,parents:b,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},t;for(t in this._model.default_state)this._model.default_state.hasOwnProperty(t)&&(g.state[t]=this._model.default_state[t]);c=d.vakata.attributes(a,!0);d.each(c,function(a,b){b=d.trim(b);if(!b.length)return!0;
g.li_attr[a]=b;"id"===a&&(g.id=b.toString())});c=a.children("a").first();c.length&&(c=d.vakata.attributes(c,!0),d.each(c,function(a,b){b=d.trim(b);b.length&&(g.a_attr[a]=b)}));c=a.children("a").first().length?a.children("a").first().clone():a.clone();c.children("ins, i, ul").remove();c=c.html();c=d("<div />").html(c);g.text=this.settings.core.force_text?c.text():c.html();c=a.data();g.data=c?d.extend(!0,{},c):null;g.state.opened=a.hasClass("jstree-open");g.state.selected=a.children("a").hasClass("jstree-clicked");
g.state.disabled=a.children("a").hasClass("jstree-disabled");if(g.data&&g.data.jstree)for(t in g.data.jstree)g.data.jstree.hasOwnProperty(t)&&(g.state[t]=g.data.jstree[t]);c=a.children("a").children(".jstree-themeicon");c.length&&(g.icon=c.hasClass("jstree-themeicon-hidden")?!1:c.attr("rel"));g.state.icon&&(g.icon=g.state.icon);c=a.children("ul").children("li");do t="j"+this._id+"_"+ ++this._cnt;while(k[t]);g.id=g.li_attr.id?g.li_attr.id.toString():t;c.length?(c.each(d.proxy(function(a,c){f=this._parse_model_from_html(d(c),
g.id,b);e=this._model.data[f];g.children.push(f);e.children_d.length&&(g.children_d=g.children_d.concat(e.children_d))},this)),g.children_d=g.children_d.concat(g.children)):a.hasClass("jstree-closed")&&(g.state.loaded=!1);g.li_attr["class"]&&(g.li_attr["class"]=g.li_attr["class"].replace("jstree-closed","").replace("jstree-open",""));g.a_attr["class"]&&(g.a_attr["class"]=g.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled",""));k[g.id]=g;g.state.selected&&this._data.core.selected.push(g.id);
return g.id},_parse_model_from_flat_json:function(a,c,b){b=b?b.concat():[];c&&b.unshift(c);var f=a.id.toString(),e=this._model.data,d=this._model.default_state,g,t;c={id:f,text:a.text||"",icon:a.icon!==u?a.icon:!0,parent:c,parents:b,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(g in d)d.hasOwnProperty(g)&&(c.state[g]=d[g]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(c.icon=a.data.jstree.icon);if(a&&a.data&&(c.data=a.data,
a.data.jstree))for(g in a.data.jstree)a.data.jstree.hasOwnProperty(g)&&(c.state[g]=a.data.jstree[g]);if(a&&"object"===typeof a.state)for(g in a.state)a.state.hasOwnProperty(g)&&(c.state[g]=a.state[g]);if(a&&"object"===typeof a.li_attr)for(g in a.li_attr)a.li_attr.hasOwnProperty(g)&&(c.li_attr[g]=a.li_attr[g]);c.li_attr.id||(c.li_attr.id=f);if(a&&"object"===typeof a.a_attr)for(g in a.a_attr)a.a_attr.hasOwnProperty(g)&&(c.a_attr[g]=a.a_attr[g]);a&&a.children&&!0===a.children&&(c.state.loaded=!1,c.children=
[],c.children_d=[]);e[c.id]=c;g=0;for(f=c.children.length;g<f;g++)d=this._parse_model_from_flat_json(e[c.children[g]],c.id,b),t=e[d],c.children_d.push(d),t.children_d.length&&(c.children_d=c.children_d.concat(t.children_d));delete a.data;delete a.children;e[c.id].original=a;c.state.selected&&this._data.core.selected.push(c.id);return c.id},_parse_model_from_json:function(a,c,b){b=b?b.concat():[];c&&b.unshift(c);var f,e,d,g,t=this._model.data;d=this._model.default_state;do f="j"+this._id+"_"+ ++this._cnt;
while(t[f]);c={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==u?a.icon:!0,parent:c,parents:b,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in d)d.hasOwnProperty(e)&&(c.state[e]=d[e]);a&&a.id&&(c.id=a.id.toString());a&&a.text&&(c.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(c.icon=a.data.jstree.icon);if(a&&a.data&&(c.data=a.data,a.data.jstree))for(e in a.data.jstree)a.data.jstree.hasOwnProperty(e)&&(c.state[e]=
a.data.jstree[e]);if(a&&"object"===typeof a.state)for(e in a.state)a.state.hasOwnProperty(e)&&(c.state[e]=a.state[e]);if(a&&"object"===typeof a.li_attr)for(e in a.li_attr)a.li_attr.hasOwnProperty(e)&&(c.li_attr[e]=a.li_attr[e]);c.li_attr.id&&!c.id&&(c.id=c.li_attr.id.toString());c.id||(c.id=f);c.li_attr.id||(c.li_attr.id=c.id);if(a&&"object"===typeof a.a_attr)for(e in a.a_attr)a.a_attr.hasOwnProperty(e)&&(c.a_attr[e]=a.a_attr[e]);if(a&&a.children&&a.children.length){e=0;for(f=a.children.length;e<
f;e++)d=this._parse_model_from_json(a.children[e],c.id,b),g=t[d],c.children.push(d),g.children_d.length&&(c.children_d=c.children_d.concat(g.children_d));c.children_d=c.children_d.concat(c.children)}a&&a.children&&!0===a.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]);delete a.data;delete a.children;c.original=a;t[c.id]=c;c.state.selected&&this._data.core.selected.push(c.id);return c.id},_redraw:function(){var a=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),
c=document.createElement("UL"),b,d,e,k=this._data.core.focused;d=0;for(e=a.length;d<e;d++)(b=this.redraw_node(a[d],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&c.appendChild(b);this._model.force_full_redraw&&(c.className=this.get_container_ul()[0].className,c.setAttribute("role","group"),this.element.empty().append(c));null!==k&&((b=this.get_node(k,!0))&&b.length&&b.children(".jstree-anchor")[0]!==document.activeElement?b.children(".jstree-anchor").focus():this._data.core.focused=
null);this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:a})},redraw:function(a){a&&(this._model.force_full_redraw=!0);this._redraw()},draw_children:function(a){var c=this.get_node(a),b,d,e;b=document;if(!c)return!1;if("#"===c.id)return this.redraw(!0);a=this.get_node(a,!0);if(!a||!a.length)return!1;a.children(".jstree-children").remove();a=a[0];if(c.children.length&&c.state.loaded){e=b.createElement("UL");e.setAttribute("role","group");e.className="jstree-children";
b=0;for(d=c.children.length;b<d;b++)e.appendChild(this.redraw_node(c.children[b],!0,!0));a.appendChild(e)}},redraw_node:function(a,c,b,f){var e=this.get_node(a),k=!1,g=!1,t=!1,m=!1,r=!1,n=!1,h="",l=document,n=this._model.data,p=!1,q=null,B=h=0;if(!e)return!1;if("#"===e.id)return this.redraw(!0);c=c||0===e.children.length;if(a=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(e.id[0])?"\\3"+e.id[0]+" "+e.id.substr(1).replace(d.jstree.idregex,"\\$&"):e.id.replace(d.jstree.idregex,
"\\$&"))):document.getElementById(e.id))a=d(a),b||(k=a.parent().parent()[0],k===this.element[0]&&(k=null),g=a.index()),c||!e.children.length||a.children(".jstree-children").length||(c=!0),c||(t=a.children(".jstree-children")[0]),p=a.children(".jstree-anchor")[0]===document.activeElement,a.remove();else if(c=!0,!b){k="#"!==e.parent?d("#"+e.parent.replace(d.jstree.idregex,"\\$&"),this.element)[0]:null;if(!(null===k||k&&n[e.parent].state.opened))return!1;g=d.inArray(e.id,null===k?n["#"].children:n[e.parent].children)}a=
D.cloneNode(!0);h="jstree-node ";for(m in e.li_attr)e.li_attr.hasOwnProperty(m)&&"id"!==m&&("class"!==m?a.setAttribute(m,e.li_attr[m]):h+=e.li_attr[m]);e.a_attr.id||(e.a_attr.id=e.id+"_anchor");a.setAttribute("aria-selected",!!e.state.selected);a.setAttribute("aria-level",e.parents.length);a.setAttribute("aria-labelledby",e.a_attr.id);e.state.disabled&&a.setAttribute("aria-disabled",!0);e.state.loaded&&!e.children.length?h+=" jstree-leaf":(h+=e.state.opened&&e.state.loaded?" jstree-open":" jstree-closed",
a.setAttribute("aria-expanded",e.state.opened&&e.state.loaded));null!==e.parent&&n[e.parent].children[n[e.parent].children.length-1]===e.id&&(h+=" jstree-last");a.id=e.id;a.className=h;h=(e.state.selected?" jstree-clicked":"")+(e.state.disabled?" jstree-disabled":"");for(r in e.a_attr)!e.a_attr.hasOwnProperty(r)||"href"===r&&"#"===e.a_attr[r]||("class"!==r?a.childNodes[1].setAttribute(r,e.a_attr[r]):h+=" "+e.a_attr[r]);h.length&&(a.childNodes[1].className="jstree-anchor "+h);if(e.icon&&!0!==e.icon||
!1===e.icon)!1===e.icon?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===e.icon.indexOf("/")&&-1===e.icon.indexOf(".")?a.childNodes[1].childNodes[0].className+=" "+e.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage="url("+e.icon+")",a.childNodes[1].childNodes[0].style.backgroundPosition="center center",a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom");this.settings.core.force_text?
a.childNodes[1].appendChild(l.createTextNode(e.text)):a.childNodes[1].innerHTML+=e.text;if(c&&e.children.length&&(e.state.opened||f)&&e.state.loaded){n=l.createElement("UL");n.setAttribute("role","group");n.className="jstree-children";m=0;for(r=e.children.length;m<r;m++)n.appendChild(this.redraw_node(e.children[m],c,!0));a.appendChild(n)}t&&a.appendChild(t);if(!b){k||(k=this.element[0]);m=0;for(r=k.childNodes.length;m<r;m++)if(k.childNodes[m]&&k.childNodes[m].className&&-1!==k.childNodes[m].className.indexOf("jstree-children")){q=
k.childNodes[m];break}q||(q=l.createElement("UL"),q.setAttribute("role","group"),q.className="jstree-children",k.appendChild(q));k=q;g<k.childNodes.length?k.insertBefore(a,k.childNodes[g]):k.appendChild(a);p&&(h=this.element[0].scrollTop,B=this.element[0].scrollLeft,a.childNodes[1].focus(),this.element[0].scrollTop=h,this.element[0].scrollLeft=B)}e.state.opened&&!e.state.loaded&&(e.state.opened=!1,setTimeout(d.proxy(function(){this.open_node(e.id,!1,0)},this),0));return a},open_node:function(a,c,
b){var f,e,k;if(d.isArray(a)){a=a.slice();f=0;for(e=a.length;f<e;f++)this.open_node(a[f],c,b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;b=b===u?this.settings.core.animation:b;if(!this.is_closed(a))return c&&c.call(this,a,!1),!1;if(this.is_loaded(a))f=this.get_node(a,!0),k=this,f.length&&(b&&f.children(".jstree-children").length&&f.children(".jstree-children").stop(!0,!0),a.children.length&&!this._firstChild(f.children(".jstree-children")[0])&&this.draw_children(a),b?(this.trigger("before_open",
{node:a}),f.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(b,function(){this.style.display="";k.trigger("after_open",{node:a})})):(this.trigger("before_open",{node:a}),f[0].className=f[0].className.replace("jstree-closed","jstree-open"),f[0].setAttribute("aria-expanded",!0))),a.state.opened=!0,c&&c.call(this,a,!0),f.length||this.trigger("before_open",{node:a}),
this.trigger("open_node",{node:a}),b&&f.length||this.trigger("after_open",{node:a});else{if(this.is_loading(a))return setTimeout(d.proxy(function(){this.open_node(a,c,b)},this),500);this.load_node(a,function(a,e){return e?this.open_node(a,c,b):c?c.call(this,a,!1):!1})}},_open_to:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var c,b,f=a.parents;c=0;for(b=f.length;c<b;c+=1)"#"!==c&&this.open_node(f[c],!1,0);return d("#"+a.id.replace(d.jstree.idregex,"\\$&"),this.element)},close_node:function(a,
c){var b,f,e,k;if(d.isArray(a)){a=a.slice();b=0;for(f=a.length;b<f;b++)this.close_node(a[b],c);return!0}a=this.get_node(a);if(!a||"#"===a.id||this.is_closed(a))return!1;c=c===u?this.settings.core.animation:c;e=this;k=this.get_node(a,!0);k.length&&(c?k.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(c,function(){this.style.display="";k.children(".jstree-children").remove();
e.trigger("after_close",{node:a})}):(k[0].className=k[0].className.replace("jstree-open","jstree-closed"),k.attr("aria-expanded",!1).children(".jstree-children").remove()));a.state.opened=!1;this.trigger("close_node",{node:a});c&&k.length||this.trigger("after_close",{node:a})},toggle_node:function(a){var c,b;if(d.isArray(a)){a=a.slice();c=0;for(b=a.length;c<b;c++)this.toggle_node(a[c]);return!0}if(this.is_closed(a))return this.open_node(a);if(this.is_open(a))return this.close_node(a)},open_all:function(a,
c,b){a||(a="#");a=this.get_node(a);if(!a)return!1;var d="#"===a.id?this.get_container_ul():this.get_node(a,!0),e,k;if(!d.length){d=0;for(e=a.children_d.length;d<e;d++)this.is_closed(this._model.data[a.children_d[d]])&&(this._model.data[a.children_d[d]].state.opened=!0);return this.trigger("open_all",{node:a})}b=b||d;k=this;d=this.is_closed(a)?d.find(".jstree-closed").addBack():d.find(".jstree-closed");d.each(function(){k.open_node(this,function(a,e){e&&this.is_parent(a)&&this.open_all(a,c,b)},c||
0)});0===b.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(b)})},close_all:function(a,c){a||(a="#");a=this.get_node(a);if(!a)return!1;var b="#"===a.id?this.get_container_ul():this.get_node(a,!0),f=this,e;if(!b.length){b=0;for(e=a.children_d.length;b<e;b++)this._model.data[a.children_d[b]].state.opened=!1;return this.trigger("close_all",{node:a})}b=this.is_open(a)?b.find(".jstree-open").addBack():b.find(".jstree-open");d(b.get().reverse()).each(function(){f.close_node(this,
c||0)});this.trigger("close_all",{node:a})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(a){var c,b;if(d.isArray(a)){a=a.slice();c=0;for(b=a.length;c<b;c++)this.enable_node(a[c]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!1;this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1);this.trigger("enable_node",{node:a})},disable_node:function(a){var c,b;if(d.isArray(a)){a=
a.slice();c=0;for(b=a.length;c<b;c++)this.disable_node(a[c]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!0;this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0);this.trigger("disable_node",{node:a})},activate_node:function(a,c){if(this.is_disabled(a))return!1;this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==u?this.get_node(this._data.core.last_clicked.id):null;this._data.core.last_clicked&&
!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null);!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&(!c.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(c.shiftKey){var b=this.get_node(a).id,d=this._data.core.last_clicked.id,
e=this.get_node(this._data.core.last_clicked.parent).children,k=!1,g,t;g=0;for(t=e.length;g<t;g+=1)e[g]===b&&(k=!k),e[g]===d&&(k=!k),k||e[g]===b||e[g]===d?this.select_node(e[g],!0,!1,c):this.deselect_node(e[g],!0,c);this.trigger("changed",{action:"select_node",node:this.get_node(a),selected:this._data.core.selected,event:c})}else this.is_selected(a)?this.deselect_node(a,!1,c):this.select_node(a,!1,!1,c);else!this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&this.is_selected(a)?this.deselect_node(a,
!1,c):(this.deselect_all(!0),this.select_node(a,!1,!1,c),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a)})},hover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||a.children(".jstree-hovered").length)return!1;var c=this.element.find(".jstree-hovered"),b=this.element;c&&c.length&&this.dehover_node(c);a.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(a)});setTimeout(function(){b.attr("aria-activedescendant",
a[0].id)},0)},dehover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||!a.children(".jstree-hovered").length)return!1;a.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(a)})},select_node:function(a,c,b,f){var e,k;if(d.isArray(a)){a=a.slice();e=0;for(k=a.length;e<k;e++)this.select_node(a[e],c,b,f);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;e=this.get_node(a,!0);a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),
b||(e=this._open_to(a)),e&&e.length&&e.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:f}),c||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:f}))},deselect_node:function(a,c,b){var f,e;if(d.isArray(a)){a=a.slice();f=0;for(e=a.length;f<e;f++)this.deselect_node(a[f],c,b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;f=this.get_node(a,!0);a.state.selected&&
(a.state.selected=!1,this._data.core.selected=d.vakata.array_remove_item(this._data.core.selected,a.id),f.length&&f.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:b}),c||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:b}))},select_all:function(a){var c=this._data.core.selected.concat([]),b,d;this._data.core.selected=this._model.data["#"].children_d.concat();
b=0;for(d=this._data.core.selected.length;b<d;b++)this._model.data[this._data.core.selected[b]]&&(this._model.data[this._data.core.selected[b]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:c})},deselect_all:function(a){var c=this._data.core.selected.concat([]),b,d;b=0;for(d=this._data.core.selected.length;b<d;b++)this._model.data[this._data.core.selected[b]]&&
(this._model.data[this._data.core.selected[b]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1);this.trigger("deselect_all",{selected:this._data.core.selected,node:c});a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:c})},is_selected:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.state.selected:!1},get_selected:function(a){return a?d.map(this._data.core.selected,
d.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(a){var c=this.get_selected(!0),b={},f,e,k,g;f=0;for(e=c.length;f<e;f++)b[c[f].id]=c[f];f=0;for(e=c.length;f<e;f++)for(k=0,g=c[f].children_d.length;k<g;k++)b[c[f].children_d[k]]&&delete b[c[f].children_d[k]];c=[];for(f in b)b.hasOwnProperty(f)&&c.push(f);return a?d.map(c,d.proxy(function(a){return this.get_node(a)},this)):c},get_bottom_selected:function(a){var c=this.get_selected(!0),b=[],
f,e;f=0;for(e=c.length;f<e;f++)c[f].children.length||b.push(c[f].id);return a?d.map(b,d.proxy(function(a){return this.get_node(a)},this)):b},get_state:function(){var a={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},c;for(c in this._model.data)this._model.data.hasOwnProperty(c)&&"#"!==c&&(this._model.data[c].state.opened&&a.core.open.push(c),this._model.data[c].state.selected&&a.core.selected.push(c));return a},set_state:function(a,c){if(a){if(a.core){var b,
f,e,k;if(a.core.open){if(!d.isArray(a.core.open))return delete a.core.open,this.set_state(a,c),!1;b=!0;f=!1;e=this;d.each(a.core.open.concat([]),function(g,k){if(f=e.get_node(k))e.is_loaded(k)?(e.is_closed(k)&&e.open_node(k,!1,0),a&&a.core&&a.core.open&&d.vakata.array_remove_item(a.core.open,k)):(e.is_loading(k)||e.open_node(k,d.proxy(function(b,e){!e&&a&&a.core&&a.core.open&&d.vakata.array_remove_item(a.core.open,b.id);this.set_state(a,c)},e),0),b=!1)});b&&(delete a.core.open,this.set_state(a,c));
return!1}if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==u&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==u&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,c),!1;if(a.core.selected)return k=this,this.deselect_all(),d.each(a.core.selected,function(a,b){k.select_node(b)}),delete a.core.selected,this.set_state(a,c),!1;if(d.isEmptyObject(a.core))return delete a.core,this.set_state(a,c),!1}return d.isEmptyObject(a)?(a=null,c&&
c.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a,c){this._data.core.state=!0===c?{}:this.get_state();c&&d.isFunction(c)&&(this._data.core.state=c.call(this,this._data.core.state));this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var b=this.get_container_ul()[0].className;a||(this.element.html("<ul class='"+b+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+
this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"));this.load_node("#",function(a,e){e&&(this.get_container_ul()[0].className=b,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(d.extend(!0,
{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var c=[],b=[];this._data.core.selected.concat([]);b.push(a.id);!0===a.state.opened&&c.push(a.id);this.get_node(a,!0).find(".jstree-open").each(function(){c.push(this.id)});this._load_nodes(b,d.proxy(function(b){this.open_node(c,!1,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:a,nodes:b})},this))},set_id:function(a,
c){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b,f,e=this._model.data;c=c.toString();e[a.parent].children[d.inArray(a.id,e[a.parent].children)]=c;b=0;for(f=a.parents.length;b<f;b++)e[a.parents[b]].children_d[d.inArray(a.id,e[a.parents[b]].children_d)]=c;b=0;for(f=a.children.length;b<f;b++)e[a.children[b]].parent=c;b=0;for(f=a.children_d.length;b<f;b++)e[a.children_d[b]].parents[d.inArray(a.id,e[a.children_d[b]].parents)]=c;b=d.inArray(a.id,this._data.core.selected);-1!==b&&(this._data.core.selected[b]=
c);(b=this.get_node(a.id,!0))&&b.attr("id",c);delete e[a.id];a.id=c;e[c]=a;return!0},get_text:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.text:!1},set_text:function(a,c){var b,f;if(d.isArray(a)){a=a.slice();b=0;for(f=a.length;b<f;b++)this.set_text(a[b],c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.text=c;this.get_node(a,!0).length&&this.redraw_node(a.id);this.trigger("set_text",{obj:a,text:c});return!0},get_json:function(a,c,b){a=this.get_node(a||"#");if(!a)return!1;c&&c.flat&&
!b&&(b=[]);var f={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:d.extend(!0,{},a.li_attr),a_attr:d.extend(!0,{},a.a_attr),state:{},data:c&&c.no_data?!1:d.extend(!0,{},a.data)},e,k;c&&c.flat?f.parent=a.parent:f.children=[];if(!c||!c.no_state)for(e in a.state)a.state.hasOwnProperty(e)&&(f.state[e]=a.state[e]);c&&c.no_id&&(delete f.id,f.li_attr&&f.li_attr.id&&delete f.li_attr.id,f.a_attr&&f.a_attr.id&&delete f.a_attr.id);c&&c.flat&&"#"!==a.id&&b.push(f);if(!c||!c.no_children)for(e=0,k=a.children.length;e<
k;e++)c&&c.flat?this.get_json(a.children[e],c,b):f.children.push(this.get_json(a.children[e],c));return c&&c.flat?b:"#"===a.id?f.children:f},create_node:function(a,c,b,f,e){null===a&&(a="#");a=this.get_node(a);if(!a)return!1;b=b===u?"last":b;if(!b.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(a))return this.load_node(a,function(){this.create_node(a,c,b,f,!0)});c||(c={text:this.get_string("New node")});"string"===typeof c&&(c={text:c});c.text===u&&(c.text=this.get_string("New node"));var k,
g,t;"#"===a.id&&("before"===b&&(b="first"),"after"===b&&(b="last"));switch(b){case "before":e=this.get_node(a.parent);b=d.inArray(a.id,e.children);a=e;break;case "after":e=this.get_node(a.parent);b=d.inArray(a.id,e.children)+1;a=e;break;case "inside":case "first":b=0;break;case "last":b=a.children.length;break;default:b||(b=0)}b>a.children.length&&(b=a.children.length);c.id||(c.id=!0);if(!this.check("create_node",c,a,b))return this.settings.core.error.call(this,this._data.core.last_error),!1;!0===
c.id&&delete c.id;c=this._parse_model_from_json(c,a.id,a.parents.concat());if(!c)return!1;e=this.get_node(c);k=[];k.push(c);k=k.concat(e.children_d);this.trigger("model",{nodes:k,parent:a.id});a.children_d=a.children_d.concat(k);g=0;for(t=a.parents.length;g<t;g++)this._model.data[a.parents[g]].children_d=this._model.data[a.parents[g]].children_d.concat(k);c=e;e=[];g=0;for(t=a.children.length;g<t;g++)e[g>=b?g+1:g]=a.children[g];e[b]=c.id;a.children=e;this.redraw_node(a,!0);f&&f.call(this,this.get_node(c));
this.trigger("create_node",{node:this.get_node(c),parent:a.id,position:b});return c.id},rename_node:function(a,c){var b,f;if(d.isArray(a)){a=a.slice();b=0;for(f=a.length;b<f;b++)this.rename_node(a[b],c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;b=a.text;if(!this.check("rename_node",a,this.get_parent(a),c))return this.settings.core.error.call(this,this._data.core.last_error),!1;this.set_text(a,c);this.trigger("rename_node",{node:a,text:c,old:b});return!0},delete_node:function(a){var c,
b,f,e,k,g,t,m;if(d.isArray(a)){a=a.slice();c=0;for(b=a.length;c<b;c++)this.delete_node(a[c]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=this.get_node(a.parent);b=d.inArray(a.id,c.children);m=!1;if(!this.check("delete_node",a,c,b))return this.settings.core.error.call(this,this._data.core.last_error),!1;-1!==b&&(c.children=d.vakata.array_remove(c.children,b));f=a.children_d.concat([]);f.push(a.id);g=0;for(t=f.length;g<t;g++){e=0;for(k=a.parents.length;e<k;e++)b=d.inArray(f[g],this._model.data[a.parents[e]].children_d),
-1!==b&&(this._model.data[a.parents[e]].children_d=d.vakata.array_remove(this._model.data[a.parents[e]].children_d,b));this._model.data[f[g]].state.selected&&(m=!0,b=d.inArray(f[g],this._data.core.selected),-1!==b&&(this._data.core.selected=d.vakata.array_remove(this._data.core.selected,b)))}this.trigger("delete_node",{node:a,parent:c.id});m&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:c.id});g=0;for(t=f.length;g<t;g++)delete this._model.data[f[g]];
this.redraw_node(c,!0);return!0},check:function(a,c,b,f,e){c=c&&c.id?c:this.get_node(c);b=b&&b.id?b:this.get_node(b);var k=a.match(/^move_node|copy_node|create_node$/i)?b:c,g=this.settings.core.check_callback;if(!("move_node"!==a&&"copy_node"!==a||e&&e.is_multi||c.id!==b.id&&d.inArray(c.id,b.children)!==f&&-1===d.inArray(b.id,c.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,pos:f,obj:c&&c.id?c.id:
!1,par:b&&b.id?b.id:!1})},!1;k&&k.data&&(k=k.data);return k&&k.functions&&(!1===k.functions[a]||!0===k.functions[a])?(!1===k.functions[a]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:f,obj:c&&c.id?c.id:!1,par:b&&b.id?b.id:!1})}),k.functions[a]):!1===g||d.isFunction(g)&&!1===g.call(this,a,c,b,f,e)||g&&!1===g[a]?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+
a,data:JSON.stringify({chk:a,pos:f,obj:c&&c.id?c.id:!1,par:b&&b.id?b.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(a,c,b,f,e,k){var g,t,m,r,n,h,l,p,q,B;c=this.get_node(c);b=b===u?0:b;if(!c)return!1;if(!b.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(c))return this.load_node(c,function(){this.move_node(a,c,b,f,!0)});if(d.isArray(a)){a=a.slice();k=0;for(g=a.length;k<g;k++)this.move_node(a[k],c,b,f,e,!0)&&(c=a[k],b="after");this.redraw();return!0}a=
a&&a.id?a:this.get_node(a);if(!a||"#"===a.id)return!1;g=(a.parent||"#").toString();m=b.toString().match(/^(before|after)$/)&&"#"!==c.id?this.get_node(c.parent):c;r=a.instance?a.instance:this._model.data[a.id]?this:d.jstree.reference(a.id);n=!r||!r._id||this._id!==r._id;t=r&&r._id&&g&&r._model.data[g]&&r._model.data[g].children?d.inArray(a.id,r._model.data[g].children):-1;if(n)return this.copy_node(a,c,b,f,e)?(r&&r.delete_node(a),!0):!1;"#"===c.id&&("before"===b&&(b="first"),"after"===b&&(b="last"));
switch(b){case "before":b=d.inArray(c.id,m.children);break;case "after":b=d.inArray(c.id,m.children)+1;break;case "inside":case "first":b=0;break;case "last":b=m.children.length;break;default:b||(b=0)}b>m.children.length&&(b=m.children.length);if(!this.check("move_node",a,m,b,{core:!0,is_multi:r&&r._id&&r._id!==this._id,is_foreign:!r||!r._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===m.id){e=m.children.concat();n=d.inArray(a.id,e);-1!==n&&(e=d.vakata.array_remove(e,
n),b>n&&b--);n=[];h=0;for(l=e.length;h<l;h++)n[h>=b?h+1:h]=e[h];n[b]=a.id;m.children=n;this._node_changed(m.id);this.redraw("#"===m.id)}else{n=a.children_d.concat();n.push(a.id);h=0;for(l=a.parents.length;h<l;h++){e=[];B=r._model.data[a.parents[h]].children_d;p=0;for(q=B.length;p<q;p++)-1===d.inArray(B[p],n)&&e.push(B[p]);r._model.data[a.parents[h]].children_d=e}r._model.data[g].children=d.vakata.array_remove_item(r._model.data[g].children,a.id);h=0;for(l=m.parents.length;h<l;h++)this._model.data[m.parents[h]].children_d=
this._model.data[m.parents[h]].children_d.concat(n);e=[];h=0;for(l=m.children.length;h<l;h++)e[h>=b?h+1:h]=m.children[h];e[b]=a.id;m.children=e;m.children_d.push(a.id);m.children_d=m.children_d.concat(a.children_d);a.parent=m.id;n=m.parents.concat();n.unshift(m.id);B=a.parents.length;a.parents=n;n=n.concat();h=0;for(l=a.children_d.length;h<l;h++)this._model.data[a.children_d[h]].parents=this._model.data[a.children_d[h]].parents.slice(0,-1*B),Array.prototype.push.apply(this._model.data[a.children_d[h]].parents,
n);if("#"===g||"#"===m.id)this._model.force_full_redraw=!0;this._model.force_full_redraw||(this._node_changed(g),this._node_changed(m.id));k||this.redraw()}f&&f.call(this,a,m,b);this.trigger("move_node",{node:a,parent:m.id,position:b,old_parent:g,old_position:t,is_multi:r&&r._id&&r._id!==this._id,is_foreign:!r||!r._id,old_instance:r,new_instance:this});return!0},copy_node:function(a,c,b,f,e,k){var g,t,m,h,n,l;c=this.get_node(c);b=b===u?0:b;if(!c)return!1;if(!b.toString().match(/^(before|after)$/)&&
!e&&!this.is_loaded(c))return this.load_node(c,function(){this.copy_node(a,c,b,f,!0)});if(d.isArray(a)){a=a.slice();k=0;for(g=a.length;k<g;k++)if(t=this.copy_node(a[k],c,b,f,e,!0))c=t,b="after";this.redraw();return!0}a=a&&a.id?a:this.get_node(a);if(!a||"#"===a.id)return!1;g=(a.parent||"#").toString();n=b.toString().match(/^(before|after)$/)&&"#"!==c.id?this.get_node(c.parent):c;l=a.instance?a.instance:this._model.data[a.id]?this:d.jstree.reference(a.id);"#"===c.id&&("before"===b&&(b="first"),"after"===
b&&(b="last"));switch(b){case "before":b=d.inArray(c.id,n.children);break;case "after":b=d.inArray(c.id,n.children)+1;break;case "inside":case "first":b=0;break;case "last":b=n.children.length;break;default:b||(b=0)}b>n.children.length&&(b=n.children.length);if(!this.check("copy_node",a,n,b,{core:!0,is_multi:l&&l._id&&l._id!==this._id,is_foreign:!l||!l._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;m=l?l.get_json(a,{no_id:!0,no_data:!0,no_state:!0}):a;if(!m)return!1;
!0===m.id&&delete m.id;m=this._parse_model_from_json(m,n.id,n.parents.concat());if(!m)return!1;t=this.get_node(m);a&&a.state&&!1===a.state.loaded&&(t.state.loaded=!1);e=[];e.push(m);e=e.concat(t.children_d);this.trigger("model",{nodes:e,parent:n.id});m=0;for(h=n.parents.length;m<h;m++)this._model.data[n.parents[m]].children_d=this._model.data[n.parents[m]].children_d.concat(e);e=[];m=0;for(h=n.children.length;m<h;m++)e[m>=b?m+1:m]=n.children[m];e[b]=t.id;n.children=e;n.children_d.push(t.id);n.children_d=
n.children_d.concat(t.children_d);"#"===n.id&&(this._model.force_full_redraw=!0);this._model.force_full_redraw||this._node_changed(n.id);k||this.redraw("#"===n.id);f&&f.call(this,t,n,b);this.trigger("copy_node",{node:t,original:a,parent:n.id,position:b,old_parent:g,old_position:l&&l._id&&g&&l._model.data[g]&&l._model.data[g].children?d.inArray(a.id,l._model.data[g].children):-1,is_multi:l&&l._id&&l._id!==this._id,is_foreign:!l||!l._id,old_instance:l,new_instance:this});return t.id},cut:function(a){a||
(a=this._data.core.selected.concat());d.isArray(a)||(a=[a]);if(!a.length)return!1;var c=[],b,f,e;f=0;for(e=a.length;f<e;f++)(b=this.get_node(a[f]))&&b.id&&"#"!==b.id&&c.push(b);if(!c.length)return!1;h=c;p=this;l="move_node";this.trigger("cut",{node:a})},copy:function(a){a||(a=this._data.core.selected.concat());d.isArray(a)||(a=[a]);if(!a.length)return!1;var c=[],b,f,e;f=0;for(e=a.length;f<e;f++)(b=this.get_node(a[f]))&&b.id&&"#"!==b.id&&c.push(b);if(!c.length)return!1;h=c;p=this;l="copy_node";this.trigger("copy",
{node:a})},get_buffer:function(){return{mode:l,node:h,inst:p}},can_paste:function(){return!1!==l&&!1!==h},paste:function(a,c){a=this.get_node(a);if(!(a&&l&&l.match(/^(copy_node|move_node)$/)&&h))return!1;this[l](h,a,c)&&this.trigger("paste",{parent:a.id,node:h,mode:l});p=l=h=!1},clear_buffer:function(){p=l=h=!1;this.trigger("clear_buffer")},edit:function(a,c){a=this.get_node(a);if(!a)return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",
id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;c="string"===typeof c?c:a.text;this.set_text(a,"");a=this._open_to(a);var b=this._data.core.rtl,f=this.element.width(),e=a.children(".jstree-anchor"),k=d("<span>"),g=c,h=d("<div />",{css:{position:"absolute",top:"-200px",left:b?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),m=d("<input />",{value:g,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver",
"box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:d.proxy(function(){var b=k.children(".jstree-rename-input").val();""===b&&(b=g);h.remove();k.replaceWith(e);k.remove();this.set_text(a,g);!1===this.rename_node(a,d("<div></div>").text(b)[this.settings.core.force_text?"text":"html"]())&&this.set_text(a,g)},this),keydown:function(a){var b=a.which;27===b&&(this.value=g);27!==b&&13!==b&&37!==b&&38!==b&&39!==
b&&40!==b&&32!==b||a.stopImmediatePropagation();if(27===b||13===b)a.preventDefault(),this.blur()},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){m.width(Math.min(h.text("pW"+this.value).width(),f))},keypress:function(a){if(13===a.which)return!1}}),b={fontFamily:e.css("fontFamily")||"",fontSize:e.css("fontSize")||"",fontWeight:e.css("fontWeight")||"",fontStyle:e.css("fontStyle")||"",fontStretch:e.css("fontStretch")||"",fontVariant:e.css("fontVariant")||
"",letterSpacing:e.css("letterSpacing")||"",wordSpacing:e.css("wordSpacing")||""};k.attr("class",e.attr("class")).append(e.contents().clone()).append(m);e.replaceWith(k);h.css(b);m.css(b).width(Math.min(h.text("pW"+m[0].value).width(),f))[0].select()},set_theme:function(a,c){if(!a)return!1;if(!0===c){var b=this.settings.core.themes.dir;b||(b=d.jstree.path+"/themes");c=b+"/"+a+"/style.css"}c&&-1===d.inArray(c,v)&&(d("head").append('<link rel="stylesheet" href="'+c+'" type="text/css" />'),v.push(c));
this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=a;this.element.addClass("jstree-"+a);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive");this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);
(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():
this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons")},
toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(a,c){var b,f;if(d.isArray(a)){a=a.slice();b=0;for(f=a.length;b<f;b++)this.set_icon(a[b],c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;f=a.icon;a.icon=c;b=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon");!1===c?this.hide_icon(a):(!0===c?b.removeClass("jstree-themeicon-custom "+f).css("background","").removeAttr("rel"):-1===c.indexOf("/")&&-1===c.indexOf(".")?
(b.removeClass(f).css("background",""),b.addClass(c+" jstree-themeicon-custom").attr("rel",c)):(b.removeClass(f).css("background",""),b.addClass("jstree-themeicon-custom").css("background","url('"+c+"') center center no-repeat").attr("rel",c)),!1===f&&this.show_icon(a));return!0},get_icon:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.icon:!1},hide_icon:function(a){var c,b;if(d.isArray(a)){a=a.slice();c=0;for(b=a.length;c<b;c++)this.hide_icon(a[c]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;
a.icon=!1;this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return!0},show_icon:function(a){var c,b;if(d.isArray(a)){a=a.slice();c=0;for(b=a.length;c<b;c++)this.show_icon(a[c]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;c=this.get_node(a,!0);a.icon=c.length?c.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0;a.icon||(a.icon=!0);c.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");
return!0}};d.vakata={};d.vakata.attributes=function(a,c){a=d(a)[0];var b=c?{}:[];a&&a.attributes&&d.each(a.attributes,function(a,e){-1===d.inArray(e.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==e.value&&""!==d.trim(e.value)&&(c?b[e.name]=e.value:b.push(e.name))});return b};d.vakata.array_unique=function(a){var c=[],b,d,e;b=0;for(e=a.length;b<e;b++){for(d=0;d<=b&&a[b]!==a[d];d++);d===b&&c.push(a[b])}return c};d.vakata.array_remove=function(a,c,b){b=a.slice((b||c)+1||
a.length);a.length=0>c?a.length+c:c;a.push.apply(a,b);return a};d.vakata.array_remove_item=function(a,c){var b=d.inArray(c,a);return-1!==b?d.vakata.array_remove(a,b):a};var A=document.createElement("I");A.className="jstree-icon jstree-checkbox";A.setAttribute("role","presentation");d.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0};d.jstree.plugins.checkbox=function(a,c){this.bind=function(){c.bind.call(this);this._data.checkbox.uto=
!1;this._data.checkbox.selected=[];this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",d.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked");this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",d.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":
"hide_checkboxes"]()},this));if(-1!==this.settings.checkbox.cascade.indexOf("undetermined"))this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",d.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(d.proxy(this._undetermined,this),50)},this));if(!this.settings.checkbox.tie_selection)this.element.on("model.jstree",d.proxy(function(a,
c){var b=this._model.data,d=c.nodes,f,h;f=0;for(h=d.length;f<h;f++)b[d[f]].state.checked=b[d[f]].original&&b[d[f]].original.state&&b[d[f]].original.state.checked,b[d[f]].state.checked&&this._data.checkbox.selected.push(d[f])},this));if(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))this.element.on("model.jstree",d.proxy(function(a,c){var b=this._model.data,f=b[c.parent],g=c.nodes,h=[],m,r,n,l,p=this.settings.checkbox.cascade,q=this.settings.checkbox.tie_selection;
if(-1!==p.indexOf("down"))if(f.state[q?"selected":"checked"]){m=0;for(r=g.length;m<r;m++)b[g[m]].state[q?"selected":"checked"]=!0;this._data[q?"core":"checkbox"].selected=this._data[q?"core":"checkbox"].selected.concat(g)}else for(m=0,r=g.length;m<r;m++)if(b[g[m]].state[q?"selected":"checked"]){n=0;for(l=b[g[m]].children_d.length;n<l;n++)b[b[g[m]].children_d[n]].state[q?"selected":"checked"]=!0;this._data[q?"core":"checkbox"].selected=this._data[q?"core":"checkbox"].selected.concat(b[g[m]].children_d)}if(-1!==
p.indexOf("up")){m=0;for(r=f.children_d.length;m<r;m++)b[f.children_d[m]].children.length||h.push(b[f.children_d[m]].parent);h=d.vakata.array_unique(h);n=0;for(l=h.length;n<l;n++)for(f=b[h[n]];f&&"#"!==f.id;){m=g=0;for(r=f.children.length;m<r;m++)g+=b[f.children[m]].state[q?"selected":"checked"];if(g===r)f.state[q?"selected":"checked"]=!0,this._data[q?"core":"checkbox"].selected.push(f.id),(m=this.get_node(f,!0))&&m.length&&m.attr("aria-selected",!0).children(".jstree-anchor").addClass(q?"jstree-clicked":
"jstree-checked");else break;f=this.get_node(f.parent)}}this._data[q?"core":"checkbox"].selected=d.vakata.array_unique(this._data[q?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",d.proxy(function(a,c){var b=c.node,f=this._model.data,g=this.get_node(b.parent),h=this.get_node(b,!0),m,r,n,l=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(-1!==l.indexOf("down"))for(this._data[p?"core":"checkbox"].selected=
d.vakata.array_unique(this._data[p?"core":"checkbox"].selected.concat(b.children_d)),m=0,r=b.children_d.length;m<r;m++)n=f[b.children_d[m]],n.state[p?"selected":"checked"]=!0,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(;g&&"#"!==g.id;){m=b=0;for(r=g.children.length;m<r;m++)b+=f[g.children[m]].state[p?"selected":"checked"];if(b===r)g.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(g.id),
(n=this.get_node(g,!0))&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked");else break;g=this.get_node(g.parent)}-1!==l.indexOf("down")&&h.length&&h.find(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",d.proxy(function(a,d){var b=this.get_node("#"),c=this._model.data,f,h,m;f=0;for(h=b.children_d.length;f<
h;f++)(m=c[b.children_d[f]])&&m.original&&m.original.state&&m.original.state.undetermined&&(m.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",d.proxy(function(a,c){var b=c.node,f=this.get_node(b,!0),g,h,m,r=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection;b&&b.original&&b.original.state&&b.original.state.undetermined&&(b.original.state.undetermined=!1);if(-1!==r.indexOf("down"))for(g=0,h=b.children_d.length;g<
h;g++)m=this._model.data[b.children_d[g]],m.state[n?"selected":"checked"]=!1,m&&m.original&&m.original.state&&m.original.state.undetermined&&(m.original.state.undetermined=!1);if(-1!==r.indexOf("up"))for(g=0,h=b.parents.length;g<h;g++)m=this._model.data[b.parents[g]],m.state[n?"selected":"checked"]=!1,m&&m.original&&m.original.state&&m.original.state.undetermined&&(m.original.state.undetermined=!1),(m=this.get_node(b.parents[g],!0))&&m.length&&m.attr("aria-selected",!1).children(".jstree-anchor").removeClass(n?
"jstree-clicked":"jstree-checked");m=[];g=0;for(h=this._data[n?"core":"checkbox"].selected.length;g<h;g++)-1!==r.indexOf("down")&&-1!==d.inArray(this._data[n?"core":"checkbox"].selected[g],b.children_d)||-1!==r.indexOf("up")&&-1!==d.inArray(this._data[n?"core":"checkbox"].selected[g],b.parents)||m.push(this._data[n?"core":"checkbox"].selected[g]);this._data[n?"core":"checkbox"].selected=d.vakata.array_unique(m);-1!==r.indexOf("down")&&f.length&&f.find(".jstree-anchor").removeClass(n?"jstree-clicked":
"jstree-checked").parent().attr("aria-selected",!1)},this));if(-1!==this.settings.checkbox.cascade.indexOf("up"))this.element.on("delete_node.jstree",d.proxy(function(a,c){for(var b=this.get_node(c.parent),d=this._model.data,f,h,m,r=this.settings.checkbox.tie_selection;b&&"#"!==b.id;){f=m=0;for(h=b.children.length;f<h;f++)m+=d[b.children[f]].state[r?"selected":"checked"];if(m===h)b.state[r?"selected":"checked"]=!0,this._data[r?"core":"checkbox"].selected.push(b.id),(f=this.get_node(b,!0))&&f.length&&
f.attr("aria-selected",!0).children(".jstree-anchor").addClass(r?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}},this)).on("move_node.jstree",d.proxy(function(a,c){var b=c.is_multi,f=c.old_parent,g=this.get_node(c.parent),h=this._model.data,m,r,n=this.settings.checkbox.tie_selection;if(!b)for(b=this.get_node(f);b&&"#"!==b.id;){m=f=0;for(r=b.children.length;m<r;m++)f+=h[b.children[m]].state[n?"selected":"checked"];if(f===r)b.state[n?"selected":"checked"]=!0,this._data[n?"core":
"checkbox"].selected.push(b.id),(f=this.get_node(b,!0))&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}for(b=g;b&&"#"!==b.id;){m=f=0;for(r=b.children.length;m<r;m++)f+=h[b.children[m]].state[n?"selected":"checked"];if(f===r)b.state[n?"selected":"checked"]||(b.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(b.id),(f=this.get_node(b,!0))&&f.length&&f.attr("aria-selected",
!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked"));else if(b.state[n?"selected":"checked"])b.state[n?"selected":"checked"]=!1,this._data[n?"core":"checkbox"].selected=d.vakata.array_remove_item(this._data[n?"core":"checkbox"].selected,b.id),(f=this.get_node(b,!0))&&f.length&&f.attr("aria-selected",!1).children(".jstree-anchor").removeClass(n?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}},this))};this._undetermined=function(){var a,c,e=this._model.data,
k=this.settings.checkbox.tie_selection,g=this._data[k?"core":"checkbox"].selected,h=[],m=this;a=0;for(c=g.length;a<c;a++)e[g[a]]&&e[g[a]].parents&&(h=h.concat(e[g[a]].parents));this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var b=m.get_node(this),d;if(b.state.loaded)for(a=0,c=b.children_d.length;a<c;a++)d=e[b.children_d[a]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined&&(h.push(d.id),h=h.concat(d.parents));
else b.original&&b.original.state&&b.original.state.undetermined&&!0===b.original.state.undetermined&&(h.push(b.id),h=h.concat(b.parents))});h=d.vakata.array_unique(h);h=d.vakata.array_remove_item(h,"#");this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");a=0;for(c=h.length;a<c;a++)e[h[a]].state[k?"selected":"checked"]||(g=this.get_node(h[a],!0))&&g.length&&g.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")};this.redraw_node=function(a,
f,e,k){if(a=c.redraw_node.apply(this,arguments)){var b,h,m=null;b=0;for(h=a.childNodes.length;b<h;b++)if(a.childNodes[b]&&a.childNodes[b].className&&-1!==a.childNodes[b].className.indexOf("jstree-anchor")){m=a.childNodes[b];break}m&&(!this.settings.checkbox.tie_selection&&this._model.data[a.id].state.checked&&(m.className+=" jstree-checked"),m.insertBefore(A.cloneNode(!1),m.childNodes[0]))}e||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),
this._data.checkbox.uto=setTimeout(d.proxy(this._undetermined,this),50));return a};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()};this.is_undetermined=function(a){a=this.get_node(a);
var b=this.settings.checkbox.cascade,c;c=this.settings.checkbox.tie_selection;var k=this._data[c?"core":"checkbox"].selected,g=this._model.data;if(!a||!0===a.state[c?"selected":"checked"]||-1===b.indexOf("undetermined")||-1===b.indexOf("down")&&-1===b.indexOf("up"))return!1;if(!a.state.loaded&&!0===a.original.state.undetermined)return!0;b=0;for(c=a.children_d.length;b<c;b++)if(-1!==d.inArray(a.children_d[b],k)||!g[a.children_d[b]].state.loaded&&g[a.children_d[b]].original.state.undetermined)return!0;
return!1};this.activate_node=function(a,f){this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||d(f.target).hasClass("jstree-checkbox"))&&(f.ctrlKey=!0);if(this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!d(f.target).hasClass("jstree-checkbox"))return c.activate_node.call(this,a,f);if(this.is_disabled(a))return!1;this.is_checked(a)?this.uncheck_node(a,f):this.check_node(a,f);this.trigger("activate_node",{node:this.get_node(a)})};this.check_node=function(a,
c){if(this.settings.checkbox.tie_selection)return this.select_node(a,!1,!0,c);var b,f;if(d.isArray(a)){a=a.slice();b=0;for(f=a.length;b<f;b++)this.check_node(a[b],c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;b=this.get_node(a,!0);a.state.checked||(a.state.checked=!0,this._data.checkbox.selected.push(a.id),b&&b.length&&b.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:a,selected:this._data.checkbox.selected,event:c}))};this.uncheck_node=function(a,
c){if(this.settings.checkbox.tie_selection)return this.deselect_node(a,!1,c);var b,f;if(d.isArray(a)){a=a.slice();b=0;for(f=a.length;b<f;b++)this.uncheck_node(a[b],c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;b=this.get_node(a,!0);a.state.checked&&(a.state.checked=!1,this._data.checkbox.selected=d.vakata.array_remove_item(this._data.checkbox.selected,a.id),b.length&&b.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:a,selected:this._data.checkbox.selected,
event:c}))};this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();this._data.checkbox.selected.concat([]);var a,c;this._data.checkbox.selected=this._model.data["#"].children_d.concat();a=0;for(c=this._data.checkbox.selected.length;a<c;a++)this._model.data[this._data.checkbox.selected[a]]&&(this._model.data[this._data.checkbox.selected[a]].state.checked=!0);this.redraw(!0);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();
var a=this._data.checkbox.selected.concat([]),c,d;c=0;for(d=this._data.checkbox.selected.length;c<d;c++)this._model.data[this._data.checkbox.selected[c]]&&(this._model.data[this._data.checkbox.selected[c]].state.checked=!1);this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:a})};this.is_checked=function(a){return this.settings.checkbox.tie_selection?this.is_selected(a):(a=this.get_node(a))&&
"#"!==a.id?a.state.checked:!1};this.get_checked=function(a){return this.settings.checkbox.tie_selection?this.get_selected(a):a?d.map(this._data.checkbox.selected,d.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected};this.get_top_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_top_selected(a);var b=this.get_checked(!0),c={},k,g,h,m;k=0;for(g=b.length;k<g;k++)c[b[k].id]=b[k];k=0;for(g=b.length;k<g;k++)for(h=0,m=b[k].children_d.length;h<m;h++)c[b[k].children_d[h]]&&
delete c[b[k].children_d[h]];b=[];for(k in c)c.hasOwnProperty(k)&&b.push(k);return a?d.map(b,d.proxy(function(a){return this.get_node(a)},this)):b};this.get_bottom_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(a);var b=this.get_checked(!0),c=[],k,g;k=0;for(g=b.length;k<g;k++)b[k].children.length||c.push(b[k].id);return a?d.map(c,d.proxy(function(a){return this.get_node(a)},this)):c};this.load_node=function(a,f){var b,k,g;if(!d.isArray(a)&&!this.settings.checkbox.tie_selection&&
(g=this.get_node(a))&&g.state.loaded)for(b=0,k=g.children_d.length;b<k;b++)this._model.data[g.children_d[b]].state.checked&&(this._data.checkbox.selected=d.vakata.array_remove_item(this._data.checkbox.selected,g.children_d[b]));return c.load_node.apply(this,arguments)};this.get_state=function(){var a=c.get_state.apply(this,arguments);if(this.settings.checkbox.tie_selection)return a;a.checkbox=this._data.checkbox.selected.slice();return a};this.set_state=function(a,f){var b=c.set_state.apply(this,
arguments);if(b&&a.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var k=this;d.each(a.checkbox,function(a,b){k.check_node(b)})}delete a.checkbox;return!1}return b}};var y=null,F,H;d.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,c){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.create_node(a,{},"last",function(a){setTimeout(function(){b.edit(a)},
0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.edit(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.delete_node(b.get_selected()):b.delete_node(a)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,
separator_after:!1,label:"Cut",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.cut(b.get_selected()):b.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.copy(b.get_selected()):b.copy(a)}},paste:{separator_before:!1,icon:!1,_disabled:function(a){return!d.jstree.reference(a.reference).can_paste()},separator_after:!1,label:"Paste",
action:function(a){var b=d.jstree.reference(a.reference);a=b.get_node(a.reference);b.paste(a)}}}}}}};d.jstree.plugins.contextmenu=function(a,c){this.bind=function(){c.bind.call(this);var a=0;this.element.on("contextmenu.jstree",".jstree-anchor",d.proxy(function(b,c){b.preventDefault();a=b.ctrlKey?+new Date:0;if(c||y)a=+new Date+1E4;y&&clearTimeout(y);this.is_loading(b.currentTarget)||this.show_contextmenu(b.currentTarget,b.pageX,b.pageY,b)},this)).on("click.jstree",".jstree-anchor",d.proxy(function(b){this._data.contextmenu.visible&&
(!a||250<+new Date-a)&&d.vakata.context.hide();a=0},this)).on("touchstart.jstree",".jstree-anchor",function(a){a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(F=a.pageX,H=a.pageY,y=setTimeout(function(){d(a.currentTarget).trigger("contextmenu",!0)},750))});d(document).on("context_hide.vakata.jstree",d.proxy(function(){this._data.contextmenu.visible=!1},this))};this.teardown=function(){this._data.contextmenu.visible&&d.vakata.context.hide();c.teardown.call(this)};
this.show_contextmenu=function(a,c,e,k){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b=this.settings.contextmenu,f=this.get_node(a,!0).children(".jstree-anchor"),h=!1,h=!1;if(b.show_at_node||c===u||e===u)h=f.offset(),c=h.left,e=h.top+this._data.core.li_height;this.settings.contextmenu.select_node&&!this.is_selected(a)&&this.activate_node(a,k);h=b.items;d.isFunction(h)&&(h=h.call(this,a,d.proxy(function(b){this._show_contextmenu(a,c,e,b)},this)));d.isPlainObject(h)&&this._show_contextmenu(a,c,
e,h)};this._show_contextmenu=function(a,c,e,k){var b=this.get_node(a,!0).children(".jstree-anchor");d(document).one("context_show.vakata.jstree",d.proxy(function(a,b){var c="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";d(b.element).addClass(c)},this));this._data.contextmenu.visible=!0;d.vakata.context.show(b,{x:c,y:e},k);this.trigger("show_contextmenu",{node:a,x:c,y:e})}};d(function(){d(document).on("touchmove.vakata.jstree",function(a){y&&a.originalEvent&&a.originalEvent.changedTouches&&
a.originalEvent.changedTouches[0]&&(50<Math.abs(F-a.pageX)||50<Math.abs(H-a.pageY))&&clearTimeout(y)}).on("touchend.vakata.jstree",function(a){y&&clearTimeout(y)})});(function(a){var c=!1,b=!1,d=!1,e=0,k=0,g=[],h="",m=!1;a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(c){a(document).triggerHandler("context_"+c+".vakata",{reference:d,element:b,position:{x:e,y:k}})},_execute:function(c){return(c=g[c])&&(!c._disabled||a.isFunction(c._disabled)&&!c._disabled({item:c,reference:d,
element:b}))&&c.action?c.action.call(null,{item:c,reference:d,element:b,position:{x:e,y:k}}):!1},_parse:function(c,e){if(!c)return!1;e||(h="",g=[]);var f="",k=!1,m;e&&(f+="<ul>");a.each(c,function(c,e){if(!e)return!0;g.push(e);!k&&e.separator_before&&(f+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>");k=!1;f+="<li class='"+(e._class||"")+(!0===e._disabled||a.isFunction(e._disabled)&&e._disabled({item:e,reference:d,
element:b})?" vakata-contextmenu-disabled ":"")+"' "+(e.shortcut?" data-shortcut='"+e.shortcut+"' ":"")+">";f+="<a href='#' rel='"+(g.length-1)+"'>";a.vakata.context.settings.icons&&(f+="<i ",e.icon&&(f=-1!==e.icon.indexOf("/")||-1!==e.icon.indexOf(".")?f+(" style='background:url(\""+e.icon+"\") center center no-repeat' "):f+(" class='"+e.icon+"' ")),f+="></i><span class='vakata-contextmenu-sep'>&#160;</span>");f+=(a.isFunction(e.label)?e.label({item:c,reference:d,element:b}):e.label)+(e.shortcut?
' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+e.shortcut+'">'+(e.shortcut_label||"")+"</span>":"")+"</a>";e.submenu&&(m=a.vakata.context._parse(e.submenu,!0))&&(f+=m);f+="</li>";e.separator_after&&(f+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",k=!0)});f=f.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");e&&(f+="</ul>");e||(h=f,a.vakata.context._trigger("parse"));return 10<
f.length?f:!1},_show_submenu:function(b){b=a(b);if(b.length&&b.children("ul").length){var d=b.children("ul"),e=b.offset().left+b.outerWidth(),f=b.offset().top,g=d.width(),k=d.height(),h=a(window).width()+a(window).scrollLeft(),m=a(window).height()+a(window).scrollTop();if(c)b[0>e-(g+10+b.outerWidth())?"addClass":"removeClass"]("vakata-context-left");else b[e+g+10>h?"addClass":"removeClass"]("vakata-context-right");f+k+10>m&&d.css("bottom","-1px");d.show()}},show:function(f,n,l){var t,r,p,q,v;b&&b.length&&
b.width("");switch(!0){case !n&&!f:return!1;case !!n&&!!f:d=f;e=n.x;k=n.y;break;case !n&&!!f:d=f;n=f.offset();e=n.left+f.outerHeight();k=n.top;break;case !!n&&!f:e=n.x,k=n.y}f&&!l&&a(f).data("vakata_contextmenu")&&(l=a(f).data("vakata_contextmenu"));a.vakata.context._parse(l)&&b.html(h);g.length&&(b.appendTo("body"),l=b,n=e,t=k,r=l.width(),p=l.height(),q=a(window).width()+a(window).scrollLeft(),v=a(window).height()+a(window).scrollTop(),c&&(n-=l.outerWidth()-a(f).outerWidth(),n<a(window).scrollLeft()+
20&&(n=a(window).scrollLeft()+20)),n+r+20>q&&(n=q-(r+20)),t+p+20>v&&(t=v-(p+20)),b.css({left:n,top:t}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),m=!0,a.vakata.context._trigger("show"))},hide:function(){m&&(b.hide().find("ul").hide().end().find(":focus").blur().end().detach(),m=!1,a.vakata.context._trigger("hide"))}};a(function(){c="rtl"===a("body").css("direction");var d=!1;b=a("<ul class='vakata-context'></ul>");b.on("mouseenter","li",function(c){c.stopImmediatePropagation();
a.contains(this,c.relatedTarget)||(d&&clearTimeout(d),b.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(b){a.contains(this,b.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(b){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover");
a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(b){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(b){b.preventDefault();a(this).blur().parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(c){var d;switch(c.which){case 13:case 32:c.type="mouseup";c.preventDefault();a(c.currentTarget).trigger(c);break;case 37:m&&
(b.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 38:m&&(d=b.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),d.length||(d=b.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),
d.addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 39:m&&(b.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 40:m&&(d=b.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),
d.length||(d=b.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),d.addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 27:a.vakata.context.hide(),c.preventDefault()}}).on("keydown",function(a){a.preventDefault();a=b.find(".vakata-contextmenu-shortcut-"+a.which).parent();a.parent().not(".vakata-context-disabled")&&a.click()});a(document).on("mousedown.vakata.jstree",function(c){m&&!a.contains(b[0],
c.target)&&a.vakata.context.hide()}).on("context_show.vakata.jstree",function(a,d){b.find("li:has(ul)").children("a").addClass("vakata-context-parent");c&&b.addClass("vakata-context-rtl").css("direction","rtl");b.find("ul").hide().end()})})})(d);d.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0};d.jstree.plugins.dnd=function(a,c){this.bind=function(){c.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",
".jstree-anchor",d.proxy(function(a){if("touchstart"===a.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!d(a.currentTarget).hasClass("jstree-clicked")))return!0;var b=this.get_node(a.target),c=this.is_selected(b)&&this.settings.drag_selection?this.get_selected().length:1,k=1<c?c+" "+this.get_string("nodes"):this.get_text(a.currentTarget);this.settings.core.force_text&&(k=d("<div />").text(k).html());if(b&&b.id&&"#"!==b.id&&(1===a.which||"touchstart"===a.type)&&(!0===this.settings.dnd.is_draggable||
d.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<c?this.get_selected(!0):[b])))return this.element.trigger("mousedown.jstree"),d.vakata.dnd.start(a,{jstree:!0,origin:this,obj:this.get_node(b,!0),nodes:1<c?this.get_selected():[b.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+k+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},
this))}};d(function(){var a=!1,c=!1,b=!1,f=d('<div id="jstree-marker">&#160;</div>').hide();d(document).on("dnd_start.vakata.jstree",function(b,c){a=!1;c&&c.data&&c.data.jstree&&f.appendTo("body")}).on("dnd_move.vakata.jstree",function(e,k){b&&clearTimeout(b);if(k&&k.data&&k.data.jstree&&(!k.event.target.id||"jstree-marker"!==k.event.target.id)){var g=d.jstree.reference(k.event.target),h=!1,m=!1,l=!1,n,p,q,v,u,B,w,C,A,D,y,z,x,E;if(g&&g._data&&g._data.dnd)if(f.attr("class","jstree-"+g.get_theme()+
(g.settings.core.themes.responsive?" jstree-dnd-responsive":"")),k.helper.children().attr("class","jstree-"+g.get_theme()+" jstree-"+g.get_theme()+"-"+g.get_theme_variant()+" "+(g.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[k.data.origin&&(k.data.origin.settings.dnd.always_copy||k.data.origin.settings.dnd.copy&&(k.event.metaKey||k.event.ctrlKey))?"show":"hide"](),k.event.target!==g.element[0]&&k.event.target!==g.get_container_ul()[0]||0!==g.get_container_ul().children().length){if((h=
d(k.event.target).closest(".jstree-anchor"))&&h.length&&h.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(m=h.offset(),l=k.event.pageY-m.top,q=h.height(),B=l<q/3?["b","i","a"]:l>q-q/3?["a","i","b"]:l>q/2?["i","a","b"]:["i","b","a"],d.each(B,function(e,l){switch(l){case "b":n=m.left-6;p=m.top;v=g.get_parent(h);u=h.parent().index();break;case "i":x=g.settings.dnd.inside_pos;E=g.get_node(h.parent());n=m.left-2;p=m.top+q/2+1;v=E.id;u="first"===x?0:"last"===x?E.children.length:Math.min(x,E.children.length);
break;case "a":n=m.left-6,p=m.top+q,v=g.get_parent(h),u=h.parent().index()+1}w=!0;C=0;for(A=k.data.nodes.length;C<A;C++)if(D=k.data.origin&&(k.data.origin.settings.dnd.always_copy||k.data.origin.settings.dnd.copy&&(k.event.metaKey||k.event.ctrlKey))?"copy_node":"move_node",y=u,"move_node"===D&&"a"===l&&k.data.origin&&k.data.origin===g&&v===g.get_parent(k.data.nodes[C])&&(z=g.get_node(v),y>d.inArray(k.data.nodes[C],z.children)&&--y),w=w&&(g&&g.settings&&g.settings.dnd&&!1===g.settings.dnd.check_while_dragging||
g.check(D,k.data.origin&&k.data.origin!==g?k.data.origin.get_node(k.data.nodes[C]):k.data.nodes[C],v,y,{dnd:!0,ref:g.get_node(h.parent()),pos:l,is_multi:k.data.origin&&k.data.origin!==g,is_foreign:!k.data.origin})),!w){g&&g.last_error&&(c=g.last_error());break}"i"===l&&h.parent().is(".jstree-closed")&&g.settings.dnd.open_timeout&&(b=setTimeout(function(a,b){return function(){a.open_node(b)}}(g,h),g.settings.dnd.open_timeout));if(w)return a={ins:g,par:v,pos:"i"!==l||"last"!==x||0!==u||g.is_loaded(E)?
u:"last"},f.css({left:n+"px",top:p+"px"}).show(),k.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),c={},B=!0,!1}),!0===B))return}else{w=!0;C=0;for(A=k.data.nodes.length;C<A&&(w=w&&g.check(k.data.origin&&(k.data.origin.settings.dnd.always_copy||k.data.origin.settings.dnd.copy&&(k.event.metaKey||k.event.ctrlKey))?"copy_node":"move_node",k.data.origin&&k.data.origin!==g?k.data.origin.get_node(k.data.nodes[C]):k.data.nodes[C],"#","last",{dnd:!0,ref:g.get_node("#"),pos:"i",
is_multi:k.data.origin&&k.data.origin!==g,is_foreign:!k.data.origin}),w);C++);if(w){a={ins:g,par:"#",pos:"last"};f.hide();k.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");return}}a=!1;k.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");f.hide()}}).on("dnd_scroll.vakata.jstree",function(b,c){c&&c.data&&c.data.jstree&&(f.hide(),a=!1,c.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",
function(e,k){b&&clearTimeout(b);if(k&&k.data&&k.data.jstree){f.hide().detach();var g,h,m=[];if(a){g=0;for(h=k.data.nodes.length;g<h;g++)m[g]=k.data.origin?k.data.origin.get_node(k.data.nodes[g]):k.data.nodes[g],k.data.origin&&(m[g].instance=k.data.origin);a.ins[k.data.origin&&(k.data.origin.settings.dnd.always_copy||k.data.origin.settings.dnd.copy&&(k.event.metaKey||k.event.ctrlKey))?"copy_node":"move_node"](m,a.par,a.pos);g=0;for(h=m.length;g<h;g++)m[g].instance&&(m[g].instance=null)}else g=d(k.event.target).closest(".jstree"),
g.length&&c&&c.error&&"check"===c.error&&(g=g.jstree(!0))&&g.settings.core.error.call(this,c)}}).on("keyup.jstree keydown.jstree",function(a,b){if((b=d.vakata.dnd._get())&&b.data&&b.data.jstree)b.helper.find(".jstree-copy").first()[b.data.origin&&(b.data.origin.settings.dnd.always_copy||b.data.origin.settings.dnd.copy&&(a.metaKey||a.ctrlKey))?"show":"hide"]()})});(function(a){var c=!1,b=!1,d=!1,e=!1,k=!1,g=0,h=!1,m=0,l=0,n=0,p=0,q=!1,v=!1,w=!1;a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,
helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(b,c){var d=a.vakata.dnd._get();d.event=c;a(document).triggerHandler("dnd_"+b+".vakata",d)},_get:function(){return{data:h,element:c,helper:k}},_clean:function(){k&&k.remove();v&&(clearInterval(v),v=!1);k=e=d=b=c=!1;g=0;h=!1;p=n=l=m=0;w=v=q=!1;a(document).off("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag);a(document).off("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop)},_scroll:function(b){if(!q||
!n&&!p)return v&&(clearInterval(v),v=!1),!1;if(!v)return v=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===b)return!1;b=q.scrollTop();var c=q.scrollLeft();q.scrollTop(b+p*a.vakata.dnd.settings.scroll_speed);q.scrollLeft(c+n*a.vakata.dnd.settings.scroll_speed);b===q.scrollTop()&&c===q.scrollLeft()||a.vakata.dnd._trigger("scroll",q)},start:function(f,g,n){"touchstart"===f.type&&f.originalEvent&&f.originalEvent.changedTouches&&f.originalEvent.changedTouches[0]&&(f.pageX=f.originalEvent.changedTouches[0].pageX,
f.pageY=f.originalEvent.changedTouches[0].pageY,f.target=document.elementFromPoint(f.originalEvent.changedTouches[0].pageX-window.pageXOffset,f.originalEvent.changedTouches[0].pageY-window.pageYOffset));e&&a.vakata.dnd.stop({});try{f.currentTarget.unselectable="on",f.currentTarget.onselectstart=function(){return!1},f.currentTarget.style&&(f.currentTarget.style.MozUserSelect="none")}catch(J){}m=f.pageX;l=f.pageY;h=g;d=!0;c=f.currentTarget;b=f.target;w="touchstart"===f.type;!1!==n&&(k=a("<div id='vakata-dnd'></div>").html(n).css({display:"block",
margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));a(document).on("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag);a(document).on("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop);return!1},drag:function(b){"touchmove"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-
window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(d){if(!e)if(Math.abs(b.pageX-m)>(w?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(b.pageY-l)>(w?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold))k&&(k.appendTo("body"),g=k.outerWidth()),e=!0,a.vakata.dnd._trigger("start",b);else return;var c=!1,f=!1,h=!1,t=!1,r=!1,v=f=!1,u=!1,t=c=!1;n=p=0;q=!1;a(a(b.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&
(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var c=a(this),d=c.offset();this.scrollHeight>this.offsetHeight&&(d.top+c.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(p=1),b.pageY-d.top<a.vakata.dnd.settings.scroll_proximity&&(p=-1));this.scrollWidth>this.offsetWidth&&(d.left+c.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&(n=1),b.pageX-d.left<a.vakata.dnd.settings.scroll_proximity&&(n=-1));if(p||n)return q=a(this),!1});!q&&(c=a(document),
f=a(window),h=c.height(),t=f.height(),r=c.width(),f=f.width(),v=c.scrollTop(),u=c.scrollLeft(),h>t&&b.pageY-v<a.vakata.dnd.settings.scroll_proximity&&(p=-1),h>t&&t-(b.pageY-v)<a.vakata.dnd.settings.scroll_proximity&&(p=1),r>f&&b.pageX-u<a.vakata.dnd.settings.scroll_proximity&&(n=-1),r>f&&f-(b.pageX-u)<a.vakata.dnd.settings.scroll_proximity&&(n=1),p||n)&&(q=c);q&&a.vakata.dnd._scroll(!0);k&&(c=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),t=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,
10),h&&c+25>h&&(c=h-50),r&&t+g>r&&(t=r-(g+2)),k.css({left:t+"px",top:c+"px"}));a.vakata.dnd._trigger("move",b);return!1}},stop:function(c){"touchend"===c.type&&c.originalEvent&&c.originalEvent.changedTouches&&c.originalEvent.changedTouches[0]&&(c.pageX=c.originalEvent.changedTouches[0].pageX,c.pageY=c.originalEvent.changedTouches[0].pageY,c.target=document.elementFromPoint(c.originalEvent.changedTouches[0].pageX-window.pageXOffset,c.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(e)a.vakata.dnd._trigger("stop",
c);else if("touchend"===c.type&&c.target===b){var d=setTimeout(function(){a(c.target).click()},100);a(c.target).one("click",function(){d&&clearTimeout(d)})}a.vakata.dnd._clean();return!1}}})(d);d.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1};d.jstree.plugins.search=function(a,c){this.bind=function(){c.bind.call(this);this._data.search.str="";this._data.search.dom=d();this._data.search.res=[];this._data.search.opn=
[];this._data.search.som=!1;this.element.on("before_open.jstree",d.proxy(function(a,c){var b,f,g=this._data.search.res,h=[];b=d();if(g&&g.length&&(this._data.search.dom=d(this.element[0].querySelectorAll("#"+d.map(g,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this._data.search.som&&this._data.search.res.length)){b=
0;for(f=g.length;b<f;b++)h=h.concat(this.get_node(g[b]).parents);h=d.vakata.array_remove_item(d.vakata.array_unique(h),"#");b=h.length?d(this.element[0].querySelectorAll("#"+d.map(h,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))):d();this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");b=b.add(this._data.search.dom);
b.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){d(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)).on("search.jstree",d.proxy(function(a,c){this._data.search.som&&c.nodes.length&&(this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),c.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){d(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))},
this)).on("clear_search.jstree",d.proxy(function(a,c){this._data.search.som&&c.nodes.length&&this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")},this))};this.search=function(a,c,e){if(!1===a||""===d.trim(a.toString()))return this.clear_search();a=a.toString();var b=this.settings.search,f=b.ajax?b.ajax:!1,h=null,m=[],l=[];this._data.search.res.length&&this.clear_search();e===u&&(e=b.show_only_matches);if(!c&&
!1!==f){if(d.isFunction(f))return f.call(this,a,d.proxy(function(b){b&&b.d&&(b=b.d);this._load_nodes(d.isArray(b)?d.vakata.array_unique(b):[],function(){this.search(a,!0,e)},!0)},this));f=d.extend({},f);f.data||(f.data={});f.data.str=a;return d.ajax(f).fail(d.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(f)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(d.proxy(function(b){b&&
b.d&&(b=b.d);this._load_nodes(d.isArray(b)?d.vakata.array_unique(b):[],function(){this.search(a,!0,e)},!0)},this))}this._data.search.str=a;this._data.search.dom=d();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=e;h=new d.vakata.search(a,!0,{caseSensitive:b.case_sensitive,fuzzy:b.fuzzy});d.each(this._model.data,function(c,d){d.text&&(b.search_callback&&b.search_callback.call(this,a,d)||!b.search_callback&&h.search(d.text).isMatch)&&(!b.search_leaves_only||d.state.loaded&&
0===d.children.length)&&(m.push(c),l=l.concat(d.parents))});m.length&&(l=d.vakata.array_unique(l),this._search_open(l),this._data.search.dom=d(this.element[0].querySelectorAll("#"+d.map(m,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=m,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"));this.trigger("search",{nodes:this._data.search.dom,str:a,
res:this._data.search.res,show_only_matches:e})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=d()};this._search_open=function(a){var b=this;d.each(a.concat([]),
function(c,f){if("#"===f)return!0;try{f=d("#"+f.replace(d.jstree.idregex,"\\$&"),b.element)}catch(g){}f&&f.length&&b.is_closed(f)&&(b._data.search.opn.push(f[0].id),b.open_node(f,function(){b._search_open(a)},0))})}};(function(a){a.vakata.search=function(a,b,d){d=d||{};!1!==d.fuzzy&&(d.fuzzy=!0);a=d.caseSensitive?a:a.toLowerCase();var c=d.location||0,f=d.distance||100,g=d.threshold||.6,h=a.length,m,l,n,p;32<h&&(d.fuzzy=!1);d.fuzzy&&(m=1<<h-1,l=function(){var b={},c;for(c=0;c<h;c++)b[a.charAt(c)]=
0;for(c=0;c<h;c++)b[a.charAt(c)]|=1<<h-c-1;return b}(),n=function(a,b){var d=a/h,e=Math.abs(c-b);return f?d+e/f:e?1:d});p=function(b){b=d.caseSensitive?b:b.toLowerCase();if(a===b||-1!==b.indexOf(a))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var e,f,k=b.length,p=g,q=b.indexOf(a,c),r,t,v=h+k,w,u,A=1,D=[];-1!==q&&(p=Math.min(n(0,q),p),q=b.lastIndexOf(a,c+h),-1!==q&&(p=Math.min(n(0,q),p)));q=-1;for(e=0;e<h;e++){r=0;for(t=v;r<t;)n(e,c+t)<=p?r=t:v=t,t=Math.floor((v-r)/2+r);v=t;r=
Math.max(1,c-t+1);f=Math.min(c+t,k)+h;t=Array(f+2);for(t[f+1]=(1<<e)-1;f>=r;f--)if(u=l[b.charAt(f-1)],t[f]=0===e?(t[f+1]<<1|1)&u:(t[f+1]<<1|1)&u|(w[f+1]|w[f])<<1|1|w[f+1],t[f]&m&&(A=n(e,f-1),A<=p))if(p=A,q=f-1,D.push(q),q>c)r=Math.max(1,2*c-q);else break;if(n(e+1,c)>p)break;w=t}return{isMatch:0<=q,score:A}};return!0===b?{search:p}:p(b)}})(d);d.jstree.defaults.sort=function(a,c){return this.get_text(a)>this.get_text(c)?1:-1};d.jstree.plugins.sort=function(a,c){this.bind=function(){c.bind.call(this);
this.element.on("model.jstree",d.proxy(function(a,c){this.sort(c.parent,!0)},this)).on("rename_node.jstree create_node.jstree",d.proxy(function(a,c){this.sort(c.parent||c.node.parent,!1);this.redraw_node(c.parent||c.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",d.proxy(function(a,c){this.sort(c.parent,!1);this.redraw_node(c.parent,!0)},this))};this.sort=function(a,c){var b,f;if((a=this.get_node(a))&&a.children&&a.children.length&&(a.children.sort(d.proxy(this.settings.sort,this)),
c))for(b=0,f=a.children_d.length;b<f;b++)this.sort(a.children_d[b],!1)}};var I=!1;d.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1};d.jstree.plugins.state=function(a,c){this.bind=function(){c.bind.call(this);var a=d.proxy(function(){this.element.on(this.settings.state.events,d.proxy(function(){I&&clearTimeout(I);I=setTimeout(d.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},
this);this.element.on("ready.jstree",d.proxy(function(b,c){this.element.one("restore_state.jstree",a);this.restore_state()||a()},this))};this.save_state=function(){var a={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};d.vakata.storage.set(this.settings.state.key,JSON.stringify(a))};this.restore_state=function(){var a=d.vakata.storage.get(this.settings.state.key);if(a)try{a=JSON.parse(a)}catch(f){return!1}if(a&&a.ttl&&a.sec&&+new Date-a.sec>a.ttl)return!1;a&&a.state&&(a=a.state);
a&&d.isFunction(this.settings.state.filter)&&(a=this.settings.state.filter.call(this,a));return a?(this.element.one("set_state.jstree",function(b,c){c.instance.trigger("restore_state",{state:d.extend(!0,{},a)})}),this.set_state(a),!0):!1};this.clear_state=function(){return d.vakata.storage.del(this.settings.state.key)}};(function(a,c){a.vakata.storage={set:function(a,c){return window.localStorage.setItem(a,c)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}})(d);
d.jstree.defaults.types={"#":{},"default":{}};d.jstree.plugins.types=function(a,c){this.init=function(a,d){var b,f;if(d&&d.types&&d.types["default"])for(b in d.types)if("default"!==b&&"#"!==b&&d.types.hasOwnProperty(b))for(f in d.types["default"])d.types["default"].hasOwnProperty(f)&&d.types[b][f]===u&&(d.types[b][f]=d.types["default"][f]);c.init.call(this,a,d);this._model.data["#"].type="#"};this.refresh=function(a,d){c.refresh.call(this,a,d);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",
d.proxy(function(a,c){var b=this._model.data,d=c.nodes,f=this.settings.types,h,m,l;h=0;for(m=d.length;h<m;h++)l="default",b[d[h]].original&&b[d[h]].original.type&&f[b[d[h]].original.type]&&(l=b[d[h]].original.type),b[d[h]].data&&b[d[h]].data.jstree&&b[d[h]].data.jstree.type&&f[b[d[h]].data.jstree.type]&&(l=b[d[h]].data.jstree.type),b[d[h]].type=l,!0===b[d[h]].icon&&f[l].icon!==u&&(b[d[h]].icon=f[l].icon);b["#"].type="#"},this));c.bind.call(this)};this.get_json=function(a,f,e){var b=this._model.data,
g=f?d.extend(!0,{},f,{no_id:!1}):{},g=c.get_json.call(this,a,g,e);if(!1===g)return!1;if(d.isArray(g))for(a=0,e=g.length;a<e;a++)g[a].type=g[a].id&&b[g[a].id]&&b[g[a].id].type?b[g[a].id].type:"default",f&&f.no_id&&(delete g[a].id,g[a].li_attr&&g[a].li_attr.id&&delete g[a].li_attr.id,g[a].a_attr&&g[a].a_attr.id&&delete g[a].a_attr.id);else g.type=g.id&&b[g.id]&&b[g.id].type?b[g.id].type:"default",f&&f.no_id&&(g=this._delete_ids(g));return g};this._delete_ids=function(a){if(d.isArray(a)){for(var b=0,
c=a.length;b<c;b++)a[b]=this._delete_ids(a[b]);return a}delete a.id;a.li_attr&&a.li_attr.id&&delete a.li_attr.id;a.a_attr&&a.a_attr.id&&delete a.a_attr.id;a.children&&d.isArray(a.children)&&(a.children=this._delete_ids(a.children));return a};this.check=function(a,f,e,h,g){if(!1===c.check.call(this,a,f,e,h,g))return!1;f=f&&f.id?f:this.get_node(f);e=e&&e.id?e:this.get_node(e);g=f&&f.id?d.jstree.reference(f.id):null;var b,k,l,n;g=g&&g._model&&g._model.data?g._model.data:null;switch(a){case "create_node":case "move_node":case "copy_node":if("move_node"!==
a||-1===d.inArray(f.id,e.children)){b=this.get_rules(e);if(b.max_children!==u&&-1!==b.max_children&&b.max_children===e.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+a,data:JSON.stringify({chk:a,pos:h,obj:f&&f.id?f.id:!1,par:e&&e.id?e.id:!1})},!1;if(b.valid_children!==u&&-1!==b.valid_children&&-1===d.inArray(f.type||"default",b.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",
reason:"valid_children prevents function: "+a,data:JSON.stringify({chk:a,pos:h,obj:f&&f.id?f.id:!1,par:e&&e.id?e.id:!1})},!1;if(g&&f.children_d&&f.parents){l=k=0;for(n=f.children_d.length;l<n;l++)k=Math.max(k,g[f.children_d[l]].parents.length);k=k-f.parents.length+1}if(0>=k||k===u)k=1;do{if(b.max_depth!==u&&-1!==b.max_depth&&b.max_depth<k)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+a,data:JSON.stringify({chk:a,pos:h,obj:f&&f.id?
f.id:!1,par:e&&e.id?e.id:!1})},!1;e=this.get_node(e.parent);b=this.get_rules(e);k++}while(e)}}return!0};this.get_rules=function(a){a=this.get_node(a);if(!a)return!1;a=this.get_type(a,!0);a.max_depth===u&&(a.max_depth=-1);a.max_children===u&&(a.max_children=-1);a.valid_children===u&&(a.valid_children=-1);return a};this.get_type=function(a,c){return(a=this.get_node(a))?c?d.extend({type:a.type},this.settings.types[a.type]):a.type:!1};this.set_type=function(a,c){var b,f,g;if(d.isArray(a)){a=a.slice();
b=0;for(f=a.length;b<f;b++)this.set_type(a[b],c);return!0}b=this.settings.types;a=this.get_node(a);if(!b[c]||!a)return!1;f=a.type;g=this.get_icon(a);a.type=c;(!0===g||b[f]&&b[f].icon!==u&&g===b[f].icon)&&this.set_icon(a,b[c].icon!==u?b[c].icon:!0);return!0}};d.jstree.defaults.unique={case_sensitive:!1,duplicate:function(a,c){return a+" ("+c+")"}};d.jstree.plugins.unique=function(a,c){this.check=function(a,f,e,h,g){if(!1===c.check.call(this,a,f,e,h,g))return!1;f=f&&f.id?f:this.get_node(f);e=e&&e.id?
e:this.get_node(e);if(!e||!e.children)return!0;g="rename_node"===a?h:f.text;var b=[],k=this.settings.unique.case_sensitive,l=this._model.data,n,p;n=0;for(p=e.children.length;n<p;n++)b.push(k?l[e.children[n]].text:l[e.children[n]].text.toLowerCase());k||(g=g.toLowerCase());switch(a){case "rename_node":return n=-1===d.inArray(g,b)||f.text&&f.text[k?"toString":"toLowerCase"]()===g,n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+g+" already exists. Preventing: "+
a,data:JSON.stringify({chk:a,pos:h,obj:f&&f.id?f.id:!1,par:e&&e.id?e.id:!1})}),n;case "create_node":return n=-1===d.inArray(g,b),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+g+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:h,obj:f&&f.id?f.id:!1,par:e&&e.id?e.id:!1})}),n;case "copy_node":return n=-1===d.inArray(g,b),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+g+" already exists. Preventing: "+
a,data:JSON.stringify({chk:a,pos:h,obj:f&&f.id?f.id:!1,par:e&&e.id?e.id:!1})}),n;case "move_node":return n=f.parent===e.id||-1===d.inArray(g,b),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+g+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:h,obj:f&&f.id?f.id:!1,par:e&&e.id?e.id:!1})}),n}return!0};this.create_node=function(a,f,e,h,g){if(!f||f.text===u){null===a&&(a="#");a=this.get_node(a);if(!a)return c.create_node.call(this,
a,f,e,h,g);e=e===u?"last":e;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(a))return c.create_node.call(this,a,f,e,h,g);f||(f={});var b,k,l,n,p,q=this._model.data,v=this.settings.unique.case_sensitive,w=this.settings.unique.duplicate;k=b=this.get_string("New node");l=[];n=0;for(p=a.children.length;n<p;n++)l.push(v?q[a.children[n]].text:q[a.children[n]].text.toLowerCase());for(n=1;-1!==d.inArray(v?k:k.toLowerCase(),l);)k=w.call(this,b,++n).toString();f.text=k}return c.create_node.call(this,
a,f,e,h,g)}};var G=document.createElement("DIV");G.setAttribute("unselectable","on");G.setAttribute("role","presentation");G.className="jstree-wholerow";G.innerHTML="&#160;";d.jstree.plugins.wholerow=function(a,c){this.bind=function(){c.bind.call(this);this.element.on("ready.jstree set_state.jstree",d.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",d.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",d.proxy(function(a,
c){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",d.proxy(function(a,c){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var b,d,f;d=0;for(f=c.selected.length;d<f;d++)(b=this.get_node(c.selected[d],!0))&&b.length&&b.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",d.proxy(function(a,c){this.get_node(c.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},
this)).on("hover_node.jstree dehover_node.jstree",d.proxy(function(a,c){if("hover_node"!==a.type||!this.is_disabled(c.node))this.get_node(c.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",d.proxy(function(a){a.preventDefault();var b=d.Event("contextmenu",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,pageX:a.pageX,pageY:a.pageY});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b)},
this)).on("click.jstree",".jstree-wholerow",function(a){a.stopImmediatePropagation();var b=d.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",d.proxy(function(a){a.stopImmediatePropagation();var b=d.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()},
this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",d.proxy(function(a){a.stopImmediatePropagation();this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget);return!1},this)).on("mouseleave.jstree",".jstree-node",d.proxy(function(a){this.dehover_node(a.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();c.teardown.call(this)};this.redraw_node=function(a,f,e,h){if(a=c.redraw_node.apply(this,arguments)){var b=G.cloneNode(!0);
-1!==d.inArray(a.id,this._data.core.selected)&&(b.className+=" jstree-wholerow-clicked");this._data.core.focused&&this._data.core.focused===a.id&&(b.className+=" jstree-wholerow-hovered");a.insertBefore(b,a.childNodes[0])}return a}};(function(a){if(document.registerElement&&Object&&Object.create){var c=Object.create(HTMLElement.prototype);c.createdCallback=function(){var b={core:{},plugins:[]},c;for(c in a.jstree.plugins)a.jstree.plugins.hasOwnProperty(c)&&this.attributes[c]&&(b.plugins.push(c),this.getAttribute(c)&&
JSON.parse(this.getAttribute(c))&&(b[c]=JSON.parse(this.getAttribute(c))));for(c in a.jstree.defaults.core)a.jstree.defaults.core.hasOwnProperty(c)&&this.attributes[c]&&(b.core[c]=JSON.parse(this.getAttribute(c))||this.getAttribute(c));jQuery(this).jstree(b)};try{document.registerElement("vakata-jstree",{prototype:c})}catch(b){}}})(jQuery)}});
(function(d,u){var x=0;d.widget("s3.hierarchicalopts",{options:{selected:null,multiple:!0,leafonly:!0,cascade:!1,bulkSelect:!1,cascadeOptionInTree:!0,noneSelectedText:"Select",selectedText:"selected",noOptionsText:"No options available",selectAllText:"Select All",deselectAllText:"Deselect All",icons:!1,stripes:!0,htmlTitles:!0},_create:function(){var h=d(this.element),l=this.options;this.id=x;x+=1;this._namespace=".hierarchicalopts"+x;this.treeID=h.attr("id")+"-tree";this.input=h.find(".s3-hierarchy-input").first();
this.input.data("input",!0);var p=l.selected;p&&this.input.val(JSON.stringify(p));this.button=d('<button type="button" class="s3-hierarchy-button ui-multiselect ui-widget ui-state-default ui-corner-all"><span class="ui-icon ui-icon-triangle-1-s"></span></button>');this.buttonText=d("<span>"+l.noneSelectedText+"</span>").appendTo(this.button);this.noopts=d('<span class="no-options-available">'+l.noOptionsText+"</span>").hide();this.tree=h.find(".s3-hierarchy-tree").first();this.wrapper=this.tree.closest(".s3-hierarchy-wrapper").hide().before(this.noopts).before(this.button).detach().appendTo("body");
this.manualCascadeOption=this._isBulk=this._isOpen=!1},_init:function(){this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this);this._unbindEvents();d(this.button).remove();d(this.noopts).remove();d(this.tree).detach().appendTo(this.element).show()},refresh:function(){this._unbindEvents();var h=this.options,l=this.tree;if(l.find("li").length){this.noopts.hide();this.button.show();this.input.next(".error_wrapper").insertAfter(this.button).one("click",function(){d(this).fadeOut()});
var p=this.input.val();if(p){var p=JSON.parse(p),v=this.treeID;d.each(p,function(){d("#"+v+"-"+this).data("jstree",{selected:!0})})}p=l.find("> ul > li");if(1==p.length){var p=p.first(),q=p.data("jstree");p.data("jstree",d.extend({},q,{opened:!0}))}var p=h.multiple,q=h.leafonly,w=h.cascade,u=!1,x=null,A=["sort","checkbox"];this.input.data("multiple",p);if((w||q)&&p)u=!0;else if(p)if(h.cascadeOptionInTree)this.manualCascadeOption=!0;else{var y=this,x=function(h){return l.jstree("is_parent",h)?(d.vakata.context.settings.icons=
!1,{select_all:{label:y.options.selectAllText,icon:!1,action:function(d){y._selectBranch(h)}},deselect_all:{label:y.options.deselectAllText,icon:!1,action:function(d){y._deselectBranch(h)}}}):null};A.push("contextmenu")}l.jstree({core:{themes:{name:"s3",icons:h.icons,stripes:h.stripes},animation:100,multiple:p,check_callback:!0},checkbox:{three_state:u},sort:function(d,h){var l=this.get_text(d)>this.get_text(h)?1:-1,a,c;try{a=this.get_node(d).li_attr.rel}catch(b){a=null}try{c=this.get_node(h).li_attr.rel}catch(b){c=
null}return"bulk"==a?-1:"bulk"==c?1:"none"==a?-1:"none"==c?1:l},contextmenu:{items:x,select_node:!1,icons:!1},plugins:A});var F=jQuery.jstree.reference(l);p&&((h.bulkSelect||this.manualCascadeOption)&&h.cascadeOptionInTree?(this.wrapper.find(".s3-hierarchy-header").hide(),F.create_node("#",{id:this.treeID+"-select-all",text:h.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first")):this.wrapper.find(".s3-hierarchy-header").removeClass("hide").show());y=this;l.on("ready.jstree",
function(){var d=F.get_checked();y._updateButtonText(d)});this._bindEvents()}else this.button.hide(),this.noopts.show()},_setOption:function(h,l){if("selected"===h){var p=jQuery.jstree.reference(d(this.tree));if(p!==u&&(p.uncheck_all(),l)){this.input.val(JSON.stringify(l));var v=this.treeID;d.each(l,function(){p.check_node("#"+v+"-"+this)});this._updateButtonText(l)}}this._super(h,l)},_updateSelectedNodes:function(){var h=jQuery.jstree.reference(d(this.tree)),l=this.input.val(),l=l?JSON.parse(l):
[],p=[],v=[],q=this.options.leafonly,w=h.get_checked(!0);d(w).each(function(){var l=d(this).attr("id");if("bulk"!=d(this).attr("rel")&&l&&(!q||h.is_leaf(this))){var w=l.split("-").pop();"None"!=w&&(w=parseInt(w));w&&(p.push(w),v.push(l))}});var w=!1,u=d(p).not(l).get();u.length?w=!0:(u=d(l).not(p).get(),u.length&&(w=!0));this.input.val(JSON.stringify(p));this._updateButtonText(v);w&&(this.input.change(),d(this.element).trigger("select.s3hierarchy"));return!0},_updateButtonText:function(h){var l=this.options,
p=0;h&&(p=h.length);if(p)if(1<p)h=l.selectedText.replace("#",p);else{for(var v=[],q=0;q<p;q++)v.push(d("#"+h[q]+" > a").text().replace(/^\s+|\s+$/g,""));h=v.length?v.join(" "):l.noneSelectedText}else h=l.noneSelectedText;this.buttonText.text(h)},_updateAndClose:function(){if(!this._isBulk){this._updateSelectedNodes();var d=this.wrapper,l=this;if(l.options.multiple)d.unbind("mouseleave.hierarchicalopts").one("mouseleave.hierarchicalopts",function(){window.setTimeout(function(){l.closeMenu()},100)});
else window.setTimeout(function(){l.closeMenu()},100)}},_selectNode:function(h){var l=this.options,p=jQuery.jstree.reference(d(this.tree)),v=l.multiple,q=l.leafonly;if(v)this._isBulk||"bulk"!=h.li_attr.rel||((l=p.get_parent(h))&&"#"!=l?(l=p.get_node(l),this._selectBranch(l,!0)):p.select_all());else{var w=h.id;d(p.get_checked(!0)).each(function(){w!=this.id&&(q&&!p.is_leaf(this)||p.uncheck_node(this))})}if(q&&!v&&!p.is_leaf(h))return p.deselect_node(h),!1;this._updateAndClose()},_deselectNode:function(h){var l=
jQuery.jstree.reference(d(this.tree));if(!this._isBulk){if("bulk"==h.li_attr.rel)(h=l.get_parent(h))&&"#"!=h?(h=l.get_node(h),this._deselectBranch(h,!0)):l.deselect_all();else if(h=l.get_parent(h))if(h=l.get_node(h+"-select-all"))this._isBulk=!0,l.uncheck_node(h),this._isBulk=!1;if(h=l.get_node(this.treeID+"-select-all"))this._isBulk=!0,l.uncheck_node(h),this._isBulk=!1}this._updateSelectedNodes()},_openNode:function(h){var l=jQuery.jstree.reference(d(this.tree)),p=l.get_parent(h);p.length&&l.open_node(p,
!1,!0);if(this.manualCascadeOption){var v=h.id,p=l.get_node(v+"-select-all");p||(h=l.create_node(h,{id:v+"-select-all",text:this.options.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first"),p=l.get_node(h));(h=l.get_node(this.treeID+"-select-all"))&&l.is_checked(h)&&(this._isBulk=!0,l.check_node(p),this._isBulk=!1)}},_selectBranch:function(h,l){var p=jQuery.jstree.reference(d(this.tree)),v=this;this._isBulk=!0;p.open_node(h,function(){var q=p.get_children_dom(h);d(q).each(function(){v._selectBranch(this)});
l||p.check_node(h)});this._isBulk=!1;this._updateAndClose()},_deselectBranch:function(h,l){var p=jQuery.jstree.reference(d(this.tree)),v=this;this._isBulk=!0;p.open_node(h,function(){var q=p.get_children_dom(h);d(q).each(function(){v._deselectBranch(this)});l||p.uncheck_node(h)});this._isBulk=!1;this._updateSelectedNodes()},set:function(h){var l=jQuery.jstree.reference(d(this.tree));l.uncheck_all();if(h)for(var p=0,v=h.length,q;p<v;p++)q=d("#"+this.treeID+"-"+h[p]),l.check_node(q)},get:function(){var d=
this.input.val();return d?JSON.parse(d):[]},reset:function(){this._isBulk=!0;this.tree.jstree("uncheck_all");this._isBulk=!1;this._updateSelectedNodes();return!0},openMenu:function(){this._isOpen&&this.closeMenu();var h=d(this.button),l=h.offset();d(this.wrapper).css({position:"absolute",top:l.top+h.outerHeight(),left:l.left,minWidth:h.outerWidth()-8}).show();d(this.tree).jstree("set_focus");this._isOpen=!0;h.addClass("ui-state-active");d(this).trigger("open")},closeMenu:function(){d(this.tree).jstree("unset_focus").unbind("click.hierarchicalopts").unbind("mouseleave.hierarchicalopts");
d(this.wrapper).fadeOut(50);this._isOpen=!1;d(this.button).removeClass("ui-state-active");d(this).trigger("close")},addNode:function(h,l,p,v){var q=this.tree,w=this.treeID,u="#";h&&(u=d("#"+w+"-"+h),u.length||(u="#"));l=w+"-"+l;q.jstree("create_node",u,{id:l,text:p,li_attr:{rel:"leaf"}},"last");h&&(u.attr({rel:"parent"}),q.jstree("open_node",u));v&&q.jstree("check_node",d("#"+l))},_bindEvents:function(){var h=this,l=d(this.wrapper),p=d(this.tree),v=d(this.button),q=this._namespace,u=this.options,
x=jQuery.jstree.reference(p),z=d.vakata.context.settings.icons;d(document).bind("context_show.vakata",function(){l.unbind("mouseleave.hierarchicalopts");d.vakata.context.settings.icons=z});p.bind("select_node.jstree",function(d,l){h._selectNode(l.node)}).bind("deselect_node.jstree",function(d,l){h._deselectNode(l.node)}).bind("open_node.jstree",function(d,l){h._openNode(l.node)});v.bind("click"+q,function(){h._isOpen?h.closeMenu():h.openMenu()}).bind("keyup"+q,function(d){d.preventDefault();switch(d.keyCode){case 27:case 38:case 37:h.closeMenu();
break;case 39:case 40:h.openMenu()}}).bind("mouseenter"+q,function(){v.hasClass("ui-state-disabled")||d(this).addClass("ui-state-hover")}).bind("mouseleave"+q,function(){d(this).removeClass("ui-state-hover")}).bind("focus"+q,function(){v.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")}).bind("blur"+q,function(){d(this).removeClass("ui-state-focus")});u.multiple&&u.bulkSelect&&!u.cascadeOptionInTree&&(l.find(".s3-hierarchy-select-all").bind("click"+q,function(d){d.preventDefault();
x.select_all();h._updateSelectedNodes()}),l.find(".s3-hierarchy-deselect-all").bind("click"+q,function(d){d.preventDefault();x.deselect_all();h._updateSelectedNodes()}),l.find(".s3-hierarchy-header").bind("click"+q,function(d){d.preventDefault();d.stopPropagation()}).bind("mousedown"+q,function(d){d.preventDefault();d.stopPropagation()}));d(document).bind("mousedown"+q,function(q){var u=q.target;if(d(".jstree-contextmenu").has(u).length||3==q.which)return l.unbind("mouseleave.hierarchicalopts"),!0;
p.is(u)||v.is(u)||0!==p.has(u).length||0!==v.has(u).length||h.closeMenu()});return!0},_unbindEvents:function(){var h=d(this.tree);d(this.button);var l=this._namespace;h.unbind("select_node.jstree").unbind("deselect_node.jstree").unbind("loaded.jstree").unbind("open_node.jstree");d(this.button).unbind(l);d(document).unbind(l);return!0}})})(jQuery);
(function(d,u){var x=0;d.widget("s3.hierarchicalcrud",{options:{widgetID:null,ajaxURL:null,openLabel:"Open",openURL:null,editTitle:"Edit Record",editLabel:"Edit",editURL:null,deleteLabel:"Delete",deleteURL:null,addTitle:"Add Record",addLabel:"Add",addURL:null,icons:!1,stripes:!0,htmlTitles:!0},_create:function(){this.treeID=d(this.element).attr("id")+"-tree";this.id=x;x+=1},_init:function(){this.tree=d(this.element).find(".s3-hierarchy-tree");this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this)},
refresh:function(){var h=this.tree,l=this.options;this._unbindEvents();var p=h.find("> ul > li");if(1==p.length){var p=p.first(),v=p.data("jstree");p.data("jstree",d.extend({},v,{opened:!0}))}var q=this;h.jstree({core:{themes:{name:"s3",icons:l.icons,stripes:l.stripes},animation:100,multiple:!1,check_callback:!0},contextmenu:{items:function(d){return{open:{label:q.options.openLabel,action:function(h){q._openNode(d)},separator_after:!0},edit:{label:q.options.editLabel,action:function(h){q._editNode(d)}},
"delete":{label:q.options.deleteLabel,separator_after:!0,action:function(h){q._deleteNode(d)}},add:{label:q.options.addLabel,action:function(h){q._addNode(d)}}}},select_node:!0},plugins:["sort","contextmenu"]});this._bindEvents()},_openNode:function(d){var h=this.options.openURL;d=d.id;h&&d&&(d=parseInt(d.split("-").pop()))&&(h=h.replace("[id]",d).replace("%5Bid%5D",d),window.location.href=h)},refreshNode:function(h){var l=this.options.ajaxURL,p=h.attr("id");if(l&&p&&(p=parseInt(p.split("-").pop()))){var v=
this.tree,q=this.treeID;d.getJSONS3(l+"?node="+p,function(d){d.label&&v.jstree("rename_node",h,d.label);if(d=d.children){v.jstree("open_node",h,!1,!1);for(var l,p,u,w=0,x=0,H=d.length;x<H;x++)l=d[x],p=q+"-"+l.node,(u=v.jstree("get_node","#"+p,!0))?v.jstree("rename_node",u,l.label):(v.jstree("create_node",h,{id:p,text:l.label,li_attr:{rel:"leaf"}}),w++);w&&(v.jstree("open_node",h),h.attr({rel:"parent"}))}})}},_editNode:function(h){var l=this.options.editURL;h=h.id;if(l&&h){var p=parseInt(h.split("-").pop());
p&&(l=l.replace("[id]",p).replace("%5Bid%5D",p).split("?")[0],l+="?node="+h+"&hierarchy="+this.options.widgetID,h=S3.uid(),l=d('<iframe id="'+h+'" src='+l+" onload=\"S3.popup_loaded('"+h+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(l,this.options.editTitle))}},_addNode:function(h){var l=this.options.addURL;h=h.id;if(l&&h){var p=parseInt(h.split("-").pop());p&&(l=l.split("?")[0],l+="?node="+h+"&link_to_parent="+p+"&hierarchy="+
this.options.widgetID,h=S3.uid(),l=d('<iframe id="'+h+'" src='+l+" onload=\"S3.popup_loaded('"+h+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(l,this.options.addTitle))}},_deleteNode:function(h){if(!confirm(i18n.delete_confirmation))return!1;var l=this.options.deleteURL,p=h.id,v=this.tree;l&&p&&(p=parseInt(p.split("-").pop()))&&(l=l.replace("[id]",p).replace("%5Bid%5D",p).split("?")[0],d.ajaxS3({type:"POST",url:l+"?recursive=1",
data:{},dataType:"JSON",success:function(d){v.jstree("delete_node",h)},error:function(d,h,l){h=d.responseText;if("{"==h[0])try{h=JSON.parse(d.responseText),S3.showAlert(h.message,"error")}catch(z){}}}))},_openPopup:function(h,l){h.dialog({close:function(d,l){if(self.parent){var p=self.parent.$("iframe.ui-dialog-content"),u=p.width();p.width(0);window.setTimeout(function(){p.width(u)},300)}h.remove()},minHeight:480,modal:!0,open:function(l,u){d(".ui-widget-overlay").bind("click",function(){h.dialog("close")})},
title:l,minWidth:320,closeText:""})},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);
