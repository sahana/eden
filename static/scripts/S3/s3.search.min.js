function fncSearchAutocompleteTimer(){try{clearTimeout(S3.TimeoutVar[$(this).attr("id")])}catch(a){}var f=$(this);S3.TimeoutVar[$(this).attr("id")]=setTimeout(function(){fncSearchAutocompleteAjax(f)},400)}
function fncSearchAutocompleteAjax(a){try{S3.JSONRequest[a.attr("id")].abort()}catch(f){}var b=a.parent(),d=b.parent().find(".hidden_input"),j=b.attr("get_fieldname"),k=b.attr("resourcename"),e=b.attr("fieldname"),l=$('[name ^= "'+e+'_search_simple"]');d.val("");d.change();var i=$("#"+e+"_result_list"),h=$("#"+e+"_ajax_throbber"),c=a.find(":input[value]").serialize();if(c){i.remove();h.length==0&&(b.append('<div id="'+e+'_ajax_throbber" class="ajax_throbber"/>'),h=$("#"+e+"_ajax_throbber"));var i=
b.attr("prefix"),m=a.attr("class").replace("-","_"),c=S3.Ap.concat("/",i,"/",k,"/search.acjson?",m,"=True&",c),c=c.replace(e,k);j!=void 0&&(c+="&get_fieldname="+j);S3.JSONRequest[a.attr("id")]=$.ajax({url:c,dataType:"json",success:function(a){if(a.length==1){var g=$(a[0].represent).text();l.val(g);d.val(a[0].id);d.change()}else{g='<UL id = "'+e+'_result_list"class = "search_autocomplete_result_list" style = "display:inline;">';if(a.length==0)g+='<LI class = "search_autocomplete_result_item" style = "border:1px solid;list-style-type:none;">'+
S3.i18n.no_match+"</LI>";else{for(var c=0;c<a.length;c++){g+='<LI id="'+a[c].id+'"class = "search_autocomplete_result_item" style = "border:1px solid;list-style-type:none;">';var f=$(a[c].represent);g+='<SPAN style = "cursor:pointer;">'+f.text()+'</SPAN><A href="'+f.attr("href")+'" target = "blank" style = "font-size:0.8em;margin-right:10px;float:right;">Details</A></LI>'}a.length>10&&(g+='<LI class = "search_autocomplete_result_item" style = "border:1px solid;list-style-type:none;"><I>'+S3.i18n.ac_widget_more_results+
"</I></LI>")}g+="</UL>";b.append(g)}h.remove();$('[name ^= "'+e+'_search_simple"]').blur()}})}else h.remove(),$("#"+e+"_result_list").remove()}function CancelEnterPress(a){if(a.which===13)return!1}
$(document).ready(function(){void 0!=$(".advanced-form").val()&&(void 0==$(".simple-form").val()?($(".simple-form").hide(),$(".advanced-form").show()):($("#search-mode").attr("mode")=="advanced"?($(".simple-form").hide(),$(".advanced-form").show()):$(".advanced-form").hide(),$(".advanced-lnk").click(function(a){a.preventDefault();a=$('.search_form[fieldname="'+$(this).attr("fieldname")+'"]');a.length==0&&(a=$(".search_form"));a.find(".simple-form").hide();a.find(".advanced-form").show();return!1}),
$(".simple-lnk").click(function(a){a.preventDefault();a=$('.search_form[fieldname="'+$(this).attr("fieldname")+'"]');a.length==0&&(a=$(".search_form"));a.find(".advanced-form").hide();a.find(".simple-form").show();return!1})));$(".search_select_letter_label").click(function(){$("#"+$(this).attr("id").replace("label","widget")).slideToggle();$(this).toggleClass("expanded")});$("div.simple-form").keyup(fncSearchAutocompleteTimer).click(fncSearchAutocompleteTimer).keypress(CancelEnterPress);$("div.advanced-form").keyup(fncSearchAutocompleteTimer).click(fncSearchAutocompleteTimer).keypress(CancelEnterPress);
$(".search_autocomplete_result_list li span").live("click",function(){var a=$(this).parent(),f=a.parent(),b=f.parent(),d=b.parent().find(".hidden_input"),b=b.attr("fieldname"),a=a.attr("id");a!=void 0&&(d.val(a),d.change(),d=$('[name ^= "'+b+'_search_simple"]'),a=$(this).text(),d.val(a),f.remove())})});
