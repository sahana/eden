function fncSearchAutocompleteTimer(){try{clearTimeout(S3.TimeoutVar[$(this).attr("id")])}catch(a){}var g=$(this);S3.TimeoutVar[$(this).attr("id")]=setTimeout(function(){fncSearchAutocompleteAjax(g)},400)}
function fncSearchAutocompleteAjax(a){try{S3.JSONRequest[a.attr("id")].abort()}catch(g){}var c=a.parent(),e=c.parent().find(".hidden_input"),j=c.attr("get_fieldname"),k=c.attr("resourcename"),f=c.attr("fieldname"),l=$('[name ^= "'+f+'_search_simple"]');e.val("");e.change();var i=$("#"+f+"_result_list"),h=$("#"+f+"_ajax_throbber"),b=a.find(":input[value]").serialize();if(b){i.remove();0==h.length&&(c.append('<div id="'+f+'_ajax_throbber" class="ajax_throbber"/>'),h=$("#"+f+"_ajax_throbber"));var i=
c.attr("prefix"),m=a.attr("class").replace("-","_"),b=S3.Ap.concat("/",i,"/",k,"/search.acjson?",m,"=True&",b),b=b.replace(f,k);void 0!=j&&(b+="&get_fieldname="+j);S3.JSONRequest[a.attr("id")]=$.ajax({url:b,dataType:"json",success:function(a){if(1==a.length){var d=$(a[0].represent).text();l.val(d);e.val(a[0].id);e.change()}else{d='<UL id = "'+f+'_result_list"class = "search_autocomplete_result_list" style = "display:inline;">';if(0==a.length)d+='<LI class = "search_autocomplete_result_item" style = "border:1px solid;list-style-type:none;">'+
S3.i18n.no_match+"</LI>";else{for(var b=0;b<a.length;b++)var d=d+('<LI id="'+a[b].id+'"class = "search_autocomplete_result_item" style = "border:1px solid;list-style-type:none;">'),g=$(a[b].represent),d=d+('<SPAN style = "cursor:pointer;">'+g.text()+'</SPAN><A href="'+g.attr("href")+'" target = "blank" style = "font-size:0.8em;margin-right:10px;float:right;">Details</A></LI>');10<a.length&&(d+='<LI class = "search_autocomplete_result_item" style = "border:1px solid;list-style-type:none;"><I>'+S3.i18n.ac_widget_more_results+
"</I></LI>")}c.append(d+"</UL>")}h.remove();$('[name ^= "'+f+'_search_simple"]').blur()}})}else h.remove(),$("#"+f+"_result_list").remove()}function CancelEnterPress(a){if(13===a.which)return!1}
$(document).ready(function(){void 0!=$(".advanced-form").val()&&(void 0==$(".simple-form").val()?($(".simple-form").hide(),$(".advanced-form").show()):("advanced"==$("#search-mode").attr("mode")?($(".simple-form").hide(),$(".advanced-form").show()):$(".advanced-form").hide(),$(".advanced-lnk").click(function(a){a.preventDefault();a=$('.search_form[fieldname="'+$(this).attr("fieldname")+'"]');0==a.length&&(a=$(".search_form"));a.find(".simple-form").hide();a.find(".advanced-form").show();return!1}),
$(".simple-lnk").click(function(a){a.preventDefault();a=$('.search_form[fieldname="'+$(this).attr("fieldname")+'"]');0==a.length&&(a=$(".search_form"));a.find(".advanced-form").hide();a.find(".simple-form").show();return!1})));$(".search_select_letter_label").click(function(){$("#"+$(this).attr("id").replace("label","widget")).slideToggle();$(this).toggleClass("expanded")});$("div.simple-form").keyup(fncSearchAutocompleteTimer).click(fncSearchAutocompleteTimer).keypress(CancelEnterPress);$("div.advanced-form").keyup(fncSearchAutocompleteTimer).click(fncSearchAutocompleteTimer).keypress(CancelEnterPress);
$(".search_autocomplete_result_list li span").live("click",function(){var a=$(this).parent(),g=a.parent(),c=g.parent(),e=c.parent().find(".hidden_input"),c=c.attr("fieldname"),a=a.attr("id");void 0!=a&&(e.val(a),e.change(),e=$('[name ^= "'+c+'_search_simple"]'),a=$(this).text(),e.val(a),g.remove())})});
