function s3_popup_refresh_caller(f){var a=getQueryParams(document.location.search),d=window.parent,l,p,c,e=a.refresh;if(void 0!==e){isNaN(parseInt(e))||d.location.reload(!0);var h=d.$("#"+e);if(h.hasClass("dl")){var b=a.record;void 0!==b?h.datalist("ajaxReloadItem",b):h.datalist("ajaxReload")}else if(h.hasClass("s3-organizer"))try{h.organizer("reload")}catch(D){}else try{h.dataTable().fnReloadAjax()}catch(D){}var n=d.S3.gis.maps;if("undefined"!=typeof n)for(c in n){var q=n[c];b=e.replace(/-/g,"_");
f=q.layers;a=0;for(p=f.length;a<p;a++){var g=f[a];if(g.s3_layer_id==b){var u=g.strategies;g=0;for(l=u.length;g<l;g++){var v=u[g];if("OpenLayers.Strategy.Refresh"==v.CLASS_NAME){v.refresh();break}}break}}}d.$(".filter-form").trigger("dataChanged",e);d.S3.popup_remove()}else if(b=a.refresh_layer,"undefined"!=typeof b){if(n=d.S3.gis.maps,"undefined"!=typeof n)for(c in"undefined"!=b&&(b=parseInt(b)),e=d.i18n.gis_draft_layer,n)for(q=n[c],f=q.layers,a=0,p=f.length;a<p;a++)if(g=f[a],g.s3_layer_id==b)for(u=
g.strategies,g=0,l=u.length;g<l;g++){if(v=u[g],"OpenLayers.Strategy.Refresh"==v.CLASS_NAME){v.refresh();break}}else if(g.name==e){for(;q.popups.length;)q.removePopup(q.popups[0]);l=g.features;for(g=l.length-1;0<=g;g--)l[g].destroy()}}else if(c=a.node)b=d.$("#"+a.hierarchy),c=d.$("#"+c),b&&c&&b.hierarchicalcrud("refreshNode",c),d.S3.popup_remove();else if(c=a.agent,"undefined"!=typeof c)b="undefined"!=typeof f?[f]:[],d.$("#"+c).trigger("configSaved",b);else if("undefined"!=typeof a.level)d.S3.popup_remove();
else{var k=a.caller;if(void 0===k)s3_debug("Neither calling element nor refresh-target specified in popup URL!"),d.S3.popup_remove();else if(s3_debug("Caller: ",k),c=a.person_id,"undefined"!=typeof c)d.$("#"+k).val(c).change(),d.S3.popup_remove();else{b=new RegExp(".*\\"+S3.Ap+"\\/");c=a.child;if("undefined"===typeof c){e=(""+window.location).replace(b,"");e=e.split("?")[0].split("/");var r=e[1].split(".")[0]+"_id"}else r=c;s3_debug("childResource",r);var w=a.parent;f=""+d.location;c=a.prefix;e=f.replace(b,
"");"undefined"===typeof w?(b=k.replace("_"+r,""),s3_debug("parentField",b),a=b.replace(/_.*/,""),a=b.replace(a+"_",""),e=e.split("?")[0].split("/"),b=null,c||(c=e[0]),f=e[1],2<e.length&&(null!==e[2].match(/\d*/)?3<e.length&&(b=e[3]):b=e[2]),null!==b&&a!=f&&a==b&&(a=f+"/"+b)):(a=w,c||(e=f.replace(b,""),e=e.split("?")[0].split("/"),c=e[0]));s3_debug("parentResource",a);s3_debug("lookupPrefix",c);c=S3.Ap.concat("/"+c+"/"+a+"/options.s3json?field="+r);h=d.$("#"+k);s3_debug("callerWidget",h);var E="sub_"==
k.substring(0,4),z=d.$("#dummy_"+k),A=void 0!==z.val();s3_debug("hasDummy",A);var x=h.hasClass("checkboxes-widget-s3"),B=h.hasClass("s3-hierarchy-input"),y;if(x){var F=d.$("#"+k+" tbody tr:first").children().length;var m=[]}else{var G=d.$("#"+k+" >option");(y="select"==h.prop("tagName").toLowerCase())?m=[]:c=B?c+"&hierarchy=1&only_last=1":c+"&only_last=1"}var t=1,C="";$.getJSONS3(c,function(a){var c=0;if((a=a.option)&&a.length)if(a.forEach(function(a){var b=a["@value"];a=a.$;void 0===a&&(a="");if(y)m.push(["<option value='",
b,"'>",a,"</option>"].join(""));else if(x){var d="id_"+r+"-"+c;m.push(["<td><input id='",d,"' name='",r,"' value='",b,"' type='checkbox'><label for='",d,"'>",a,"</label></td>"].join(""));c++}else B&&(w=this["@parent"],h.parent().hierarchicalopts("addNode",w,b,a,!0));b=+b;!isNaN(b)&&b>t&&(t=b,C=a)}),A&&(z.val(C),h.val(t).change()),y){if(E){var b=["_0","_none","_default"],e=k.split("_").slice(0,-1).join("_");for(a=0;a<b.length;a++){var f=b[a];d.$("#"+e+f).empty().append(m.join(""))}}else G.remove(),
h.append(m.join("")).val(t).change();h.val(t).change();h.prop("disabled",!1);if(h.hasClass("multiselect-widget")&&h.multiselect("instance"))try{h.multiselect("refresh")}catch(H){}}else{if(x){var g=[];d.$("#"+k+" input").each(function(){$(this).prop("checked")&&g.push($(this).val())});b=[];for(a=c=0;a<m.length;a++)0===c?(b.push("<tr>"),b.push(m[a]),c++):c==F-1?(b.push(m[a]),b.push("</tr>"),c=0):(b.push(m[a]),c++);h.html(b.join(""));g.push(t);for(a=0;a<g.length;a++)d.$("#"+k+' input[value="'+g[a]+'"]').prop("checked",
!0)}}else s3_debug("No options available to refresh parent field");d.S3.popup_remove()})}}}function getQueryParams(f){f=f.substring(1);var a={};if(f){f=f.split("&");for(var d,l=0,p=f.length;l<p;l++)d=f[l].split("="),a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a};
