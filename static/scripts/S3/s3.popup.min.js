function s3_popup_refresh_caller(f){var a=getQueryParams(document.location.search),d=window.parent,m,v,b,e=a.refresh;if(void 0!==e){isNaN(parseInt(e))||d.location.reload(!0);var g=d.$("#"+e);if(g.hasClass("dl")){var c=a.record;void 0!==c?g.datalist("ajaxReloadItem",c):g.datalist("ajaxReload")}else if(g.hasClass("s3-organizer"))try{g.organizer("reload")}catch(h){}else try{g.dataTable().fnReloadAjax()}catch(h){}var u=d.S3.gis.maps;if("undefined"!=typeof u)for(b in u){var w=u[b];c=e.replace(/-/g,"_");
f=w.layers;a=0;for(v=f.length;a<v;a++){var k=f[a];if(k.s3_layer_id==c){var z=k.strategies;k=0;for(m=z.length;k<m;k++){var A=z[k];if("OpenLayers.Strategy.Refresh"==A.CLASS_NAME){A.refresh();break}}break}}}d.$(".filter-form").trigger("dataChanged",e);d.S3.popup_remove()}else if(c=a.refresh_layer,"undefined"!=typeof c){if(u=d.S3.gis.maps,"undefined"!=typeof u)for(b in"undefined"!=c&&(c=parseInt(c)),e=d.i18n.gis_draft_layer,u)for(w=u[b],f=w.layers,a=0,v=f.length;a<v;a++)if(k=f[a],k.s3_layer_id==c)for(z=
k.strategies,k=0,m=z.length;k<m;k++){if(A=z[k],"OpenLayers.Strategy.Refresh"==A.CLASS_NAME){A.refresh();break}}else if(k.name==e){for(;w.popups.length;)w.removePopup(w.popups[0]);m=k.features;for(k=m.length-1;0<=k;k--)m[k].destroy()}}else if(b=a.node)c=d.$("#"+a.hierarchy),b=d.$("#"+b),c&&b&&c.hierarchicalcrud("refreshNode",b),d.S3.popup_remove();else if(b=a.agent,"undefined"!=typeof b)c="undefined"!=typeof f?[f]:[],d.$("#"+b).trigger("configSaved",c);else if("undefined"!=typeof a.level)d.S3.popup_remove();
else{var l=a.caller;if(void 0===l)s3_debug("Neither calling element nor refresh-target specified in popup URL!"),d.S3.popup_remove();else if(s3_debug("Caller: ",l),b=a.person_id,"undefined"!=typeof b)d.$("#"+l).val(b).change(),d.S3.popup_remove();else{c=new RegExp(".*\\"+S3.Ap+"\\/");b=a.child;if("undefined"===typeof b){e=(""+window.location).replace(c,"");e=e.split("?")[0].split("/");var x=e[1].split(".")[0]+"_id"}else x=b;s3_debug("childResource",x);var B=a.parent;f=""+d.location;b=a.prefix;e=f.replace(c,
"");"undefined"===typeof B?(c=l.replace("_"+x,""),s3_debug("parentField",c),a=c.replace(/_.*/,""),a=c.replace(a+"_",""),e=e.split("?")[0].split("/"),c=null,b||(b=e[0]),f=e[1],2<e.length&&(null!==e[2].match(/\d*/)?3<e.length&&(c=e[3]):c=e[2]),null!==c&&a!=f&&a==c&&(a=f+"/"+c)):(a=B,b||(e=f.replace(c,""),e=e.split("?")[0].split("/"),b=e[0]));s3_debug("parentResource",a);s3_debug("lookupPrefix",b);b=S3.Ap.concat("/"+b+"/"+a+"/options.s3json?field="+x);g=d.$("#"+l);s3_debug("callerWidget",g);var K="sub_"==
l.substring(0,4),F=d.$("#dummy_"+l),G=void 0!==F.val();s3_debug("hasDummy",G);var D=g.hasClass("checkboxes-widget-s3"),H=g.hasClass("s3-hierarchy-input"),E;if(D){var L=d.$("#"+l+" tbody tr:first").children().length;var p=[]}else{var M=d.$("#"+l+" >option");(E="select"==g.prop("tagName").toLowerCase())?p=[]:b=H?b+"&hierarchy=1&only_last=1":b+"&only_last=1"}var y=1,I="";$.getJSONS3(b,function(h){var r=0;if((h=h.option)&&h.length)if(h.forEach(function(n){var t=n["@value"];n=n.$;void 0===n&&(n="");if(E)p.push(["<option value='",
t,"'>",n,"</option>"].join(""));else if(D){var J="id_"+x+"-"+r;p.push(["<td><input id='",J,"' name='",x,"' value='",t,"' type='checkbox'><label for='",J,"'>",n,"</label></td>"].join(""));r++}else H&&(B=this["@parent"],g.parent().hierarchicalopts("addNode",B,t,n,!0));t=+t;!isNaN(t)&&t>y&&(y=t,I=n)}),G&&(F.val(I),g.val(y).change()),E){if(K){var q=["_0","_none","_default"],N=l.split("_").slice(0,-1).join("_");for(h=0;h<q.length;h++){var O=q[h];d.$("#"+N+O).empty().append(p.join(""))}}else M.remove(),
g.append(p.join("")).val(y).change();g.val(y).change();g.prop("disabled",!1);if(g.hasClass("multiselect-widget")&&g.multiselect("instance"))try{g.multiselect("refresh")}catch(n){}}else{if(D){var C=[];d.$("#"+l+" input").each(function(){$(this).prop("checked")&&C.push($(this).val())});q=[];for(h=r=0;h<p.length;h++)0===r?(q.push("<tr>"),q.push(p[h]),r++):r==L-1?(q.push(p[h]),q.push("</tr>"),r=0):(q.push(p[h]),r++);g.html(q.join(""));C.push(y);for(h=0;h<C.length;h++)d.$("#"+l+' input[value="'+C[h]+'"]').prop("checked",
!0)}}else s3_debug("No options available to refresh parent field");d.S3.popup_remove()})}}}function getQueryParams(f){f=f.substring(1);var a={};if(f){f=f.split("&");for(var d,m=0,v=f.length;m<v;m++)d=f[m].split("="),a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a};
