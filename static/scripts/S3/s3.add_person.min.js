(function(){S3.addPersonWidget=function(b){var a="#"+b,d=$(a),e=d.next(".error_wrapper"),k=$(a+"_title__row"),h=$(a+"_organisation_id__row"),l=$(a+"_full_name__row"),f=$(a+"_date_of_birth__row"),g=$(a+"_gender__row"),c=$(a+"_occupation__row"),q=$(a+"_mobile_phone__row"),s=$(a+"_email__row"),m=$(a+"_box_bottom");$(a+"__row").hide().after(m).after(s).after(q).after(c).after(g).after(f).after(l).after(h).after(k).after(e);k.show();h.show();l.show();f.show();g.show();c.show();q.show();s.show();m.show();
d.val()?(t(b),$(a+"_edit_bar .icon-remove").hide()):(n(b),$(a+"_edit_bar .icon-edit").hide());$(a+"_edit_bar").removeClass("hide").show();$(a+"_edit_bar .icon-edit").click(function(){var a="#"+b;n(b);$(a).val("");$(a+"_organisation_id").prop("disabled",!1).val("").change();$(a+"_full_name").prop("disabled",!1).val("");$(a+"_gender").prop("disabled",!1).val("");$(a+"_date_of_birth").prop("disabled",!1).val("");$(a+"_occupation").prop("disabled",!1).val("");$(a+"_mobile_phone").prop("disabled",!1).val("");
$(a+"_email").prop("disabled",!1).val("");$(a+"_edit_bar .icon-edit").hide();$(a+"_edit_bar .icon-remove").show()});$(a+"_edit_bar .icon-remove").click(function(){var a="#"+b,c=$(a).data("existing");c?($(a).val(c.value),$(a+"_organisation_id").prop("disabled",!0).val(c.organisation_id),$(a+"_full_name").prop("disabled",!0).val(c.full_name),$(a+"_gender").prop("disabled",!0).val(c.gender),$(a+"_date_of_birth").prop("disabled",!0).val(c.date_of_birth),$(a+"_occupation").prop("disabled",!0).val(c.occupation),
$(a+"_mobile_phone").prop("disabled",!0).val(c.mobile_phone),$(a+"_email").prop("disabled",!0).val(c.email),$(a+"_edit_bar .icon-edit").show(),$(a+"_edit_bar .icon-remove").hide()):($(a+"_full_name").prop("disabled",!1).val(""),r(b))});$(a+"_organisation_id").change(function(){var a=$(this).val(),b=d.data("url");a?(b=b.split("?")[0],b+="?~.organisation_id="+a):b=b.split("?")[0];d.data("url",b)});$("form").submit(function(){S3ClearNavigateAwayConfirm();var a="#"+b;$(a+"_organisation_id").prop("disabled",
!1);$(a+"_full_name").prop("disabled",!1);$(a+"_gender").prop("disabled",!1);$(a+"_date_of_birth").prop("disabled",!1);$(a+"_occupation").prop("disabled",!1);$(a+"_mobile_phone").prop("disabled",!1);$(a+"_email").prop("disabled",!1);return!0})};var t=function(b){b="#"+b;$(b+"_organisation_id").prop("disabled",!0);$(b+"_full_name").prop("disabled",!0);$(b+"_gender").prop("disabled",!0);$(b+"_date_of_birth").prop("disabled",!0);$(b+"_occupation").prop("disabled",!0);$(b+"_mobile_phone").prop("disabled",
!0);$(b+"_email").prop("disabled",!0);$(b+"_edit_bar .icon-edit").show();$(b+"_edit_bar .icon-remove").hide()},r=function(b){b="#"+b;$(b).val("");$(b+"_organisation_id").prop("disabled",!1).val("");$(b+"_gender").prop("disabled",!1).val("");$(b+"_date_of_birth").prop("disabled",!1).val("");$(b+"_occupation").prop("disabled",!1).val("");$(b+"_mobile_phone").prop("disabled",!1).val("");$(b+"_email").prop("disabled",!1).val("")},p=function(b){var a=b.first;b.middle&&(a+=" "+b.middle);b.last&&(a+=" "+
b.last);return a},n=function(b){var a="#"+b,d=$(a+"_full_name");if(!d.attr("autocomplete")){var e=$(a),k=e.val(),h=k?{value:k,full_name:d.val(),organisation_id:$(a+"_organisation_id").val(),gender:$(a+"_gender").val(),date_of_birth:$(a+"_date_of_birth").val(),occupation:$(a+"_occupation").val(),mobile_phone:$(a+"_mobile_phone").val(),email:$(a+"_email").val()}:{};e.data("existing",h);$(a+"_full_name").after('<div id="'+b+'_throbber" class="throbber input_throbber hide"></div>');var l=$(a+"_throbber"),
a=d.attr("data-c"),k=d.attr("data-f"),a=S3.Ap.concat("/"+a+"/"+k+"/search_ac");e.data("url",a);d.autocomplete({delay:450,minLength:2,source:function(a,b){$.ajax({url:e.data("url"),data:{term:a.term}}).done(function(a){if(0==a.length)e.val("");else{var d=i18n.none_of_the_above;a.push({id:0,value:"",label:d,first:d})}b(a)})},search:function(a,b){l.removeClass("hide").show();return!0},response:function(a,b,c){l.hide();return c},focus:function(a,b){p(b.item);return!1},select:function(a,g){var c=g.item;
if(c.id){var q=p(c);d.val(q);e.val(c.id);u(b,c.id)}else e.val("");return!1}}).data("ui-autocomplete")._renderItem=function(a,b){var c;c=b.first;b.middle&&(c+=" "+b.middle);b.last&&(c+=" "+b.last);var d=b.org,e=b.job;if(d||e)e?(c+=" ("+e,d&&(c+=", "+d),c+=")"):c+=" ("+d+")";return $("<li>").data("item.autocomplete",b).append("<a>"+c+"</a>").appendTo(a)};d.blur(function(){h&&h.full_name!=d.val()&&e.val("")})}},u=function(b,a){var d="#"+b,e=$(d+"_full_name");e.prop("disabled",!1);r(b);var k=$(d),h=e.attr("data-c"),
l=e.attr("data-f"),h=S3.Ap.concat("/"+h+"/"+l+"/"+a+"/lookup");$.getJSONS3(h,function(f){try{var g=e.val(),g={value:a,full_name:g};k.val(a);k.data("existing",g);if(f.hasOwnProperty("email")){var c=f.email;$(d+"_email").val(c);g.email=c}if(f.hasOwnProperty("phone")){var h=f.phone;$(d+"_mobile_phone").val(h);g.mobile_phone=h}if(f.hasOwnProperty("gender")){var l=f.gender;$(d+"_gender").val(l);g.gender=l}if(f.hasOwnProperty("date_of_birth")){var m=f.date_of_birth;$(d+"_date_of_birth").val(m);g.date_of_birth=
m}if(f.hasOwnProperty("occupation")){var n=f.occupation;$(d+"_occupation").val(n);g.occupation=n}if(f.hasOwnProperty("organisation_id")){var p=f.organisation_id;$(d+"_organisation_id").val(p);g.organisation_id=p}t(b)}catch(u){k.val(""),r(b)}})}})();
