(function(a){a.widget("ui.selectmenu",{options:{appendTo:"body",typeAhead:1E3,style:"dropdown",positionOptions:{my:"left top",at:"left bottom",offset:null},width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null,escapeHtml:!1,bgImage:function(){}},_create:function(){var b=this,d=this.options,c=(this.element.attr("id")||"ui-selectmenu-"+Math.random().toString(16).slice(2,10)).replace(/(:|\.)/g,"");this.ids=[c,c+"-button",c+"-menu"];this._safemouseup=!0;this.isOpen=!1;this.newelement=
a("<a />",{"class":this.widgetBaseClass+" ui-widget ui-state-default ui-corner-all",id:this.ids[1],role:"button",href:"#nogo",tabindex:this.element.attr("disabled")?1:0,"aria-haspopup":!0,"aria-owns":this.ids[2]});this.newelementWrap=a("<span />").append(this.newelement).insertAfter(this.element);(c=this.element.attr("tabindex"))&&this.newelement.attr("tabindex",c);this.newelement.data("selectelement",this.element);this.selectmenuIcon=a('<span class="'+this.widgetBaseClass+'-icon ui-icon"></span>').prependTo(this.newelement);
this.newelement.prepend('<span class="'+b.widgetBaseClass+'-status" />');this.element.bind({"click.selectmenu":function(a){b.newelement.focus();a.preventDefault()}});this.newelement.bind("mousedown.selectmenu",function(a){b._toggle(a,!0);"popup"==d.style&&(b._safemouseup=!1,setTimeout(function(){b._safemouseup=!0},300));return!1}).bind("click.selectmenu",function(){return!1}).bind("keydown.selectmenu",function(d){var c=!1;switch(d.keyCode){case a.ui.keyCode.ENTER:c=!0;break;case a.ui.keyCode.SPACE:b._toggle(d);
break;case a.ui.keyCode.UP:d.altKey?b.open(d):b._moveSelection(-1);break;case a.ui.keyCode.DOWN:d.altKey?b.open(d):b._moveSelection(1);break;case a.ui.keyCode.LEFT:b._moveSelection(-1);break;case a.ui.keyCode.RIGHT:b._moveSelection(1);break;case a.ui.keyCode.TAB:c=!0;break;case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.HOME:b.index(0);break;case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.END:b.index(b._optionLis.length);break;default:c=!0}return c}).bind("keypress.selectmenu",function(a){0<a.which&&b._typeAhead(a.which,
"mouseup");return!0}).bind("mouseover.selectmenu",function(){d.disabled||a(this).addClass("ui-state-hover")}).bind("mouseout.selectmenu",function(){d.disabled||a(this).removeClass("ui-state-hover")}).bind("focus.selectmenu",function(){d.disabled||a(this).addClass("ui-state-focus")}).bind("blur.selectmenu",function(){d.disabled||a(this).removeClass("ui-state-focus")});a(document).bind("mousedown.selectmenu-"+this.ids[0],function(a){b.isOpen&&b.close(a)});this.element.bind("click.selectmenu",function(){b._refreshValue()}).bind("focus.selectmenu",
function(){b.newelement&&b.newelement[0].focus()});d.width||(d.width=this.element.outerWidth());this.newelement.width(d.width);this.element.hide();this.list=a("<ul />",{"class":"ui-widget ui-widget-content","aria-hidden":!0,role:"listbox","aria-labelledby":this.ids[1],id:this.ids[2]});this.listWrap=a("<div />",{"class":b.widgetBaseClass+"-menu"}).append(this.list).appendTo(d.appendTo);this.list.bind("keydown.selectmenu",function(d){var c=false;switch(d.keyCode){case a.ui.keyCode.UP:d.altKey?b.close(d,
true):b._moveFocus(-1);break;case a.ui.keyCode.DOWN:d.altKey?b.close(d,true):b._moveFocus(1);break;case a.ui.keyCode.LEFT:b._moveFocus(-1);break;case a.ui.keyCode.RIGHT:b._moveFocus(1);break;case a.ui.keyCode.HOME:b._moveFocus(":first");break;case a.ui.keyCode.PAGE_UP:b._scrollPage("up");break;case a.ui.keyCode.PAGE_DOWN:b._scrollPage("down");break;case a.ui.keyCode.END:b._moveFocus(":last");break;case a.ui.keyCode.ENTER:case a.ui.keyCode.SPACE:b.close(d,true);a(d.target).parents("li:eq(0)").trigger("mouseup");
break;case a.ui.keyCode.TAB:c=true;b.close(d,true);a(d.target).parents("li:eq(0)").trigger("mouseup");break;case a.ui.keyCode.ESCAPE:b.close(d,true);break;default:c=true}return c}).bind("keypress.selectmenu",function(a){a.which>0&&b._typeAhead(a.which,"focus");return true}).bind("mousedown.selectmenu mouseup.selectmenu",function(){return false});a(window).bind("resize.selectmenu-"+this.ids[0],a.proxy(b.close,this))},_init:function(){var b=this,d=this.options,c=[];this.element.find("option").each(function(){var j=
a(this);c.push({value:j.attr("value"),text:b._formatText(j.text(),j),selected:j.attr("selected"),disabled:j.attr("disabled"),classes:j.attr("class"),typeahead:j.attr("typeahead"),parentOptGroup:j.parent("optgroup"),bgImage:d.bgImage.call(j)})});var e="popup"==b.options.style?" ui-state-active":"";this.list.html("");if(c.length)for(var f=0;f<c.length;f++){var h={role:"presentation"};c[f].disabled&&(h["class"]=this.namespace+"-state-disabled");var i={html:c[f].text||"&nbsp;",href:"#nogo",tabindex:-1,
role:"option","aria-selected":!1};c[f].disabled&&(i["aria-disabled"]=c[f].disabled);c[f].typeahead&&(i.typeahead=c[f].typeahead);i=a("<a/>",i).bind("focus.selectmenu",function(){a(this).parent().mouseover()}).bind("blur.selectmenu",function(){a(this).parent().mouseout()});h=a("<li/>",h).append(i).data("index",f).addClass(c[f].classes).data("optionClasses",c[f].classes||"").bind("mouseup.selectmenu",function(d){if(b._safemouseup&&!b._disabled(d.currentTarget)&&!b._disabled(a(d.currentTarget).parents("ul>li."+
b.widgetBaseClass+"-group "))){var c=a(this).data("index")!=b._selectedIndex();b.index(a(this).data("index"));b.select(d);c&&b.change(d);b.close(d,true)}return false}).bind("click.selectmenu",function(){return false}).bind("mouseover.selectmenu",function(){if(!a(this).hasClass(b.namespace+"-state-disabled")&&!a(this).parent("ul").parent("li").hasClass(b.namespace+"-state-disabled")){b._selectedOptionLi().addClass(e);b._focusedOptionLi().removeClass(b.widgetBaseClass+"-item-focus ui-state-hover");
a(this).removeClass("ui-state-active").addClass(b.widgetBaseClass+"-item-focus ui-state-hover")}}).bind("mouseout.selectmenu",function(){a(this).is(b._selectedOptionLi())&&a(this).addClass(e);a(this).removeClass(b.widgetBaseClass+"-item-focus ui-state-hover")});c[f].parentOptGroup.length?(i=b.widgetBaseClass+"-group-"+this.element.find("optgroup").index(c[f].parentOptGroup),this.list.find("li."+i).length?this.list.find("li."+i+":last ul").append(h):a(' <li role="presentation" class="'+b.widgetBaseClass+
"-group "+i+(c[f].parentOptGroup.attr("disabled")?" "+this.namespace+'-state-disabled" aria-disabled="true"':'"')+'><span class="'+b.widgetBaseClass+'-group-label">'+c[f].parentOptGroup.attr("label")+"</span><ul></ul></li> ").appendTo(this.list).find("ul").append(h)):h.appendTo(this.list);if(d.icons)for(var g in d.icons)h.is(d.icons[g].find)&&(h.data("optionClasses",c[f].classes+" "+b.widgetBaseClass+"-hasIcon").addClass(b.widgetBaseClass+"-hasIcon"),i=d.icons[g].icon||"",h.find("a:eq(0)").prepend('<span class="'+
b.widgetBaseClass+"-item-icon ui-icon "+i+'"></span>'),c[f].bgImage&&h.find("span").css("background-image",c[f].bgImage))}else a('<li role="presentation"><a href="#nogo" tabindex="-1" role="option"></a></li>').appendTo(this.list);f="dropdown"==d.style;this.newelement.toggleClass(b.widgetBaseClass+"-dropdown",f).toggleClass(b.widgetBaseClass+"-popup",!f);this.list.toggleClass(b.widgetBaseClass+"-menu-dropdown ui-corner-bottom",f).toggleClass(b.widgetBaseClass+"-menu-popup ui-corner-all",!f).find("li:first").toggleClass("ui-corner-top",
!f).end().find("li:last").addClass("ui-corner-bottom");this.selectmenuIcon.toggleClass("ui-icon-triangle-1-s",f).toggleClass("ui-icon-triangle-2-n-s",!f);"dropdown"==d.style?this.list.width(d.menuWidth?d.menuWidth:d.width):this.list.width(d.menuWidth?d.menuWidth:d.width-d.handleWidth);this.list.css("height","auto");f=this.listWrap.height();g=a(window).height();g=d.maxHeight?Math.min(d.maxHeight,g):g/3;f>g&&this.list.height(g);this._optionLis=this.list.find("li:not(."+b.widgetBaseClass+"-group)");
this.element.attr("disabled")?this.disable():this.enable();this._refreshValue();this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-focus");clearTimeout(this.refreshTimeout);this.refreshTimeout=window.setTimeout(function(){b._refreshPosition()},200)},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled").unbind(".selectmenu");a(window).unbind(".selectmenu-"+this.ids[0]);a(document).unbind(".selectmenu-"+
this.ids[0]);this.newelementWrap.remove();this.listWrap.remove();this.element.unbind(".selectmenu").show();a.Widget.prototype.destroy.apply(this,arguments)},_typeAhead:function(b,a){var c=this,e=String.fromCharCode(b).toLowerCase(),f=null,h=null;c._typeAhead_timer&&(window.clearTimeout(c._typeAhead_timer),c._typeAhead_timer=void 0);c._typeAhead_chars=(void 0===c._typeAhead_chars?"":c._typeAhead_chars).concat(e);2>c._typeAhead_chars.length||c._typeAhead_chars.substr(-2,1)===e&&c._typeAhead_cycling?
(c._typeAhead_cycling=!0,f=e):(c._typeAhead_cycling=!1,f=c._typeAhead_chars);for(var e=("focus"!==a?this._selectedOptionLi().data("index"):this._focusedOptionLi().data("index"))||0,i=0;i<this._optionLis.length;i++)if(this._optionLis.eq(i).text().substr(0,f.length).toLowerCase()===f)if(c._typeAhead_cycling){if(null===h&&(h=i),i>e){h=i;break}}else h=i;null!==h&&this._optionLis.eq(h).find("a").trigger(a);c._typeAhead_timer=window.setTimeout(function(){c._typeAhead_timer=void 0;c._typeAhead_chars=void 0;
c._typeAhead_cycling=void 0},c.options.typeAhead)},_uiHash:function(){var b=this.index();return{index:b,option:a("option",this.element).get(b),value:this.element[0].value}},open:function(b){var a=this.options;if("true"!=this.newelement.attr("aria-disabled")){this._closeOthers(b);this.newelement.addClass("ui-state-active");this.list.attr("aria-hidden",!1);this.listWrap.addClass(this.widgetBaseClass+"-open");var c=this._selectedOptionLi();"dropdown"==a.style?this.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"):
this.list.css("left",-5E3).scrollTop(this.list.scrollTop()+c.position().top-this.list.outerHeight()/2+c.outerHeight()/2).css("left","auto");this._refreshPosition();a=c.find("a");a.length&&a[0].focus();this.isOpen=!0;this._trigger("open",b,this._uiHash())}},close:function(b,a){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.listWrap.removeClass(this.widgetBaseClass+"-open"),this.list.attr("aria-hidden",!0),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),
a&&this.newelement.focus(),this.isOpen=!1,this._trigger("close",b,this._uiHash()))},change:function(b){this.element.trigger("change");this._trigger("change",b,this._uiHash())},select:function(b){if(this._disabled(b.currentTarget))return!1;this._trigger("select",b,this._uiHash())},widget:function(){return this.listWrap.add(this.newelementWrap)},_closeOthers:function(b){a("."+this.widgetBaseClass+".ui-state-active").not(this.newelement).each(function(){a(this).data("selectelement").selectmenu("close",
b)});a("."+this.widgetBaseClass+".ui-state-hover").trigger("mouseout")},_toggle:function(b,a){this.isOpen?this.close(b,a):this.open(b)},_formatText:function(b,d){this.options.format?b=this.options.format(b,d):this.options.escapeHtml&&(b=a("<div />").text(b).html());return b},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find("."+this.widgetBaseClass+"-item-focus")},
_moveSelection:function(b,a){if(!this.options.disabled){var c=parseInt(this._selectedOptionLi().data("index")||0,10)+b;0>c&&(c=0);c>this._optionLis.size()-1&&(c=this._optionLis.size()-1);if(c===a)return!1;this._optionLis.eq(c).hasClass(this.namespace+"-state-disabled")?(0<b?++b:--b,this._moveSelection(b,c)):this._optionLis.eq(c).trigger("mouseover").trigger("mouseup")}},_moveFocus:function(b,a){var c=isNaN(b)?parseInt(this._optionLis.filter(b).data("index"),10):parseInt(this._focusedOptionLi().data("index")||
0,10)+b;0>c&&(c=0);c>this._optionLis.size()-1&&(c=this._optionLis.size()-1);if(c===a)return!1;var e=this.widgetBaseClass+"-item-"+Math.round(1E3*Math.random());this._focusedOptionLi().find("a:eq(0)").attr("id","");this._optionLis.eq(c).hasClass(this.namespace+"-state-disabled")?(0<b?++b:--b,this._moveFocus(b,c)):this._optionLis.eq(c).find("a:eq(0)").attr("id",e).focus();this.list.attr("aria-activedescendant",e)},_scrollPage:function(b){var a=Math.floor(this.list.outerHeight()/this._optionLis.first().outerHeight());
this._moveFocus("up"==b?-a:a)},_setOption:function(b,a){this.options[b]=a;"disabled"==b&&(a&&this.close(),this.element.add(this.newelement).add(this.list)[a?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",a))},disable:function(b,a){"undefined"==typeof b?this._setOption("disabled",!0):"optgroup"==a?this._disableOptgroup(b):this._disableOption(b)},enable:function(b,a){"undefined"==typeof b?this._setOption("disabled",!1):"optgroup"==
a?this._enableOptgroup(b):this._enableOption(b)},_disabled:function(b){return a(b).hasClass(this.namespace+"-state-disabled")},_disableOption:function(b){var a=this._optionLis.eq(b);a&&(a.addClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!0),this.element.find("option").eq(b).attr("disabled","disabled"))},_enableOption:function(b){var a=this._optionLis.eq(b);a&&(a.removeClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!1),this.element.find("option").eq(b).removeAttr("disabled"))},
_disableOptgroup:function(b){var a=this.list.find("li."+this.widgetBaseClass+"-group-"+b);a&&(a.addClass(this.namespace+"-state-disabled").attr("aria-disabled",!0),this.element.find("optgroup").eq(b).attr("disabled","disabled"))},_enableOptgroup:function(b){var a=this.list.find("li."+this.widgetBaseClass+"-group-"+b);a&&(a.removeClass(this.namespace+"-state-disabled").attr("aria-disabled",!1),this.element.find("optgroup").eq(b).removeAttr("disabled"))},index:function(b){if(arguments.length){if(this._disabled(a(this._optionLis[b])))return!1;
this.element[0].selectedIndex=b;this._refreshValue()}else return this._selectedIndex()},value:function(b){if(arguments.length)this.element[0].value=b,this._refreshValue();else return this.element[0].value},_refreshValue:function(){var b="popup"==this.options.style?" ui-state-active":"",a=this.widgetBaseClass+"-item-"+Math.round(1E3*Math.random());this.list.find("."+this.widgetBaseClass+"-item-selected").removeClass(this.widgetBaseClass+"-item-selected"+b).find("a").attr("aria-selected","false").attr("id",
"");this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-selected"+b).find("a").attr("aria-selected","true").attr("id",a);var b=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"",c=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(b).data("optionClasses",c).addClass(c).find("."+this.widgetBaseClass+"-status").html(this._selectedOptionLi().find("a:eq(0)").html());this.list.attr("aria-activedescendant",
a)},_refreshPosition:function(){var b=this.options;if("popup"==b.style&&!b.positionOptions.offset)var a=this._selectedOptionLi(),a="0 "+(this.list.offset().top-a.offset().top-(this.newelement.outerHeight()+a.outerHeight())/2);this.listWrap.removeAttr("style").zIndex(this.element.zIndex()+1).position({of:b.positionOptions.of||this.newelement,my:b.positionOptions.my,at:b.positionOptions.at,offset:b.positionOptions.offset||a,collision:b.positionOptions.collision||("popup"==b.style?"fit":"flip")})}})})(jQuery);
var TypeHelpers=new function(){var a=this;a.hasSmoothing=function(){if("undefined"!=typeof screen.fontSmoothingEnabled)return screen.fontSmoothingEnabled;try{var a=document.createElement("canvas");a.width="35";a.height="35";a.style.display="none";document.body.appendChild(a);var d=a.getContext("2d");d.textBaseline="top";d.font="32px Arial";d.fillStyle="black";d.strokeStyle="black";d.fillText("O",0,0);for(a=8;32>=a;a++)for(var c=1;32>=c;c++){var e=d.getImageData(c,a,1,1).data[3];if(255!=e&&0!=e)return!0}return!1}catch(f){return null}};
a.insertClasses=function(){var b=a.hasSmoothing(),d=document.getElementsByTagName("html")[0];d.className=!0==b?d.className+" hasFontSmoothing-true":!1==b?d.className+" hasFontSmoothing-false":d.className+" hasFontSmoothing-unknown"}},activeWindow,drawerOpen=!1,colors={"0":"#999999",1:"#ff5121",2:"#f4961c",3:"#d6b317",4:"#77b826",5:"#059346"},map,parser,proj4326,resilienceLayer,populationLayer,volunteerLayer,popupControl,current_l0,current_l1,current_l2,current_l3;S3.dataTables=[];
S3.dataTables.id=["report"];var rep_section="pending",shownReport=-1,submitedData="",submitedDataPage=0,submitDataJobID=0,submitDataItemIDs="";yepnope({load:[S3.Ap.concat("/static/scripts/gis/OpenLayers.js"),S3.Ap.concat("/static/themes/Vulnerability/js/OpenLayers.js")],complete:function(){showMap()}});
$(document).ready(function(){$("#dataTopBar").hover(function(){$("#dataTopBar img").css("background-color","#f7941d");$("#dataTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowOverPng8.png"));$("#dataOptions").fadeIn(150);$("#defaultDataLink").css("color","#c47a21")},function(){$("#dataTopBar img").css("background-color","transparent");$("#dataTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowPng8.png"));$("#dataOptions").fadeOut(150);
$("#defaultDataLink").css("color","#f7941d")});$("#reportsTopBar").hover(function(){$("#reportsTopBar img").css("background-color","#f7941d");$("#reportsTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowOverPng8.png"));$("#reportsOptions").fadeIn(150);$("#defaultReportsLink").css("color","#c47a21")},function(){$("#reportsTopBar img").css("background-color","transparent");$("#reportsTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowPng8.png"));
$("#reportsOptions").fadeOut(150);$("#defaultReportsLink").css("color","#f7941d")});var a=$("#dummy_location_search").val(),b=!1,d=function(a){switch(a.level){case "L0":return a.name;case "L1":return a.name+","+a.L0;case "L2":return a.name+","+a.L1+","+a.L0;case "L3":return a.name+","+a.L2+","+a.L1+","+a.L0;case "None":return a.label}},c=$.ui.autocomplete.prototype._response;$.ui.autocomplete.prototype._response=function(a){c.apply(this,[a]);this.element.trigger("autocompletesearchcomplete",[a])};
$("#dummy_location_search").autocomplete({source:S3.Ap.concat("/gis/location/search.json?location.level__ne=None&filter=~&field=name&simple=1"),delay:450,minLength:2,position:{my:"left bottom",at:"left top"},search:function(){$("#dummy_location_search_throbber").removeClass("hidden").show();return!0},response:function(a,b,c){$("#dummy_location_search_throbber").hide();0==b.content.length&&($().autocomplete("widget"),a=$("#dummy_location_search").autocomplete("option","source"),$("#dummy_location_search").autocomplete("option",
"source",[{label:S3.i18n.no_matching_result,value:0,id:0,name:S3.i18n.no_matching_result,level:"None"}]),$("#dummy_location_search").autocomplete("search","No"),c=[{label:S3.i18n.no_matching_result,value:0,level:"None",id:0,name:S3.i18n.no_matching_result}],$("#dummy_location_search").autocomplete("option","source",a));return c},focus:function(a,b){$("#dummy_location_search").val(b.item.name);return!1},select:function(a,c){var d=c.item.id;$("#dummy_location_search").val(c.item.name);$("#location_search").val(d);
$("#location_search").change();b=!0;$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+d),success:function(){for(var a in n)vdata[a]=n[a];n=null;v_select_region(parseInt(c.item.level[1]),d)},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"script"});return!1}}).data("autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append("<a>"+d(b)+"</a>").appendTo(a)};$("#dummy_location_search").blur(function(){$("#dummy_location_search").val()||
($("#location_search").val(""),b=!0);b?a=$("#dummy_location_search").val():$("#dummy_location_search").val(a);b=!1});$("#dummy_location_search").bind("autocompletesearchcomplete",function(a,b){0==b.length&&$("#dummy_location_search").autocomplete("widget").show()});var e=[],f=[],h,i;for(i in idata)h="        <li>            <div class='indicatorRatingLabel'>                <div class='listText'>"+idata[i].n+"</div>                <div class='popup'>                    <div class='popupContent'>                        <h3>"+
idata[i].n+"</h3>                        <p>"+idata[i].d+"</p>                    </div>                    <div class='popupBottom'></div>                </div>            </div>            <div class='visRange'>                <div class='indicatorRange' id='visRange"+i+"'>                    <div class='leftBox'></div>                    <div class='medianDot'></div>                    <div class='rightBox'></div>                </div>            </div>        </li>",f.push(h),h="        <li>            <div class='indicatorRatingLabel'>                <input name='analysisIndicators' type='radio' value='"+
i+"' checked>                <div class='listText'>"+idata[i].n+"</div>                <div class='popup'>                    <div class='popupContent'>                        <h3>"+idata[i].n+"</h3>                        <p>"+idata[i].d+"</p>                    </div>                    <div class='popupBottom'></div>                </div>            </div>            <div class='indicatorRating' id='indicatorRating"+i+"'></div>        </li>",e.push(h);$("#indicatorRatingChart ul").html(f.join(""));
$("#regionIndicators ul").html(e.join(""));for(var g in vdata){switch(vdata[g].r){case 1:e="one";break;case 2:e="two";break;case 3:e="three";break;case 4:e="four";break;case 5:e="five";break;default:e="none"}f=g==start?' selected="selected"':"";0==vdata[g].l?($("#l0_select, #l0_reports, #l0_datas, #l0_analysis1s").append('<option value="'+g+'" class="'+e+'"'+f+">"+vdata[g].n+"</option>"),$("#l0_analysis2s, #l0_analysis3s").append('<option value="'+g+'" class="'+e+'">'+vdata[g].n+"</option>")):1==
vdata[g].l&&$("#l1_select, #l1_reports, #l1_datas, #l1_analysis1s").append('<option value="'+g+'" class="'+e+'">'+vdata[g].n+"</option>")}start?$("#l1_analysis2, #l1_analysis3").hide():$("#l1, #l1_report, #l1_data, #l1_analysis1, #l1_analysis2, #l1_analysis3").hide();$("#l2, #l2_report, #l2_data, #l2_analysis1, #l2_analysis2, #l2_analysis3").hide();$("#l3, #l3_report, #l3_data, #l3_analysis1, #l3_analysis2, #l3_analysis3").hide();$("#l0_select, #l0_reports, #l0_datas").change(function(){var a=this.value,
b=hdata[a];$("#l1_select, #l1_reports, #l1_datas").html('<option value="" selected="selected" class="none">Choose '+b.l1+"</option>");try{lx_select(a,0,!1)}catch(c){readHierarchy(a,0,!1)}});$("#l1_select, #l1_reports, #l1_datas").change(function(){var a=this.value,b=hdata[$("#l0_select").val()];$("#l2_select, #l2_reports, #l2_datas").html('<option value="" selected="selected" class="none">Choose '+b.l2+"</option>");try{lx_select(a,1,!1)}catch(c){readHierarchy(a,1,!1)}});$("#l2_select, #l2_reports, #l2_datas").change(function(){var a=
this.value,b=hdata[$("#l0_select").val()];$("#l3_select, #l3_reports, #l3_datas").html('<option value="" selected="selected" class="none">Choose '+b.l3+"</option>");try{lx_select(a,2,!1)}catch(c){readHierarchy(a,2,!1)}});$("#l0_analysis1s").change(function(){var a=this.value,b=hdata[a];$("#l1_analysis1s").html('<option value="" selected="selected" class="none">Choose '+b.l1+"</option>");try{lx_select(a,0,1)}catch(c){readHierarchy(a,0,1)}});$("#l0_analysis2s").change(function(){var a=this.value,b=
hdata[a];$("#l1_analysis2s").html('<option value="" selected="selected" class="none">Choose '+b.l1+"</option>");try{lx_select(a,0,2)}catch(c){readHierarchy(a,0,2)}});$("#l0_analysis3s").change(function(){var a=this.value,b=hdata[a];$("#l1_analysis3s").html('<option value="" selected="selected" class="none">Choose '+b.l1+"</option>");try{lx_select(a,0,3)}catch(c){readHierarchy(a,0,3)}});$("#l1_analysis1s").change(function(){var a=this.value,b=hdata[$("#l0_analysis1s").val()];$("#l2_analysis1s").html('<option value="" selected="selected" class="none">Choose '+
b.l2+"</option>");try{lx_select(a,1,1)}catch(c){readHierarchy(a,1,1)}});$("#l1_analysis2s").change(function(){var a=this.value,b=hdata[$("#l0_analysis2s").val()];$("#l2_analysis2s").html('<option value="" selected="selected" class="none">Choose '+b.l2+"</option>");try{lx_select(a,1,2)}catch(c){readHierarchy(a,1,2)}});$("#l1_analysis3s").change(function(){var a=this.value,b=hdata[$("#l0_analysis3s").val()];$("#l2_analysis3s").html('<option value="" selected="selected" class="none">Choose '+b.l2+"</option>");
try{lx_select(a,1,3)}catch(c){readHierarchy(a,1,3)}});$("#l2_analysis1s").change(function(){var a=this.value,b=hdata[$("#l0_analysis1s").val()];$("#l3_analysis1s").html('<option value="" selected="selected" class="none">Choose '+b.l3+"</option>");try{lx_select(a,2,1)}catch(c){readHierarchy(a,2,1)}});$("#l2_analysis2s").change(function(){var a=this.value,b=hdata[$("#l0_analysis2s").val()];$("#l3_analysis2s").html('<option value="" selected="selected" class="none">Choose '+b.l3+"</option>");try{lx_select(a,
2,2)}catch(c){readHierarchy(a,2,2)}});$("#l2_analysis3s").change(function(){var a=this.value,b=hdata[$("#l0_analysis3s").val()];$("#l3_analysis3s").html('<option value="" selected="selected" class="none">Choose '+b.l3+"</option>");try{lx_select(a,2,3)}catch(c){readHierarchy(a,2,3)}});updateSelectMenus(!1);$("#analysisControl2 select, #analysisControl3 select").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:165,menuWidth:165});$("#analysisToggle").selectmenu("destroy").selectmenu({maxHeight:60,
width:145,menuWidth:145});resizeSubmitData();TypeHelpers.insertClasses();$(".closechromeframe").click(function(){$(".chromeframe").hide()});$("#globalBreadCrumb").click(function(){globalView()});$("#show-hide").click(function(){drawerSlide()});$("#risingTab").click(function(){drawerSlide()});$("#newRegion").click(function(){goToRegion()});$("#analysisLink").click(function(){analysisView()});$("#analysisToggle select").click(function(){toggleAnalysis()});$("#backToMap").click(function(){hideAnalysis()});
$("#analysisReset1").click(function(){analysisReset(1)});$("#analysisReset2").click(function(){analysisReset(2)});$("#analysisReset3").click(function(){analysisReset(3)});$(".calculationLink").click(function(){$("#lightbox, #calculationView").fadeIn(300)});$("#calculationView .closePanel").click(function(){$("#lightbox, #calculationView").fadeOut(300)});$(".headerRow").click(function(){$(".rowForApproval").hide();$(".rowForApproval").prev().find(".closeReviewButton").hide();$(".rowForApproval").prev().find(".reviewButton").show();
$(".headerRow.activeSection td.arrowCell .arrow").html("&rarr;");$(".headerRow.activeSection").removeClass("activeSection");$(this).addClass("activeSection");$(".headerRow.activeSection .arrow").html("&darr;");$(".activeContent").hide("slow");$(".activeContent").removeClass("activeContent");$(this).next().addClass("activeContent");$(this).parent().next().addClass("activeContent");$(".activeContent").fadeIn(200);resizeReports()});$("#filterSubmit").click(function(){displayThanks(S3.i18n.loading_report_details,
null);$("#table-container").empty();hideReportDetails(id);var a=getFilteredReport();$.ajax({type:"POST",url:"report/filter",data:a}).done(function(a){$(".approvalScreen").hide();displayReport(a)}).fail(function(){alert("error");$(".approvalScreen").hide()})});$("#l3_datas").change(indicatorsCheckCommune);$("#submitIndicators").click(function(){showSubmitData("indicators")});$("#submitReports").click(function(){showSubmitData("reports")});$("#uploadIndicatorsButton").click(uploadSubmitDataIndicators);
$("#submitDataFooter .reviewNextButton").click(nextSubmitDataReview);$("#submitDataFooter .backButton").click(backSubmitDataReview);$("#submitDataFooter .cancelButton").click(cancelSubmitDataTypeSelection);$("#submitDataFooter .submitAllButton").click(submitImportSubmitData);$("#submitDataFooter .submitMoreButton").click(moreSubmitData);$("#submitOnlineButton").click(function(){$(this).hasClass("disabled")||displaySubmitOnline()});$("#submitDataFooter .reviewSubmissionButton").click(reviewSubmitData);
$("#submitDataFooter .submitButton").click(function(){$(".submitIndicatorsForm").is(":visible")?submitSubmitData():uploadSubmitDataReport(this)});$(".submitIndicatorsForm input").change(function(){10==$(".submitIndicatorsForm input:radio:checked").length&&$("#submitDataFooter .reviewSubmissionButton").removeClass("disabled")});$(".dataSubmissionRegion input:radio").change(selectOptionSubmitData);$("#lightbox").click(function(){$("#lightbox, #reportsSection, #calculationView, #photoPanel, #submitDataSection").fadeOut(300)});
$("#reportsSection .closePanel").click(function(){$("#lightbox, #reportsSection").fadeOut(300)});$("#submitDataSection .closePanel").click(function(){$("#submitDataContent").animate({scrollTop:0},100);$("#lightbox, #submitDataSection").fadeOut(300)});$(".listText").hover(function(){$(this).siblings(".popup").show()},function(){$(this).siblings(".popup").hide()});$("#subGeo, .currentQuality").hover(function(){var a=$(this).find(".popup");$(a).data("timeout",setTimeout(function(){showSubGeo(a,200)},
200))},function(){var a=$(this).find(".popup");hideSubGeo(a,200);clearTimeout($(a).data("timeout"))})});function showSubGeo(a,b){"undefined"!==typeof activeWindow&&(clearTimeout(activeWindow.data("timeout")),activeWindow.fadeOut(b));a.fadeIn(b);activeWindow=a}function hideSubGeo(a,b){a.fadeOut(b)}
function readHierarchy(a,b,d){$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+a),success:function(){for(var c in n)vdata[c]=n[c];n=null;lx_select(a,b,d)},error:function(a,b,d){msg="UNAUTHORIZED"==d?S3.i18n.gis_requires_login:a.responseText},dataType:"script"})}
function lx_select(a,b,d){if(0==b)if(d)$("#l"+b+"_analysis"+d+"s").val(a);else{$("#l0_select, #l0_reports, #l0_datas, #l0_analysis1s").val(a);var c=hdata[a];$("#l1 label, #l1_report label, #l1_data label").html(c.l1.toUpperCase()+":");$("#l2 label, #l2_report label, #l2_data label").html(c.l2.toUpperCase()+":");$("#l3 label, #l3_report label, #l3_data label").html(c.l3.toUpperCase()+":")}b+=1;d?$("#l"+b+"_analysis"+d).show():$("#l"+b+", #l"+b+"_report, #l"+b+"_data, #l"+b+"_analysis1").show();var e,
f;for(f in vdata)if(c=vdata[f],null!=c.f&&c.f==a){switch(c.r){case 1:e="one";break;case 2:e="two";break;case 3:e="three";break;case 4:e="four";break;case 5:e="five";break;default:e="none"}c='<option value="'+f+'" class="'+e+'">'+c.n+"</option>";d?$("#l"+b+"_analysis"+d+"s").append(c):$("#l"+b+"_select, #l"+b+"_reports, #l"+b+"_datas, #l"+b+"_analysis1s").append(c)}updateSelectMenus(d)}
function updateSelectMenus(a){a?$("#analysisControl"+a+" select").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:165,menuWidth:165}):($("#browseOtherRegions select").selectmenu({style:"popup",maxHeight:280,width:160,menuWidth:160,icons:[{find:".one"},{find:".two"},{find:".three"},{find:".four"},{find:".five"}]}),$(".locationFilters select").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:160,menuWidth:160,icons:[{find:".one"},{find:".two"},{find:".three"},
{find:".four"},{find:".five"}]}),$("#chartSwitcher").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:125,menuWidth:125}),$("#analysisControl1 select").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:165,menuWidth:165}))}
function showMap(){OpenLayers.ImgPath=S3.Ap.concat("/static/img/gis/openlayers/");proj4326=new OpenLayers.Projection("EPSG:4326");map=new OpenLayers.Map("map",{theme:null});var a=new OpenLayers.Layer.WMS("VMap0","http://vmap0.tiles.osgeo.org/wms/vmap0",{layers:"basic"},{wrapDateLine:!0});map.addLayer(a);OpenLayers.Control.PanZoom.Y=50;a=new OpenLayers.Control.PanZoomBar;map.addControl(a);parser=new OpenLayers.Format.GeoJSON({});a=new OpenLayers.Style({fillColor:"${fill}",fillOpacity:"${fillOpacity}",
strokeColor:"#ffffff",strokeWidth:"${strokeWidth}",strokeOpacity:1,graphicWidth:14,graphicHeight:14,graphicXOffset:-7,graphicYOffset:-14,graphicOpacity:1,externalGraphic:"${externalGraphic}"},{context:{fill:function(a){return colors[a.attributes.r]},fillOpacity:function(a){return a.attributes.outline?0.1:0.5},strokeWidth:function(a){return a.attributes.outline?3:1},externalGraphic:function(a){a=a.attributes.r;if(5==a)a="/static/themes/Vulnerability/img/rating5.png";else if(4==a)a="/static/themes/Vulnerability/img/rating4.png";
else if(3==a)a="/static/themes/Vulnerability/img/rating3.png";else if(2==a)a="/static/themes/Vulnerability/img/rating2.png";else if(1==a)a="/static/themes/Vulnerability/img/rating1.png";else return"";return S3.Ap.concat(a)}}});a=new OpenLayers.StyleMap({"default":a,select:{fillOpacity:1}});strategy=new OpenLayers.Strategy.Fixed;protocol=new OpenLayers.Protocol.HTTP({url:S3.Ap.concat("/static/cache/countries.geojson"),format:parser});resilienceLayer=new OpenLayers.Layer.Vector("Resilience",{strategies:[strategy],
protocol:protocol,styleMap:a});map.addLayer(resilienceLayer);resilienceLayer.events.on({beforefeatureadded:addAttributes,featureselected:onResilienceFeatureSelect,featureunselected:onFeatureUnselect});""==start?globalView():v_select_region(0,start);$("#resilienceCheck").change(function(){$("#resilienceCheck").is(":checked")?resilienceCheckLayer.display(!0):resilienceCheckLayer.display(!1)});populationLayer=new OpenLayers.Layer.WMS("Population Density","http://rmsgeo.aidiq.com/geoserver/gwc/service/wms",
{layers:"ifrc:populationDensity"},{wrapDateLine:!0,isBaseLayer:!1});populationLayer.params.STYLES="populationDensityGrey";populationLayer.opacity=0.8;$("#populationCheck").change(function(){$("#populationCheck").is(":checked")?map.addLayer(populationLayer):map.removeLayer(populationLayer)});a=new OpenLayers.Style({graphicWidth:"${graphicWidth}",graphicHeight:"${graphicHeight}",graphicXOffset:"${graphicXOffset}",graphicYOffset:"${graphicYOffset}",externalGraphic:"${externalGraphic}"},{context:{graphicWidth:function(a){return a.cluster?
26:15},graphicHeight:function(a){return a.cluster?44:32},graphicXOffset:function(a){return a.cluster?-13:-7},graphicYOffset:function(a){return a.cluster?-44:-32},externalGraphic:function(a){return S3.Ap.concat(a.cluster?"/static/themes/Vulnerability/img/volunteer.png":"/static/themes/Vulnerability/img/volunteerIconOnPng8.png")}}});a=new OpenLayers.StyleMap({"default":a});volunteerLayer=new OpenLayers.Layer.Vector("Volunteers",{strategies:[new OpenLayers.Strategy.BBOX({ratio:1.5}),new OpenLayers.Strategy.Cluster({distance:20,
threshold:2})],styleMap:a,protocol:new OpenLayers.Protocol.HTTP({url:S3.Ap.concat("/vol/volunteer.geojson?components=None&maxdepth=0&references=location_id&fields=name&human_resource.status=1&track=1"),format:new OpenLayers.Format.GeoJSON})});OpenLayers.Control.SelectFeatureDouble=OpenLayers.Class(OpenLayers.Control.SelectFeature,{initialize:function(a,d){OpenLayers.Control.SelectFeature.prototype.initialize.apply(this,[a,d]);this.handlers={feature:new OpenLayers.Handler.FeatureDoubleClick(this,this.layer,
this.callbacks,{geometryTypes:this.geometryTypes})}},CLASS_NAME:"OpenLayers.Control.SelectFeatureDouble"});popupControl=new OpenLayers.Control.SelectFeatureDouble(resilienceLayer,{toggle:!0});popupControl.handlers.feature.callbacks.dblclick=function(a){var d=a.attributes.id;void 0==vdata[d].q?$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+d),async:!1,success:function(){for(var c in n)vdata[c]=n[c];n=null;v_select_region(a.attributes.l,d)},error:function(a,b,d){msg="UNAUTHORIZED"==d?S3.i18n.gis_requires_login:
a.responseText;console.log(msg)},dataType:"script"}):v_select_region(a.attributes.l,d)};map.addControl(popupControl);popupControl.activate()}
function addAttributes(a){var b=a.feature,d=b.attributes.id,c;try{c=vdata[d].l}catch(e){$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+d),async:!1,success:function(){for(var a in n)vdata[a]=n[a];n=null;c=vdata[d].l},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"script"})}a=vdata[d].r;b.attributes.l=c;b.attributes.r=a;b=b.geometry;0!=b.getArea()&&(a=new OpenLayers.Feature.Vector(b.getCentroid(),{id:parseInt(d),l:c,r:a}),resilienceLayer.addFeatures([a]))}
function onFeatureUnselect(a){a=a.feature;a.popup&&($(".ui-selectmenu-menu").removeClass("ui-selectmenu-open"),map.removePopup(a.popup),a.popup.destroy(),delete a.popup)}
function onResilienceFeatureSelect(a){drawerOpen&&drawerSlide();var a=a.feature,b=a.geometry.getBounds().getCenterLonLat();map.setCenter(b);var d=a.attributes.id,c=a.attributes.l,e="    <h3>"+S3.i18n.data_quality.toUpperCase()+":</h3>     <div class='windowQualityRatings'>        <div class='poor'>"+S3.i18n.poor.toUpperCase()+"            <div class='popup'>                <div class='popupContent'>                    <h3>"+S3.i18n.poor.toUpperCase()+"</h3>                    <p>0&ndash;25% "+S3.i18n.of_total_data_reported+
".</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='fair'>"+S3.i18n.fair.toUpperCase()+"            <div class='popup'>                <div class='popupContent'>                    <h3>"+S3.i18n.fair.toUpperCase()+"</h3>                    <p>25&ndash;50% "+S3.i18n.of_total_data_reported+".</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='moderate'>"+
S3.i18n.moderate.toUpperCase()+"            <div class='popup'>                <div class='popupContent'>                    <h3>"+S3.i18n.moderate.toUpperCase()+"</h3>                    <p>50&ndash;75% "+S3.i18n.of_total_data_reported+".</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='strong'>"+S3.i18n.strong.toUpperCase()+"            <div class='popup'>                <div class='popupContent'>                    <h3>"+
S3.i18n.strong.toUpperCase()+"</h3>                    <p>75&ndash;100% "+S3.i18n.of_total_data_reported+".</p>                </div>                <div class='popupBottom'></div>            </div>        </div>    </div>",f=vdata[d];switch(c){case 0:var h=hdata[d],i=S3.i18n.country,g=S3.i18n.country.toUpperCase(),j=h.l1.toUpperCase(),k=h.l3,h="            <h3>"+j+"S "+S3.i18n.in_this.toUpperCase()+" "+g+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>"+
S3.i18n.go_to_the.toUpperCase()+" "+j+" <span class='arrow'>&rarr;</span></a>";break;case 1:h=hdata[current_l0];i=h.l1;g=i.toUpperCase();j=h.l2.toUpperCase();k=h.l3;h="            <h3>"+j+"S "+S3.i18n.in_this.toUpperCase()+" "+g+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>"+S3.i18n.go_to_the.toUpperCase()+" "+j+" <span class='arrow'>&rarr;</span></a>";break;case 2:h=hdata[current_l0];i=h.l2;g=i.toUpperCase();j=h.l3.toUpperCase();k=h.l3;
h="            <h3>"+j+"S "+S3.i18n.in_this.toUpperCase()+" "+g+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>"+S3.i18n.go_to_the.toUpperCase()+" "+j+" <span class='arrow'>&rarr;</span></a>";break;case 3:h=hdata[current_l0],i=h.l3,g=i.toUpperCase(),h="",e="<div class='lastCollected'></div>"}var m=f.n,j=f.r;0==j&&(j="");k&&(e+="<div class='subGeoCommunesReported'></div>");var i="    <section class='infoWindow'>\t\t<div class='infoWindowMain unselectable'>\t\t\t<div id='subGeoIndicator'>"+
j+"</div>\t\t\t<h2 class='subGeoName'>"+m+"</h2>\t\t\t<h2 class='subGeoType'>"+i+"</h2>\t\t\t<a id='goToRegion' class='goToSubRegion'>"+S3.i18n.go_to_the+" "+g+" <span class='arrow'>&rarr;</span></a>\t\t\t"+e+"\t\t\t<h3 id='population'>"+S3.i18n.population.toUpperCase()+": </h3>\t\t\t"+h+"\t\t\t<div class='infoWindowButtons'>\t\t\t\t<div class='subGeoSubmitDataButton'>"+S3.i18n.submit_data+"</div>\t\t\t\t<div class='subGeoAnalysisButton'>"+S3.i18n.analysis+"</div>\t\t\t\t<div class='subGeoReportsButton'>"+
S3.i18n.reports+"</div>\t\t\t</div>\t\t</div>\t</section>",l=new OpenLayers.Popup.FramedCloud(d,b,new OpenLayers.Size(200,200),i,null,!0,closePopups);a.popup=l;map.addPopup(l);$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+d),success:function(){for(var a in n)vdata[a]=n[a];n=null;f=vdata[d];k?$(".subGeoCommunesReported").html(f.c+" "+S3.i18n.out_of+" "+f.t+" "+k+"s "+S3.i18n.reported):$(".windowQualityRatings").html(S3.i18n.last_data_collected_on+" "+f.d+" "+S3.i18n.by+" "+f.w);var b=f.p;b&&$("#population").html(S3.i18n.population.toUpperCase()+
": "+b);switch(f.q){case "p":$(".poor").addClass("currentQuality");break;case "f":$(".fair").addClass("currentQuality");break;case "m":$(".moderate").addClass("currentQuality");break;case "s":$(".strong").addClass("currentQuality")}for(a in vdata)if(vdata[a].l==c+1&&vdata[a].f==d){switch(vdata[a].r){case 1:b="one";break;case 2:b="two";break;case 3:b="three";break;case 4:b="four";break;case 5:b="five";break;default:b="none"}$(".subGeoSelect").append('<option value="'+a+'" class="'+b+'">'+vdata[a].n+
"</option>")}$(".subGeoSelect").selectmenu({style:"popup",maxHeight:280,width:160,menuWidth:160,icons:[{find:".one"},{find:".two"},{find:".three"},{find:".four"},{find:".five"}]});$("#goToRegion").click(function(){v_select_region(c,d)});$("#goToSubRegion").click(function(){var a=$(".subGeoSelect").val();void 0==vdata[a].q?$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+a),async:!1,success:function(){for(var b in n)vdata[b]=n[b];n=null;v_select_region(c+1,a)},error:function(a,b,c){msg="UNAUTHORIZED"==
c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"script"}):v_select_region(c+1,a)});l.updateSize()},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;$("#"+d+"_contentDiv").html(msg);l.updateSize()},dataType:"script"});""==j?$("#subGeoIndicator").css("background-color",colors[0]):$("#subGeoIndicator").css("background-color",colors[j])}
function closePopups(){for(;map.popups.length;)map.removePopup(map.popups[0]);$(".ui-selectmenu-menu").removeClass("ui-selectmenu-open")}function hideFeature(a){var a=resilienceLayer.getFeaturesByAttribute("id",parseInt(a)),b;for(b in a)try{var d=a[b];0==d.geometry.getArea()?d.destroy():(d.attributes.outline=1,resilienceLayer.drawFeature(d))}catch(c){}}
function showFeature(a){if(null!=a){var b=resilienceLayer.getFeaturesByAttribute("id",parseInt(a)),d;for(d in b)try{var c=b[d];c.attributes.outline=0;resilienceLayer.drawFeature(c);var e=new OpenLayers.Feature.Vector(c.geometry.getCentroid(),{id:parseInt(a),l:c.attributes.l,r:c.attributes.r});resilienceLayer.addFeatures([e])}catch(f){}}}
function removeFeatures(a){var b,d=[],c;for(c in resilienceLayer.features){b=resilienceLayer.features[c];try{b.attributes.l>=a&&d.push(b)}catch(e){}}resilienceLayer.destroyFeatures(d)}
function globalView(){closePopups();removeFeatures(1);var a=(new OpenLayers.LonLat(80,-50)).transform(proj4326,map.getProjectionObject()),b=(new OpenLayers.LonLat(180,50)).transform(proj4326,map.getProjectionObject());map.zoomToExtent([a.lon,a.lat,b.lon,b.lat]);showFeature(current_l0);showFeature(current_l1);showFeature(current_l2);showFeature(current_l3);$("#l0_breadcrumb, #l1_breadcrumb, #l2_breadcrumb, #l3_breadcrumb, #show-hide, #divider, #analysisLink, #indicator, #risingTab").hide();$(".geoName").html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select a country");
$(".geoType").html("");$(".year").html("");markersOff();current_l3=current_l2=current_l1=current_l0=null}
function v_select_region(a,b){closePopups();var d=vdata[b];switch(a){case 0:current_l0!=b&&(showFeature(current_l0),current_l0=b);current_l3=current_l2=current_l1="";var c=hdata[b],e=d.n;$("#l1_breadcrumb, #l2_breadcrumb, #l3_breadcrumb").hide();$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+b+");");$("#l0_breadcrumb span").html(" &raquo; "+e);$(".geoName").html(e);$(".geoType").html(S3.i18n.country_in);$("#l0_select, #l0_reports, #l0_datas, #l0_analysis1s").val(b);$("#l1_select, #l1_reports, #l1_datas, #l1_analysis1s").val("");
$("#l2_select, #l2_reports, #l2_datas, #l2_analysis1s").val("");$("#l3_select, #l3_reports, #l3_datas, #l3_analysis1s").val("");$("#l1, #l1_report, #l1_data, #l1_analysis1").show();$("#l2, #l2_report, #l2_data, #l2_analysis1").hide();$("#l3, #l3_report, #l3_data, #l3_analysis1").hide();markersOff();removeFeatures(1);hideFeature(b);$.ajax({url:S3.Ap.concat("/static/cache/1_"+b+".geojson"),success:function(a){var a=parser.read(a),b;for(b in a)try{a[b].geometry&&a[b].geometry.transform(proj4326,map.getProjectionObject())}catch(c){}resilienceLayer.addFeatures(a);
popupControl.unselectAll()},error:function(a,b,c){msg=c=="UNAUTHORIZED"?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});break;case 1:current_l1!=b&&(showFeature(current_l1),current_l1=b);current_l0!=d.f&&(showFeature(current_l0),current_l0=d.f);current_l3=current_l2="";var c=hdata[current_l0],e=vdata[current_l0].n,f=d.n;$("#l2_breadcrumb, #l3_breadcrumb").hide();$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+current_l0+");");$("#l0_breadcrumb span").html(" &raquo; "+
e);$("#l1_breadcrumb").show().attr("href","javascript:v_select_region(1,"+b+");");$("#l1_breadcrumb span").html(" &raquo; "+f);$(".geoName").html(f);e=c.l1;$(".geoType").html(e+" "+S3.i18n.in_);$("#l0_select, #l0_reports, #l0_datas, #l0_analysis1s").val(current_l0);$("#l1_select, #l1_reports, #l1_datas, #l1_analysis1s").val(b);$("#l2_select, #l2_reports, #l2_datas, #l2_analysis1s").val("");$("#l3_select, #l3_reports, #l3_datas, #l3_analysis1s").val("");$("#l1, #l1_report, #l1_data, #l1_analysis1").show();
$("#l2, #l2_report, #l2_data, #l2_analysis1").show();$("#l3, #l3_report, #l3_data, #l3_analysis1").hide();markersOff();removeFeatures(2);e=resilienceLayer.getFeaturesByAttribute("id",parseInt(b));(e=[])&&$.ajax({url:S3.Ap.concat("/static/cache/1_"+current_l0+".geojson"),async:!1,success:function(a){var a=parser.read(a),c=[],d;for(d in a)try{if(a[d].attributes.id==b){a[d].geometry.transform(proj4326,map.getProjectionObject());c.push(a[d])}}catch(e){}resilienceLayer.addFeatures(c);popupControl.unselectAll()},
error:function(a,b,c){msg=c=="UNAUTHORIZED"?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});hideFeature(b);$.ajax({url:S3.Ap.concat("/static/cache/2_"+b+".geojson"),success:function(a){var a=parser.read(a),b;for(b in a)try{a[b].geometry&&a[b].geometry.transform(proj4326,map.getProjectionObject())}catch(c){}resilienceLayer.addFeatures(a);popupControl.unselectAll()},error:function(a,b,c){msg=c=="UNAUTHORIZED"?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},
dataType:"json"});break;case 2:current_l2!=b&&(showFeature(current_l2),current_l2=b);current_l1!=d.f&&(showFeature(current_l1),current_l1=d.f);current_l0!=vdata[current_l1].f&&(showFeature(current_l0),current_l0=vdata[current_l1].f);current_l3="";var c=hdata[current_l0],e=vdata[current_l0].n,f=vdata[current_l1].n,h=d.n;$("#l3_breadcrumb").hide();$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+current_l0+");");$("#l0_breadcrumb span").html(" &raquo; "+e);$("#l1_breadcrumb").show().attr("href",
"javascript:v_select_region(1,"+current_l1+");");$("#l1_breadcrumb span").html(" &raquo; "+f);$("#l2_breadcrumb").show().attr("href","javascript:v_select_region(2,"+b+");");$("#l2_breadcrumb span").html(" &raquo; "+h);$(".geoName").html(h);e=c.l2;$(".geoType").html(e+" "+S3.i18n.in_);$("#l0_select, #l0_reports, #l0_datas, #l0_analysis1s").val(current_l0);$("#l1_select, #l1_reports, #l1_datas, #l1_analysis1s").val(current_l1);$("#l2_select, #l2_reports, #l2_datas, #l2_analysis1s").val(b);$("#l3_select, #l3_reports, #l3_datas, #l3_analysis1s").val("");
$("#l1, #l1_report, #l1_data, #l1_analysis1").show();$("#l2, #l2_report, #l2_data, #l2_analysis1").show();$("#l3, #l3_report, #l3_data, #l3_analysis1").show();markersOn();removeFeatures(3);e=resilienceLayer.getFeaturesByAttribute("id",parseInt(b));(e=[])&&$.ajax({url:S3.Ap.concat("/static/cache/2_"+current_l1+".geojson"),async:!1,success:function(a){var a=parser.read(a),c=[],d;for(d in a)try{if(a[d].attributes.id==b){a[d].geometry.transform(proj4326,map.getProjectionObject());c.push(a[d])}}catch(e){}resilienceLayer.addFeatures(c);
popupControl.unselectAll()},error:function(a,b,c){msg=c=="UNAUTHORIZED"?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});hideFeature(b);$.ajax({url:S3.Ap.concat("/static/cache/3_"+b+".geojson"),success:function(a){var a=parser.read(a),b;for(b in a)try{a[b].geometry&&a[b].geometry.transform(proj4326,map.getProjectionObject())}catch(c){}resilienceLayer.addFeatures(a);popupControl.unselectAll()},error:function(a,b,c){msg=c=="UNAUTHORIZED"?S3.i18n.gis_requires_login:a.responseText;
console.log(msg)},dataType:"json"});break;case 3:current_l3!=b&&(showFeature(current_l3),current_l3=b);current_l2!=d.f&&(showFeature(current_l2),current_l2=d.f);current_l1!=vdata[current_l2].f&&(showFeature(current_l1),current_l1=vdata[current_l2].f);current_l0!=vdata[current_l1].f&&(showFeature(current_l0),current_l0=vdata[current_l1].f);var c=hdata[current_l0],e=vdata[current_l0].n,f=vdata[current_l1].n,h=vdata[current_l2].n,i=d.n;$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+
current_l0+");");$("#l0_breadcrumb span").html(" &raquo; "+e);$("#l1_breadcrumb").show().attr("href","javascript:v_select_region(1,"+current_l1+");");$("#l1_breadcrumb span").html(" &raquo; "+f);$("#l2_breadcrumb").show().attr("href","javascript:v_select_region(2,"+current_l2+");");$("#l2_breadcrumb span").html(" &raquo; "+h);$("#l3_breadcrumb").show().attr("href","javascript:v_select_region(3,"+b+");");$("#l3_breadcrumb span").html(" &raquo; "+i);$(".geoName").html(i);e=c.l3;$(".geoType").html(e+
" "+S3.i18n.in_);$("#l0_select, #l0_reports, #l0_datas, #l0_analysis1s").val(current_l0);$("#l1_select, #l1_reports, #l1_datas, #l1_analysis1s").val(current_l1);$("#l2_select, #l2_reports, #l2_datas, #l2_analysis1s").val(current_l2);$("#l3_select, #l3_reports, #l3_datas, #l3_analysis1s").val(b);$("#l1, #l1_report, #l1_data, #l1_analysis1").show();$("#l2, #l2_report, #l2_data, #l2_analysis1").show();$("#l3, #l3_report, #l3_data, #l3_analysis1").show();markersOn();e=resilienceLayer.getFeaturesByAttribute("id",
parseInt(b));(e=[])&&$.ajax({url:S3.Ap.concat("/static/cache/3_"+current_l2+".geojson"),async:!1,success:function(a){var a=parser.read(a),c=[],d;for(d in a)try{if(a[d].attributes.id==b){a[d].geometry.transform(proj4326,map.getProjectionObject());c.push(a[d])}}catch(e){}resilienceLayer.addFeatures(c);popupControl.unselectAll()},error:function(a,b,c){msg=c=="UNAUTHORIZED"?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"})}var e=resilienceLayer.getFeaturesByAttribute("id",
parseInt(b)),g;for(g in e)try{var j=e[g];if(0!=j.geometry.getArea()){var k=j.geometry.getBounds();map.zoomToExtent(k)}}catch(m){}$(".year").html("2012");if(3==a)$("#subGeoDivider").html(""),$("#subGeoReported").html(""),$("#subGeoPopup").html("");else{$("#subGeoDivider").html("|");j=0;k=[];for(g in vdata)if(vdata[g].f==b&&(e=vdata[g].r))e="<li><div class='ratingBox"+e+"'>"+e+"</div><p>"+vdata[g].n+"</p></li>",k.push(e),j++;1==j?$("#subGeoReported").html("1 "+c["l"+(a+1)]+" "+S3.i18n.reported):$("#subGeoReported").html(j+
" "+c["l"+(a+1)]+"s "+S3.i18n.reported);j="            <div class='popupContent'>            <ul>"+k.join("")+"</ul>          </div>          <div class='popupBottom'></div>";$("#subGeoPopup").html(j)}j=d.r;null==j?($("#indicator").css("background-color",colors[0]),$("#mainRating").css("background-color",colors[0])):($("#indicator").html(j),$("#mainRating").html(j),$("#indicator").css("background-color",colors[j]),$("#mainRating").css("background-color",colors[j]));j=d.i;k=!1;for(g in j)k=!0,b=g,
h=j[g],e=h.min,f=h.max,h=h.med,i="#visRange"+b,$(i).css("left",58*e+"px"),$(i).css("width",58*(f-e)+"px"),$(i+" .medianDot").css("left",58*(h-e)+"px"),h==e?$(i+" .leftBox").hide():$(i+" .leftBox").show(),h==f?$(i+" .rightBox").hide():$(i+" .rightBox").show();k?$(".visRange").show():$(".visRange").hide();3==a?$("#qualityCommunes").html(S3.i18n.last_data_collected_on+": "+d.d):$("#qualityCommunes").html(d.c+" "+S3.i18n.out_of+" "+d.t+" "+c.l3+"s "+S3.i18n.reported);switch(d.q){case "p":$("#poor").addClass("currentQuality");
$("#fair").removeClass("currentQuality");$("#moderate").removeClass("currentQuality");$("#strong").removeClass("currentQuality");break;case "f":$("#poor").removeClass("currentQuality");$("#fair").addClass("currentQuality");$("#moderate").removeClass("currentQuality");$("#strong").removeClass("currentQuality");break;case "m":$("#poor").removeClass("currentQuality");$("#fair").removeClass("currentQuality");$("#moderate").addClass("currentQuality");$("#strong").removeClass("currentQuality");break;case "s":$("#poor").removeClass("currentQuality"),
$("#fair").removeClass("currentQuality"),$("#moderate").removeClass("currentQuality"),$("#strong").addClass("currentQuality")}$("#populationCount .listText").html(d.p);$("#populationCount .popupContent p").html(d.s);if(3==a)for(g in d.b)j=d.b[g],$("#dataBreakdown ul").append("            <li>                <p>"+j.n+":</p>                <div class='statistic'>                    <div class='listText'>"+j.v+"</div>                    <div class='popup'>                        <div class='popupContent'>                            <p>Source: "+
j.s+"</p>                        </div>                        <div class='popupBottom'></div>                    </div>                </div>            </li>            ");current_l1?$("#l1_select, #l1_reports, #l1_datas, #l1_analysis1s").html('<option value="" class="none">'+S3.i18n.choose+" "+c.l1+"</option>"):$("#l1_select, #l1_reports, #l1_datas, #l1_analysis1s").html('<option value="" selected="selected" class="none">'+S3.i18n.choose+" "+c.l1+"</option>");current_l2?$("#l2_select, #l2_reports, #l2_datas, #l2_analysis1s").html('<option value="" class="none">'+
S3.i18n.choose+" "+ +c.l2+"</option>"):$("#l2_select, #l2_reports, #l2_datas, #l2_analysis1s").html('<option value="" selected="selected" class="none">'+S3.i18n.choose+" "+c.l2+"</option>");current_l3?$("#l3_select, #l3_reports, #l3_datas, #l3_analysis1s").html('<option value="" class="none">'+S3.i18n.choose+" "+c.l3+"</option>"):$("#l3_select, #l3_reports, #l3_datas, #l3_analysis1s").html('<option value="" selected="selected" class="none">'+S3.i18n.choose+" "+c.l3+"</option>");for(g in vdata){switch(vdata[g].r){case 1:res=
"one";break;case 2:res="two";break;case 3:res="three";break;case 4:res="four";break;case 5:res="five";break;default:res="none"}null!=vdata[g].f&&(vdata[g].f==current_l0?(selected=g==current_l1?' selected="selected"':"",$("#l1_select, #l1_reports, #l1_datas, #l1_analysis1s").append('<option value="'+g+'" class="'+res+'"'+selected+">"+vdata[g].n+"</option>")):vdata[g].f==current_l1?(selected=g==current_l2?' selected="selected"':"",$("#l2_select, #l2_reports, #l2_datas, #l2_analysis1s").append('<option value="'+
g+'" class="'+res+'"'+selected+">"+vdata[g].n+"</option>")):vdata[g].f==current_l2&&(selected=g==current_l3?' selected="selected"':"",$("#l3_select, #l3_reports, #l3_datas, #l3_analysis1s").append('<option value="'+g+'" class="'+res+'"'+selected+">"+vdata[g].n+"</option>")))}$("#l1 label, #l1_report label, #l1_data label").html(c.l1.toUpperCase()+":");$("#l2 label, #l2_report label, #l2_data label").html(c.l2.toUpperCase()+":");$("#l3 label, #l3_report label, #l3_data label").html(c.l3.toUpperCase()+
":");updateSelectMenus(!1);drawerOpen||($("#show-hide").html('<span class="arrow">&uarr;</span> '+S3.i18n.show_more.toUpperCase()).show(),$("#divider").show(),$("#analysisLink").show(),d=S3.Ap.concat("/static/themes/Vulnerability/img/openTabPng8.png"),$("#risingTab").css("background-image","url("+d+")").show())}
function drawerSlide(){switch(drawerOpen){case !0:$(".hidden").hide("slow");$("#show-hide").html('<span class="arrow">&uarr;</span> '+S3.i18n.show_more.toUpperCase());var a=S3.Ap.concat("/static/themes/Vulnerability/img/openTabPng8.png");$("#risingTab").css("background-image","url("+a+")");$(".olPopup").fadeIn(300);$("#dummy_location_search").autocomplete("option","position",{my:"left bottom",at:"left top"});drawerOpen=!1;break;case !1:$("#drawerInside").show("slow"),$("#drawerInside").data("fade",
setTimeout(function(){$("#resilienceSummary, #drawerQuickActions, #indicatorRatingChart, #browseOtherRegions, #dataBreakdown").fadeIn(500);$(".communeOnly").hide()},500)),$("#show-hide").html('<span class="arrow">&darr;</span> '+S3.i18n.show_less.toUpperCase()),a=S3.Ap.concat("/static/themes/Vulnerability/img/closeTabPng8.png"),$("#risingTab").css("background-image","url("+a+")"),$(".olPopup").fadeOut(300),$("#dummy_location_search").autocomplete("option","position",{my:"left top",at:"left bottom"}),
drawerOpen=!0}}function goToRegion(){var a;(a=$("#l3_select").val())?v_select_region(3,a):(a=$("#l2_select").val())?v_select_region(2,a):(a=$("#l1_select").val())?v_select_region(1,a):(a=$("#l0_select").val())&&v_select_region(0,a)}
function markersOn(){map.addLayer(volunteerLayer);var a=S3.Ap.concat("/static/themes/Vulnerability/img/mapIconOnPng8.png");$("#mapSection").css("background","url("+a+") no-repeat center top transparent");a=S3.Ap.concat("/static/themes/Vulnerability/img/volunteerIconOnPng8.png");$("#volunteerSection").css("background","url("+a+") no-repeat center top transparent");$(".iconSection").css("color","#565656")}
function markersOff(){try{map.removeLayer(volunteerLayer)}catch(a){}var b=S3.Ap.concat("/static/themes/Vulnerability/img/mapIconOffPng8.png");$("#mapSection").css("background","url("+b+") no-repeat center top transparent");b=S3.Ap.concat("/static/themes/Vulnerability/img/volunteerIconOffPng8.png");$("#volunteerSection").css("background","url("+b+") no-repeat center top transparent");$(".iconSection").css("color","#ccc")}
function resizeReports(){reportsHeight=window.innerHeight-111;activeContentHeight=0;$(".activeContent.contentTable .content").children("tr:visible").each(function(){activeContentHeight+=$(this).innerHeight()});507>reportsHeight&&(reportsHeight=507);activeContentHeight>reportsHeight-180&&(activeContentHeight=reportsHeight-180);$("#lightbox").css("height",$("#vulnerability").innerHeight()+"px");$("#reportsContent, #reportFilters").css("height",reportsHeight+"px");$(".activeContent.contentTable").css("height",
activeContentHeight+"px").css("display","block")}function showReports(a){$("#table-container").empty();displayThanks(S3.i18n.loading_report_details,null);rep_section=a;$.ajax({type:"GET",url:"report/"}).done(function(a){prepareReport(a)}).fail(function(){alert("error")})}
function getFilteredReport(){var a={};a.location_id=$("#l3_reports").val()?$("#l3_reports").val():$("#l2_reports").val()?$("#l2_reports").val():$("#l1_reports").val()?$("#l1_reports").val():$("#l0_reports").val()?$("#l0_reports").val():-1;a.from_date=$("#dateFromReports").val();a.to_date=$("#dateToReports").val();$("#indicatorsCheckbox").is(":checked")&&(a.indicator=!0);$("#mapCheckbox").is(":checked")&&(a.map=!0);$("#imagesCheckbox").is(":checked")&&(a.images=!0);$("#reportsCheckbox").is(":checked")&&
(a.reports=!0);$("#demographicsCheckbox").is(":checked")&&(a.demographics=!0);return a}
function prepareReport(a){$("#dateFromReports").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,maxDate:"+0d",minDate:"-20y"});$("#dateToReports").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,maxDate:"+0d",minDate:"-20y"});$(".rowForApproval").hide();$(".rowForApproval").prev().find(".closeReviewButton").hide();$(".rowForApproval").prev().find(".reviewButton").show();$(".headerRow.activeSection td.arrowCell .arrow").html("&rarr;");$(".headerRow.activeSection").removeClass("activeSection");
$("."+rep_section+"Header").addClass("activeSection");$(".headerRow.activeSection .arrow").html("&darr;");$(".activeContent").hide();$(".activeContent").removeClass("activeContent");$(".activeSection").next().addClass("activeContent");$(".activeSection").parent().next().addClass("activeContent");$(".activeContent").css("display","block");$(".approvalScreen").hide();$("#lightbox, #reportsSection").fadeIn(300);$("#table-container").empty();a?($("#table-container").append(a.report),fnInitDataTable($("#report"),
0,!0),formatTable(a),openReportRow("group_011")):$("#numberReports").html(S3.i18n.no_entries_found);resizeReports()}function displayReport(a){$("#table-container").empty();a?($("#table-container").append(a),fnInitDataTable($("#report"),0,!0),formatTable(a),openReportRow("group_011")):$("#numberReports").html(S3.i18n.no_entries_found);resizeReports()}
function openReportRow(a){-1!=shownReport&&hideReportDetails(shownReport);-1==$("."+a).html().indexOf("(0)")?accordionRow(0,"level_1",a):-1==$(".group_011").html().indexOf("(0)")?accordionRow(0,"level_1","group_011"):-1==$(".group_012").html().indexOf("(0)")?accordionRow(0,"level_1","group_012"):accordionRow(0,"level_1","group_013")}
function formatTable(){$("#report").addClass("reportsTable");$("#report").addClass("headerTable");$(".group").each(function(){$(this).addClass("headerLabel")});$("#report th");$("#report tr").each(function(){$(this).hasClass("even")&&$(this).addClass("gray");var a=$(this).find("td:first");0==a.length&&(a=$(this).find("th:first"));a.addClass("date");a=a.next();a.addClass("communeName");a=a.next();a.addClass("type");a=a.next();a.addClass("submittedBy");a=a.next();a.addClass("status");a=a.next();a.addClass("action")});
$("#numberReports").html($("#reportCount").val());$(".expandable").click(function(){-1!=shownReport&&hideReportDetails(shownReport);thisAccordionRow(0,this)})}function showReportDetails(a){$.getJSON("report/review",{id:a}).done(function(b){displayReportDetails(a,b)}).fail(function(){alert("error")})}function viewReportDetails(a){$.getJSON("report/view",{id:a}).done(function(b){displayReportDetails(a,b)}).fail(function(){alert("error")})}
function hideReportDetails(a){var b=$("#"+a).parent().parent();$("#show"+a).remove();$(b).find(".reviewButton").show();$(b).find(".viewButton").show();$(b).find(".closeReviewButton").hide()}
function displayReportDetails(a,b){var d=$("#"+a).parent().parent(),c=document.createElement("tr"),e=document.createElement("td");-1!=shownReport&&hideReportDetails(shownReport);shownReport=a;e.colSpan=6;e.innerHTML=b;c.appendChild(e);$(c).addClass("showReport");$(c).attr("id","show"+a);$(c).insertAfter(d);$(d).find(".reviewButton").hide();$(d).find(".viewButton").hide();$(d).find(".closeReviewButton").show();$(".approveButton, .declineButton").click(processReportDetails)}
function displayThanks(a,b){$(".approvalScreen .thanks").html(a);$(".approvalScreen").fadeIn(300);$(".approvalScreen .return2reports").hide();b&&($(".approvalScreen").data("approvalTimeout",setTimeout(function(){$(".approvalScreen").fadeOut(300)},b)),$(".approvalScreen .return2reports").show());resizeReports()}
function processReportDetails(){id=this.name.substr(7);$("#table-container").empty();hideReportDetails(id);var a=$("#form"+id).serialize(),b=getFilteredReport();b.id=id;b.report=a;$("#"+id).parent().parent();$(this).hasClass("approveButton")?(displayThanks(S3.i18n.approval_request_submitted,null),$.ajax({type:"POST",url:"report/approve",data:b}).done(function(a){$(".approvalScreen").hide();displayThanks(S3.i18n.thankyou_for_your_approval,5E3);displayReport(a)}).fail(function(){alert("error");$(".approvalScreen").hide()})):
(displayThanks(S3.i18n.reject_request_submitted,null),$.ajax({type:"POST",url:"report/decline",data:b}).done(function(a){$(".approvalScreen").hide();displayThanks(S3.i18n.submission_has_been_declined,5E3);displayReport(a)}).fail(function(){alert("error");$(".approvalScreen").hide()}))}
function toggleReports(a){switch(a){case "myReports":$(".allReports").removeClass("active").html("<a href=\"javascript:toggleReports('allReports')\" title='All Reports'>"+S3.i18n.all_reports.toUpperCase()+"</a>");$(".myReports").addClass("active").html(S3.i18n.my_reports.toUpperCase());break;case "allReports":$(".myReports").removeClass("active").html("<a href=\"javascript:toggleReports('myReports')\" title='My Reports'>"+S3.i18n.my_reports.toUpperCase()+"</a>"),$(".allReports").addClass("active").html(S3.i18n.all_reports.toUpperCase())}}
function uploadSubmitDataIndicators(){var a=new FormData($("#uploadIndicatorsForm")[0]);a.file?(a.append("action","vulnerability_part1"),a.append("approach","ajax"),$.ajax({url:"submitData/import.aadata",type:"POST",data:a,cache:!1,contentType:!1,processData:!1}).done(function(a){submitDataJobID=a.upload_id;submitDataItemIDs=a.items;submitedData=a.data;submitedDataPage=0;$(".indicatorsStart").fadeOut(300);displaySubmitDataIndicators()}).fail(function(){alert("error")})):alert("Please, select a file")}
function displaySubmitDataIndicators(){submitedData&&(total_pages=submitedData.length,page_data=submitedData[submitedDataPage],page=submitedDataPage+1);$("#submitDataUpload").html($("#submitDataUpload").html());$("#submitDataContent .reviewIndicatorsView h3").html(S3.i18n.review+" <span class='currentPage'>"+page+"</span> "+S3.i18n.of+"<span class='totalPages'>"+total_pages+"<span>");$(".reviewIndicatorsView h4 mark").html(page_data.location);$(".reviewIndicatorsView .indicatorReviewTable tbody tr").each(function(){var a=
$(this).find("td.indicatorLabels").html().substr(14),a=page_data.data[a];$(this).find("input[value='"+a+"']").attr("checked",true)});$(".reviewIndicatorsView.firstPage").fadeIn(300);$("#submitDataFilters").animate({"background-color":"#f7941d"},500);$("#submitDataFilters h3").hide(300);$("#submissionToggle").hide(300);1==page&&($("#submitDataFooter mark, #submitDataFooter .reviewNextButton").fadeIn(300),$(".backButton").hide());1<page&&!$(".backButton").is(":visible")&&$(".backButton").fadeIn(300);
page==total_pages?($(".reviewNextButton").hide(),$(".submitAllButton").show()):($(".reviewNextButton").show(),$(".submitAllButton").hide())}function nextSubmitDataReview(){submitedDataPage+=1;total_pages=submitedData.length;submitedDataPage>=total_pages&&(submitedDataPage=total_pages-1);displaySubmitDataIndicators()}function backSubmitDataReview(){submitedDataPage-=1;0>submitedDataPage&&(submitedDataPage=0);displaySubmitDataIndicators()}
function submitImportSubmitData(){details={approach:"ajax",action:"vulnerability_part2",job:submitDataJobID,mode:"Inclusive",selected:JSON.stringify(submitDataItemIDs)};$.ajax({url:"submitData/import",type:"POST",data:details}).done(function(){$(".reviewIndicatorsView").fadeOut(300);$("#indicatorsSubmissionViews .thankyou").fadeIn(300);$("#submitDataFooter div, #submitDataFooter mark").fadeOut(300);$("#submitDataFooter .submitMoreButton").fadeIn(300)}).fail(function(){alert("error")})}
function moreSubmitData(){$(".thankyou, #submitDataFooter .submitMoreButton").fadeOut(300);$("#submitDataFilters").animate({"background-color":"#c6c6c6"},500);$("#submitDataFilters h3").fadeIn(300);$("#submissionToggle").fadeIn(300);$("#submitDataContent .dataUploadContainer h4").html(S3.i18n.select_data_type);$("#submitDataContent .dataUploadContainer h3, .delete, .reviewTitling").hide();$("#indicatorsSubmissionViews").is(":visible")?($("#submitDataContent .indicatorsStart").fadeIn(300),$("#submitDataContent .indicatorsStart p").filter(":first").show()):
($("#newSubmissionRegions, #dataSubmissionRegion .submissionContent").empty(),$("#dataSubmissionRegion").removeClass("mapSubmission imageSubmission otherSubmission demographicsSubmission vcaSubmission loaded").removeAttr("style"),$("#dataSubmissionRegion input").attr("disabled",!1).attr("checked",!1),numberSubmissions=2,numberSubmissionsDeleted=0,$("#dataAndReportsSubmissionViews .dataUploadContainer").fadeIn(300),$(".fileType, .labelFile, .remove, .imgDesc, .fakePlaceholder, .labelHangRight, .checkHangRight").fadeIn(300),
$(".dataSubmissionRegion input:radio").each(function(){$(this).parent().removeAttr("style")}))}
function indicatorsCheckCommune(){switch($("#l3_datas").val()){case null:$("#submitOnlineButton").addClass("disabled");$("#submitDataContent .indicatorsStart p").filter(":first").show(200);$("#selectCommune").show(200);$("#dataSubmissionRegion").hide();break;default:$("#submitOnlineButton").removeClass("disabled"),$("#submitDataContent .indicatorsStart p").filter(":first").hide(200),$("#selectCommune").hide(200),$("#dataSubmissionRegion").show()}}
function displaySubmitOnline(){$("#submitDataContent .submitIndicatorsForm input").attr("checked",!1);$("#submitDataContent .submitIndicatorsForm, #submitDataFooter mark").fadeIn(300);$("#submitDataContent .indicatorsStart").fadeOut(300);$("#submitDataFooter .reviewSubmissionButton").addClass("disabled").fadeIn(300)}
function reviewSubmitData(){var a=hdata[$("#l0_datas").val()];if($("#l3_datas").val())var b=$("#l3_datas option:selected").html()+" "+a.l3+".";else $("#l2_datas").val()?b=$("#l2_datas option:selected").html()+" "+a.l2+".":$("#l1_datas").val()?b=$("#l1_datas option:selected").html()+" "+a.l1+".":$("#l0_datas").val()&&(b=$("#l0_datas option:selected").html()+" "+S3.i18n.country+".");$("#submitDataContent .submitIndicatorsForm").is(":visible")&&($("#submitDataContent .submitIndicatorsForm h3").html(S3.i18n.review),
$("#submitDataContent .submitIndicatorsForm h4").filter(":first").html(S3.i18n.about_to_submit_indicator_ratings+" <mark>"+b+"</mark>"),$(".submitIndicatorsForm h3, .submitIndicatorsForm h4").fadeIn(300),$("#submitDataFooter .reviewSubmissionButton, .submitIndicatorsForm .indicatorLabels div").fadeOut(300),$("#submitDataFilters").animate({"background-color":"#f7941d"},500),$("#submitDataFilters h3").hide(300),$("#submissionToggle").fadeOut(200),setTimeout(function(){$("#submitDataFooter .submitButton").fadeIn(300)},
300))}
function submitSubmitData(){var a=new FormData;$(".submitIndicatorsForm input:radio:checked").each(function(b){a.append(b+1,$(this).attr("value"))});a.append("location",$("#l3_data").val());a.append("action","vulnerability");a.append("approach","ajax");$.ajax({url:"submitData/create",type:"POST",data:a,cache:!1,contentType:!1,processData:!1}).done(function(a){submitDataJobID=a.upload_id;submitDataItemIDs=a.items;submitedData=a.data;submitedDataPage=0;$(".indicatorsStart").fadeOut(300);displaySubmitDataIndicators()}).fail(function(){alert("error")});$("#submitDataContent .submitIndicatorsForm").is(":visible")?
($("#submitDataContent .submitIndicatorsForm").fadeOut(300),$("#indicatorsSubmissionViews .thankyou").fadeIn(300),$("#submitDataFooter div, #submitDataFooter mark").fadeOut(300),setTimeout(function(){$("#submitDataFooter .submitMoreButton").fadeIn(300);$("#submitDataFooter .reviewSubmissionButton").addClass("disabled");$(".submitIndicatorsForm h3, .submitIndicatorsForm h4").hide();$(".submitIndicatorsForm .indicatorLabels div").show()},300)):$("#submitDataContent .dataUploadContainer").is(":visible")&&
($("#submitDataContent .dataUploadContainer").fadeOut(300),$("#dataAndReportsSubmissionViews .thankyou").fadeIn(300),$("#submitDataFooter div, #submitDataFooter mark").fadeOut(300),setTimeout(function(){$("#submitDataFooter .submitMoreButton").fadeIn(300)},300))}function resizeSubmitData(){var a=$(window).innerHeight()-186;432>a&&(a=432);$("#submitDataContent").css("height",a+"px");$("#submitDataFilters").css("height",a+75+"px");$("#submitDataSection").css("height",a+136+"px")}
function showSubmitData(a){$("#submitDataContent .dataUploadContainer h3, .delete, .reviewTitling, #submitDataContent .thankyou, .loadingErrorView").hide();$("#submitDataFooter div, #submitDataFooter mark").hide();$("#submitDataFilters #submissionToggle, #submitDataFilters h3").show();$("#dataAndReportsSubmissionViews .dataUploadContainer").show();$(".fileType, .labelFile, .remove, .imgDesc, .fakePlaceholder, .labelHangRight, .checkHangRight").show();$("#submitIndicators, #submitReports").removeClass("active");
$("#submitDataFilters").css("background-color","#c6c6c6");$("#dataSubmissionRegion").removeClass("mapSubmission imageSubmission otherSubmission demographicsSubmission vcaSubmission loaded").removeAttr("style");$("#dataSubmissionRegion").removeClass("mapSubmission imageSubmission otherSubmission demographicsSubmission vcaSubmission loaded").removeAttr("style");$("#dataSubmissionRegion input").attr("checked",!1);$(".dataSubmissionRegion input:radio").each(function(){$(this).parent().removeAttr("style");
$(this).removeAttr("disabled")});$("#newSubmissionRegions, #dataSubmissionRegion .submissionContent").empty();$("#newSubmissionRegions, #dataSubmissionRegion .submissionContent").empty();$("#submitDataContent .dataUploadContainer h4").html(S3.i18n.select_data_type);numberSubmissions=2;numberSubmissionsDeleted=0;switch(a){case "indicators":$("#submitIndicators").addClass("active");$("#indicatorsSubmissionViews").show();$("#dataAndReportsSubmissionViews").hide();$("#indicatorsSubmissionViews").children("div").hide();
$("#submitDataFooter, #submitDataFooter mark").removeAttr("style");$("#submitDataFooter .reviewSubmissionButton").removeClass("disabled");$("#submitDataContent .indicatorsStart").show();break;case "reports":$("#submitReports").addClass("active"),$("#dataAndReportsSubmissionViews").show(),$("#indicatorsSubmissionViews").hide(),$("#demoContent").hide(),$("#uploadReportsForm").hide(),$(".uploadReportsForm").hide(),$(".dataSubmissionRegion").height(46)}$("#submitDataFooter").show();indicatorsCheckCommune();
$("#lightbox, #submitDataSection").fadeIn(300)}function disableOptionSubmitDataPanel(a,b){$(b+" input:radio").attr("disabled",!0);$(b+" .mapOption, "+b+" .imageOption, "+b+" .otherOption, "+b+" .demoOption, "+b+" .VCAOption").css("color","#999")}function enableOptionSubmitDataPanel(a){$(a+" input:radio").attr("disabled",!1);$(a+" input:radio").attr("checked",!1);$(a+" .mapOption, "+a+" .imageOption, "+a+" .otherOption, "+a+" .demoOption, "+a+" .VCAOption").css("color","#000")}
function selectOptionSubmitData(){var a="#"+$(this).parent().parent().attr("id");inputValue=$(this).val();disableOptionSubmitDataPanel(inputValue,a);$("#demoContent").hide();$("#uploadReportsForm").hide();switch(inputValue){case "map":$("#uploadReportsForm").show();$(a).height(116);$("#uploadReportsForm .fakePlaceholder").click(function(){$(this).hide();$(this).siblings(".imgDesc").focus()});$("#submitDataFooter .submitButton, #submitDataFooter .cancelButton, #submitDataFooter mark").fadeIn(300);
break;case "image":$("#uploadReportsForm").show();$(a).height(116);$("#uploadReportsForm .fakePlaceholder").click(function(){$(this).hide();$(this).siblings(".imgDesc").focus()});$("#submitDataFooter .submitButton, #submitDataFooter .cancelButton, #submitDataFooter mark").fadeIn(300);break;case "other":$("#uploadReportsForm").show();$(a).height(86);$("#descFordataSubmissionRegion").hide();$("#fakeFordataSubmissionRegion").hide();$("#submitDataFooter .submitButton, #submitDataFooter .cancelButton").fadeIn(300);
break;case "demographics":$("#demoContent").show();$(a).height(350);$("#submitDataFooter .submitButton, #submitDataFooter .cancelButton").fadeIn(300);break;case "vca":$("#uploadReportsForm").show(),$(a).height(86),$("#descFordataSubmissionRegion").hide(),$("#fakeFordataSubmissionRegion").hide(),$("#submitDataFooter .submitButton, #submitDataFooter .cancelButton").fadeIn(300)}$(a+" .submissionContent").is(":visible")&&$(a+" .submissionContent").fadeOut(300)}
function cancelSubmitDataTypeSelection(){$("#uploadReportsForm").html($("#uploadReportsForm").html());enableOptionSubmitDataPanel("#dataSubmissionRegion");$("#uploadReportsForm .fakePlaceholder").show();$("#demoContent").hide();$("#uploadReportsForm").hide();$("#dataSubmissionRegion").height(46);$("#submitDataFooter div, #submitDataFooter mark").fadeOut(300);selectSubmitDataType()}
function uploadSubmitDataReport(){inputValue=$("#dataSubmissionRegion input[type=radio]:checked").val();if("demographics"==inputValue){var a=new FormData;jQuery.each($("#dataSubmissionRegion .demographicsForm input"),function(b,d){a.append(d.id,d.value)})}else a=new FormData($("#dataSubmissionRegion .uploadReportsForm")[0]);a.append("action",inputValue);a.append("location",$("#l3_datas").val());$.ajax({url:"submitData",type:"POST",data:a,cache:!1,contentType:!1,processData:!1}).done(function(){cancelSubmitDataTypeSelection();
displayThanks(S3.i18n.upload_successful,null)}).fail(function(){alert("error")});displayThanks(S3.i18n.uploading_report_details,null)}function analysisView(){closePopups();drawerOpen&&drawerSlide();$("#drawer").hide();$("#analysis").show()}function hideAnalysis(){$("#analysis").hide();$("#drawer").show()}function toggleAnalysis(){}
function analysisReset(a){$("#l0_analysis"+a+"s").val("");$("#l1_analysis"+a).hide("");$("#l2_analysis"+a).hide("");$("#l3_analysis"+a).hide("");$("#analysisControl"+a+" select").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:125,menuWidth:125})};
