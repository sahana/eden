(function(c){c.widget("ui.selectmenu",{options:{appendTo:"body",typeAhead:1E3,style:"dropdown",positionOptions:{my:"left top",at:"left bottom",offset:null},width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null,escapeHtml:!1,bgImage:function(){}},_create:function(){var a=this,b=this.options,d=(this.element.attr("id")||"ui-selectmenu-"+Math.random().toString(16).slice(2,10)).replace(/(:|\.)/g,"");this.ids=[d,d+"-button",d+"-menu"];this._safemouseup=!0;this.isOpen=!1;this.newelement=
c("<a />",{"class":this.widgetBaseClass+" ui-widget ui-state-default ui-corner-all",id:this.ids[1],role:"button",href:"#nogo",tabindex:this.element.attr("disabled")?1:0,"aria-haspopup":!0,"aria-owns":this.ids[2]});this.newelementWrap=c("<span />").append(this.newelement).insertAfter(this.element);(d=this.element.attr("tabindex"))&&this.newelement.attr("tabindex",d);this.newelement.data("selectelement",this.element);this.selectmenuIcon=c('<span class="'+this.widgetBaseClass+'-icon ui-icon"></span>').prependTo(this.newelement);
this.newelement.prepend('<span class="'+a.widgetBaseClass+'-status" />');this.element.bind({"click.selectmenu":function(b){a.newelement.focus();b.preventDefault()}});this.newelement.bind("mousedown.selectmenu",function(c){a._toggle(c,!0);"popup"==b.style&&(a._safemouseup=!1,setTimeout(function(){a._safemouseup=!0},300));return!1}).bind("click.selectmenu",function(){return!1}).bind("keydown.selectmenu",function(b){var d=!1;switch(b.keyCode){case c.ui.keyCode.ENTER:d=!0;break;case c.ui.keyCode.SPACE:a._toggle(b);
break;case c.ui.keyCode.UP:b.altKey?a.open(b):a._moveSelection(-1);break;case c.ui.keyCode.DOWN:b.altKey?a.open(b):a._moveSelection(1);break;case c.ui.keyCode.LEFT:a._moveSelection(-1);break;case c.ui.keyCode.RIGHT:a._moveSelection(1);break;case c.ui.keyCode.TAB:d=!0;break;case c.ui.keyCode.PAGE_UP:case c.ui.keyCode.HOME:a.index(0);break;case c.ui.keyCode.PAGE_DOWN:case c.ui.keyCode.END:a.index(a._optionLis.length);break;default:d=!0}return d}).bind("keypress.selectmenu",function(b){0<b.which&&a._typeAhead(b.which,
"mouseup");return!0}).bind("mouseover.selectmenu",function(){b.disabled||c(this).addClass("ui-state-hover")}).bind("mouseout.selectmenu",function(){b.disabled||c(this).removeClass("ui-state-hover")}).bind("focus.selectmenu",function(){b.disabled||c(this).addClass("ui-state-focus")}).bind("blur.selectmenu",function(){b.disabled||c(this).removeClass("ui-state-focus")});c(document).bind("mousedown.selectmenu-"+this.ids[0],function(b){a.isOpen&&a.close(b)});this.element.bind("click.selectmenu",function(){a._refreshValue()}).bind("focus.selectmenu",
function(){a.newelement&&a.newelement[0].focus()});b.width||(b.width=this.element.outerWidth());this.newelement.width(b.width);this.element.hide();this.list=c("<ul />",{"class":"ui-widget ui-widget-content","aria-hidden":!0,role:"listbox","aria-labelledby":this.ids[1],id:this.ids[2]});this.listWrap=c("<div />",{"class":a.widgetBaseClass+"-menu"}).append(this.list).appendTo(b.appendTo);this.list.bind("keydown.selectmenu",function(b){var d=false;switch(b.keyCode){case c.ui.keyCode.UP:b.altKey?a.close(b,
true):a._moveFocus(-1);break;case c.ui.keyCode.DOWN:b.altKey?a.close(b,true):a._moveFocus(1);break;case c.ui.keyCode.LEFT:a._moveFocus(-1);break;case c.ui.keyCode.RIGHT:a._moveFocus(1);break;case c.ui.keyCode.HOME:a._moveFocus(":first");break;case c.ui.keyCode.PAGE_UP:a._scrollPage("up");break;case c.ui.keyCode.PAGE_DOWN:a._scrollPage("down");break;case c.ui.keyCode.END:a._moveFocus(":last");break;case c.ui.keyCode.ENTER:case c.ui.keyCode.SPACE:a.close(b,true);c(b.target).parents("li:eq(0)").trigger("mouseup");
break;case c.ui.keyCode.TAB:d=true;a.close(b,true);c(b.target).parents("li:eq(0)").trigger("mouseup");break;case c.ui.keyCode.ESCAPE:a.close(b,true);break;default:d=true}return d}).bind("keypress.selectmenu",function(b){b.which>0&&a._typeAhead(b.which,"focus");return true}).bind("mousedown.selectmenu mouseup.selectmenu",function(){return false});c(window).bind("resize.selectmenu-"+this.ids[0],c.proxy(a.close,this))},_init:function(){var a=this,b=this.options,d=[];this.element.find("option").each(function(){var e=
c(this);d.push({value:e.attr("value"),text:a._formatText(e.text()),selected:e.attr("selected"),disabled:e.attr("disabled"),classes:e.attr("class"),typeahead:e.attr("typeahead"),parentOptGroup:e.parent("optgroup"),bgImage:b.bgImage.call(e)})});var f="popup"==a.options.style?" ui-state-active":"";this.list.html("");if(d.length)for(var e=0;e<d.length;e++){var h={role:"presentation"};d[e].disabled&&(h["class"]=this.namespace+"-state-disabled");var i={html:d[e].text||"&nbsp;",href:"#nogo",tabindex:-1,
role:"option","aria-selected":!1};d[e].disabled&&(i["aria-disabled"]=d[e].disabled);d[e].typeahead&&(i.typeahead=d[e].typeahead);i=c("<a/>",i);h=c("<li/>",h).append(i).data("index",e).addClass(d[e].classes).data("optionClasses",d[e].classes||"").bind("mouseup.selectmenu",function(b){if(a._safemouseup&&!a._disabled(b.currentTarget)&&!a._disabled(c(b.currentTarget).parents("ul>li."+a.widgetBaseClass+"-group "))){var d=c(this).data("index")!=a._selectedIndex();a.index(c(this).data("index"));a.select(b);
d&&a.change(b);a.close(b,true)}return false}).bind("click.selectmenu",function(){return false}).bind("mouseover.selectmenu focus.selectmenu",function(b){if(!c(b.currentTarget).hasClass(a.namespace+"-state-disabled")&&!c(b.currentTarget).parent("ul").parent("li").hasClass(a.namespace+"-state-disabled")){a._selectedOptionLi().addClass(f);a._focusedOptionLi().removeClass(a.widgetBaseClass+"-item-focus ui-state-hover");c(this).removeClass("ui-state-active").addClass(a.widgetBaseClass+"-item-focus ui-state-hover")}}).bind("mouseout.selectmenu blur.selectmenu",
function(){c(this).is(a._selectedOptionLi().selector)&&c(this).addClass(f);c(this).removeClass(a.widgetBaseClass+"-item-focus ui-state-hover")});d[e].parentOptGroup.length?(i=a.widgetBaseClass+"-group-"+this.element.find("optgroup").index(d[e].parentOptGroup),this.list.find("li."+i).length?this.list.find("li."+i+":last ul").append(h):c(' <li role="presentation" class="'+a.widgetBaseClass+"-group "+i+(d[e].parentOptGroup.attr("disabled")?" "+this.namespace+'-state-disabled" aria-disabled="true"':'"')+
'><span class="'+a.widgetBaseClass+'-group-label">'+d[e].parentOptGroup.attr("label")+"</span><ul></ul></li> ").appendTo(this.list).find("ul").append(h)):h.appendTo(this.list);if(b.icons)for(var g in b.icons)h.is(b.icons[g].find)&&(h.data("optionClasses",d[e].classes+" "+a.widgetBaseClass+"-hasIcon").addClass(a.widgetBaseClass+"-hasIcon"),i=b.icons[g].icon||"",h.find("a:eq(0)").prepend('<span class="'+a.widgetBaseClass+"-item-icon ui-icon "+i+'"></span>'),d[e].bgImage&&h.find("span").css("background-image",
d[e].bgImage))}else c('<li role="presentation"><a href="#nogo" tabindex="-1" role="option"></a></li>').appendTo(this.list);e="dropdown"==b.style;this.newelement.toggleClass(a.widgetBaseClass+"-dropdown",e).toggleClass(a.widgetBaseClass+"-popup",!e);this.list.toggleClass(a.widgetBaseClass+"-menu-dropdown ui-corner-bottom",e).toggleClass(a.widgetBaseClass+"-menu-popup ui-corner-all",!e).find("li:first").toggleClass("ui-corner-top",!e).end().find("li:last").addClass("ui-corner-bottom");this.selectmenuIcon.toggleClass("ui-icon-triangle-1-s",
e).toggleClass("ui-icon-triangle-2-n-s",!e);"dropdown"==b.style?this.list.width(b.menuWidth?b.menuWidth:b.width):this.list.width(b.menuWidth?b.menuWidth:b.width-b.handleWidth);this.list.css("height","auto");e=this.listWrap.height();g=c(window).height();g=b.maxHeight?Math.min(b.maxHeight,g):g/3;e>g&&this.list.height(g);this._optionLis=this.list.find("li:not(."+a.widgetBaseClass+"-group)");this.element.attr("disabled")?this.disable():this.enable();this.index(this._selectedIndex());this._selectedOptionLi().addClass(this.widgetBaseClass+
"-item-focus");clearTimeout(this.refreshTimeout);this.refreshTimeout=window.setTimeout(function(){a._refreshPosition()},200)},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled").unbind(".selectmenu");c(window).unbind(".selectmenu-"+this.ids[0]);c(document).unbind(".selectmenu-"+this.ids[0]);this.newelementWrap.remove();this.listWrap.remove();this.element.unbind(".selectmenu").show();
c.Widget.prototype.destroy.apply(this,arguments)},_typeAhead:function(a,b){var d=this,c=String.fromCharCode(a).toLowerCase(),e=null,h=null;d._typeAhead_timer&&(window.clearTimeout(d._typeAhead_timer),d._typeAhead_timer=void 0);d._typeAhead_chars=(void 0===d._typeAhead_chars?"":d._typeAhead_chars).concat(c);2>d._typeAhead_chars.length||d._typeAhead_chars.substr(-2,1)===c&&d._typeAhead_cycling?(d._typeAhead_cycling=!0,e=c):(d._typeAhead_cycling=!1,e=d._typeAhead_chars);for(var c=("focus"!==b?this._selectedOptionLi().data("index"):
this._focusedOptionLi().data("index"))||0,i=0;i<this._optionLis.length;i++)if(this._optionLis.eq(i).text().substr(0,e.length).toLowerCase()===e)if(d._typeAhead_cycling){if(null===h&&(h=i),i>c){h=i;break}}else h=i;null!==h&&this._optionLis.eq(h).find("a").trigger(b);d._typeAhead_timer=window.setTimeout(function(){d._typeAhead_timer=void 0;d._typeAhead_chars=void 0;d._typeAhead_cycling=void 0},d.options.typeAhead)},_uiHash:function(){var a=this.index();return{index:a,option:c("option",this.element).get(a),
value:this.element[0].value}},open:function(a){var b=this.options;if("true"!=this.newelement.attr("aria-disabled")){this._closeOthers(a);this.newelement.addClass("ui-state-active");this.list.attr("aria-hidden",!1);this.listWrap.addClass(this.widgetBaseClass+"-open");var d=this._selectedOptionLi();"dropdown"==b.style?this.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"):this.list.css("left",-5E3).scrollTop(this.list.scrollTop()+d.position().top-this.list.outerHeight()/2+d.outerHeight()/
2).css("left","auto");this._refreshPosition();b=d.find("a");b.length&&b[0].focus();this.isOpen=!0;this._trigger("open",a,this._uiHash())}},close:function(a,b){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.listWrap.removeClass(this.widgetBaseClass+"-open"),this.list.attr("aria-hidden",!0),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),b&&this.newelement.focus(),this.isOpen=!1,this._trigger("close",
a,this._uiHash()))},change:function(a){this.element.trigger("change");this._trigger("change",a,this._uiHash())},select:function(a){if(this._disabled(a.currentTarget))return!1;this._trigger("select",a,this._uiHash())},widget:function(){return this.listWrap.add(this.newelementWrap)},_closeOthers:function(a){c("."+this.widgetBaseClass+".ui-state-active").not(this.newelement).each(function(){c(this).data("selectelement").selectmenu("close",a)});c("."+this.widgetBaseClass+".ui-state-hover").trigger("mouseout")},
_toggle:function(a,b){this.isOpen?this.close(a,b):this.open(a)},_formatText:function(a){this.options.format?a=this.options.format(a):this.options.escapeHtml&&(a=c("<div />").text(a).html());return a},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find("."+this.widgetBaseClass+"-item-focus")},_moveSelection:function(a,b){if(!this.options.disabled){var d=parseInt(this._selectedOptionLi().data("index")||
0,10)+a;0>d&&(d=0);d>this._optionLis.size()-1&&(d=this._optionLis.size()-1);if(d===b)return!1;this._optionLis.eq(d).hasClass(this.namespace+"-state-disabled")?(0<a?++a:--a,this._moveSelection(a,d)):this._optionLis.eq(d).trigger("mouseover").trigger("mouseup")}},_moveFocus:function(a,b){var d=isNaN(a)?parseInt(this._optionLis.filter(a).data("index"),10):parseInt(this._focusedOptionLi().data("index")||0,10)+a;0>d&&(d=0);d>this._optionLis.size()-1&&(d=this._optionLis.size()-1);if(d===b)return!1;var c=
this.widgetBaseClass+"-item-"+Math.round(1E3*Math.random());this._focusedOptionLi().find("a:eq(0)").attr("id","");this._optionLis.eq(d).hasClass(this.namespace+"-state-disabled")?(0<a?++a:--a,this._moveFocus(a,d)):this._optionLis.eq(d).find("a:eq(0)").attr("id",c).focus();this.list.attr("aria-activedescendant",c)},_scrollPage:function(a){var b=Math.floor(this.list.outerHeight()/this._optionLis.first().outerHeight());this._moveFocus("up"==a?-b:b)},_setOption:function(a,b){this.options[a]=b;"disabled"==
a&&(b&&this.close(),this.element.add(this.newelement).add(this.list)[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",b))},disable:function(a,b){"undefined"==typeof a?this._setOption("disabled",!0):"optgroup"==b?this._disableOptgroup(a):this._disableOption(a)},enable:function(a,b){"undefined"==typeof a?this._setOption("disabled",!1):"optgroup"==b?this._enableOptgroup(a):this._enableOption(a)},_disabled:function(a){return c(a).hasClass(this.namespace+
"-state-disabled")},_disableOption:function(a){var b=this._optionLis.eq(a);b&&(b.addClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!0),this.element.find("option").eq(a).attr("disabled","disabled"))},_enableOption:function(a){var b=this._optionLis.eq(a);b&&(b.removeClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!1),this.element.find("option").eq(a).removeAttr("disabled"))},_disableOptgroup:function(a){var b=this.list.find("li."+this.widgetBaseClass+"-group-"+
a);b&&(b.addClass(this.namespace+"-state-disabled").attr("aria-disabled",!0),this.element.find("optgroup").eq(a).attr("disabled","disabled"))},_enableOptgroup:function(a){var b=this.list.find("li."+this.widgetBaseClass+"-group-"+a);b&&(b.removeClass(this.namespace+"-state-disabled").attr("aria-disabled",!1),this.element.find("optgroup").eq(a).removeAttr("disabled"))},index:function(a){if(arguments.length){if(this._disabled(c(this._optionLis[a])))return!1;this.element[0].selectedIndex=a;this._refreshValue()}else return this._selectedIndex()},
value:function(a){if(arguments.length)this.element[0].value=a,this._refreshValue();else return this.element[0].value},_refreshValue:function(){var a="popup"==this.options.style?" ui-state-active":"",b=this.widgetBaseClass+"-item-"+Math.round(1E3*Math.random());this.list.find("."+this.widgetBaseClass+"-item-selected").removeClass(this.widgetBaseClass+"-item-selected"+a).find("a").attr("aria-selected","false").attr("id","");this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-selected"+a).find("a").attr("aria-selected",
"true").attr("id",b);var a=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"",c=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(a).data("optionClasses",c).addClass(c).find("."+this.widgetBaseClass+"-status").html(this._selectedOptionLi().find("a:eq(0)").html());this.list.attr("aria-activedescendant",b)},_refreshPosition:function(){var a=this.options;if("popup"==a.style&&!a.positionOptions.offset)var b=
this._selectedOptionLi(),b="0 "+(this.list.offset().top-b.offset().top-(this.newelement.outerHeight()+b.outerHeight())/2);this.listWrap.removeAttr("style").zIndex(this.element.zIndex()+1).position({of:a.positionOptions.of||this.newelement,my:a.positionOptions.my,at:a.positionOptions.at,offset:a.positionOptions.offset||b,collision:a.positionOptions.collision||"popup"==a.style?"fit":"flip"})}})})(jQuery);
var TypeHelpers=new function(){var c=this;c.hasSmoothing=function(){if("undefined"!=typeof screen.fontSmoothingEnabled)return screen.fontSmoothingEnabled;try{var a=document.createElement("canvas");a.width="35";a.height="35";a.style.display="none";document.body.appendChild(a);var b=a.getContext("2d");b.textBaseline="top";b.font="32px Arial";b.fillStyle="black";b.strokeStyle="black";b.fillText("O",0,0);for(a=8;32>=a;a++)for(var c=1;32>=c;c++){var f=b.getImageData(c,a,1,1).data[3];if(255!=f&&0!=f)return!0}return!1}catch(e){return null}};
c.insertClasses=function(){var a=c.hasSmoothing(),b=document.getElementsByTagName("html")[0];b.className=!0==a?b.className+" hasFontSmoothing-true":!1==a?b.className+" hasFontSmoothing-false":b.className+" hasFontSmoothing-unknown"}},drawerOpen=!1,colors={"0":"#999999",1:"#ff5121",2:"#f4961c",3:"#d6b317",4:"#77b826",5:"#059346"},map,parser,proj4326,resilienceLayer,current_l0,current_l1,current_l2,current_l3;S3.i18n.gis_requires_login="Requires Login";
yepnope({load:[S3.Ap.concat("/static/scripts/gis/OpenLayers.js")],complete:function(){showMap()}});
$(document).ready(function(){$("#dataTopBar").hover(function(){$("#dataTopBar img").css("background-color","#f7941d");$("#dataTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowOverPng8.png"));$("#dataOptions").fadeIn(150);$("#defaultDataLink").css("color","#c47a21")},function(){$("#dataTopBar img").css("background-color","transparent");$("#dataTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowPng8.png"));$("#dataOptions").fadeOut(150);
$("#defaultDataLink").css("color","#f7941d")});$("#reportsTopBar").hover(function(){$("#reportsTopBar img").css("background-color","#f7941d");$("#reportsTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowOverPng8.png"));$("#reportsOptions").fadeIn(150);$("#defaultReportsLink").css("color","#c47a21")},function(){$("#reportsTopBar img").css("background-color","transparent");$("#reportsTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowPng8.png"));
$("#reportsOptions").fadeOut(150);$("#defaultReportsLink").css("color","#f7941d")});var c=[],a,b;for(b in idata)a="        <li>            <div class='indicatorRatingLabel'>                <div class='listText'>"+idata[b].n+"</div>                <div class='popup'>                    <div class='popupContent'>                        <h3>"+idata[b].n+"</h3>                        <p>"+idata[b].d+"</p>                    </div>                    <div class='popupBottom'></div>                </div>            </div>            <div class='visRange'>                <div class='indicatorRange' id='visRange"+
b+"'>                    <div class='leftBox'></div>                    <div class='medianDot'></div>                    <div class='rightBox'></div>                </div>            </div>        </li>",c.push(a);$("#indicatorRatingChart ul").html(c.join(""));for(var d in vdata){switch(vdata[d].r){case 1:c="one";break;case 2:c="two";break;case 3:c="three";break;case 4:c="four";break;case 5:c="five";break;default:c="none"}a=d==start?' selected="selected"':"";0==vdata[d].l?$("#l0_select").append('<option value="'+
d+'" class="'+c+'"'+a+">"+vdata[d].n+"</option>"):1==vdata[d].l&&$("#l1_select").append('<option value="'+d+'" class="'+c+'">'+vdata[d].n+"</option>")}TypeHelpers.insertClasses();$(".closechromeframe").click(function(){$(".chromeframe").hide()});$("#show-hide").click(function(){drawerSlide()});$("#risingTab").click(function(){drawerSlide()});$(".calculationLink").click(function(){$("#lightbox, #calculationView").fadeIn(300)});$("#calculationView .closePanel").click(function(){$("#lightbox, #calculationView").fadeOut(300)});
$(".listText").hover(function(){$(this).siblings(".popup").show()},function(){$(this).siblings(".popup").hide()})});
function showMap(){OpenLayers.ImgPath=S3.Ap.concat("/static/img/gis/openlayers/");parser=new OpenLayers.Format.GeoJSON;proj4326=new OpenLayers.Projection("EPSG:4326");map=new OpenLayers.Map("map",{theme:null});var c=new OpenLayers.Layer.OSM("OpenStreetMap",["http://otile1.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.png"],{attribution:'Tiles Courtesy of <a href="http://open.mapquest.co.uk/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" border="0">'});
map.addLayer(c);var c=new OpenLayers.Style({fillColor:"${fill}",fillOpacity:0.5,strokeColor:"#ffffff",strokeWidth:1,strokeOpacity:1,graphicWidth:14,graphicHeight:14,graphicXOffset:-7,graphicYOffset:-14,graphicOpacity:1,externalGraphic:"${externalGraphic}"},{context:{fill:function(a){return colors[a.attributes.resilience]},externalGraphic:function(a){a=a.attributes.resilience;if(5==a)a="/static/themes/Vulnerability/img/rating5.png";else if(4==a)a="/static/themes/Vulnerability/img/rating4.png";else if(3==
a)a="/static/themes/Vulnerability/img/rating3.png";else if(2==a)a="/static/themes/Vulnerability/img/rating2.png";else if(1==a)a="/static/themes/Vulnerability/img/rating1.png";else return"";return S3.Ap.concat(a)}}}),c=new OpenLayers.StyleMap({"default":c,select:{fillOpacity:1}}),a=[],b,d,f;for(f in gdata)f!=start&&(b=gdata[f],d=parser.read(b,"Geometry"),d.transform(proj4326,map.getProjectionObject()),b=new OpenLayers.Feature.Vector(d,{id:f,level:vdata[f].l,resilience:vdata[f].r}),a.push(b),b=new OpenLayers.Feature.Vector(d.getCentroid(),
{id:f,level:vdata[f].l,resilience:vdata[f].r}),a.push(b));resilienceLayer=new OpenLayers.Layer.Vector("Resilience",{styleMap:c});resilienceLayer.addFeatures(a);map.addLayer(resilienceLayer);resilienceLayer.events.on({featureselected:onResilienceFeatureSelect,featureunselected:onFeatureUnselect});""==start?globalView():v_select_region(0,start);popupControl=new OpenLayers.Control.SelectFeature(resilienceLayer,{toggle:!0,clickout:!0,multiple:!0});map.addControl(popupControl);popupControl.activate()}
function onFeatureUnselect(c){c=c.feature;c.popup&&(map.removePopup(c.popup),c.popup.destroy(),delete c.popup)}
function onResilienceFeatureSelect(c){var c=c.feature,a=c.attributes.id,b=c.attributes.level,d="    <h3>DATA QUALITY:</h3>     <div class='windowQualityRatings'>        <div class='poor'>POOR            <div class='popup'>                <div class='popupContent'>                    <h3>POOR</h3>                    <p>0&ndash;25% of total data reported.</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='fair'>FAIR            <div class='popup'>                <div class='popupContent'>                    <h3>FAIR</h3>                    <p>25&ndash;50% of total data reported.</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='moderate'>MODERATE            <div class='popup'>                <div class='popupContent'>                    <h3>MODERATE</h3>                    <p>50&ndash;75% of total data reported.</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='strong'>STRONG            <div class='popup'>                <div class='popupContent'>                    <h3>STRONG</h3>                    <p>75&ndash;100% of total data reported.</p>                </div>                <div class='popupBottom'></div>            </div>        </div>    </div>",f=
vdata[a];switch(b){case 0:var e=hdata[a],h="Country",i="COUNTRY",g=capitalize(e.l1),j=e.l4,g="            <h3>"+g+"S IN THIS "+i+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>GO TO THE "+g+" <span class='arrow'>&rarr;</span></a>";break;case 1:e=hdata[current_l0];h=e.l1;i=capitalize(h);g=capitalize(e.l2);j=e.l4;g="            <h3>"+g+"S IN THIS "+i+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>GO TO THE "+
g+" <span class='arrow'>&rarr;</span></a>";break;case 2:e=hdata[current_l0];h=e.l2;i=capitalize(h);g=capitalize(e.l3);j=e.l4;g="            <h3>"+g+"S IN THIS "+i+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>GO TO THE "+g+" <span class='arrow'>&rarr;</span></a>";break;case 3:e=hdata[current_l0];h=e.l3;i=capitalize(h);g=capitalize(e.l4);j=e.l4;g="            <h3>"+g+"S IN THIS "+i+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>GO TO THE "+
g+" <span class='arrow'>&rarr;</span></a>";break;case 4:e=hdata[current_l0],h=e.l4,i=capitalize(h),g="",d="<div class='lastCollected'></div>"}var l=f.n,e=f.r;0==e&&(e="");j&&(d+="<div class='subGeoCommunesReported'> out of  "+capitalize(j)+"S Reported</div>");var h="    <section class='infoWindow'>\t\t<div class='infoWindowMain'>\t\t\t<div id='subGeoIndicator'>"+e+"</div>\t\t\t<h2 class='subGeoName'>"+l+"</h2>\t\t\t<h2 class='subGeoType'>"+h+"</h2>\t\t\t<a id='goToRegion' class='goToSubRegion'>GO TO THE "+
i+" <span class='arrow'>&rarr;</span></a>\t\t\t"+d+"\t\t\t<h3 id='population'>POPULATION: </h3>\t\t\t"+g+"\t\t\t<div class='infoWindowButtons'>\t\t\t\t<div class='subGeoSubmitDataButton'>Submit Data</div>\t\t\t\t<div class='subGeoAnalysisButton'>Analysis</div>\t\t\t\t<div class='subGeoReportsButton'>Reports</div>\t\t\t</div>\t\t</div>\t</section>",i=c.geometry.getBounds().getCenterLonLat(),k=new OpenLayers.Popup.FramedCloud(a,i,new OpenLayers.Size(200,200),h,null,!0,closePopups);c.popup=k;map.addPopup(k);
$("#goToRegion").click(function(){v_select_region(b,a)});$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+a),success:function(){for(var c in n)vdata[c]=n[c];n=null;f=vdata[a];if(j){var d=f.c,e=f.t;$(".subGeoCommunesReported").html(d+" out of "+e+" "+j+"s Reported")}d=f.p;null!=d&&$("#population").html("POPULATION: "+d);switch(f.q){case "p":$(".poor").addClass("currentQuality");break;case "f":$(".fair").addClass("currentQuality");break;case "m":$(".moderate").addClass("currentQuality");break;case "s":$(".strong").addClass("currentQuality")}for(c in vdata)if(vdata[c].l==
b+1){switch(vdata[c].r){case 1:d="one";break;case 2:d="two";break;case 3:d="three";break;case 4:d="four";break;case 5:d="five";break;default:d="none"}$(".subGeoSelect").append('<option value="'+c+'" class="'+d+'">'+vdata[c].n+"</option>")}$(".subGeoSelect").selectmenu({style:"popup",maxHeight:280,width:160,menuWidth:160,icons:[{find:".one"},{find:".two"},{find:".three"},{find:".four"},{find:".five"}]});$("#goToSubRegion").click(function(){var a=$(".subGeoSelect").val();v_select_region(b+1,a)});k.updateSize()},
error:function(b,c,d){msg="UNAUTHORIZED"==d?S3.i18n.gis_requires_login:b.responseText;$("#"+a+"_contentDiv").html(msg);k.updateSize()},dataType:"script"});""==e?$("#subGeoIndicator").css("background-color",colors[0]):$("#subGeoIndicator").css("background-color",colors[e])}function closePopups(){for(;map.popups.length;)map.removePopup(map.popups[0])}
function addFeature(c,a){var b,d;for(d in gdata)if(d==a){b=gdata[d];break}if(null!=b){b=parser.read(b,"Geometry");b.transform(proj4326,map.getProjectionObject());features=[];var f=new OpenLayers.Feature.Vector(b,{id:d,level:c,resilience:vdata[d].r});features.push(f);f=new OpenLayers.Feature.Vector(b.getCentroid(),{id:d,level:c,resilience:vdata[d].r});features.push(f);resilienceLayer.addFeatures(features)}}
function removeFeature(c){var a,b=[],d;for(d in resilienceLayer.features){a=resilienceLayer.features[d];try{a.attributes.id==c&&b.push(a)}catch(f){}}resilienceLayer.destroyFeatures(b)}
var addFeatures=function(c){var a=[],b,d,f;for(f in vdata)v=vdata[f],v.f==c&&null!=gdata[f]&&(d=parser.read(gdata[f],"Geometry"),d.transform(proj4326,map.getProjectionObject()),b=new OpenLayers.Feature.Vector(d,{id:f,level:v.l,resilience:v.r}),a.push(b),b=new OpenLayers.Feature.Vector(d.getCentroid(),{id:f,level:v.l,resilience:v.r}),a.push(b));resilienceLayer.addFeatures(a)};
function removeFeatures(c){var a,b=[],d;for(d in resilienceLayer.features){a=resilienceLayer.features[d];try{a.attributes.level>=c&&b.push(a)}catch(f){}}resilienceLayer.destroyFeatures(b)}
var globalView=function(){closePopups();removeFeatures(1);var c=(new OpenLayers.LonLat(80,-50)).transform(proj4326,map.getProjectionObject()),a=(new OpenLayers.LonLat(180,50)).transform(proj4326,map.getProjectionObject());map.zoomToExtent([c.lon,c.lat,a.lon,a.lat]);current_l0&&addFeature(0,current_l0);$("#l0_breadcrumb, #l1_breadcrumb, #l2_breadcrumb, #l3_breadcrumb, #l4_breadcrumb, #l5_breadcrumb, #show-hide, #divider, #analysisLink, #indicator, #risingTab").hide();$(".geoName").html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select a country");
$(".geoType").html("");$(".year").html("");markersOff();current_l3=current_l2=current_l1=current_l0=null},v_select_region=function(c,a){closePopups();switch(c){case 0:current_l0=a;var b=hdata[a],d=vdata[a],f=d.n;$("#l1_breadcrumb, #l2_breadcrumb, #l3_breadcrumb, #l4_breadcrumb, #l5_breadcrumb").hide();$("#l0_breadcrumb").html(" &raquo; "+f).show();$("#geoName").html(f);$(".geoType").html("Country in");$("#l0").val(a);$("#l1, #l2, #l3, #l4, #l5").val("");markersOff();removeFeatures(1);removeFeature(a);
$.ajax({url:S3.Ap.concat("/vulnerability/gdata/"+a+"/1"),success:function(){for(var b in n)gdata[b]=n[b];n=null;addFeatures(a)},error:function(b,c,d){msg="UNAUTHORIZED"==d?S3.i18n.gis_requires_login:b.responseText;$("#"+a+"_contentDiv").html(msg);popup.updateSize()},dataType:"script"});break;case 1:current_l1=a;var b=hdata[current_l0],d=vdata[a],f=vdata[current_l0].n,e=d.n;$("#l2_breadcrumb, #l3_breadcrumb, #l4_breadcrumb, #l5_breadcrumb").hide();$("#l0_breadcrumb").html(" &raquo; "+f).show();$("#l1_breadcrumb").html(" &raquo; "+
e).show();$("#geoName").html(e);f=b.l1;$(".geoType").html(f+" in");$("#l0").val(current_l0);$("#l1").val(a);$("#l2, #l3, #l4, #l5").val("");markersOff();break;case 2:current_l2=a;var b=hdata[current_l0],d=vdata[a],f=vdata[current_l0].n,e=vdata[current_l1].n,h=d.n;$("#l3_breadcrumb, #l4_breadcrumb, #l5_breadcrumb").hide();$("#l0_breadcrumb").html(" &raquo; "+f).show();$("#l1_breadcrumb").html(" &raquo; "+e).show();$("#l2_breadcrumb").html(" &raquo; "+h).show();$("#geoName").html(h);f=b.l2;$(".geoType").html(f+
" in");$("#l0").val(current_l0);$("#l1").val(current_l1);$("#l2").val(a);$("#l3, #l4, #l5").val("");markersOn();break;case 3:current_l3=a;var b=hdata[current_l0],d=vdata[a],f=vdata[current_l0].n,e=vdata[current_l1].n,h=vdata[current_l2].n,i=d.n;$("#l4_breadcrumb, #l5_breadcrumb").hide();$("#l0_breadcrumb").html(" &raquo; "+f).show();$("#l1_breadcrumb").html(" &raquo; "+e).show();$("#l2_breadcrumb").html(" &raquo; "+h).show();$("#l3_breadcrumb").html(" &raquo; "+i).show();$("#geoName").html(i);f=b.l3;
$(".geoType").html(f+" in");$("#l0").val(current_l0);$("#l1").val(current_l1);$("#l2").val(current_l1);$("#l3").val(a);$("#l4, #l5").val("");markersOn()}e=parser.read(gdata[a],"Geometry").getBounds();f=(new OpenLayers.LonLat(e.left,e.bottom)).transform(proj4326,map.getProjectionObject());e=(new OpenLayers.LonLat(e.right,e.top)).transform(proj4326,map.getProjectionObject());map.zoomToExtent([f.lon,f.lat,e.lon,e.lat]);$(".year").html("2012");d=d.r;null==d?($("#indicator").css("background-color",colors[0]),
$("#mainRating").css("background-color",colors[0])):($("#indicator").html(d),$("#mainRating").html(d),$("#indicator").css("background-color",colors[d]),$("#mainRating").css("background-color",colors[d]));$("#show-hide").html('<span class="arrow">&uarr;</span> SHOW MORE').show();$("#divider").show();$("#analysisLink").show();d=S3.Ap.concat("/static/themes/Vulnerability/img/openTabPng8.png");$("#risingTab").css("background-image","url("+d+")").show();current_l1?$("#l1_select").html('<option value="" class="none">Choose '+
b.l1+"</option>"):$("#l1_select").html('<option value="" selected="selected" class="none">Choose '+b.l1+"</option>");current_l2?$("#l2_select").html('<option value="" class="none">Choose '+b.l2+"</option>"):$("#l2_select").html('<option value="" selected="selected" class="none">Choose '+b.l2+"</option>");current_l3?$("#l3_select").html('<option value="" class="none">Choose '+b.l3+"</option>"):$("#l3_select").html('<option value="" selected="selected" class="none">Choose '+b.l3+"</option>");for(var g in vdata){switch(vdata[g].r){case 1:res=
"one";break;case 2:res="two";break;case 3:res="three";break;case 4:res="four";break;case 5:res="five";break;default:res="none"}vdata[g].f==current_l0?$("#l1_select").append('<option value="'+g+'" class="'+res+'">'+vdata[g].n+"</option>"):vdata[g].f==current_l1?$("#l2_select").append('<option value="'+g+'" class="'+res+'">'+vdata[g].n+"</option>"):vdata[g].f==current_l2?$("#l3_select").append('<option value="'+g+'" class="'+res+'">'+vdata[g].n+"</option>"):vdata[g].f==current_l3&&$("#l4_select").append('<option value="'+
g+'" class="'+res+'">'+vdata[g].n+"</option>")}$("#l1 label").html(capitalize(b.l1)+":");$("#l2 label").html(capitalize(b.l2)+":");$("#l3 label").html(capitalize(b.l3)+":");$("#l4 label").html(capitalize(b.l4)+":");switch(c){case 0:$("#l0").val(a);$("#l1, #l2, #l3, #l4, #l5").val("");break;case 1:$("#l0").val(current_l0);$("#l1").val(a);$("#l2, #l3, #l4, #l5").val("");break;case 2:$("#l0").val(current_l0);$("#l1").val(current_l1);$("#l2").val(a);$("#l3, #l4, #l5").val("");break;case 3:$("#l0").val(current_l0),
$("#l1").val(current_l1),$("#l2").val(current_l1),$("#l3").val(a),$("#l4, #l5").val("")}$("#browseOtherRegions select").val(a).selectmenu({style:"popup",maxHeight:280,width:160,menuWidth:160,icons:[{find:".one"},{find:".two"},{find:".three"},{find:".four"},{find:".five"}]});$("#chartSwitcher").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:125,menuWidth:125})},drawerSlide=function(){switch(drawerOpen){case !0:$(".hidden").hide("slow");$("#show-hide").html('<span class="arrow">&uarr;</span> SHOW MORE');
var c=S3.Ap.concat("/static/themes/Vulnerability/img/openTabPng8.png");$("#risingTab").css("background-image","url("+c+")");$(".olPopup").fadeIn(300);drawerOpen=!1;break;case !1:$("#drawerInside").show("slow"),$("#drawerInside").data("fade",setTimeout(function(){$("#resilienceSummary, #drawerQuickActions, #indicatorRatingChart, #browseOtherRegions, #dataBreakdown").fadeIn(500);$(".communeOnly").hide()},500)),$("#show-hide").html('<span class="arrow">&darr;</span> SHOW LESS'),c=S3.Ap.concat("/static/themes/Vulnerability/img/closeTabPng8.png"),
$("#risingTab").css("background-image","url("+c+")"),$(".olPopup").fadeOut(300),drawerOpen=!0}},markersOn=function(){var c=S3.Ap.concat("/static/themes/Vulnerability/img/mapIconOnPng8.png");$("#mapSection").css("background","url("+c+") no-repeat center top transparent");c=S3.Ap.concat("/static/themes/Vulnerability/img/volunteerIconOnPng8.png");$("#volunteerSection").css("background","url("+c+") no-repeat center top transparent");$(".iconSection").css("color","#565656")},markersOff=function(){var c=
S3.Ap.concat("/static/themes/Vulnerability/img/mapIconOffPng8.png");$("#mapSection").css("background","url("+c+") no-repeat center top transparent");c=S3.Ap.concat("/static/themes/Vulnerability/img/volunteerIconOffPng8.png");$("#volunteerSection").css("background","url("+c+") no-repeat center top transparent");$(".iconSection").css("color","#ccc")};function capitalize(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].toUpperCase());return a.join("")};
