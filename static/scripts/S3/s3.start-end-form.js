/**
 * Used by the Forms with start_date and end_dates
 * This script is in Static to allow caching

 * Dynamic constants (e.g. Id(s) of the start_date and end_date selectors) are set in server-generated script
 */

// Module pattern to hide internal vars
(function () {

    var select_start_date,
        select_end_date,
        select_start_date_prev,
        parts;

    var end_date_automate = function() {
        select_start_date = $(start_date_selector).datepicker('getDate');

        // Add the days to the start_date and the prev start_date.
        if (select_start_date_prev != null) {
            select_start_date_prev.setDate(select_start_date_prev.getDate() + add_end_date_days);
        }
        select_start_date.setDate(select_start_date.getDate() + add_end_date_days);

        select_end_date = $(end_date_selector).datepicker('getDate');

        // Check whether end date is generated by script or by user. Avoid updation if updated by user.
        if ((select_end_date == null) || (select_end_date.equalDate(select_start_date_prev))) {
            $(end_date_selector).datepicker('setDate', select_start_date);
        }

        select_start_date_prev = $(start_date_selector).datepicker('getDate');
    };

    Date.prototype.equalDate = function(pDate) {
        return (
            this.getFullYear() === pDate.getFullYear() &&
            this.getMonth() === pDate.getMonth() &&
            this.getDate() === pDate.getDate()
        );
    }

    $(document).ready(function() {
        // Checks if function is valid, else returns.
        if ((typeof end_date_selector != "undefined") && (typeof start_date_selector != "undefined")) {
            select_end_date = $(end_date_selector).datepicker('getDate');

            // Store the prev start_date before change to check whether the end date was generated by script or by user.
            select_start_date_prev = $(start_date_selector).datepicker('getDate');

            // Checks if Expiry Date is already Set or not. If it is, Then disables updation based on start date.
            if (select_end_date == null) {
                if(select_start_date_prev != null) {
                    end_date_automate();
                }
                $(start_date_selector).change(end_date_automate);
            }
        } else {
            return;
        }
    });

}());
// END ========================================================================
