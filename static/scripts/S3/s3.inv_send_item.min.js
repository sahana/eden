$(document).ready(function(){var A=$("#inv_track_item_send_inv_item_id");if(A.length){var r=$("#inv_track_item_item_pack_id"),l=$("#inv_track_item_quantity"),J=$("#inv_track_item_req_item_id__row"),t=A.val(),h;J.length&&J.hide();A.on("change.s3",function(w,f){var n=A.val(),x;r.html("");f||l.val("");$("#TotalQuantity").remove();if(""!==n){w=$(this).attr("id");try{S3.JSONRequest[w].abort()}catch(b){}f=S3.supply.inv_items;if(void 0===f){0===$("#item_pack_throbber").length&&r.after('<div id="item_pack-throbber" class="throbber"/>');
var u=S3.Ap.concat("/inv/inv_item_quantity.json/"+n);S3.JSONRequest[w]=$.getJSON(u,function(b){var k=$("#quantity__error"),p=!0,e,K=b.quantity,B=b.packs,C=B.length,v;for(e=0;e<C;e++){var c=B[e];if(1==c.quantity){var P=c.name;break}}for(e=0;e<C;e++){c=B[e];if(D&&t==n&&D==c.id){var y=x=c.quantity;var E=c.name;b=" selected"}else p?(y=c.quantity,E=c.name,b=" selected"):b="";b=1!==c.quantity?'<option value="'+c.id+'"'+b+">"+c.name+" ("+c.quantity+" x "+P+")</option>":'<option value="'+c.id+'"'+b+">"+c.name+
"</option>";r.append(b);p=!1}$("#item_pack-throbber").remove();if(k.length)for(k=k.html().split(" "),e=0;e<k.length&&!(v=parseFloat(k[e]));e++);else v=K/y,h&&t==n&&(v+=h*x/y);k='<span id="TotalQuantity"> / '+v.toFixed(2)+" "+E+" ("+i18n.in_inv+")</span>";l.after(k);if(1<C){var L;r.on("change",function(){L=parseInt(r.val());for(e=0;e<C;e++)if(c=B[e],c.id==L){y=c.quantity;E=c.name;v=K/y;h&&t==n&&(v+=h*x/y);$("#TotalQuantity").html(v.toFixed(2)+" "+E+" ("+i18n.in_inv+")");break}})}})}else{f=f[n];w=$("#quantity__error");
var F=!0,a,G=f.packs,H=G.length,z=f.req_items,m=z[0],M=m.inv_quantity;for(a=0;a<H;a++){var d=G[a];if(1==d.quantity){u=d.name;break}}for(a=0;a<H;a++){d=G[a];if(D&&t==n&&D==d.id){var q=x=d.quantity;var I=d.name;f=" selected"}else F?(q=d.quantity,I=d.name,f=" selected"):f="";f=1!==d.quantity?'<option value="'+d.id+'"'+f+">"+d.name+" ("+d.quantity+" x "+u+")</option>":'<option value="'+d.id+'"'+f+">"+d.name+"</option>";r.append(f);F=!1}if(w.length)for(u=w.html().split(" "),a=0;a<u.length&&!(g=parseFloat(u[a]));a++);
else{var g=M/q;h&&t==n&&(g+=h*x/q)}u='<span id="TotalQuantity"> / '+g.toFixed(2)+" "+I+" ("+i18n.in_inv+")</span>";l.after(u);var N=function(){if(1==z.length){if(!h||t!=n){var b=m.req_quantity/q;b<=g?l.val(b):l.val(g)}$("#inv_track_item_req_item_id").val(m.req_item_id)}else{J.show();var k=$("#inv_track_item_req_item_id"),p=k.val();p&&(p=parseInt(p));k.html("");for(a=0;a<z.length;a++)m=z[a],k.append(new Option(m.req_ref,m.req_item_id)),p?m.req_item_id!=p||h&&t==n||(b=m.req_quantity/q,b<=g?l.val(b):
l.val(g)):F&&(b=m.req_quantity/q,b<=g?l.val(b):l.val(g)),F=!1;k.on("change",function(){p=parseInt(k.val());for(a=0;a<z.length;a++)if(m=z[a],m.req_item_id==p){b=m.req_quantity/q;b<=g?l.val(b):l.val(g);break}})}};N();if(1<H){var O;r.on("change",function(){O=parseInt(r.val());for(a=0;a<H;a++)if(d=G[a],d.id==O){q=d.quantity;I=d.name;g=M/q;h&&t==n&&(g+=h*x/q);$("#TotalQuantity").html(g.toFixed(2)+" "+I+" ("+i18n.in_inv+")");N();break}})}}}});if(t){(h=l.val())&&(h=parseFloat(h));var D=parseInt(r.val());
A.trigger("change.s3",!0)}}});
